Admin Console
=============

Панель администратора для сервера ОМЕГА К100

Release Notes
-------------

# v1.1.8
*Август 08, 2023*

**Необходимые версии:**
* Сервер >= 2.0.2.4
* Диспетчер >= 2.1.3
* Моб. клиент >= 2.1.5

**Обновлено**
* OC-55 Убрать меню открываемое с ПКМ в Пользователи/Группы

**Исправлено**
* BF Кнопка удалить группу теперь неактивна при загрузке приложения до выбора группы
* BF OC-53 Текстовые изменения
* BF OC-56 Текстовые изменения в панели администратора - 5 ЧАСТИЧНО!
* BF OC-57 При смене имени на существующее пытается применить изменения. Поправил этот случай и все другие при изменении пользователя и группы
* BF OC-45 Поп-ап, открывающийся после ПКМ по группе/пользователю, не закрывается
* Запрещаем кириллицу при вводе логина на окне авторизации (на AL падает)

**Новое**
* Новый механизм аутентификации пользователя admin с динамически генерируемым паролем при выключенном сервере
  + При установке сервера генерируется случайный пароль, копируем хэш в скрытый файлик
  + При выключенном сервере и попытке локального входа с admin сравниваем хэш введённого пароля с хэшем в файле
  + При смене пароля admin перехешируем файл
  + Работает как локально, так и через сеть
  + Обфускация кода никак не влияет (раньше хардкодился кеш сгенерированного пароля при установке системы в программу)

**TODO**


# v1.1.7
*Июнь 27, 2023*

**Необходимые версии:**
* Сервер >= 2.0.2.4
* Диспетчер >= 2.1.3
* Моб. клиент >= 2.1.5

**Обновлено**
* Уровень логгера для ssh paramiko установил в warning, чтобы не вывалил всё в лог
* При запуске приложения и при выборе в меню - Установить лицензию смотрим фидбек сервера в файле Omega/.licenseState на сервере и пишем в лог состояние
  + 6 - нет файла Omega/generated.lic
  + 7 - нет файла Omega/keys/pub.pem
  + 8 - лицензия не валидна
  + 9 - не получить дату окончания лицензии
  + 10 - лицензия просрочена
  + 11 - Количество пользователей в лицензии = 0
  + Любое другое число - Неизвестное состояние лицензии
* Перерисовал иконки
* Добавил в настройки глубину лога (по умолчанию, 1000 строк) - критично для AstraLinux

**Исправлено**
* BF: Если сделать поиск по конкретному пользователю/группе и удалить его, то цвет поиска не изменится
* BF: Если сделать пустой поиск и добавить пользователя/группу, то цвет поиска не изменится
* BF: После разблокировки, иконка остается разблокирования, а подпись заблокировать

**Новое**
* Добавил Статус бар со сроком окончания лицензии. Меняет цвет на красный, если время окончания лицензии <= 30 дней. В противном случае - зелёный.
* Добавил лог при запуске о количестве дней до окончания лицензии
* Обновляю информацию при загрузке новой лицензии
* Добавил типы для логов сервера

**TODO**

# v1.1.6
*Июнь 20, 2023*

**Необходимые версии:**
* Сервер >= 2.0.2.4
* Диспетчер >= 2.1.3
* Моб. клиент >= 2.1.5

**Обновлено**
* Переделал UI/UX в Пользователях и группах
* Фокус на OK в поп-ап окне (Enter и пробел закрывает окно)
* заменил кнопки с текстом на кнопки с иконками во вкладке Пользователи (Добавить/Изменить/Клонировать/Заблокировать/Удалить/Применить)
* заменил кнопки с текстом на кнопки с иконками во вкладке Группы (Добавить/Изменить/Заблокировать/Удалить/Применить)
* Пользователя admin нельзя удалить
* Добавил правильное поведение при выборе пользователя стрелками вверх/вниз на клавиатуре
* убрал фрейм со свободным местом сервера и кнопками
* Перенёс функционал кнопок по Удалению БД частично и полностью в Меню приложения
* Поменял символы Юникода для совместимости с AstraLinux

**Исправлено**
* BF при отсутствии git некорректно загружал основное окно

**Новое**
* Добавил кнопку сброса фильтра в Пользователях и группах
* Фильтр пользователей ищет по логину и имени пользователя. Поиск регистронезависимый
* Фильтр групп ищет по имени и описанию группы. Поиск регистронезависимый
* Добавил выделение цветом текста в фильтре: голубым, если есть результат, красным, если нет
* Кнопки недоступны при невыбранном пользователе/группе, кроме Добавить
* Кнопка Заблокировать меняется на Разблокировать в зависимости от текущего состояния пользователя/группы
* Добавил в статус бар информацию о свободном месте на сервере
* Переработал вкладку журнал. Теперь там 2 вкладки - Локальный (старый журнал приложения) и Сервер (Лог сервера)
* Лог сервера копируется на локальную машину, добавляются порядковые номера событий в строку
* Добавляется номер событию в строку локального лога
* файл локального лога можно скачать с помощью новой кнопки. При этом если отфильтровать лог и выбрать различные типы событий, то сохранится отфильтрованный лог. Имя лога включает текущие Дату и Время
* файл лога сервера можно скачать с помощью новой кнопки. При этом если отфильтровать лог, то сохранится отфильтрованный лог. Имя лога включает текущие Дату и Время
* Локальный файл лога обновляется автоматически по нажатию на вкладку Локального лога
* Файл лога сервера скачивается по нажатию на вкладку серверного лога в первый раз
* Обновление серверного лога можно запросить по нажатию на новую кнопку Обновить 


**TODO**


# v1.1.5
*Июнь 2, 2023*

**Необходимые версии:**
* Сервер >= 2.0.2.4
* Диспетчер >= 2.1.3
* Моб. клиент >= 2.1.5

**Обновлено**
* обновление поведения кнопок в окне лицензирования (OC-51)
* изменение текста в окне лицензирования (OC-52)
* Текстовые изменения в панели администратора (OC-53)
**Исправлено**

**Новое**
* Панель с онлайн пользователями можно скрыть

**TODO**


# v1.1.3
*Май 31, 2023*

**Необходимые версии:**
* Сервер >= 2.0.0
* Диспетчер >=2.0.1
* Моб. клиент >= 2.1.3

**Обновлено**
* Валидация логина (буквы, цифры, -, _) при создании, клонировании пользователя
* Валидация имени пользователя, имени группы, описания группы (буквы, цифры, -, _, пробел) при создании, изменении, клонировании пользователя, создания и изменения группы

**Исправлено**
* отключена возможность вызова контекстного меню в пользователях и группах, если сервер оффлайн (ОС-47)
* Изменения в тексте уведомлений (ОС-46)
* bug fix (OC-49) Обработана возможность нажать ПКМ в Пользователях и Группах внизу списка (без выбора пользователя/группы), что приводило к некорректном вызове контекстного меню
* не отображаем журнал событий, если не выбран ни один чекбокс серьёзности уведомления

**Новое**
* добавил модуль для работы с ssh paramiko~=3.1.0 в requirements.txt
* В заголовке указываем текущую ветку, если сможем её получить. Нужно для разработки. в проде не отображается
* Старт сервера удалённо (по ssh)
* При стопе сервера локально пытаемся остановить через get запрос к серверу. Если по каким-то причинам этого 
не происходит, то через 10 секунд предлагаем остановить сервис принудительно через systemctl
* Можем получить id удалённого сервера по ssh
* Можем удалённо загрузить лицензию. Файл лицензии должен быть с расширением .lic в любом месте системы. 
После валидации файл копируется в папку $HOME/Omega/generated.lic
* Добавил кнопку Перезагрузить в окне загрузки лицензии
* При выборе лицензии происходит её валидация и отображение содержимого самой лицензии. После этого становится доступна 
возможность её установки на сервер.
* Также после установки новой лицензии доступна кнопка перезагрузки сервера, чтобы лицензия применилась
* Также становится доступной кнопка просмотра текущей лицензии (Кнопка Текущая лицензия) при установке новой лицензии, но до перезагрузки сервера. 
При этом кнопка меняет своё название на Новая лицензия, которая позволяет увидеть содержимое новой лицензии
* Возможность загрузки публичного ключа сервера для проверки лицензии (если лицензия выпущена с использованием другого закрытого ключа сервера)
* Копия открытого ключа сервера (в составе дистрибутва) хранится в папке приложения и при необходимости может быть восстановлен
**TODO**



# v1.1.0
*Апрель 6, 2023*

**Необходимые версии:**
* Сервер >= 2.0.0
* Диспетчер >=2.0.1
* Моб. клиент >= 2.1.3

**Обновлено**
* добавил человеческие названия лицензиям
* разрешил менять таймаут тонального вызова

**Исправлено**
* модальное окно для загрузки лицензий
* tonalTimeout -> finalizeTonalTimeout в установке времени тонального вызова
* Обернул все запросы к серверу в try - except
* BF неправильно уведомления при остановке сервера по кнопке Стоп
* BF неправильно отображались даты лицензии для фич при загрузке лицензии
* Поправил роли по умолчанию, предлагаемые при изменении существующего пользователя
* Округление свободно места до сотых Гб
* fix при загрузке новой лицензии, если старая истекла
* OS-98 поменял Создать на Добавить в окне добавления пользователя и группы

**Новое**

**TODO**


# СПЕЦ требования СТИС v1.0.8
*Январь 23, 2023*

**Необходимые версии:**
* Сервер >=1.7.0
* Диспетчер >=1.6.9
* Моб. клиент >= 1.1.24

**Обновлено**
* отключил кнопку Загрузить лицензию, если не выбран файл
* отключил возможность загружать лицензию и получать id сервера удалённо (если ip не 127.0.0.1)
* Добавил уведомление при попытке старта сервера не локально

**Исправлено**
* BF починил фильтры
* BF При запуске сервера с админки, данные отображаются только после следующего пинга
* BF Клонируем с учётом ролей

**TODO**
* Обернуть все запросы к серверу в try - except


# СПЕЦ требования СТИС v1.0.7
*Январь 20, 2023*

**Необходимые версии:**
* Сервер >=1.7.0
* Диспетчер >=1.6.9
* Моб. клиент >= 1.1.24

**Новое**
* скрипт установки для 1,7 -- добавление хэша пароля в код админки для логина офлайн + бэкдорный пользователь - работает с сервером >=1.6.2
* Добавил роль -- разрешение индивидуальных сообщений в добавлении и изменении пользователя
* Добавил в настройки количество дней для автоматической очистки сервера
* Добавил получение machine-id на linux, необходимый для генерации лицензии
* запрашиваем лицензию с сервера при заходе в меню Установить лицензию
* Проверка установки новой лицензии, разбор состава, добавление в таблицу, информируем сервер
 
**Обновлено**
* В окне авторизации кнопка Войти теперь реагирует на enter
* Уменьшил высоту приложения
* убрал попап при запуске сервера локально - мешал корректному отображение данных от сервера
* СТОП сервера через REST API

**Исправлено**
* BF при клонировании создавал юзера, даже если поля не прошли валидацию
* BF не дисэйблить кнопки Применить при получении очередного пинга от сервера

**TODO**
* Клонируется без учёта ролей 
* Пока отключил фильтры. Надо переделать.
* При запуске сервера с админки, данные отображаются только после следующего пинга


# СПЕЦ требования СТИС v1.0.4
*Январь 9, 2023*

**Новое**

**Обновлено**
* Переработка добавления пользователя
* Скрипт ALSE 1.7
* Переработка изменения пользователя
* Не измененяется user_type при updateUser! Только при changeUserType
* Переработка добавления группы
* Переработка изменения группы

**Известные баги**
* Не измененяется user_type при updateUser! Только при changeUserType


# СПЕЦ требования СТИС v1.0.2
*Декабрь 29, 2022*

**Новое**
* процент свободного места на сервере и количество в Гб на вкладке пользователи
* Блокировка/разблокировка пользователей

**Обновлено**
* Добавление в диспетчеры через UserType


# СПЕЦ требования СТИС v1.0.1
*Декабрь 27, 2022*

**Новое**
* при изменении пользователя (диспетчера) добавил чекбокс для разрешения удаления данных БД (всё, кроме учётных данных)

# СПЕЦ требования СТИС v1.0

*Декабрь 22, 2022*

**Новое**
* при изменении пользователя (диспетчера) добавил чекбокс для разрешения удаления чатов диспетчеру
* при изменении существующей группы добавил кнопку `удалить чат`


# 1.0.4

*Unreleased*

**Новое**
* добавил выбор https на окне логина
* отображение выбора https в заголовке окна
* http/https URL при выборе чекбокса
* Получение/изменение общих настроек (Таймауты: инд. вызов, гр. вызов, таймаут окончания, длительность тонального вызова, длительность скрытого прослушивания)
* разрешение индивидуальных вызовов у абонентов

**Исправлено**
* убрал пароль в открытом виде в коде
* небольшой рефакторинг


**Обновлено**

**Известные баги**



# 1.0.3

*Ноябрь 29, 2022*

**Новое**
* переделал роли и тип пользователей согласно К100 -- 1.2.3
* Добавил в БД отключённую группу.

**Исправлено**
* BF при изменении описания группы не отображалась галка у экстренных

**Известные баги**
* Не работает изменение пользователя


# 1.0.2

*Ноябрь 14, 2022*

**Новое**

* Добавлен checkbox для добавления ВСЕХ групп у пользователей и ВСЕХ пользователей для групп
* Новые меню: `Установка лицензии` и `Настройки`
* Получение id на windows, возможность выбрать файл лицензии, таблица с функциями из файла лицензии (пока только сама таблица без логики)
* Меню настроек с параметрами. Пока без синхронизации с сервером
* Добавил прогресс бар в качестве заглушки для применения настроек на сервере
* Добавил Таймаут вызова для каждого пользователя, возможность запрета индивидуальных вызовов, 
Порты подключения и аудиопорты, таймауты системы. К логике и БД не привязано
* Добавил столбец `Блок` у пользователей
* Добавил чекбокс блокировки пользователя. Без взаимодействия с сервером
* При изменении пользователя меняется цвет кнопки при изменении данных.

**Исправлено**

* фокус на apply при выборе строки в дереве
* Убрал имя первого столбца в tree
* оптимизация формирования окна `изменить` [пользователя|группы], устанавливая правильный чекбокс без дублирования кода
* Изменил механизм формирования списка для отображения пользователей
Если данные в итоге не изменились, кнопка обратно не перекрашиваетя
* disabled пункты меню Настройка и установка лицензии при недоступности сервера
* фикс поведения отключения элементов при отключении от сервера (threading) и включении

**Обновлено**

* обновлен update скрипт для работы с флагами
* цвет кнопки `показать пароль` [создать, изменить, клонировать] пользователя
* цвет выделенных строк
* в дереве в фрейме группы во вкладке пользователи первый столбец = 5 для симметрии эмуляции чекбокса
* Уменьшена высота приложения на 100 px
* ширина квадрата эмуляции чекбокса в tree = 1 вместо 2
* размер чекбокса в tree (16, 16) -> (12, 12)
* Цвет прогрессбара в цвет статус бара
* Перекрашивание disabled кнопок в grey




# 1.0.1

*Ноябрь 7, 2022*

**Новое**

* добавлена информация об экстренности группы на вкладке Группы
* сделан update скрипт для обновления сервера

**Исправлено**

* рефакторинг
* исправлено клонирование пользователя с учётом роли диспетчера

**Обновлено**

* 
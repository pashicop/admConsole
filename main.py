import copy
import hashlib
import base64
import json
import os
import platform
import socket
import subprocess
import threading
import urllib.parse
from gc import enable
from time import sleep
from time import strftime, localtime
import paramiko
import requests
from pathlib import Path
import sqlite3
import PySimpleGUI as sg
from io import BytesIO
from PIL import Image, ImageDraw
import ipaddress
import logging
import sys
from enum import Enum
import re
from datetime import date, datetime

PATH_CONFIG = Path(Path.cwd(), 'config')
PATH_LOG = Path(Path.cwd(), 'logs')
DEFAULT_BASE64_LOADING_GIF = b'R0lGODlhQABAAKUAAAQCBJyenERCRNTS1CQiJGRmZLS2tPTy9DQyNHR2dAwODKyqrFRSVNze3GxubMzKzPz6/Dw6PAwKDKSmpExKTNza3CwqLLy+vHx+fBQWFLSytAQGBKSipERGRNTW1CQmJGxqbLy6vPT29DQ2NHx6fBQSFKyurFRWVOTi5HRydPz+/Dw+PP7+/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQAsACwAAAAAQABAAAAG/kCWcEgsGo/IpHLJbDqf0CjxwEmkJgepdrvIAL6A0mJLdi7AaMC4zD4eSmlwKduuCwNxdMDOfEw4D0oOeWAOfEkmBGgEJkgphF8ph0cYhCRHeJB7SCgJAgIJKFpnkGtTCoQKdEYGEmgSBlEqipAEEEakcROcqGkSok8PkGCBRhNwcrtICYQJUJnDm0YHASkpAatHK4Qrz8Nf0mTbed3B3wDFZY95kk8QtIS2bQ29r8BPE8PKbRquYBuxpJCwdKhBghUrQpFZAA8AgX2T7DwIACiixYsYM2rc+OSAhwrZOEa5QGHDlw0dLoiEAqEAoQK3VjJxCQmEzCUhzgXciOKE/gIFJ+4NEXBOAEcPyL6UqEBExLkvIjYyiMOAyICnAAZs9IdGgVWsWjWaTON1yAGsUTVOTUOhyLhh5TQi7cqUyIVzKjmiYCBBQtAjNAnZvKmk5cuYhJVc6DAWZd7ETTx6CAm5suXLRQY4sPDTQoqwmIlAADE2DYi0oUUQhbQC8WUQ5wZf9oDVA58KdaPAflqgTgMEXxA0iPIB64c6I9AgiFL624Y2FeLkbtJ82HM2tNPYfmLBOHLlUQJ/6z0POADhUa4+3V7HA/vw58gfEaFBA+qMIt6Su9/UPAL+F4mwWxwwJZGLGitp9kFfHzgAGhIHmhKaESIkB8AIrk1YBAQmDJiQoYYghijiiFAEAQAh+QQJCQApACwAAAAAQABAAIUEAgSEgoREQkTU0tRkYmQ0MjSkpqTs6ux0cnQUEhSMjozc3ty0trT09vRUUlRsamw8OjwMCgxMSkx8fnwcGhyUlpTk5uS8vrz8/vwEBgSMioxERkTc2txkZmQ0NjS0srT08vR0dnQUFhSUkpTk4uS8urz8+vxsbmw8Pjz+/v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCUcEgsGo/IpHLJbDqf0Kh0Sl0aPACAx1DtOh/ZMODhLSMNYjHXzBZi01lPm42BizHz5CAk2YQGSSYZdll4eUUYCHAhJkhvcAWHRiGECGeEa0gNAR4QEw1TA4RZgEcdcB1KBwViBQdSiqOWZ6wABZlIE3ATUhujAAJsj2FyUQK/wWbDcVInvydsumm8UaKjpWWrra+whNBtDRMeHp9UJs5pJ4aSXgMnGxsI2Oz09fb3+Pn6+/xEJh8KRjBo1M/JiARiEowoyIQAIQIMk1T4tXAfBw6aEI5KAArfgjcFFhj58CsLg3zDIhXRUBKABnwc4GAkoqDly3vWxMxLQbLk/kl8tbKoJAJCIyGO+RbUCnlkxC8F/DjsLOLQDsSISRREEBMBKlYlDRgoUMCg49ezaNOqVQJCqtm1Qy5IGAQgw4YLcFOYOGWnA8G0fAmRSVui5c+zx0omM2NBgwYLUhq0zPKWSIMFHCojsUAhiwjIUHKWnPpBAF27H5YEEBOg2mQA80A4ICQBRBJpWVpDAfHabAMUv1BoFkJChGcSUoCXREGEUslZRxoHAB3lQku8Qg7Q/ZWB26HAdgYLmTi5Aru9hPwSqdryKrsLG07fNTJ7soN7IAZwsH2EfUn3ETk1WUVYWbDdKBlQh1Usv0D3VQPLpOHBcAyBIAFt/K31AQrbBqGQWhtBAAAh+QQJCQAyACwAAAAAQABAAIUEAgSEgoTEwsREQkTk4uQsLiykoqRkYmQUEhTU0tRUUlT08vS0srSMjox8enwMCgzMysw8OjwcGhxcWlz8+vy8urxMSkzs6uysqqxsamzc2tyUlpQEBgSMiozExsTk5uQ0NjSkpqRkZmQUFhRUVlT09vS0trSUkpR8fnwMDgzMzsw8PjwcHhxcXlz8/vy8vrxMTkzc3tz+/v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCZcEgsGo/IpHLJbDqf0Kh0Sq1ar8nEgMOxqLBgZCIFKAMeibB6aDGbB2u1i+Muc1xxJSWmoSwpdHUcfnlGJSgIZSkoJUptdXCFRRQrdQArhEcqD24PX0wUmVMOlmUOSiqPXkwLLQ8PLQtTFCOlAAiiVyRuJFMatmVpYIB1jVEJwADCWCWBdsZQtLa4artmvaO2p2oXrhyxVCWVdSvQahR4ViUOZAApDuaSVhQaGvHy+Pn6+/z9/v8AAzrxICJCBBEeBII6YOnAPYVDWthqAfGIgGQC/H3o0OEDEonAKPL7IKHMCI9GQCQD0S+AmwBHVAJjyQ/FyyMgJ/YjUAvA/ggCFjFqDNAxSc46IitOOlqmRS6lQwSIABHhwAuoWLNq3cq1ogcHLVqgyFiFAoMGJ0w8teJBphsQCaWcaFcGwYkwITiV4hAiCsNSB7B4cLYXwpMNye5WcVEgWZkC6ZaUSAQMwUMnFRybqdCEgWYTVUhpBrBtSQfNHZC48BDCgIfIRKxpxrakAWojLjaUNCNhA2wZsh3TVuLZMWgiJRTYgiFKtObSShbQLZUinohkIohkHs25yYnERVRo/iSDQmPHBdYi+Wsp6ZDrjrNH1Uz2SYPpKRocOZ+sQJEQhLnBgQFTlHBWAyZcxoJmEhjRliVw4cMfMP4ZQYEADpDQggMvJ/yWB3zYYQWBZnFBxV4p8mFVAgzLqacQBSf0ZNIJLla0mgGu1ThFEAAh+QQJCQAqACwAAAAAQABAAIUEAgSUkpRERkTMyswkIiTs6uy0trRkZmQ0MjTU1tQcGhykpqRUVlT09vTEwsQsKix8enwMCgycnpzU0tS8vrw8Ojzc3txcXlz8/vwEBgSUlpRMSkzMzswkJiT08vS8urxsamw0NjTc2twcHhysqqz8+vzExsQsLix8fnxkYmT+/v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCVcEgsGo/IpHLJbDqf0Kh0Sq1ar8tEAstdWk4AwMnSLRfBYbF5nUint+tu2w2Ax5OFghMdPt2TBg9hDwZMImgnIn9HH3QAhUxaTw0LCw1WHY4dax6CAA8eVAWOYXplEm4SoqQApl2oaapUmXSbZgW0HaFUBo6QZpQLu1UGub+LWHnIy8zNzs/Q0dLTzSYQFxcoDtRMAwiOCCZJDRwDl88kGawZC0YlEOoAGRDnywPx6wNEHnxpJ8N/SvRjdaLEkAOsDiyjwMrRByEe8NHJADAOhIZ0IAgZgFHcIgYY3TAQYqIjMpAhw4xUEXFdxTUXUwLQKAQhKYXIGsl8CHGg/piXa0p4wvgAA5EG8MLMq4esZEiPRRoMMMGU2QKJbthxQ2LiG51wW5NgcACBwQUIFIyGXcu2bdgGGjZ06LBBQ1UoJg5UqHAAKhcTBByN8OukRApHKe5OcYA1TQbCTC6wuoClQeCGIxQjcYBxm5UAKQM8kdyQshUBKQU8CYERwZURKUc88crKNZIJZRlAmIAEdkjZTkhPPtLAppsDd1GHVO2Ec0PPREoodyTAIBHQIUWPHm5EA0btQxoowKgAaJISwtNcsF7ENyvgRCg0Vgq5iYMDISqkoIDEQkoyRZjgXhojQHcHRyHpYwRcAhBAgAB2LeNfSACyNaBgbqngXUPgGLElHSvVZahCA4fRcYFma3GQGwQciAhNEAAh+QQJCQAwACwAAAAAQABAAIUEAgSEgoTEwsRERkTk4uQkIiSkpqRsamwUEhTU0tT08vSUkpRUUlQ0MjS0trQMCgzMyszs6ux8enwcGhzc2tz8+vyMioxMTkysrqw8OjwEBgSEhoTExsRMSkzk5uQkJiSsqqxsbmwUFhTU1tT09vSUlpRUVlQ0NjS8vrwMDgzMzszs7ux8fnwcHhzc3tz8/vz+/v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCYcEgsGo/IpHLJbDqf0Kh0Sq1ar9hs1sNiebRgowsBACBczJcKA1K9wkxWucxSVgKTOUC0qcCTcnN1SBEnenoZX39iZAApaEcVhod6J35SFSgoJE4EXYpHFpSUAVIqBWUFKlkVIqOHIpdOJHlzE5xXEK+UHFAClChYBruHBlAowMLEesZPtHoiuFa6y2W9UBAtZS2rWK3VsVIkmtJYosuDi1Ekk68n5epPhe4R8VR3rnN8svZTLxAg2vDrR7CgwYMItZAo0eHDhw4l4CVMwgHVoRbXjrygMOLNQQEaXmnISARErQnNCFbQtqsFPBCUUtpbUG0BkRe19EzwaG9A/rUBREa8GkHQIrEWRCgMJcjyKJFvsHjG87kMaMmYBWkus1nEwEmZ9p7tmqBA44gRA/uhCDlq5MQlHJrOaSHgLZOFAwoUGBDRrt+/gAMLhkMiwYiyV0iogCARCwUTbDWYoHBPQmQJjak4eEDpgQMpKxpQarAiCwXOox4QhXLg1YEsDIgxgKKALSUNiKvUXpb5CLVXJKeoqNatCQdiwY2QyH0kAfEnu9syJ0Jiw4dUGxorqNb7SOtRr4+saDeH9BETsqOEHl36yIVXF46MQN15NRQSlstowIzk+K7kMGzW2WdUKAABB90FQEwp8l1g2wX2xfOda0oolkB3YWyw4GBCIfgHHIdCvDdKByAKsd4h5pUIAwkBsNRCdioWoUB7MRoUBAAh+QQJCQAuACwAAAAAQABAAIUEAgSEhoTMzsxMSkykpqQcHhz08vRkYmQUEhSUlpS0trTc3twsLixsbmwMCgzU1tSsrqz8+vycnpyMjoxUUlQkJiRsamwcGhy8vrw0NjR0dnQEBgTU0tSsqqz09vRkZmQUFhScmpy8urzk5uQ0MjR0cnQMDgzc2ty0srT8/vykoqSUkpRUVlQsKiz+/v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCXcEgsGo8RRWlAaSgix6h0Sp2KKoCstiKqer/fkHasTYDP6KFoQ25303BqBNsmV6DxvBFSr0P0gEMNfW0WgYEDhGQDRwsTFhYTC4dTiYpajEQeB2xjBx6URxaXWoZDHiR9JKChRHykAH9DB4oHcQIlJQJRc6R3Qwukk2gcnRscUSKkb0ITpBNpo6VSCZ11ZkS0l7Zo0lmmUQp0YxUKRtq1aQLGyFNJDUxOeEXOl9DqDbqhJ6QnrYDo6nD7l8cDgz4MWBHMYyBglgMGFh46MeHDhwn+JGrcyLGjx48gO3rg8CBiSDQnWBhjkfFkFQUO2jgwF8UACgUmPz6IWcfB/oMjGBBkQYABJAVFFIwYMDEGQc6NBqz1USjk1RhZHAWQ2kUERRsUHrVe4jpk6RgTTzV6IEVVCAamAEwU/XiUUNIjNlGk5bizj0+XVGDKpAl4yoO6WSj8LOzFgwAObRlLnky5suXLEg2o0FCCwF40KU48SEGwg1AtCDrk6XAhywUCrTr0UZ1GNhnYhwycbuMUdGsyF0gHkqBIApoHfRYDKqGoAcrkhzQoKoEmAog2IIRHSSEiQAAR84wQJ2Qcje0xuKOcaDGmhfIiZuughUPg9+spI66TATEiyvnbeaTwwAPhidLHB1IQsBsACKS3kX7YTWGABLlI8BlBEShSIGUQIO6HmRDekIHgh/lh19+HLjzA3hbvfZiEdwpoh+KMjAUBACH5BAkJACYALAAAAABAAEAAhQQCBISGhMzKzERCRDQyNKSmpOzq7GRiZBQSFHRydJyanNTW1LS2tPz6/Dw6PAwODLSytPTy9GxubBweHHx6fKSipNze3AQGBIyKjMzOzExOTDQ2NKyqrOzu7GRmZBQWFHR2dJyenNza3Ly+vPz+/Dw+PP7+/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJNwSCwaj8ikcslsmjoYx+fjwHSc2KyS8QF4vwiGdjxmXL5or5jMXnYQ6TTi2q4bA/F4wM60UDZTGxQWRw55aRt8SSQUhyAkRQ+HaA+KRw0akwAaDUSSmgCVRg0hA1MDCp1ZIKAACUQbrYlFBrGIBlgirV4LQ3ige0QNtnEbqkwSuwASQ2+aD3RDCpoKTgTKBEQMmmtEhpMlTp+tokMMcGkP3UToh+VL46DvQh0BGwgIGwHRkc/W2HW+HQrXJNkuZm2mTarWZIGyXm2GHTKGhRWoV3ZqFcOFBZMmTooaKCiBr0SqMQ0sxgFxzJIiESAI4CMAQoTLmzhz6tzJs6f+z59Ah0SoACJBgQhByXDoAoZD0iwcDjlFIuDAAQFPOzCNM+dIhjMALmRIGkJTiCMe0BxIavAQwiIH1CZNoAljka9exJI1iySDVaxJneV5gPQpk6h5Chh2UqAdAASKFzvpEKJoCH6SM2vezLmz58+gQ7fhsOHCBQeR20SAwKDwzbZf3o4ZgQ7BiJsFDqXOEiFeV0sCEZGBEGcqHxKaIGkhngaCJRJg41xQnkWwF8IuiQknM+LTg9tMBAQIADhJ7sRtOrDGfIRE3C8HWhqB7UV2Twx6lhQofWHDbp8TxDGBaEIgl4d8nwWYxoAEmvALGsEQ6J5aCIYmHnkNZqghgUEBAAAh+QQJCQAnACwAAAAAQABAAIUEAgSEgoRERkTEwsTk4uRkYmQ0MjQUFhRUVlTU1tT08vSkpqQMCgxMTkzMysxsbmz8+vzs6uwcHhxcXlzc3tysrqwEBgSEhoRMSkzExsRkZmQ8OjwcGhxcWlzc2tz09vSsqqwMDgxUUlTMzsx0dnT8/vzs7uz+/v4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCTcEgsGo/IpHLJbA5NjozJSa02RxiAFiAYWb/g08Ky3VoW4TRzxCiXLV613Jh1lwVzJ4RCgCQjdnZTeUkZImQAFiIZRxmBbgOERyUkjyQlRQOPZZFIFCAVHmGVmyRFgJtag0UUAncUVpqpAJ1Drpt4RhQHdgewVHWpGEUOiHZwR7d2uU0fbbMWfkRjx2hGHqkJTtizWqLEylwOSAup1kzc3d9GERlSShWpIE4fxpvRaumB2k7BuHPh7lSRlapWml29flEhZYkQARF31lGBwNANCWmEPIAAwS9MhgaILDQwKEnSHgoYS6pcqRJCSpZzMhTgBeBAAZIwrXzo8AjB/oecXxQYSGVgFdAmCLohODoEhAELFjacE+KoGy2mD+w8IJLU6lKgIB6d42C15tENjwwMKatFQc4SqTCdYAvALcwS9t7IpdntwNGhgdQK4en1aNhA5wjOwrkyq5utXJUyFbLgqQUDU4UIJWp3MhMFXe0gMOqZyYAJZAFwmMC4dBMIP13Lnk27tu3buHPnSYABKoaOYRwUKMBIZYJnWhgAtzIiZBxJ/rQw+6KhTIGSEPImkvulgPWSeI+9pNJcC7KS0bmoGTFhwnNJx8sod10BAYIKTRLcErD86IUyAeiGhAn2WECagCeMYMd7CJ5A4BsHIhgAgA0eUd99FWao4YYcAy4RBAA7OEloRWRqYW9jdzhOTjdUeHV4MTVCcmpRRWxDKzdGSWtiWnV5UUlCY0t5QTlKYmUzU25OM3ArSDd0K3JOMEtOTw=='
ICON_BASE_64 = b'iVBORw0KGgoAAAANSUhEUgAAAMcAAADJCAYAAACXDya2AAAABmJLR0QA/wD/AP+gvaeTAAARR0lEQVR42u1dCZAU1RluLzzwjHgQQRHY3cGNaLJB1CiCioocO9Oz44EQMIUSj6CEmIgSXMUDNQKuO/16sujiRuKJWh4xokhpKEKhiEQFl+USOQJIIpco1+Z/vUh0WWBm+nX3+7r/v+ovqiy0nPe+r99//4bB4qHU72fERRsjbvUwEmKIkbQeNkzxNOlbpO+Tfky6kPRLw7Q20p/19PfW0Z+rd/7zOaQzSSeTVtPfGUHa10hmOhupiuP4fFlwxMy0JHBfZSTFGALztF2A90obiCSJdpdRZl9k9K9pzpfAooeknjvAMNPdDNMeu/MVqA9YtzovjXyh4uIsviAW/00l0+5Cr8J4AuIaDQixN5Wm2X1GaeZ0vjcW76R3pgWRYjiBrU5zQuxB7U/IDBtqpDJH8WWyKDKdrCICVxXp15ik2E3XE0nGOf4RC0tekrTaEogmEJi2hYQUjXUT6YNGT+sYvmyWLF+KMYcSaMpJN4eUFI11rZG0bzHKy/fny2fZs8hwqCmWRIQUjXWKYVa1YhCwNA7JNtuZoNseUWL8/xUxRYIBwdIgicpjKZLzTsRJ8X3dQWbWaDazOBJFkShrEROiSZ1oXJ85iEESyWhUJkYAWM4k2Gtu5DVjYPUhDJZIEcMuoMtfxeDPQpPWJDaxIuVjWLUM/JwIIhg4YRf5BWTnO0+1BjGAwixOPwQDPU/dbMTTZzKIQulnVBbvLOlmoOevs9j/COWrYb/E4FaiAxlMoXLC0x2c5BYDW4Xvschp8mIJy6shLAa1yuiVSDKowiA9Ko6kC93AoFaq/2RghePVGMxg9uT1+CmDC58c0xnMnuhjDC5oR7yykB1xz+qu/kt99YcxyHCTfvcziD2NXPVlkCGKUyoiljKAPe4eZAGUsvQlDF4fGqNS6fYMNjxHfCKD1wdNiHsZbHi5jU0MXl90pdG1/EAGHUyUSlzHoPX19ejFoMMhx3sMWl/1eQYdgpSmW/OInQB6PXgGL4AkrdsYrFzKztIkOcQHDNQg/A77TQafzhLPtGOgBqbbKOdxIoNQ21fDHskgDTRqNYRBqG3ijxa0MEi5z4OlcfjWPoPBqUOfBw3MY9Eut/EAg1OLSt0RDEbtTCqxgIGphc5jMGpFDOtsBqVGysPftDKpxjEotdIHGZQ6SENT0zIGpFa6lCcj6iBlomsIwESjg6xn6M8/kdaQrglBj3kXBmfgiT8aj49edtF43XEqfTiRZQY4QdIMziBFjqXEXkLzhdHn8SP2kLfpDt8ExWNDA3XELwQfjHZniIlPr6J1AYOUTao8wUMDrveeu6kCz5ZXMkiDi1KtAM4k1+77ZbQvY9OKJY/EX7pb6Kd2yFXHpljLUSuWHMlB0RDoLLJVkuXvrOaZuiwRMqnEEsOo3y/LoEMvNq1YcohSURQEO0o1Juvf2qPiYPp3voL+vWXW+Qxa/0yqxyIFFlM8BV7GXsGg9c+kWg4Mln/nbGaYIgFvWnGtlQ8iv7rYQLFz/s0Dqw+hf289dnQucx6D13OTip5obH/j0jyrAZ4F/92PMni9N6mAy9NpG1LquWb5VQOIK8BfzBVsWnkapaKnGRsgNXn/drliDH9y/C8YxJ6RA77jL+EySvcieFXAOAaxJ0JJM1N8DgyOTUb/muYuPw7XsGnF0kSUKn0uODBecH0GsvdDTjRn04qlUVb8EexojdVPyTkkxavghYhjGczqTaolwKD41oiPPVoNOawB4C/HkqzryliyAYT9c/DyiTeUnYUkmSQb9HlkfsagVpb4E/eBm1TXK06EvgFuWo1iUKsjxzxgMGxXvrfCtAaBk+MTBrUKSdmngdvY7yo/k96ZFvTf3Qp9LimriMHtPjpzJ7i/catHCdG3wT8av2dwuycH9o6/VNWpHp3LDbzoJtK+RuUpdIg7gAHwvmdn06fqBGcPH+7Z0L1WtWKQ5286DAU3qe7wOFDxLngZ+w0M8vzJ8R725WdiHp/PEHDTajKDPL+LPx7abEiIT72P5ImTwM3OLbsN0WbJxuGkxBknurIxraZzzVnknHH0LLBPJRKmGAZOjkkM9pzMhcxR4PVDi30rritNtwY3rTY5XY4sWZtU/cBH7z/i7ytLIWPsBT6lDPrsyTGJx9DklBC8Hbx9dgKDPiuTasyh5G9sjNTQNvcfk7bgId21RtfyAxn8+zYREuAOpgjmtbVng78eFzL4902OGuw5uOlLAorujeBVBWEWuawlKf4TyaFtrs1RKgHHJscybp/du2N5KXgt1ZPBvrrURAR9fulOTII9m1Q2uL8RD/j8ysE/LvczCZoS/G1NwSezSjOng5OjlonQlODPwX1ek9d3Hvbr63ElMyY5wIe2mVZfTciBPanFtIczGXa/1IXQpdeqhra5PkcqeMR+gWcyGcJ1oa9r9qFZAN0+K4spWXaFIEeBm1SD9DJR7YfA22dvZlKEIz6/zela1CpflOkM/hJPYVI4F2kXgNcETdXvUOF3mWxzBtfxq0HRCWxyDNH0XMeCJ1QHMDlkdALZeUxlTua8kSd+x8sRJwYN9cJu8dQ37NhQcbAc+Gy/dr0mDjvxBz53SXbg6e3PVXKtGi45pvKkcC9f5nQ38Gz5E9EkBv4Y/Y+1P2PZrmuKVcBn/KXvLcd6fNXAF7AkrLtBAh7YbQB+D6vQ5NJeh760ePpMDNPV7g4+tuehaBEDf5/2YpizllM9TLEG+Kzropb4u5KHtvl63k9w4APH33gGfMLIuVDnnbQv5xVpCNKj4mAK4a4DvqiVToINSeCnuohp0SBH3OoB/hVLgwZAkOeBqV9Xran9mwHP2l6MmXClYc3Y1Qi/Cjcx4CeM0NA2aaKwOcuFiMpFOrLYJlU1eG7paehCxFDv8TDFg+DtsH3ATdoybNPK7h1eciTEZ8CXs8FZj4As8suLvd6hKpzESFYWg3f8PRuS1/sF4HtYBRdGz44c4k5wclwVjnuwrwavtTonjP4GcjvsNxTtOTIU95BKH+44t7gfqQfCRQz0ZfJJ8WrIXvGXgT9Uc0PmiFs3cQJKq1e8P7ZpVVkYpst4C3qGUqriuFCRQ871xd7zPowvQo+s+DshzTkhN5u9GxL71uoH3uT/m3CG1slU5ImIHFfnid9N+YGVx0IPuICfiCiL3UyxHrhcZIYRZjHFZGByTEJPOPUGb4f9Q8jJMRj4w7XRGFh9CPDhW+O5d1ljgZ8dZvXEPPiG3o2VwLmNfxlREOipk9Q4Byll1vngvRvlkSCH3KKEe0crnF0kgFlx7O2wCfuMSJBD9mbLHm3Y4XriLERnD3g7rLXI6+OpN4wD6mKxc2pjseHzi4omzo/FZtCf80gXks4hnUpq1RYWDpoXi7Xx+K6mARci3ouW+OvIIyibls+KiooI9GNJvyStz0FnE1Fu+rS4+HAP/I6hPNDbvxDuSO4Z+KEsaNeudW1RUQ2BfFuOpGisq+sKC4d+UFKibtAD+hKhVLo9kkn1ITA5lqvuNiOTaTCBep1LUuz2ktAr1FFh2H0GsBl8KwgxKk/B7t2gbUiK5ItWrQ6l1+Iviknxfd1ExOuryBS+jTf6em9S3YI9B9e+SMUxrCgpOYzA+7aHxPhOd9QVFbn/cqaqTgX+qG1zasX0fzmoxBt5k5Ac2e9SyGluRi/GOz4QY5eSH3KjAnN4FnCtVT/NcxvglZ6KdtDNLyyc4CcxdupWCg1f6tLvuAPYHH5Od0d8YNSHhhFIrw2AGN/pmrkdOrR0YRIXQM8V07oQ0bRfivLhUh7iJA+iUjkpmXPuZsrKmjLcEPxlmpYh0DRA6Gl6tFDHpZBZ82SQxNjlf8Ril7h4/e8C/sBZumbF4+DtsFe6MqcKCjoQMLfrQA7SmfnfI/RkyuV6FiImxIQoD22jr/WfNSFGgxYUdHHxeszFLUS0SjQzqZxl8MAbS61XFOQ0NuhEDpl8dOE7jgL+0N2jmSOe7gbeDnutS0f8Sq1ejQZdt7hNm/wCDHLHOu59fqSbSTUuymNedHHEd9PCwotdmFZ1uIWIlO3XKL+xGJgcUxTkNhbqSA7qFbnbRc5jNHCt1RA9iIH9BNc7baJuXo327Y/U8tVo0FdcmMqdgMnxti6Fhsi9GzucXgYXsiAWK9GYHHNdWgSo3ZxbjJ7WMTqYVO8Dk2O6a5MqFuulMTnWufMlgecAyCU9wRIj0xK7d4N6GNyT42qNybGdetXzT4ohb/9NiL8GHaW6Lup7HqhUvL/G5Kif2rWrixJ8yjabYino/X5F+bdmAb4clDyLeDycXo6kxuTY7N6nFI9GvXEtz0JDsQmYHHepOAbq475QV3JQlnylgkrrLsCRyEeDMql6QZtUpZnTVRyDnCmlKzmofXaa6x/YMNZ1Beg9LwmqdyMDTI46VcdADu/+zqADPV+O8YoikhZw0KWjz8xwHLUvgMN8o1Weht/94jm8HGoWfUrbHbeodITPWXEqC4bOimc6qzwOiliN1LS2qq3CquvVoPc902eTiiaQ45JjmeqGGKrKjWlIjlmK77wqqlUQuR7ULOBntsKLI6GQ7oeaFR2qXUcs+7NxP4iD/SFGn8d+DJ0Vl70nHgiBcYBG5FhPvRxHK/2B12cOovNbC9oC/ZpfrwbwHjk1Q9uaEjnIjUC5SBNyjPbk7nFbob8x+jx+hB8h3NeATarxXh4NRYdSGhBj9cK2bY/yqAIbdwFqwjY5Kx7ggkVZ5EfgfD1QcqgaLN2UNKzO/gr0/qu9rqXqA2xSrfdjIt7i4uITCaSrAiLHUz6Y1RNhTWoZkvbwYKpwn1X/SpgptNvJ96w5RcvmdOzY3PuyITJPYDGQOc/LrPgy4AkjKT9TQUSQOIH2W786/lzNyM3dtN7A6+x+8GoA9xSbYrM/0YpGuY+Cgp4+zLP6gFaqHe9z0emzUa+pa2xS3QNcuvyyEZDUnXZaMUWxaj0qD5kgt0f5/qOS4grcsT1WkRdhvNnAlZkDjABFApjA/DDpFkXEWCbNtsB+UO/MYbBRSwWt0T+U0nRr4Kz4VrdD21TJguLi9jsHwH2TJymWk+P9u0Bei90tiRdBw/n/UJ34uxHY35hsaCb01W9B5SY3k7n1NwL8xn0QYinp40Sq3pRHOUCbH5EQ18BOuExVHKcyv/EGsL9xg6GxyGYpGgzXbn6HDt1lht2p0YrFTCLQeZJE2v6PywCHDHRg4mKgmkPoX9Mc+BC2O4WSLF455q+C+h2TVNmWCWCTahoj2FO/A3QHJG0gU1ItITes4pJjGCPYQ4mPPZrO+Nto1tk1TJ5YCRzCbcsI9vz1+DsoPmy3jvjZwEMUZjNyfYlaoU69XOGuXdoU9wGTYyQj15eEYAsnl4TZFdrJTTQCeCe1+Akj1zfTagpo++yo/H5wKnMysCM+nxHrJzlgk8Rz8n01bgZ+NR5gxPqZEKw6wck8R2Z/IG4UgnZRi7MYsb475u9FY38gdlZc+dA2lqzIMSQa+wORe8UDGzsfcUmJk0Art3PcH4g8Qb1MdGWkBha1mh7+/YGm+ByUHGu8GtrGkhVuhoV7+EbCPgM4hFvFCA1Q4qINqGmV5f5A0x4OnBW/nBEa+OuBuXo7q/2Bssybh7ax5CtJcXs4Azmp8T/CrZOhSXwsGpCDKqFDuT/QtPri+ht2GSNTG9Pqo/DtDzTFU6Dk+NpJXLLoQo4/hmt/YMPetzWgr8ZLjEidEoI0OC1U+wPL0ucC7174JSNSM0mIT8OzPzAh7gUlxxYnkMCiGTmsu8OzPxB13GfCfpORqGXUqmM49gciL8FM2L9mJGrrmM/D3x+I2yS/3TAzLRmFupLDuh9/f6CM9vBQYBbVErdKsPcHyoIrWXqBWUv1W0ag9qbVAtz9gQm7Ow9tY/EuakWrxmD3BybEOFByzGLkIUStMp1x9wfKMTahSvWz6CXOolXE5rm6/wGZ2bRwzwfZsgAAAABJRU5ErkJggg=='
ICON_BLANK_BASE_64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZSURBVDhPY/hPIhjVQAwY1UAMGHQa/v8HAK+t/R8kTA7nAAAAAElFTkSuQmCC'
ICON_SHOW_BASE_64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAPFJREFUOE+10zFKg0EQBeAviEEEC9HCVrCxtBJsBLGJOYA2egUPkMJUXsATiIieQAWRaJsiBxAtLUQrwUJBIxsmsPxEjPnJVLO7M2/evNmpKGmVkvnGBrCBIyzRK/KAfVwXGRcZLOIeEzjFMbrYwy6+sByAPawcYBvnOEQjKq1hEndxbuIgAE9ygM2gt4p2BD9hIfw3zIa/gg62cJkYTOMdNVxF0DxeMoapjaTHY7wnjW4w8xvAHF4xhW98BpvnQQDpblALt1iPhBZS1WT9Fuq4yEXcwVlBxGq08fGXiP3xlhpj/kdG/kj/Xo2x7cLQTH4AHKU1KbsxXsMAAAAASUVORK5CYII='
ICON_HIDE_BASE_64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAU9JREFUOE+V088rp2EUBfCPYSZJmcgsSGOhzExpsrCwMMWfYGMnyU7ZKAsLNJtpasrGYmYxK/4IFpQdUhJSI+Xnhkg2mmGGnum+9fbN1zfP7n3ec84999z7lHn+eYF/Ga3s+Xy36MJK4pYSKA/MXRQawwSqn3LwGktoL3C3iY9owX4xgW8YxSr6cBTAJmzFd1teON/CIrrRHMBKzONliB0j3X1GJz7lM/iBoQCkkNJJSW/gdxB+BqYi7mYxkBx8wA7qcJmzfIAUYgfWCgKvwVXKJGvhL75jOASS1Rv0YAGDmMv1Po0RVGQCtbjAF4wHMInNhFBVjjyFSbzBeT7ERpxgN0b4J3JoxS+8wjrSFN5mEypcpNTzNt5F5UO8xxnqsReZZYtVdBMbcIpkvTdIX3FduPrFVjlVXkZ/qbfymEAWaKl38l+7GCjd35eqnv4/AN2DP0ArBQAaAAAAAElFTkSuQmCC'
ICON_CHECK_BASE_64 = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASfSURBVFiFzZdfbBRFHMc/M7t3Vwq09qCAxPKnJbYFKqSatCgEMdGgCKT+xagxkGCID0bA+CT4NyEN/iHBF6I+qPFBTCu+8IKQGMSWllJLQFqsEdoCd71ry9Frr3d7N+PD9Y52uS1XbaLfZLOzs7/5fT87szs7A/+xxCRipwOPAZVAEZALRIA+4BzQCLRPNSDA48IQR4UUMUBPdEhTdgC7gRlZ5K0AKibqgUphigM6rtcACCkoKPfiLZuFp8CDJz8HZSmioSihzgH6zgeJhqIACEMEdULvBr52yL0BqAOGnAC2CSEOaa1Nd56bJU+Xcs/DRbjz3I60OqHpbfXTWXeJgfZ+hCES1furZzbsaog4mHuA/ZkAaoG3ABY/WULpC+WYuaajcSb1tvhACOZUzm1Qluupo8997xu9tR74AcgBDgA77QBvAJ9Kl6Rix0qKHlkwKWMHdZhQfaTmSLXdHGDsoz2K4GOAyl0PMK96/lSYA5ReOdlzHFhqNweQo2e3dMkv0MjSLeVTaU6g1U/bwdbKTOZjAXYoSy2YuTCPJc/eO6XmzfuaUFaCRU8UR2vqaz60x0hACkPuASh/eRlCTGZuys588cYSlm+/zxOTaqc9TgKrdELNnj5/BnPun5sxWd+FIG2ftRK9MZKVeW+Lj+Z9p9Pmy7ZVJM202JIJYDPAvKq7HRNeO3mV7uNXaNhz6o4QvS0+ztQ2oSxF8aZb5gAaSjbU1ywfByBMYx1A4Yo5jknLXlpKfsldhHsGaXj7F0b6M0MEWv2cqW1GWYrFG0tYurVi3P3ojSh/1nVsHweAVsUA0wqnOQK4ZriofvehJMTVMI17b4ewj/nYJ0/p/OdttH/7++tA1S0ARR6Ax5vjCJAJomHPLYhszAF0XKeK89IA6SptD88MUbX3QfIW5TN0LUzj3lN0n+hKv3D2MbcrEUukiioNICQhwHFc7XLnuVn1werRnhik7eBZxzG3a2Qg7XEjDYCgEyASGM4KAMYPBzBht6ektSYSSP8YO1MFU8f1CaAq0OqncKXzl5AJYtX7q7l5JYS3fNYd4wfa+4kPW0iX7FKWup6ql8CPAL7TPsfGTjJzzazMAfxNSU9lqe/G1kugSZrSN+wfwtd4PVPbfy0rbNH1U1fqst4OoFVcvQNw8ZsL6IRiqtVZdwkrHEOY4gTJxWtaxui5Tbrki7FQ1KvjmtkrCqfMvP9iH+cPtaG11iieAcaNdep3HFeW2iqESHTWX+Lqz91TYh4JDNNS24SKK9B8ArTaY4wx5S6gG9jsb/ZhmEbWL1gm3bwc4vR7DYz0jyAMcRzNK2SY7gzb9W9IQLE2eC4gIsFhvGVeDE/2i1Kd0HQdu8zZj5qJ3YwhTKNRJ9QmkpuY2+S0+nheSPGVVtpj5poUb15C0boFTCvMdTSOj8TxN/v443AH4Z7BZKXkSxSvATGndhMtf8qFIfbrhN6QqsgvzqegbBY5BTl4CjzEh+NE+iKEewYJnguirORcL13yL2WpN7F9cv9Ua6SUh4UhhphoayZICFP8CrwKuLJNPpkFoBtYS3JzupDk5jQKBIALwDEgOIl8/w/9DR5k79YG7eHTAAAAAElFTkSuQmCC'
ICON_MODIFY_BASE_64 = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAA3QAAAN0BcFOiBwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKZSURBVFiFzdfPi1ZVGAfwz3lHZWgkUipaRCFIC4MQIbOmxSSBLRIFcRdE4cpZtNWV9AcELSZBK7WpNm7ClUKgFa2KKBF0U4tcRD+MtEn8MTZPi3tHTsf7zr3vO++ADxzuPef5Puf7Pc8999znpoiwUpZS2oDd2IQJfIfTEXHxLigiRt6QMI1/EEWbx9tYHRHSYgZSSlvxGrZgbcvibmM2ImYaVt3DB3ijZY7DETG9qPgA7jSoXaot4Mli5T0cK3BzOIJ38GcR/xK8XHcGIQ/8jDUF+fECcwprM8w4vs/8JxPOYEedlkt4F7+1pG8e5yLiBnfTfgyvZ5jLeCoibuWBKaV9eL/u/gRXMkVTQ2y4Hk70ydJhqn2W4Scz/1+KgMeGIP+omGNuKRGYzXznhhZQk88W8WfwML5qEoHtuJWNHxxKwBLk47V/Al8U/s9wPetfwJqBBdTkH/cjz3ATdYqb9sZVbF48gzoLwBg+aSPP8A/gmwJ/Dc9lmIEEfNiVvMZvL9J+DdsKTDcB2DNq8s4C8Ah+z3CfD0j+N57vg+0k4FCG+QOPjoJ8EAGnMsxbA5K/0LKvOgm4nGG2joq8kwDVYZFj1jVgdjSQT7aRdxUwXmAeynyPY8b/P+dzXcmHFXABP6g+2eUJN4cXi/hn8cRyH0GXguVLbCxi36x9d1S1wT0CelosIm7jdB/3vKrCmVbVEj8W/lfr6xheaZpgVZuA2nZiCg9mY7/gfBQVT2G9PveDCYiIBZztgh3UWh/BStt9ISCvgDePauKUUsLT2dCvTbhVqoJhZ90/mlJ6T3tZ3mZj2IWN2di3/cDb8K/293w57dO+B1F9YOzHzRUiP4v1/QTkP6ebsBfPqArK5diC6q/na5yMRZIG+w8Ygbg8bIo6hwAAAABJRU5ErkJggg=='
ICON_ADD_BASE_64_WHITE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAQAAACJ4248AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAAAqo0jMgAAAAlwSFlzAAAAYAAAAGAA8GtCzwAAAAd0SU1FB+cGBBYXLZ9A5EwAAAC4SURBVFjD7dfBCYQwEAXQH1GwDk8mZzuwCxvK0SpShh3YgUkfguLfQ2D34sVx0ct8CMwlkxdCIAGEIZ3jkRKPGMm2lfYRh/Se33gv7VPICXV9Xj8G+E8UoAAFKEABhnQOGAagLC/NZN/DdF2u5xlmmq4tve9ACIZHSjBN887+YywA8p3FcwxpbT6Cqro08/YRbBsQglhOjuPvQTKO0j6v3wIFKEABClDADcC6ntcPhbSWXJY85N/zD9XJWNi47SReAAAAAElFTkSuQmCC'
# ICON_ADD_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAYAAAAj6qa3AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAAAAAAAAPlDu38AAAAJcEhZcwAAAGAAAABgAPBrQs8AAAAHdElNRQfnBgYJFxxz7ciwAAABq0lEQVRo3u2YP0gCYRiHf+95QZu0lUuQm1PD2RIV6BJhkwYhVAYShSQ1N4R70BFFDQ0VCIFJRNEQWTREgxpCBEE69mdpCBoC9fuazk0w4u6N+p7xveF9eOA43iM4TN/j2Nj8qc8n50WH0I+PMYhphKUUWSToMhQqFrO368bDg1M+mtMB5IDwyNjEBN7whqOeHhxiBZNer/aEAYxMTTnt43gAbNOJDLe3tzz/cwF+GSoAtwA3KgC3ADcqALcANyoAtwA3KgC3ADdkXWciJdz1j2gU4zJJO7pu28YAzeI5GKQhdKHfMKyxvMILrgsFXMgteHI52/bv05qM1Wr6vbjBUjpN/uHwTOKsUmlcZ/8FU2bQXS5r1j3O7cOF7sqIuOwcHa2tucrkjkbxLvIotbXZtpH7FXBrfvRWqzIJgwLpNNm2qAn+k4g3Mbe6ipTshbaw0HiwTCUI08yHDiobm4uLTvn8+6+ACsAtwI0KwC3AjQrALcCNCsAtwI0KwC3AjfMB4jJE2c/Pluc2Y9+Pjya4usS5cO/t1U26o+5IxJqLJBk43d3FKwDjBwu+yRfVWJFYbEc2CQAAAABJRU5ErkJggg=='
ICON_ADD_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABFSURBVHgB7daxDQAhDARB//dEJZRB/zGIGg7JyazkfOTErgoac+07FfRXcwAAAAAAAO2ALz2nae0biPKQAAAAAAAAvOgAwKsJ9ovGESQAAAAASUVORK5CYII='
ICON_MODIFY_BASE_64_WHITE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAQAAACJ4248AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAAAqo0jMgAAAAlwSFlzAAAAYAAAAGAA8GtCzwAAAAd0SU1FB+cGBBU6HgL8YewAAALXSURBVFjDzZc/LHNRGMafU0UoCbrSSVlUhPgTkVSaELNEDDYGO4MgkZBIWEwGg6XJNwgTCW1i0EkTKk38GUgaAwYVA3H9Ses833Bxvktb19Um3zvdc9/n7fM75z339lyBHAZZWwsMDAB1dYDdDpycAKurQkSjufQFmZdHzs2RySS/hJTk8jJlYSEACFXU2QkMDYHV1RD5+ZktpASCQSGmplKZA36/PvNMlGtrEP39b0Wzs7QSsr7+68z//DGKTk/JsTFydJQ8ODDmentB2ddnyZzxOFlentl8c5MsKvrQSLudcntb5QMBQRkOQ7S16YpoFFhYAF5eMi6fSCTA3V1hi8fTL/vlJeB2C/H8bFwlrxcIhfTR7S3Ix0dF1NhobcN9nvl7LC2RQhj0sq5O5TUNxp5WVv7e/O4uEwQ5Oalyh4eWAdL3vKKCcmcnFQTp85FPT+r+zIwlgLTmb8826XCQoZAxv75OapoaX12R5eU/BvjOXOlSQbzH/T1lS8ub0DyAWXMDhNzf/2LO9vZ/ROYA9B76/WbN9Rqfz7jsn8x/BjA+nnVzswCULpdx9wYCWTE3DcD5eaWJxShLS7Nibh7g+FhphoezZm4GQN98z89K43ZnzdwcgMNh3HzqH/BDI7u6LJmbApAlJUaAsjJV63SS09NkImHJ3BKAjEbJSIQ8O/t65DKak0JQdneTDQ2/aEFxMc2EjMUoPR5j7diYnnx9pWxtTeVv+26FhHh8BPb20ivOz4GJCQiPR9iOjoz0b+972GxAc3Oqaru5Rvl8gNcLOhyK7OYGuLgQIhbLQC9SXv8UQAhNA7a2zMH+LL5tQa7jPwCgpn2MRFVVdn/e5VLXDw+pFHaISATwevWh30+5uIhPR2lr0dEBNDWpcZoniezp0b/XchkbGxlZyZER8vU1J94yHCadznTe6rwuPR6IwUGgpgYsKPh1B8T1NRgMAisrwpZMppP9BbWc4qhCs8IrAAAAAElFTkSuQmCC'
# ICON_MODIFY_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAYAAAAj6qa3AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAAAAAAAAPlDu38AAAAJcEhZcwAAAGAAAABgAPBrQs8AAAAHdElNRQfnBgYJFCB3r+f0AAAE30lEQVRo3uWZa0wUVxiG3292W0O9Fa2VYEldLlGsYBWwoKYC1sYogbIwNYiA0KSiLNZrExOjQuOl1WpCAI23gkWQLqK0GOsFCrSNGrCIxKQWwxKo1laLRlcNhp2vP+xM7G42s6CwLH1/7jnzTZ7nXGbmLMHFEjo19q3lfv7+lkTBQOb9+xGIw0icMgUXUYqc6mpcEdZw0dKl9UajMf/DW7fU6pGzgXoMDuE+LaquhhbTccfDw7ofH8YwXtXSoh0mPJI+iYi44GU07j1544bLCnAUvLciBGcD2kvQNDHe8HpAgGW50EXutbU24M2IRll3N1bxGrQfPWp9PSXDTLv9/CyrLYWaXVVVU2dE/2SI9vQc8ALkERdYusjLzpzBPkxByJgxcjsfQhfmWCzIoB+5ccmS+kXlM/K+S0jgWnxOp9atsynYRknImTBBc/Cl/dKumprQDlFMXzBunCLK2cByQkRRXBE6bx6ypcfdqysrkYwhVKvRKB3+HXHu5Dq6sHhxwyvlB3N1paXWdYJ/12dn3Fy/nmKpCVu2brW50Xj+GiuuXQM0KdwUHu50AfJUF2Isu/jv8+dRSauQPnSodb+nI79pU0PAsco8fXa2Wl1VEQc4D+9UVDhtCSjgy6TLPL6qyh64EnfMRejatcHu+pWG9TNnqtVveKN8Y57ntm0chgfYXlJi02EB7qM4IqLfBdiA21vjEXjAWU+eyL9TLOqwZfhwWonV/MXp00EcxxkcHm7vPsGP9B8ZTAsX0j4kwlcUbTqE4TJONTb22xJQA7de4/yEZ/H3nZ2Ct1CIvRUV8MFozHJzU/pH8W7sffhQ2khe6I6KukTHKI9qahTwUfQuhxYVIQDfIl6rVa77GE2ov31bky8N4buzZ/e5ALXnuDziVEAeHJqSUv9l2YF8zyNHFHH3Yr/K2DN3rpoI/gN1fGXHDiogC0Vu2GAPXNojvE1tc+Zc+sVYlvtXc3OfCXhecJsZpCbCXuyAy80vfA940eByLr16PDVv2dmzUquUgvSYGOs9oqfgcrR4QekrcJuYqJRHjxzJSXiZ6jQa+uG/zXTt6V5i2SMQsX1wOc89A/oLPKhRP2/5N/HxQhglUGZJCaVhCKqeeVHagptwM5st7ZKEzfPnq4ErwlwN3NHNzdH6PRYwWMB7LKC/wKeHxMcZMkSRmzmay4qL+wrcYQGDFVxVwGAHtyvg/wIuR3kMBi+OXZt+evJk1RMYHx5LUxMTewsuv6s7G1wRIIqiKIoaDU0S4jTxJ06ofaTYO4hwFFztI6W/wBUBpj+lSI/UwEAcx04k+/jIDfJUH6zgigDhMZ3jk76+Ni2/QsK4q1d7Cy6v8YEKrgjgHM5hX29vmxYJYxmtrb0FHyhrXFUAvLgQM3Q6mwYD7xRSTabBCq5wcgVthp+tANzF+2hVF+Cq4HK0iEQCd+p0KID52ZcCfo1mYYSn5/Q7ehiQmcknhHuc6u0NL+lnhOl0/BulYYJOx0kczdGTJrkauBwKydK3Z2jMZtVTWUfjIuByBJShC7ktLc9bSP4vjmulDyyfRUYOdHA5Wnanc8KbaWl0l7dLOHSIyzEC0yZORDd9yqM7OlCNEhplMqELw7ittVUo52TBaDKhS+jAfZNJcuP3aMH16w3+k9NH+TQ1AVmU5StJzgZzNP8AFdhd7LR0w/4AAAAASUVORK5CYII='
ICON_MODIFY_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAG4SURBVHgBzZcxT8JAFMffa2VnVoeOEhdILDjC6FbhA6iDicrCNwA/AQ7GuOkH0KSjG7oZcGCS0TrI3FlSzrvKkVJ6FEvv8J807aOP/H45XugVQHJM6zS/6L4OElOs1Y9A05+2cyZ8DXovoFKAwQnAvV8glkUSUgSCcALERsAdkYQGKScIR8TLt8ebQyDkxJdBbBWrF81gf6orEIZ3H65b7Ho46PW3cuYn/dAKr0RqAiI4j0gCIYXMwAGcby9T6NtXblTvXq3eoT1l3rfyDMxMO4BLr42MPurkrUY23GvW6nccrnlehUmuJBBedt3zCkjAoWU+LMHg9HTM4a/2reN/DxJG9JvvW2fGWNM7BMGgZX/kZSpUph0FTywQN3BBCdrnUkg2Cp5IIA4elPB0/WMCiYSz/GkGloWzUHgzDj65nz5cNHCJBWTBlxKQCY8VkA1fKKACLhRQBY8UUAmfE1ANnxFYB3wqsC44i/9XvC74VIBHNXxOQDV8KQGZcJaNYFGqnjdwTGxeTx6p0uAsv0NIh4+dx6i12SaCH7LhLP57wfC9+7y5W0K6oTRo6U4PBIduNA9kwf9FfgD1H5EO9RKFuwAAAABJRU5ErkJggg=='
ICON_DELETE_BASE_64_WHITE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAQAAACJ4248AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAAAqo0jMgAAAAlwSFlzAAAAYAAAAGAA8GtCzwAAAAd0SU1FB+cGBBYPOp6I+dIAAAHISURBVFjDxVdNzgFBEO2aiIifDXu2XEFYIU7DNbDkOMwOS5eQcAF/mUzU+xatfejp+dN4m0mqu1+9elU9gxAJAM5mgckE2O+hYbcDxmNwNpuEMxGA8RiRGI0+KGC3k0maTd2dVks58UEBEmnXg+A8V1GrgV0X8Lwgc18TJVv3PPBiAa5WzRWy60b3+E3wfB5isaq8XLbfvkpFOZG6x++L0PmdtGS2kDEp/ZaAFwdWq8+nXC5Dl8HDoezUdGorJTCbSc7BIMIBIQQdj/JUsWivasV14w4VoDbRswBgvQae7YsbuxcDXUDAEKpNrw7o7//4sRsXxXEAJgFvgMwOBMzA4SA3l0rWBCguxR3LAfqZAx9owc9nQJgd0PPDcQBm4HoFiP7j+ockTgwgklzMgKMVrAWImAXOZyEcR4h8/u3iUShIrtOJiDlSgFShrLJwE0hxBNtv+Byrq2hhDu4c+hU0C7B5FSl8AMNbYNMBStSC7zmQCT6lHHgcwtVKiNdfSnFi4UNoEHAbmAcHiNptrbhYsTRDKLZb+ez1wBmDyGgAuZwQ/b5UpjhjHWw0gMvF3r+RywWo15Op524X2GwA30+f2PclR6djyvMHRma5BDgyq2gAAAAASUVORK5CYII='
ICON_DELETE_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAYAAAAj6qa3AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAAAAAAAAPlDu38AAAAJcEhZcwAAAGAAAABgAPBrQs8AAAAHdElNRQfnBgYJDQjZGuYWAAAFKklEQVRo3uVZbUxTZxR+zm3FrpTMDDdjkbnNqYE5F9QqoZJOjRo3MUgpOhCMc05D/cjmB5owCbgsc5sfgKgzcYu6NAtF3eZMjJIRRFSG1CVkKCNmRpRlGagLbYO13LMfeO0d7q4VW1u359/t+573Pue5zz3n7X0JIUJipSWziKOitF/z6T+2bNlCen6H1uXmogGtWD98uGLgWnyIjo4O1vFd3Dl0yO1WlQw9vnlzS5a9qpg8nmDzVIdKAK22d3PnmyUl1E7F9OKGDWhHK9YHELgNhdDr9QQCUFAQ3S6O6BrG3De4adMTIwA5aRAG5+ZK11yLrWKJ0XhBe/jlPbFnzyrFTZxgycyvnDpVUIlMtXV12IkVbMzLw0KU4mjwBRBCJYD0JKVLf4lLaHLYq3ZnnTmjtE6wQUoDSZ9l7LJmjxyp3kGFSN6/HzmYzNmpqahBDBVFRYVMuEfFNHRzsceDLhjRdvq0eFFoVo9durTJYa8qe+batYAFMMSZh1jLqquhxwy0zpgR7rwGjI04gFunTjWaD+sqbLNm9R9WrgG+Jw4qAlRHBCEqJzb2fLzdviPl5s1w56UEw/X0S9aG2FjMVxXiYGcnGpDBZSYTAMD24HzlGtDP6pGeuITGEd8kVEzp6lLKI3AB/icIuA0aDGaz1Sr14/8OlB3wBS+BUdaOnlBwORxcUFc34AUMH5nPWWNWr5YcMMmd4bF+W1oa7sT6Y9K+zIR8V1mZxHOyOmPiSs2qVf7i/NYAPoGfoHM6pWu6TOPRqdOFO+H+oCviRnh8vMQzwusY5+M9YAEoC7UYIltoMsbilrIAhtnmRGtbfb2hOeN7q03ZesGex6lIwl0fL2EVrmKKfwH8FkExHUcw1OkUDiANAHASo/CnTofpCgE3kYCdKSl4m77814WDPI9qkAivzAHL0II3nE40AqhQjvPrAKGBtyNepmQ6nkd35L0CbKHRcgEEJ9fT8iC8AlxKKmFRd/f9H5bgO14TExPuhPuDlvFJOu7jxeeE5b3bZbwHKoAqDmuo16ckr0A8eiPPAdiLUXJnet8DA0FwgPcX8UbPMVkXqEAc6SNQgJU0Ei4fL/UOUFAE0FztbfU+LXPARgzD7QgUYCtGyAVwWYLkgPquJGP8Jy4XDDBjJTNV83LkREf3jRL5i388IEIH16BJq5V4tmQl2p+1uN2PLABQTMUkihjGUzHO7UYF5SBREMZ/mvvcukVabbhTT6y0ZOZXRkdLvJCOcux3ue7zfnQB+sDryYNBPksN/rHH5J4X/m7w1FbvHm+1jEcBriPav/UfWgC6yC+hxNdW+qps+GuBeowQp0nz8WAbpnOu//b30AJgBa4gxqdsX5UNvwC9N1DKKh8P2ot2qELgANjQClk3EK9EhgOEdCzAuzIHvIVfQyOAhVLkf4qEUd73I0EAUUdG/lzmADu3QR0KAarxG2JlG6Krqm1C7T8UwXsfUvx+iAjSPPLwa7xOtgWehpaHESDwk6FyvsBjuruBvkMrsRwvoEGnQ/LfpzW+emRuRXZqqr/lgjWPK2HCbZ2OgGoAID1l0bFQFMGPKY+GyA4WbNzMNTNnmtjERawO2RGbEky8mBezRkNncQJrZ8++L8g+LuTkBw9AlBDwTi45af4r+aMTEryV9AN95XBQNuXjoEbzuBNXAtt4N/J6enghzSFVUlJT02HHrkmXL/uLC9gB5y8e/Xl326VLaMXvwtK0NHyABbjjcKAZ81Dl9T72jKX73uNBB4XRPGHu3EATl/AXbnI9SypdsUoAAAAASUVORK5CYII='
ICON_CLONE_BASE_64_WHITE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGYSURBVFiF7ZaxK0VhGMZ/r25iMCElgwzKbCApdzBYZDEoEv+AySCTBQOTzSAUoW5GgwyUf8CqdDeUDeHm1mO4Hz469zjnnnuznKdOX9/3ve/3/s5z3nM6EEGStlW5FsLOzkQB8HQHvEaMbQJagVVJRTNbj1nrW54D2Rg5My6n4MbFoLiMpOEI57W7sVfSp2sPZnYVIXcfGAeWJWFmK79JK1VR0nS5qp4DS5KGJD27+fwPB9z4BBxEuJtPjQFtwJakgpkdhQWb2YWkEeAEWJNU/+WEo8rHKI6kc5f37pyYCoj5csBbG5T06PdE3Lfgt+aADWDHPd+9gJisDwHkgElKPZFJ6kCnpPEgJzwHQpXUAcwsJwlKPeQ7cQnMhqSuAS2JHfDWAp0IOSNfDQcOJb1582ugB9iV9GJmx38dkBSgr8y6AaNAzQAmgIYye/3E+KZUBGBm9+X2/L6IorpKAKqpFCAFSAFSgBQg8Q9JiAYkbYbsN9caoNtdoaolwCml365/A7g1s7OoAB2SbqpUuDFOcMYbu6oEEEsfZ4a0SYpYgA4AAAAASUVORK5CYII='
ICON_CLONE_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJDSURBVFiF7ZY9iBNBGIbfbzaKFlYqB2IhFop1Mio2Z2EhwiFmN+CpxWkjZjf2VmoRFc7KSyIWcqfccUpyucoT1ELhKjcWtqKNhQpqJfhzJvNaxGguuU02boJNXhhmd76feWY+ZhhBCGnbnQYwEca3TYoX/GLhWpA51ls2eQ/wW0jnTQC2wshV7XhVv5S7HhmAghOVUv5pGF+dTE9AZBqQFZCTCcddXynlr7QBaDtzqOvE4DYBIUbi2s7EAEAMPj5fnHrZlUQ4B8IRIptwXLRCxADzuGuOPx/m7zYq1BLHMmcqi1N3O8fKW6raGIx6IERWO95KczkaJfgCYL7rahqiHKVwRJS5rZPeD7+cu9/J3S/efBZPpQ8rI0ut5WgAfPYX8mfDzq+T3m4AI/Ulck7b3jp/ITfbKeZFsbAcT6WPKCNLzeXo8RS06TyAGwBntO1hLQgaHNzreJfqPwCFJVBOCpnVqXOxSABWrfawqtS4iMwHQghHSYy2YNU7oy6rKAAAUCkXSiTH61k5o23vFADULCyDPB3YBJ+Ani+iYIhEMo1VO1HMzQJ4HRSjbfcigC2RAIxl3dNJ73vT0CuQe6h4Rzvpr36pUO6WIxIAgX0Qrh4UQAgBZAzAgAAsc9z6aTasZaqKtV9U+DvlnwD8YuFDkC3heDtABpnbFPkURNUQYAgwBBgCDAH68h4I0AFtu7c62DcPGmDX79ZRAwMg5JFAJv8bgIDv/IXck7AA27XtvunLzMTGXtxjTf3OvgAg/GMEAH4Bd0/lFie5kocAAAAASUVORK5CYII='
ICON_BLOCK_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAARBSURBVHgB7ZdtSFtXGMefmxvbukyjRLMZB4uMaHOVkc6XVvxyQ6HsDUy7Mcq2QuxYkbqXlEHZvixmIGPfWjptYWwNjLGXDzOCXRkDkwykManNpS8xaKEpdVbWVjK1MTXNvXvOsVdSvSE3ar/1DzecnHNz/r/7nOc85wbgqZ4KNVZf74AnqFGOs41aLDalMU2Y484Cyw5GOM4NT0DEXAvg12q1/gs7d5rXAWRFMUgaoiT1bjWEbA6SVCEyzMn2eDyx9h6GfCCZU8MwZykRw/S2xmIe2KTWmHvaY7FepfsYubGVEGrNHwPYKohizNcBbBaiWHNFgI1AtDi6+ebUXOfh6atOYv5HdR3gFcChhJgVh8Z9p31FAaiFIMYMy7pr0wu8KxGFUvEhPDJfe2sCwTyR3we8qgEKQbQcOOpmsA/NQTbXOw9DubOLjs/cmYOpxDT8PByA23fuyT/zZrIlxwTfiaQqgHwQSua1PT30UtJwIATf/XpeBhEQwi5DsIUAvr97V/igquomGjokAL7lpUY+qn/OqWS+cH8JXH0DEIxcgX0dzatz1JtfAL7tZQiGr8Biaul5lhF3zExE/qQPBSqEFcyLlZLGdtf8v/xbs1OKT754PwXj16Zg8satdXPUGA1wxvMJlOlKSdxdLW9/xKsGkCEulVefJG373K2CYVcSgTj4hp22GUlyFwVANGJ4sXNJo4XNiADQKOBy2hyuCtUApMj03BTM5Mkr9+6lff/099OrGBFzC+YEkUaz7FAFIFc4Yj7L7wPLqVNQ19e3YYjmRssKAIC5IEBueSUF5vyjIlO9f39eCMx03HJzoEasWvNouTHwW02D2YSJ9KZ9Dx3XWa2wzWSC5MgILEQimNwMhJZZuJech1/O+em2bGqog+0lJY/Newl3CrlQQY0ac3KweGusdBtOYnXLVW4k/vP+AANNRvjwndfpdwLx/mdf00KUq8kbK3NgFUywaszJqTYdv5is5dpcy5mHO17BNSSRkLU2EmSN3z3+MS08ZCmC4cs0+ZrqV5av/6chukysKB5j1ZjLYyZraylWRJ5MKi9DPogy3TNwxHN8NeSfHzlI+0g0zgXGSLcQHjz9DavWnMjY0CGwGrEbAdZFQQmCiO96D/c+D4ZKPY3GV9/+SJ8ePb7Aciywas2JZuOhtKmx7QGu3at/Ry5D+y4ODBXlBSGqOjqoefeXJ+Td4cWjmZ6srFpzWTOxSAhzoQ5zwfbX6Dhs31ayurb5IBZxN3w6GKTmNPGy2S6SUxRgI69RGDpfDbe7MpPJ7LkgTMCwPwRlz9LyuhqReYMRriZToI9fgwdClIb9uq5S0GSzr4V8ZxLyXEzYavWTY1atea5aDxx14t53SwyY892zO3kbDs1M0PakTm8/dDEUyB1nojZbRTqddpDTDjYoAoIQnTidGUO88hdMggT24auYONR7fQwMy6mkksf//DVoTYcYxJ4AAAAASUVORK5CYII='
ICON_UNBLOCK_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAASuSURBVHgB7VZtTJtVFD63fUsLAwIhTnCaVRSygBGSFYYxxhcTlS9DmcsCukQwsgCTpWhIiDFQEqPhjy0uG/iRrT9cQsyEEgeMaAQ0i3zNVRcynDM22ogDa0r4hrbXe277ln6MWpxjf3iS9j33632ee865574Au9jFLu4xCOwQagwFaqIgQ4QS05n6/lapXwY7BJmC9AAFNQWqr2kv0O+ogNoPCg2UQrbUJjJikWwB7jLqThW1sF3rpDazWzvrL5n/VwEabY1IBHkpoVRNKfHslIA1+aF5BwW7dpMc2hm53n/tHSUhJ5bLW5gpBo9FqZyQqbGBXHDz9tqq4Djb+EVi8Lz/LEBzuK6FEKJHO25PDBSLh+BgZhqkq/eBfXEWPhnUw7prgc9dXxVg2vIAPk0bLkWDxWx03JEAf/Ly4nyoPlrIRUh4t6sebH/9wu0Y5R54MrUaTBcuw8ycHbssTES+JEIO20TO4bpKRm5Eu/nEMXil7DlQRin42MLSCujPvgVziz/55r/6fBOIB0UQcx+HkfFrsLi8kiwnbtUf1ycGcXxbxzBbW6NmTsOYwxtVL0JJfl7A+DdT3TDvnPK1i3NfhqzUJ7idsjcJOltPMk9Fo991miOvi9sWoJDJRLZYjbFG1/tjdPor6Bs/H0COP3+gCGkdOzEtIQKwXNaeKuzRGcSE20vw7P61o0UBvfaFW3Dh2w83OzYSQ8gloADuBXZysrW6BJ8ARqwlArnKTO26IsYQvBAn4+5xMXrAn9zY3QTLa0u8jRk/9/t+2Aq4Pk39ILdlsnXtpgdYnWb/fOeU0kpWPnX+CwVY5QUm3bsYgaRIjiIQSnmc57ithK9v0gYYudonoOPkgBErlW8WgZbq089mh3tRP4u5RI546elG7gGW6ezI/Q2RICAHVE6lnj2kiyJBoMKW+YAJ9/UPvpIOR546Dgf2Z0LKfUn8OJbWNsP75z6HBSYmYgHGBrODOmkZMz2VioVlTYg+hyZzqhWfN6w2GGLEwRn/TJaWx7e3o5UVJk+SdvUNwbE334OLw6MBpDd+tfEnq4LWkEI0OXjTkVOUhpWk3Nt1IKcwbd5s6Lq0LyNXJ1cuqeacw775Wal5UCHWB7wDY1zCSjMWHgzFyPiPXNxj6Q/z8dPne3mY5G53w20r4eTAzWlNUVoiU5jnlVqgKXp0ZHE++tYjGbOidMEkxd8PJ154BxRCVMg7sDRXlHjO/PdTP0PT8XLeh97oGx7Dbst4T0db2LuAHc0hkG464gmB97Rwcl1ZGyTF7YV/w8LSMidHb9Q0Gz0JSmnVRPcZU9hKyPKhCvzyQSJHXB2LB7t9HSJBCDmACcnRCHsZYT4w148RIJX+/X/+lmCZsamSv7x8hV9EUmy3whUWgsa2jzg5TzyXq8o2PRnZbcjywcpEECZCxDZ+Un36trkiJeNQ4sbGRt53lutwcWgU4mJ5eYWkhHj+nJm1w8jENTCwo/jxZ/086Ri5ReZyFY6aO63S+yP+HvDmg6OjfqBM6uNXM7sfKNkMzRZwUELaY52CcdjvYwQR8Tch5oMKVgMWe+NoQiFMRCnbj5rtyFM9KVgpJi5198a6laZgYgn/AHyK0qEpHnfuAAAAAElFTkSuQmCC'
ICON_APPLY_BASE_64_WHITE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAQAAACJ4248AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAAAqo0jMgAAAAlwSFlzAAAAYAAAAGAA8GtCzwAAAAd0SU1FB+cGBQkPDYnz3/UAAADaSURBVFjD7ZQ9CsIwAEYtpGtGCb2LnqGXk5Br6JaphRxBpIfRPIeAVeyf2MTBvD3fexCSzSaT+Qfw+z3UNb4s04opCtCaB87hpUwoN4Y3jscfygGuV7wQP5IDNE1k+eEwLu86qKosnx7zZRne7G63XD5155cLKLVQLiU41x/WGooiiTwMnk7vI8YMRawv90LA7TY89hqxurwfbtvx0RARTR4ClAoDUxGR5P1VbLdwPvMxK77zzyMifDLLI2L+cLMREeXzEQnk4xEJ5Y8IlMJbi7f266eWyWSeuAN4YjZi8rn4owAAAABJRU5ErkJggg=='
# ICON_FILTER_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYEAYAAACw5+G7AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAAAAAAAAPlDu38AAAAJcEhZcwAAAGAAAABgAPBrQs8AAAAHdElNRQfnBgYJJA3tNo1yAAADuUlEQVRYw+1VbWxTZRQ+7123McQR5t36gyyZMphYIrDdC8qqa8LQaMY277trpCHKgLVp3xKCEjDLcND5Y9HJcO4jA+OoCYotbJAuSJQEMsiypq2QukkGGZpucWCFGYpNtq73+MeSODMrW1k14fn55jnnPM85555LhK9opdnV1UUa4C75vLwc/uvgoRiEUIi7htn4dUmJilTBSvJlRgasAB42ut1chDutnDaZEq1zKlCHauLVaDCIC4nl6NHJI0Qin6WlwepeucJsz80Vv6HPs93BoChLdrN9y5ZEC44it+mV3B1nUlOFX+kp9sSVK0K35DP/Yrf/jSisrthv/tFoFA9IfpZ07544Un6VuZYtS7SBNZnSbcszBw+KQN9hTw0Pa7V6vcm0aNG0AeIIHWAuh0MI0XVsldtdkG+oMlQlJ8+18ILfXutgbRs2iPOojanD4QKkyFCnm8rjpj4opSmXwp+aTGQP6KB38WJu6+1g8qWamjkTnr+p3VDF81wNdx3estnwW2KAbfX1XnKStJALF2bcAeF7WTZ9UVT0sA1Ed1zolnws4PHMegNEmX5kth86JGqpjx3x+2Pu4CyEs4DBEP0GhTpZNqXk5cWK42IRxl4ItSUt2LsXT8ENePfOnfHl436ytakpXsKjVxBWkfMQbmggHhgibTt3evY5HG0Tg4Nx65DYTN9gyzUaMYPq2MpQaM1jUo0lS6+fab4iLMJaVKnEHprP3u/ri/5QHzRPzAlE4bacPN5ydWAA9+M8eLG6Gl8lZ/BYa+taLEMj5uQ8aOHQe5kLA5NWK/wMx8CbnU0KI3sIbN8et47/MwgRbtBqlnP2rNBHnzT7e3pkWZZlOSkpVmT0GNw/Dt2Sb8eK4uKZKvnXE/grEFFWdoVfqqyEpTAfHtdofmpUhKzdmzdPH1OLtchxpFSZ5HwtLXCCWEFqbvaUdD77Sf+5c3NsAMDr7co8fHh0lHsae7hCmw0qsYJoS0un46/d1J861r1kCfDAQVCj4e6O96pG6utnWn/WBu4jD+qg7OZNcBEnMp6fjqZ8yJVFsngeRKBgQXTpneqPnbduJd5AgvHIQKLxyECi8b83oHpYiZ8bluVdvWlpk2Flafg8pTAWWYdDRiNKxAMpgQC0xqdO/CbwMhrApFaLH9DjLLO9PfK2MjTx++gosWI50sZGsJJBVHm9kflcPyqFhfEqS2abQNxXkW4Or18PHYqHbOzsxDqSTr67eBEuw5s41NER0nLp/AKn84fXHScOkImJuDXsT/wBYvGEKnzpsjgAAAAASUVORK5CYII='
ICON_FILTER_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAI7SURBVHgB7VZNUupAEO6eBNccAW5AlbjPO4Epdf/C7j21CjwBcAKhSix34lpRbyBLS1hwAzkCGzdgMnZPJooIJkPwr8qvKplOpjP5vqnpbwbgi4F8K+7sVVDCIXwS6KfDu04rz7HgW/+i1SACQ/gkSCnrUWxHQSCwhFLeUDia+Jn84LoxghWiuLVbRcSaUn953I7eiyjoXxx1JUCXwuyaGFdghSi4/3KAqMYMEEvTfeJVJqKaGolYVh+tCBnLqpLyLIVtFrqQgO48A54FS6xkUWohHseW79dn+8XsC0qqUTOSgG5xZ9+BlGD1OmzfXp8MYwlwEq3SJse0KKuQAhtbux41Hi+8eernEmA8BmsNargKnPXtfReWBioBAUJznvqFBLgEJUI9TJCHBbeSBUMo9Qg5Vs8+syhPLOrQHw3oypmWZUg4VD9tOkYE1MeIB7otm8yCLcblSH1vynSMCUybU0ZMEi1ILjt2PDW47/+JyxdxCSjkQRhAJYk5xZWdMYHe+fEgAGzqwU/fy40znaUIMHzfroEuy/fMyX4miM0k6hMTUGUZY05cdrTonNB0HhuQEIkIMNic9JnB0Q43g5eyS6reiADPQgDyTP2EvOHt/8N3cWW3NIGPwi+BXwI/kwBtNpvr7v8UB5UX2CbJ7HI6LAhLXG1s7/Fzd5LQ9+fBaAbYZGiTyZPdlbQr5ujyaJO6hyWBkAK8MdHe4FG4CeG5H3qdltGYqQhEcOi09CDGLp2c/vY7rdhDyLfCE93c3zZs1MgRAAAAAElFTkSuQmCC'
# ICON_CLEAR_FILTER_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYEAYAAACw5+G7AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAAAAAAAAPlDu38AAAAJcEhZcwAAAGAAAABgAPBrQs8AAAAHdElNRQfnBhAOESB65Q13AAADQElEQVRYw+2VX0hTYRjG3++opK2FESpEjaLMnDdunnMmapFBOS1X29nRQUGombizRUKSRRCW/bGoiJrG7B/Rha6WimmSxm5cqTUHaogsupBJlKZeaIa683XjKSjkmC6L2O/u8L3fy/M+3/NyAAIECLBEnManMUEokjRtJs2aNcL3YrsuuoEYFMuyRlt8POXswcOX+/uD34XweIXDQal7C4ZbPB4ymtWbw2h6aUz8DRIStENcmVJJVTN9nHZwkGK1L402tVo4V23UPTVmpaYK5wlK5hUnVan+tu4fjs8Ko29rhwrdu3fPVU+u0h01nUhOJp1MJNfh9dIenbpwU2LikgsXHBeEJIxp73GVO3fO9z59lRkxr9269fvgmSxrsm7Y8M8L/xnyLLOJo4uLSZ0+0nimvFysfsFLrDy5V2eSp6WhbNQFroYGHMeXQ1dOjiu8NsdS2NKy0L6oFXqwOjQUlmMNbJme9vsAguNBniA3vl5TgyrRLYgZHQ3d6IuefN/evlDhlFdPcR179oAPPGhdfj7u4y/MtFosfhtAWE7CRVyEu/X1+CDUE0V6PU6G1VhZVzdFhhwOO9zcnLxa05ZbLJXOty9p1ceaGtPTwYDvQHdFBV7PP/DJMjJcrtoIq/XDh4Ua8sNxJas/MiKTiWWcPMAcMtrKyqg0Rs55nE7as99sblq5UsxxKoXp5qoGBqibjIGLjYtbtOBfhM0uE8UySqOtpES0XmQQSsGsM+ZlZvpLuHiEcvlW1I4xvob3oRSExMrfPLTfrsg6dQpHQBJ2OxzY9PUFH/3sGfmFZQs/Z2eDBBpRosUCBjgPV9PTX5vs1Za+t2/97rzAfCM05/1OvcF4yW6nSpkRU/j4+B+Lihi//YedXU4hKnSMpq0glyT9rUs0Er8I28ZUmpsUChQFVXyIwwEqyOfDe3uhDz6hmclJuIfK0UWJBAbwR1ykUIAMRaFrbjfk4OO4ZGJirr5YCedQDM8Tu/AOoj0vrzP6SfONDK/X7wMI0J69KeYmuRzvWtbouyKREJH4EN7M8+gx4OD7QUE+K3Flar1USjznjxHbx8bE+vEyAJTq871+JLdFsN3dAKWoFPG8Hx8rQID/km/eQo5c4yC21gAAAABJRU5ErkJggg=='
ICON_CLEAR_FILTER_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGPSURBVHgB7ZW7UsJAFIbPbsDaWp2RGhsKBy3JG6BjL3aOFuITGN7AQhw7sFZm8AnEziEW2EhLI3Vqks16NnEzIS4hF7Tyb7LX799zds8E4JdFIIN2D8+uCJCGByBgDHvt+5UZeHBCjAikschEg4xw/LY4IS8Ir2G3vlWuTj7H5ntmgyh8+HhjTD+Gg42dPRJnkshABZdzy0xoHrjUG45hulqizQG64TmaFy7lOE5XNU5XAa/UT0tFqj17awEm4bmCEn503iQcjFRwAiUBp4zpEBdBpd5cR/ix7HPOt9PAX/t3k/AaLQovarYItSI2oJGFm2ub5WppOjaf0sK9DCyCy1BdhHCEYLNr9tonaeCBgQouN+wjLGxiM9ZKCvcM4uBSERN5sqVwIVrQZh0BFx3OZgeqDWLMpbSfFu4bMPcSL9NfqK11RETRRV5NcLeJTQsrdZAU/n2YHykY2ayoj/rXVgD3C84CynXz4XYEKRS8IpVJgc4u8sDnDBQmiYRPN/anNVfJIq/UZXpwJ//6C30BOkUEgAeCF3MAAAAASUVORK5CYII='
ICON_UPDATE_LOG_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAYAAAAj6qa3AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAAAAAAAAPlDu38AAAAJcEhZcwAAAGAAAABgAPBrQs8AAAAHdElNRQfnBhQNLSJqPDyqAAAKYklEQVRo3tVZeVxURxL+6s1wCAFRDg+MAdSo8QBhBl0NAZGoSxIRhknEa4OJiAx4rKgRFQJeSNgcchgHJRGVGDlk8PpJPICgLiAYs4oxihckGAQRDxBm5vX+ge/p6rJmvUi+f+ZX3dU1/VVXv67qJrxguDgHbAiaaWVFMS1/kUjNzaWOkhXsSkuLdmLzYt62oaGsbLdMrW5qelHzoWdtUJ6omKQaOGgQ1rOp1O+99xBIVazU05NNQivKhg4lXxRilZlZuwaMEAWnqip0YqYUUlrKVnDJcNy92zjcsEYvz8kpKkpPX7++oeEP4wDXxb67QhscHZmGG8WOxcbCDDOxZ/z4Z+1YVKIeRc3NrJrlISYlhbmxRu2e2Niysp3WanVNzQtzgIvL28eDgkxMaKJRtdRr3Tp6mY2n9YGBSKIpeI3jBD22E29g6a1bZIdDSN+3j/ogkAoPH2YmCOOtf/mFJ+ygHbW1gr4khO/LF1pZ8Wc5CSdzdIQduuOauzstQAoGenpiCHLhL5WKE7HDRUxsbKS77B90ccGCkl3ZoxODNm1qb95KpVKpVEokF4/wy637zpnDaZktp6mo+N0OGFGlVAa/ZWurO6lfLvlao6FoisbHLi6ighe+Y7FXrkCFpVQRGdmQ3ZTC1W/ffn7OvvMJ3i0tT7pCI4f6hgfvt7HR+kjUnOe8eXBjg2hJWBiWoieaX3pJVNyA03BOTeU/tHTT/jM4uKxcnaJO0WrFhfvJ3yOkwceHm8YsaVlODgIwApobNx7rABdnpf+c6717UwJfqD939CjNgxvSbG0hhwKhjMGSglnf2FiTGNPGO9KYmALaTJvp7t0nJfw4DIv3S1RNfuUVyTgKQnpqKs1AAFSenqLCRpaE4RqN3UpJWO0uhSIjIyMjI0Ovl/n524TErF1LVcyNflu0iGUyNYuvqODa+6Ohn0yzCZ9qaspp9Wv032o0InFhL8azg2QcEFC6IvNmskFExPMmLuBEeHZoUvrly/Yx3JRa5dix2MlcMH3DBlHhQ1Kh2MfnUr3eodvVdeuEZpLwibR8+HBR9qBSulpS0m4EyOYoxqpupafTMZjho4AAccW301Y2wd+/9Hrm3uRz2dnPm/DvA5F8sd/mkIZNm3CIcmlZYKDYVUnNLE+hwHbWQD6bNwtbh25iGlXNnv1IBMi6+M0LXTJqlEhcwGn4sm+iojqauOuniuthvdzc5EqlMmSHk5M7c2dRTCLhv7Mq0i2aNYtFsSh8XFYmDpjLf0kX0tIe/mbw3VBDwcXFjziAXCmPzYiLExv+BgMc+uknk/w6Y+voNWs6irhLtcJQ5ebtzb7BTN6nsBCXeJ4KTpxo8rb6su7rxkZKrj8gXX7wIK6RDQ26elUcuJvmI9jUVJSt4AVZUxO7bVnesvPUKfFYkWf5Jaomv/EGYnEYn48cKTrkR/xMW5YsKaACiiadrqMcIGnmfLglly6xRn4Yn1Vfj84og7GlJepwAMdNTCgMznTczQ2Aiin/h6E49jKMysvLhqhnq1O02vsRMBw3MXfyZFEuhR32VVeXqLPKE2UaTUcRF1DSLyMjwbuiwuRs3RKrjd27kyf/Pq10cmoL+VmzhGMQQ/ABPjt1iqWiBWP0+kcMdYEF+hQWCuL9xCKNRsPLywtAGaYDSEUCbDUazABwgbGOdoCA/4zEkyex9t4vAECtBuCND4BRmglFMxaamekspDeMr8lkfAGdpgW9e/M+rcbaTRkZgj1ycVb6B83s3JmT8MzA8MYNoYPfQvVs5cSJZQMy85O7dHwEPC9w9BI/xsjXweGRnin6DEqqquroCT4ryO39eoWMCQmRXVBEhK6aOlVolyKJO6S7YW6OGTwePhK0V568yPijwMVZ6R9qM2QIJDxjA5KSKB6DmR9jI6qUyvmj9+7l0Kf1ZYy7cEEoLlAHHmanT7dVWQ8cJ39WHNK9xaK7dxflUmQhkUji1DK3cadWyx030Xy63rKqqsXVpLrTZltbvoullbZ+2LA27T/Ox+9JwW3l9mNdly5iw78wAZk63ZH63NdTP7l9W4z6HxduqY3feufOw1XUnx1sInsNB/v0ERu+hitGCmU4Y49kgi4uvteCgnr0kFdPPKMqtrTsaAJPjQb6CD29vEQ5C80s4PvvBVF0gFBmchc5pUFxZSVWS07A/No1+VyFZ8jF8nJ5qSJCtT4uzvWcf68Q87FjR1QplfOPdurU0fzag3C8w5g1oPh+ZoswyqSfDxwQRLEalPXzawrZERpKFjSNChISHvcHLJ0lY/rdu+RB/VF85AjZs/epJi+v5Xv9Z5LVavVJ0tAXdD+veNGQuyuaQyKXL0cTplJ9TAxG4xaLbm3VFWkjuRn29ieO5r6emPvrr2IEUCZu0t0HQuVhDGKLEVZXJ+pPphCkGRujJ8bg7JgxrIWq2M21aw2aJVpdbnR0RxF3ZD5sLrOwYNmQYf68eWLHHOZBlV99JRAXmqVt5aRU2vQuudQd8PAAYP9fLa8kUzTm59NsjiPHRYv4WfrlzPfNNwGAMS8vXKdaOjx4MJfOGvneeXkdQ5/IMEkaoHtt40ZsxgDy7NoVJiwVPbRa3XZswRePVrPSO81WlbXXXV3pEuy5nM6dxZ5VCEOnLVuwFAlonjYNvohEmr8/s+Mv8u5lZcffzh6abB0b26asVncM4fuQVytsVMXz58MXWqQpFGKHDY1mr0ZGngjPKk9edvnyw+M4VGIeV/BA6OtQAqurV+1SuKTay4GB7H3swooHVtQa4TRk9WrZCkVflevChR1NXLZQcV0liYjAanwO8/h4oZ3tYV/hzO7dpRlZ5cnvrl3b3niOwIJxty2UAQCX2SbIDx4ULhONIrWHmtf4+2M8W8g+LykRMinKhSPkcXGyfMUxldm2bW2nQteuz5uwcDzL8xT5qvC0NMrHTASvWiXMixWgBkeOHzf2Mw7m+0+ffs8d7SZ0HGpoFcqdnIQGmsnlspj7K96WMd261RqjH24gHTeOfYv+2LN/v6i/EPGYPnmy7iw/qPXXM2dkTYrzoQ7h4a7npoSF7TU3f1rCwkdNbqowDJ05dy77gdPi6Llz4tYUVjwESZSxZ09rksn5ToM9PH7vCxK59lfkhE4IDmZDUclPHTDgjpI7Zq1ctKji3YzMaGptfXiA8MBwqZZPsx4YEYE52Ebnly5FLPahi5GROCHhmGwCw9n9+1k/uk0fFxVhK72DhNOnaQ1/i/+0ro5JJSMkR4monjXpe/XqxarZOk7v4IDbzIbZubtTPPmzHWPH4jDMKMrQUJzIvdtp1OMwfoiLM0EdrLBy5f97c/XUT2NtIfnqq6iQ/IaMZcuwig2DxaRJaKIZqDEweFr7Iu7l8HgHQ1hCVpZuODtKOYsXC9fkT2r2mT+ODhs5oSh0Qs+ekmtSZ36qnx9NgCFe9/ZmK+gSOTg7kzsW44Nu3R4eJ1xhURXscbi6Gn9HNP565gzrROvYwJwcRgY9dKuzssrKv5mlTrmfjzwtnrkDHodRlm1XVS1VlG30kYWFPlniwIVxXEtvSb7Vtpqa9rbe88K/AYtyq+GYk/nhAAAAAElFTkSuQmCC'
ICON_SAVE_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEJSURBVHgB7ZZBCoJAFIbfS7tEtGgbbVxobT1CaQdwGRZ0hPQGLaI6RJRHcC0FrVq36hIhNk8IKqQZNTJiPhgc8J/5f58PZgAkJTDscUIDSlCDipEBZAAZQAaQAVSeQOuPWnVF2WGSBNF26YMAhu1OAdC5xvHgGKzP77TcCqiq2qIcCaLXtdwZT6+nGpzTGgVQ4+m5AfabRcjM0y/nhSBzZBqas6d/CFYBb3+hHmAhPF6IV/OIrRHYGhQQ5HKKwkanhwhgMgez2TbIyaR3DTYvYp7qISf6cOKxhsz8DXnNCeEK3HmqREnzQgGyQhQ1L41huQ4N+As+ccMt4iMPo987Db/RB49UXgHJDWyLW9JxL6HiAAAAAElFTkSuQmCC'
ICON_LEFT_ARROW_BASE_64 = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAApgAAAKYB3X3/OAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFXSURBVEiJndbLbhMxFIDhT0kGnoYNqKVcciNJuyvP1jeoEOIeoKUtb8St2+7NIk41ScaecSx5dTT/b9nnMkIISjZOcIfQsk9DCErhx/iFx4l4hQt8waBIgEWEP8nAv2G5hncWYI7fOEjEBxH8FdVGrAN8FuGHGfjnePpqJ94CfxXhR4l4Hx/xvQmeFWCKP3iWgX/AJR4kOYmPJxH+IgN/hx85eKMA4wh/mYD38BZXbfAdAUb4i1EG/gbXXeAbAgwjfJyBn+MGD7vA7wV4FOHTzKOf4WcJPISgZ7X68YS5VbXEm9dWzt9i0pI55VdUg8yiJPUOfbzf65EbJKlMWhdYeZrWIHP8wzARH+CTfQqtQZIquHWTK28VNcgiSlItY2A1XMqbXYPkeUaytE+7rkGOrQox1VnX06x84DRIUrOhildVPjJrkJMoeZqR7Df0tyRdfltehxD8B8k8yTaHLwT/AAAAAElFTkSuQmCC'
ICON_CHANGE_BASE_64 = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACxAAAAsQHGLUmNAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAOdJREFUSInl1SFOA0EUxvFfoSEtu7AJwVYWgeUG3KYCi+AIGBSOU3ABBCGtaQgOT5vgMAQSDIiZJs3CUnbYCuhnZme+N+8/ybw3yyooQ5G6eX2Bv4dx/L5OhVSpjwkusLa6yVul+S7u4niJ95r53nCEp9lCuxTwgocIuMdzAuB1UVCBIW6wVRPwYxUYCaWZV8Rk2Fgm5DT6yU04Dzn7wssj/NeQDrYrvMYg3ynDlfCk7JTNch90MFD/8nIc4xaHQrnjcx90cZAAmB20h815QBNq4RyP2G8y8d9ODieYCj+lpagQSvSf6wOQVilL2RIj8AAAAABJRU5ErkJggg=='
ICON_CHANGE_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHTSURBVEiJ3ZQ9SFtRHMXP/+bl5eOlcYndHOuiZokfWwmC1W62NkMHwSlQ03YKglNCXdwcbBQyOHZ5g6BS7WJBKmJJKB1aimtHocWa5NG8vPt3ipiY98IzcckZ77n3/Lgf5wI9r+iTtBZLJPvuul44mePPUoO+sHFG7E11HTAx9/YRCxwy835huH/1rgCyC5ewPjP4oDDyMIlsVnYN0M3wW4DYy2REmN7vYESIsMMMdpXGqPr88s2XD5t/60NKw4QSKqTiNwMRBn4RoeQmX4KrimoYtjsAgFgi2SekcgCQVE1j5nhn69LVLpp06xUV9fyFFLUZAjymEvg4lFgMtVoYnU9rQ4ms6hpQh1jCnAbBq1m03wrirxgZTZ4ftSuhbQ9uQoJMK81+WfA7MEyP9H5ygjg2uajnL4IPynHhE5lm74e+USp7+Gk7SMuiuVF0Pq35KsYegLAi1KkTfe2PLSC+sOAvXQZfCaK2l3dTDITAWCLgm1U1J4u7+Urda+hBrRoIEFOMAVcAIhADYMIAQggCuAZ0fEQAaOz56/cQPCdITJ7q6z8bzPsM7xTQNhxo/otcaPRFahngWbLw+HR7/cxunmMPnMRk5v7/Cwx+3c7ZhveGrgAiFrY4Ehz/8QAAAABJRU5ErkJggg=='
ICON_EXPAND_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFkSURBVEiJ7ZShT1tRFIe/AyiGLCxQ/gBKLe8hRyDBbpS+NCQNwfM0El4lvp0EAyVNaJdgMVTM7OKWtMkMGKqKXUbS8kOQJhheHzDZT55z7+87V9wDI4Yw/pbDfj6MZheWvnTarvnfBX4+jCQdmNnKXMYjqSSRYBAO9IBHM1tNL/pKIhkqeBHex7QjUTOzHLCWRBIr8PNhIKkC9JAVXb1y1mm7Vjqz/AfjG7CWznq/Oy3Xfi1jLE4w2U39AKrIiq5Rrg3qrlGuISsiTj91Zy7iMkaM+DgW1wyCYPym//nIjEtXL5+87Pn5MHgUG1P3qe2rq6j3WkbsP7jV9FczbYOOvVxYGNS9XFiQVDW09TfV3Xj3CwD8XLgn0yHQB9sx40FSFZiQFF03vpc+JADwNnf3gRLPyw5gwsxKv87L0bC7ibZpp+2a81n/H7AOjEmKXL0SO/mbBAB3LfdzPrtsZtZMGj4iEU+YcpHRJ5ZlsgAAAABJRU5ErkJggg=='
ICON_EXPAND_32_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHmSURBVFiF7Za/axNhGMc/T1NDizqKaDO4CG1vk+TqZgQdioLS3hX8B1ySWXDR6+ieZO5gFy8/sDg4XoQuuQidEikOWZLF2VpCe49DcyCh4HsJuHjf7eH9vs/389wL73uQ6n9XZp7NtlP2bq3mH4z6YfufA9hO2VPVtyJSvL1WYFaImQDi8LieByIxwFT4GDgHMiJSXFm3NSlEIoDpcFVxRXUfEQdYBB4mhTAGuCy826wcjL6F31dWC19nhVgwMRWL3iKqhThchO1us3IQr4et2mcRXC6OBKDguq7RcEamwSCIlu/cbyxfYV2E15169dO0Z9gLj3OWfQSydLJwYyfwa2cmvVOlSpVKTI2W62Wv6o/9CN5369WPl3nyTnkTjV5eu37yItjbOzXpa3QTuq6b+RlJC3gusJWz7KNhLzz+02M7pacoLUGss3H23t2bTz4MBkH0t95Gb4Hv++cKXyZlVpVG3ik9i9fzTnlTFR/IAkSqnSDwjK5i4yMAsLfKr1T03aQcq7ADMhbVJrAEoKpet1nbNe2ZCACgsF16A8QB8euXBRCR3U694iXpl/iPaNQP27m1jV8Ijyf7M3AxedioGk8+MwDAsN85zFn2KfAoDk/y2ecGABj2wsOctSEi0p5l8lSpYv0Gs0TP/S5ZbeUAAAAASUVORK5CYII='
ICON_COLLAPSE_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFbSURBVEiJ7ZS/S0JRFMe/R52qUZLSPyBz7T3HIqE5Hz4kEHHv7Y09t/6AZ2MtZQhp0Nqig4u3LVBoiYacbI0C9dvweCCBz9cPsMHveA7n+zn3nnsusNC8JX5J0zTDT6PYmQjuVN25mMzpOcscE9mV12ix2bSH0zxCfoBnxgwRFgGea4aV9+KaYeVJVgU8eIsOsj8+gdvp4RGJEwAjQEoi+CBZBRAhad83Tsu/ArgQyyZ5DMC7ioiIlDvXjj2rNhwE8NLtNBMp/R3AHoAQSVvVK76dfwvgQlQ7kUqLiLSCmi/0PxR4yID7XNc2trb7PdX6c4C3CyKys57UEBQSCPBl0cYishvf1BkEMhMwYT6CsESiJiIGgEwQiC9Az1kmyQqAISgFVa9c9XuqG0+mHyHYB5CJp7SHflf1pnn4/qZLg+gNgCooBdVwal5cNZwaKAUQl8uD1Vs/j4Xmr0/ZzJTTxEfPgAAAAABJRU5ErkJggg=='
ICON_COLLAPSE_32_BASE_64_BLUE = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGlSURBVFiF7ZbBSgJRFIb/M84UErkNe4CIFkFomAUxEUErF4oLkxYFuRiUNj2ArxC1ctEqaSG4ECqFitmFC2kViA+QtG2R0oz3tplRM4OZUYtgvs3APZfz/+fM5Z4LuLj8J4IxJRGIpvw/xQPRlD8YUxJ2cgpWN67GlCMCXQokqSuR9PxgPBQ5nhNIuiNQPhhT0mM1IMtZEZwOjP0LosTv+zsRiKb8TNJVAEsAiDjtyXJWtJKbrDpd3j+ZmX5v3QDYNJYaukZbU/B0mKQ/GOIAx6PgFXar+bO3sRoAgFAy42MtVgYhbCzVje+iE3HbBoChnYBTcUcGhppwKO7YwBcTHJJT8ZEJJTO+UDLj+3VhFxeTcRxCy8NomDhrdyqsxcqjmHB0D5jiAK0B+N2L6Ju4iUMTtn5Bdxj1xOswBxIhzNrsdiNyODsRA93Ke5OwoWu0LWiiDODZWFv/EL0VO2fC8oNksHLGNfmpdP5SLZ2+Mq7toK8TvMWu4/G4Z2wGVDWrk4ALAAxG5bVirmnGa8Vcs68TnINfFQqFjpXctpjEo9TF5c/5BEWtuhiat6hyAAAAAElFTkSuQmCC'
ICON_FOLDER = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsSAAALEgHS3X78AAABnUlEQVQ4y8WSv2rUQRSFv7vZgJFFsQg2EkWb4AvEJ8hqKVilSmFn3iNvIAp21oIW9haihBRKiqwElMVsIJjNrprsOr/5dyzml3UhEQIWHhjmcpn7zblw4B9lJ8Xag9mlmQb3AJzX3tOX8Tngzg349q7t5xcfzpKGhOFHnjx+9qLTzW8wsmFTL2Gzk7Y2O/k9kCbtwUZbV+Zvo8Md3PALrjoiqsKSR9ljpAJpwOsNtlfXfRvoNU8Arr/NsVo0ry5z4dZN5hoGqEzYDChBOoKwS/vSq0XW3y5NAI/uN1cvLqzQur4MCpBGEEd1PQDfQ74HYR+LfeQOAOYAmgAmbly+dgfid5CHPIKqC74L8RDyGPIYy7+QQjFWa7ICsQ8SpB/IfcJSDVMAJUwJkYDMNOEPIBxA/gnuMyYPijXAI3lMse7FGnIKsIuqrxgRSeXOoYZUCI8pIKW/OHA7kD2YYcpAKgM5ABXk4qSsdJaDOMCsgTIYAlL5TQFTyUIZDmev0N/bnwqnylEBQS45UKnHx/lUlFvA3fo+jwR8ALb47/oNma38cuqiJ9AAAAAASUVORK5CYII='
ICON_FILE = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsSAAALEgHS3X78AAABU0lEQVQ4y52TzStEURiHn/ecc6XG54JSdlMkNhYWsiILS0lsJaUsLW2Mv8CfIDtr2VtbY4GUEvmIZnKbZsY977Uwt2HcyW1+dTZvt6fn9557BGB+aaNQKBR2ifkbgWR+cX13ubO1svz++niVTA1ArDHDg91UahHFsMxbKWycYsjze4muTsP64vT43v7hSf/A0FgdjQPQWAmco68nB+T+SFSqNUQgcIbN1bn8Z3RwvL22MAvcu8TACFgrpMVZ4aUYcn77BMDkxGgemAGOHIBXxRjBWZMKoCPA2h6qEUSRR2MF6GxUUMUaIUgBCNTnAcm3H2G5YQfgvccYIXAtDH7FoKq/AaqKlbrBj2trFVXfBPAea4SOIIsBeN9kkCwxsNkAqRWy7+B7Z00G3xVc2wZeMSI4S7sVYkSk5Z/4PyBWROqvox3A28PN2cjUwinQC9QyckKALxj4kv2auK0xAAAAAElFTkSuQmCC'
ICON_RADIO_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAJ1AAACdQF32cIiAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAM9JREFUOI3F0bFOQkEQheEvXg1g1CAFJCQ2hprGgthToi2v42toQXgJSgrsbE1ssKCwtCAUSmiAgjEhF7xeK6aZPbO7/5yd5dCRpPQNKvjMCzhO6TvM8JYXcJT34H8ATbzgA32Uo15C6y/AGG084xF1PMXevc2MbrMAdbxH/RJDdFDEyma4V1mAMzSinuA6rF/gJPJ3+hnb8RCdJhjhK3Q1Onft/txewBLTWP8A9sZvtNfICc6zOqZnMI9c27q8xCKvgx4KOA09CDezLBeHjTWGkSHmlMppoQAAAABJRU5ErkJggg=='
ICON_RADIO2_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAQAAAC8EZeQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHSWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI0LTA0LTE1VDE2OjQ5OjM4KzAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0LTA0LTE1VDE3OjQ3OjAzKzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNC0wNC0xNVQxNzo0NzowMyswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N2JhMWYwZTQtMjhiOC1iMjQ3LWEzNGQtMTEyMTU4NzFiY2UyIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDg5YjE4MjAtNTMyNS1hNTRlLTk3NWUtMWYyMTcxYzY3MjNkIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE1ODJjM2ItZTY1ZS1lODQzLWEwMTctNzk2MmZiM2FiZDRlIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIxIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0iRG90IEdhaW4gMjUlIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphYTU4MmMzYi1lNjVlLWU4NDMtYTAxNy03OTYyZmIzYWJkNGUiIHN0RXZ0OndoZW49IjIwMjQtMDQtMTVUMTY6NDk6MzgrMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MGY2ODY5OGMtZDRlMC0yNDRjLWE4ZGMtODIzMjhjNzVkODlmIiBzdEV2dDp3aGVuPSIyMDI0LTA0LTE1VDE2OjUzOjE3KzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjdiYTFmMGU0LTI4YjgtYjI0Ny1hMzRkLTExMjE1ODcxYmNlMiIgc3RFdnQ6d2hlbj0iMjAyNC0wNC0xNVQxNzo0NzowMyswMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT54bXAuZGlkOmFhNTgyYzNiLWU2NWUtZTg0My1hMDE3LTc5NjJmYjNhYmQ0ZTwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PlL2CDMAAABLSURBVCiRtZBBCgAgCATb8P9f3g5RFpZC0oAQKg4bWAYgUa7U+yhcBEHbFR33SqtFnxrldDkTJlR7Ud7UhJZl+naxXf560cf/k4UG/QUXH9TfgfAAAAAASUVORK5CYII='
ICON_RADIO2_BLOCK_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAQAAAC8EZeQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHSWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI0LTA0LTE1VDE2OjQ5OjM4KzAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0LTA0LTE1VDE3OjUyOjI5KzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNC0wNC0xNVQxNzo1MjoyOSswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MmM2ODk4YWMtN2E5MC0zOTQ3LTk2N2MtNmY1MDc5MDI5NTYzIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YThlOThjNDctMjUzZi0wMjQ0LTgyYzQtMmY3YjhmOTI4NWMxIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE1ODJjM2ItZTY1ZS1lODQzLWEwMTctNzk2MmZiM2FiZDRlIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIxIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0iRG90IEdhaW4gMjUlIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphYTU4MmMzYi1lNjVlLWU4NDMtYTAxNy03OTYyZmIzYWJkNGUiIHN0RXZ0OndoZW49IjIwMjQtMDQtMTVUMTY6NDk6MzgrMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MGY2ODY5OGMtZDRlMC0yNDRjLWE4ZGMtODIzMjhjNzVkODlmIiBzdEV2dDp3aGVuPSIyMDI0LTA0LTE1VDE2OjUzOjE3KzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJjNjg5OGFjLTdhOTAtMzk0Ny05NjdjLTZmNTA3OTAyOTU2MyIgc3RFdnQ6d2hlbj0iMjAyNC0wNC0xNVQxNzo1MjoyOSswMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT54bXAuZGlkOmFhNTgyYzNiLWU2NWUtZTg0My1hMDE3LTc5NjJmYjNhYmQ0ZTwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhHyWHwAAABTSURBVCiRY/zPAAGTGBj+MzBCOQx5DOiACUMEB8Cm8D/Df0xBFiRpBmwKSLaaBYkN9wo2kynyDEGr8XiFTKsZkTBehf8Z8IQmbU3ECxjxhgkSAACslBAeYEizVwAAAABJRU5ErkJggg=='
ICON_RADIO_RED_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAJ1AAACdQF32cIiAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAUJJREFUOI3NkT9LQlEYxn/vuVe995qKkFYUDUU1pBBNDQ4NUUNDS0RTX6Dv0NLSUNRXaIigpcZoiJaoIBqNcJGCQEKXMPXaPbdJMFH7s9Szvc/znt97znvgX2nWNjOrltr8yRnVXPR4ei5tGAu/BrQo8h2A2Wq8grMdi9wEYAwkf+1Wtw4r7hEQAqaBq46AGtgzISexnwxOPorPoFLx9YLay3lkb113CEgDJeCh7RNMMZUXVMknU3DCAYohg6xtDIyYahkIAM9AquMOwoYqZ8QgqgQRwRFY1IqYSBSwgDhQ6LqDXlHsljTHlmbJhVFfGtEFMA9cdgUApLQwXPaJijTbL8BBa2/bb7wTzcnaOOeWtIs7Aypa1zUwoQVO80xVNQBvmvdOgE8jEtC/ErZ3+pQRbnhF36uc1fXGfa2W+/I6f6IPoghQeehuO1kAAAAASUVORK5CYII='
ICON_RADIO_BLACK_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAJ1AAACdQF32cIiAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAMpJREFUOI3N0k9LQkEUBfBfr39uEgwK3bSrhdqiQj9EK1Fc2XcN3LoQoU3LIIIECZIgCMGFN3i+9Jk7D1xm7hnuOZyZYddQQ2ubgYNMX93WMck5O/mPwH6mr6GEq6hqCL3iGM3YrxVo4gUdtFHBAIe4QwOTqJUREnzjGh8o4xQ3IfKGenYgjSme8IkZfjDEHgoR710OurFe4AGXKf4MvRDbKADFNfwSsv/gF7fhPsZjnuOqS0zwjCOMNhj9yXOOe3yluAL6Fs+7g5gDQzEbqjwDFmIAAAAASUVORK5CYII='
ICON_RADIO_BLACK_24_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAOwAAADsAEnxA+tAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAVtJREFUSInt1D1LXFEQxvGf75iI6HYRDATTRBTBRtNYSBoLIY0fIGIKJdoIqcRS0C8g1jZaiI0SSBO1sBZtDEkrEiUaBcWoqMU5wiK77r2rdj5wudx5hvnPZeYcnlWkmjCKyocWKs0T/4RNdD0V4BLHqHgqwKOpvID/EoN4JcxjDd9wnRRw3x9k0I0lLGAGp5hAdVbeG3xNC3iBt5jCHGaxgh5M4kvM68QQLtCSBpDBPEbi92/8REd8zlCLf9hBGXrTAPaxFzs+j8XahO16H2HvsI061KAqDeB/fC/HnENsxU5XI7Qa7TjAEU7SAG41FbtuFWbyHT+y/Cu8Fs7LYq4ChdZ0Dx9i8QP8veNv4A8+CnNKDSDs/K97/F1M5zOTnORajGMgQW5RgD7hHDQq4nZNAljCZ2FTzrPiia+LXBpGcx6vBGNoSFKoJE+8HP2oz+GVCdfGehLAswrqBgbIPmhmYfYCAAAAAElFTkSuQmCC'
ICON_RADIO_BLACK_32_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAATrAAAE6wHYKlsNAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAeFJREFUWIXt1TtoVFEQxvHfJhok4gMf0ULQaIJRsLAQLBREhICFlYqIiILY2wlWgoiFjYXPWAghxQY0VtpI+ihEfICFEjAq4gNEMIWLbizmFMsS93FvYhD2ay73nBm+P3PmzKGllmprFQ5j8VwZtNXZv4rluDxfAHALK+cTYE71XwKsQx8WzQbAggbjluE8ejGBX9iAEi6ltWqtx3v8zgNYxEaMohsd2IV9WIIVuJbWKtWDg7iYxxxGMIjOZDKB55jEGxwVxziA1SlnM/oT2HVsqWVQrwd6MJQAhjCGhXiGdziL7biAMymnA8dF6e/jZB6AKTwS0/AbduAlupJBCafwVvQEvEAZD8WxdecB+Cgabq0YRk+wCV/SfkmMa2ivyPuKadG803kASun7GD/EeU5iaVrvTHtQqADpwxrRMzVvQaNz4AFe44OoxFQy/CxGdaUOYBiHxDUfnQ2AMo5gPBl34RWO4XtV7Ah+4rZoxsEGPWZUsYnY4ar/E6Jpa6rRSZhFdxoJyvIW9GJbhrwZ1WwF9uI0PokOv5IXoNkK9OOcmHp78prTfAWKuCmu4cC/ACiIKpXT/zj2i+lYroptl0H1AO7iBu4l05nUht14mgWgUD/EVuz0d9iyeIDGsgC01NIfRSdauFFNr44AAAAASUVORK5CYII='
ICON_DISPATCHER_32_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAA7AAAAOwBeShxvQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAMLSURBVFiFrddbiJVVFAfw39EMG4fGLG1OF3uaCJMso8mcyqQg7AI9RtFLED0ZmCi9FEVFUdENiuhNeuulmigjpyKLLLq/RBlhN7B6GLo4pqljD2sd5zic+b796fxhc75v7bXW/n97r7X2Oi3N0MLVuA1LcCDl8/AHXsJYQ5/FWIJX8ADaPebPwIN4NXVnFQvFly3P5035/k6OsZQtxAX5PjCbBJ7FlbgU7+IGse0dzMONeA/DWItnZmvxfrwmtn0MJ1foDogdGcTrWFDnfG4BgbX4G9fjaeyq0N2P73AHvkYffqhyPqeAwFn4Gefh0wq9W3EVPsEy/IQz65yfUECgD7/gUI+5k7Aat4s0vBmnYxITSf64CZwjvm4Ib4uAmxDnuxc7cD++x3zcmaROwwcF/muxVQTXaAObUZGSW+sUS2LgAP5qsHgHf5qqlMdF4EQ8hVMaLL5IVMxv6hRLYuBzcb7DDQi0RD2ojYESAv/gR+wUUf1rygdFRSSKzu/5vFTUgu2lTOvQxhbsw7l4P+Wr8CQO4mLcnfItogx/UUKgCQZwL14UN98tpi6jm0RaPoeNTZyW7MB0XIcX8KE4lpaoEZeLGlCberOBUREDIzkGNasTR1AShNMxX6TZbzk6WJRz+5o4K6kD3RjBGxg3FXTyeTznVjdxWBcD/SLa2+LiuQh7RPfzGHanXhub8XjafIl/c/7jtGlEYBAP4VSRz7vFbTgX68VOMHU9X5K/H4nuqaPbxhpxU97n6CObEeeL1Foxw/yjojW7B0/gYXEbrsIjM9hcmD6X1S2+IBUXV+gMiUrX3RntStlQhd3i9N3XLZzekm0QeVxVxcbxrSjR/4l+YQLP47MKu71pc604qp54S3lmrMNXOdYV2szBm92C7jrQEk3lZKGzlbgr7UaUVcBJ0SO0cLjDqIN+FenSA5eJBnSHCMBS7Mm1TCdwhFUB+sRu7RdxcEjBf4DEYV3p37QSdrDG0c3GdlxxLI6OlcA12Nb1vi1ljdEdhAfFWb5cYDeMs3vIlhbYrsy1wP8mf55qEtryLgAAAABJRU5ErkJggg=='
ICON_DISPATCHER_16_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAdgAAAHYBTnsmCAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFBSURBVDiNjdI7S5xREAbgZ12vLOI9aKNCtLBJNKawkJSxtLKw0R9gIXZWqW3TWNgIFv4ALdOmCyJYaBpDSKMEk0UUFS/R4pvV5fOQdWBgzjvvec/MmSlI2xu8w1WcW7CDvTyxmLg8glE04CawJnTjGifV5PqEwDgasYHbwBowh/f4XkvgDpdxuYgJTOIivGYL8xjGKwzhJ7Yxg158qVXBDb5hPYcfoCtPrksIHFZVNhBeqXbtJS38wwe8xUe8xmlwn42xkBCo2LKsfxjESoqU+gNoRTu+xnk0sLP/VVCHaTSjFOT+yP0KgXPZdm7JWn0UKGABm/gb2CLaIj7F54g7MYtV3Fden5LNuNo68Cm8I5frk33w4xg7cZwjlfEjvJzLHYmdqAikptGN3/iDnkS+wNMUSrJVrbYx7Ee8hN1cvgQPYm83Z9Vif40AAAAASUVORK5CYII='
ICON_DISPATCHER2_16_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAdgAAAHYBTnsmCAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFMSURBVDiNfdPPK2ZRHAbwzztIg41fi0FJIZGVMsRCzSRL/gexUqzYzN9gJivMZlY2isU7JUqIGSUrKWVlY0cRO4zFPfftdlzzrdv93uc857nPec45BW+rBjMYwlXAWnGIJTzmzClVAd/xEwMZfBCrWAycUn2IBDpRgS0cZ/C/2AljHf8T+IQ2bEf4V5yGsabsQHnOMj7iBV3oR3dwM4uqmFwWfU+iJ+CVOMMaLnCA6SC++94SnlDEDzTgPODTkvSLgVOqWOBfpl/J9Mux9fcE7tCH+hxuI76IcivkEDswJjk031CH3xiVhLiOvZQchwi36MUwfuEGc5I89vFHJoc8B6nwCk4kufRjCs8xMRYYCvbhGu2hv0Rz6LdwlPfXBYxHyxoJT9bZBOZTIN2FFtxjM89mpp6xgYfUUbol1ZIrOx9NqA3vzxFeJ7n2XgEFbTpc2/gT+QAAAABJRU5ErkJggg=='
ICON_DISPATCHER3_16_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAQAAAC8EZeQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHlWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI0LTA0LTE1VDE2OjQ5OjM4KzAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0LTA0LTE1VDE3OjQxOjMxKzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNC0wNC0xNVQxNzo0MTozMSswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTA1NjhiMDQtYjJiNS01OTQ4LTg1OWItZGNmOTFkZTZjMzA0IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NWQyMDliOTYtYmU1ZC0wZTQ1LWI3YzctNmE2ZjM2MjE3MjRlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE1ODJjM2ItZTY1ZS1lODQzLWEwMTctNzk2MmZiM2FiZDRlIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIxIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0iRG90IEdhaW4gMjUlIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphYTU4MmMzYi1lNjVlLWU4NDMtYTAxNy03OTYyZmIzYWJkNGUiIHN0RXZ0OndoZW49IjIwMjQtMDQtMTVUMTY6NDk6MzgrMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NTJkNmM4MjQtMzUwMy0yYjRkLTgwOGUtZTFkYTQ2YzdkZjMzIiBzdEV2dDp3aGVuPSIyMDI0LTA0LTE1VDE2OjU4OjEyKzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjUwNTY4YjA0LWIyYjUtNTk0OC04NTliLWRjZjkxZGU2YzMwNCIgc3RFdnQ6d2hlbj0iMjAyNC0wNC0xNVQxNzo0MTozMSswMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6MDIyZjExMTQtZDI0Yi01YTQ2LTgzMGYtY2FiY2NlY2MyMThmPC9yZGY6bGk+IDxyZGY6bGk+eG1wLmRpZDphYTU4MmMzYi1lNjVlLWU4NDMtYTAxNy03OTYyZmIzYWJkNGU8L3JkZjpsaT4gPC9yZGY6QmFnPiA8L3Bob3Rvc2hvcDpEb2N1bWVudEFuY2VzdG9ycz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz54xnrqAAAAXUlEQVQokZWSQRLAIAgDE4f/f5meLMWAWm5K3ARGOu5qXOpgALdQ5yuMg1ZAxrygZ/LqY9lgmzHeT3mVuiGqQ0GstyBEep1XFt6NZb1ZrkWTp5dOT/xmP7sC+PF7HrUXHileph67AAAAAElFTkSuQmCC'
ICON_ADMIN_16_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAWwAAAFsB1WNqDwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFtSURBVDiNjdNPiI5RFAbw3z3+NMqkaMQX41NiQUlWWMgWKcpuFmpWszFqSoq9hd0slIVmOWZBaJqlJI2FhSVbGxY2E1kZ51p8L72j9+M7m3t67rnP+fOcW2y0Sdxo/MAa7uG7EWwP5jHWwvbiPjaNQnAX4x34CUwPexQtfwzfOmLe4dgoBOXfBf6f4Ct2dsScwdtRyCawgn0t7CyethLt+PvR5uacxC0sYKnBC77gUSllpda6HBGn8TkzV/H4N8m4gVRbu8qKiAfoYQp99EopLyJiAdtgDgeGtHWplPISu5rWpluxfdyO5vLjkOynaq3nG/8mViNiFrtxDR8CP4dkh4M4jOOZ+RzvM/MJTuJhRFxuy3jEYJ3/WGYuGijxJiKu4mJETOF10/+nNsGhjln08ArbM3MWa5k5h1JKmc/M5YI7+IEtWEfdOIY4WmudqLXOGMh7Bc8iYiYzr4+6vuci4kKttV9rXcJ+g5+7/gseFV5vbL4OGwAAAABJRU5ErkJggg=='
ICON_ADMIN2_16_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAQAAAC8EZeQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF7GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI0LTA0LTE1VDE3OjU3OjE4KzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNC0wNC0xNVQxODowMTowOSswMzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNC0wNC0xNVQxODowMTowOSswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjEiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJEb3QgR2FpbiAyNSUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NGYxMTQ1NjgtNDVjNi1iYzRkLWI1NDQtNjQ5OGY5M2Y3MTQ5IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MWU5NmM4MTEtNTM1Mi04ODQyLWE1ZTItYWJkZTkxNmEzOTdjIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MTUzNWI5ZWYtNmI0MS0xNDRlLTlmYmUtMzBjM2ZjZDhlZWViIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxNTM1YjllZi02YjQxLTE0NGUtOWZiZS0zMGMzZmNkOGVlZWIiIHN0RXZ0OndoZW49IjIwMjQtMDQtMTVUMTc6NTc6MTgrMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NGYxMTQ1NjgtNDVjNi1iYzRkLWI1NDQtNjQ5OGY5M2Y3MTQ5IiBzdEV2dDp3aGVuPSIyMDI0LTA0LTE1VDE4OjAxOjA5KzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+CXpKCwAAAGxJREFUKJGNUkEOACAICuf/v2yHMk1sy5MBkVGwEYW9MAwqqRIXwRohrBKMyAIMmWBk905Uz4zJa/iKKtkfyVq5XO+dMVkWn6N/Sl8ONUft5ukuIyGrRU+wEgtP7+4kJcgAGUmB83w3gt9vNgGRr0IhIPi9dwAAAABJRU5ErkJggg=='
ICON_ADMIN3_16_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAQAAAC8EZeQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF7GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI0LTA0LTE1VDE3OjM2OjI0KzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNC0wNC0xNVQxNzo0NTowOSswMzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNC0wNC0xNVQxNzo0NTowOSswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjEiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJEb3QgR2FpbiAyNSUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODhkYjEyYWUtODY1Ny00YzQzLWI2YzYtOTZhZTA2ZTg2ZDE5IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDM4ZDIzZjYtM2U0MC1hNzQzLWFlMjEtOGIyYzBhZjQzM2E1IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU3NDVhZDItYzVjNi1hNzQzLThlMjMtNzAwYzUzZDBmZjc2Ij4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDplZTc0NWFkMi1jNWM2LWE3NDMtOGUyMy03MDBjNTNkMGZmNzYiIHN0RXZ0OndoZW49IjIwMjQtMDQtMTVUMTc6MzY6MjQrMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODhkYjEyYWUtODY1Ny00YzQzLWI2YzYtOTZhZTA2ZTg2ZDE5IiBzdEV2dDp3aGVuPSIyMDI0LTA0LTE1VDE3OjQ1OjA5KzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ywxS9AAAAGNJREFUKJGNUUkSwDAIUqf//7I9pBYVm4ZLgjK4qcsZrkrVRURcWWgsw0u5KbEAb9vJcs6+RdQj7OPHkcdx0TwrR1pp13k5bWpIOFKm5j3iN17mt3SU6vx1DDoJUo9n2N2v4AaPPicdZCOE2AAAAABJRU5ErkJggg=='
ICON_GW_16_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAE7WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI0LTA0LTE1VDE2OjQ5OjM4KzAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0LTA0LTE1VDE2OjQ5OjM4KzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNC0wNC0xNVQxNjo0OTozOCswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YWE1ODJjM2ItZTY1ZS1lODQzLWEwMTctNzk2MmZiM2FiZDRlIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOmFhNTgyYzNiLWU2NWUtZTg0My1hMDE3LTc5NjJmYjNhYmQ0ZSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmFhNTgyYzNiLWU2NWUtZTg0My1hMDE3LTc5NjJmYjNhYmQ0ZSIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YWE1ODJjM2ItZTY1ZS1lODQzLWEwMTctNzk2MmZiM2FiZDRlIiBzdEV2dDp3aGVuPSIyMDI0LTA0LTE1VDE2OjQ5OjM4KzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+0fxmIgAAADtJREFUGJWdjjEKACAMA3Oi/39yHBzaUnHwlpbAhWBVRrxIIgdGWGQFF6V1dNY41Y4j0ZRZZtzgMf072AjGCCIn96LAAAAAAElFTkSuQmCC'
ICON_GW_16x20_BASE64 = b'iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAQAAAC8EZeQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHSWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI0LTA0LTE1VDE2OjQ5OjM4KzAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0LTA0LTE1VDE3OjQ4OjU5KzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNC0wNC0xNVQxNzo0ODo1OSswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YmQyMjBlZDMtNGZjYi01MDQ3LWIzMTAtMWZjZTVkNTNmYjEwIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6OWYzNTQ5YTItYzQzZi02MjRjLWE0MjktM2IwM2RiN2YxNjVkIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE1ODJjM2ItZTY1ZS1lODQzLWEwMTctNzk2MmZiM2FiZDRlIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIxIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0iRG90IEdhaW4gMjUlIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphYTU4MmMzYi1lNjVlLWU4NDMtYTAxNy03OTYyZmIzYWJkNGUiIHN0RXZ0OndoZW49IjIwMjQtMDQtMTVUMTY6NDk6MzgrMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4wIChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NTJkNmM4MjQtMzUwMy0yYjRkLTgwOGUtZTFkYTQ2YzdkZjMzIiBzdEV2dDp3aGVuPSIyMDI0LTA0LTE1VDE2OjU4OjEyKzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmJkMjIwZWQzLTRmY2ItNTA0Ny1iMzEwLTFmY2U1ZDUzZmIxMCIgc3RFdnQ6d2hlbj0iMjAyNC0wNC0xNVQxNzo0ODo1OSswMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT54bXAuZGlkOmFhNTgyYzNiLWU2NWUtZTg0My1hMDE3LTc5NjJmYjNhYmQ0ZTwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Ph4CiHgAAABYSURBVCiRrZLBCgAgCENd9P+/vA5RaSkZ5CUczzElUHJVkpwPgvYNQQIUAYlz2HHV2ENGyGXt4Zt2rHqqR/ZXKLswOtBq1SZZnVUmuPsFGcNjqsrf8fvvaePTGiH0WWYLAAAAAElFTkSuQmCC'
WARN_FREE_SPACE = 80
ALARM_FREE_SPACE = 95
WARN_LIC_DAYS = 30
SYMBOL_UP = ''
SYMBOL_RIGHT = ''
SYMBOL_LEFT = ''
SYMBOL_DOWN = ''
SYMBOL_SQUARE = ''
SYMBOL_CIRCLE = ''
SYMBOL_CIRCLE_OUTLINE = ''
SYMBOL_X = ''
SYMBOL_CHECK = ''
SYMBOL_CHECK_SMALL = ''
SYMBOL_X_SMALL = ''
SYMBOL_BALLOT_X = ''
SYMBOL_BALLOT_CHECK = ''
SYMBOL_LEFT_DOUBLE = ''
SYMBOL_RIGHT_DOUBLE = ''
SYMBOL_LEFT_ARROWHEAD = ''
SYMBOL_RIGHT_ARROWHEAD = ''
SYMBOL_UP_ARROWHEAD = ''
SYMBOL_DOWN_ARROWHEAD = ''
MAX_LEN_LOGIN = 25
MIN_LEN_LOGIN = 2
MAX_LEN_USERNAME = 20
MIN_LEN_PASSWORD = 6
MAX_LEN_PASSWORD = 20
MAX_LEN_GROUPNAME = 20
MAX_LEN_GROUPDESC = 100
MIN_CALL_TM = 10
MAX_CALL_TM = 120
MAX_LA_TM = 1440
MIN_CALL_END_TM = 1
MAX_CALL_END_TM = 10
MIN_TONAL_CALL_END_TM = 3
MAX_TONAL_CALL_END_TM = 60
MIN_AMB_LIST_TM = 3
MAX_AMB_LIST_TM = 90
MIN_AUDIO_PORT = 1025
MAX_AUDIO_PORT = 65535
MIN_PORTS = 20
MAX_PORTS = 1000
MIN_PING_TM = 2
MAX_PING_TM = 120
MIN_DEL_DAYS = 10
MAX_DEL_DAYS = 1095
MAX_DEPTH_LOG = 100000
DEF_PING_TM = 5
LOG_DEPTH = 1000
SSH_PORT_DEF = 22
SSH_PORT = 22
SSH_LOGIN_DEF = b'b21lZ2E='
SSH_LOGIN = ''
SSH_PWD_DEF = b'b21lZ2ExMjM0NQ=='
SSH_PWD = ''
LICS = ['', '', '']
LOCAL = False
COMPANY = ' ""'
SALT = 'omega'
DEF1 = '58eb7b6988ea079322a6a3f143166e595500e36f6317cdf169c0131573665313'
DEF1A = '04533cc2be3af54c7f5c827f07417a14ea8f1ba5ec2b6a2756b101c5446cd0ae'
DEF2 = '1d053666c10241ec97f4b70a168d5060425476a34416ee20c9d9d7629b083292'
DEF3 = '0b85f52e2913b7299ec0198b5a97029e6c85aea67dec83c685029865881674ae'
DEF3A = 'adda822db661d29dbf6a00fe86c446df41c9c71bf70b82454c829504a17d847f'
DEFSSH = '738344928e9d24022d6c7f66f0a200032a66d4524b649553d4261ed23916cb86'
role = Enum('role', 'role_allow_ind_call role_allow_delete_chats role_allow_partial_drop role_allow_ind_mes role_changer role_screen_shooter '
                    'role_amb_caller role_amb_callee role_missing_msg_rv role_allow_LLA role_allow_LLA_client role_mfc fix_device role_multiple_devices')
# type_app = Enum(value='type_app', names={'vBasic': 0, 'vTonal': 1, 'vNoScreen': 2, 'vBox': 3, 'vZteEverlink': 4})
type_app = {'': 0, '': 1, ' ': 2, '500': 3, 'ZTE': 4}
user_type = {'disabled': -1, 'user': 0, 'box': 1, 'dispatcher': 15, 'admin': 30, 'tm': 100}
client_os = Enum(value='client_os', names={'Unknown': 0, 'Android': 1, 'Linux': 2, 'Windows': 3})
# OMEGA THEME
omega_theme = {'BACKGROUND': '#ffffff',
               'TEXT': '#000000',
               'INPUT': '#f2f2f2',
               'TEXT_INPUT': '#000000',
               'SCROLL': '#bfbfbf',
               'BUTTON': ('white', '#35536b'),
               'PROGRESS': ('#699349', '#D0D0D0'),
               'BORDER': 1,
               'SLIDER_DEPTH': 0,
               'PROGRESS_DEPTH': 0}
button_color = omega_theme['BUTTON'][1]
button_color_2 = '#a6674c'
status_bar_color = '#699349'
disabled_input = 'dark gray'
sg.theme_add_new('OmegaTheme', omega_theme)
sg.theme('OmegaTheme')
# OMEGA THEME end
current_db = 0
version = '2.0.2'


def get_branch():
    try:
        get_branch_com = "git rev-parse --symbolic --abbrev-ref HEAD"
        branch = subprocess.Popen(get_branch_com, shell=True,
                                  stdout=subprocess.PIPE,
                                  stderr=subprocess.PIPE)
        err = branch.stderr.read().decode('utf-8').rstrip('\n')
        if not err:
            try:
                output = branch.stdout.read().decode('utf-8').rstrip('\n')
            except Exception as e:
                print(f'{e}')
                return ''
        else:
            return ''
        return output[:10]
    except Exception as e:
        print(f'{e}')
        return ''


def icon(check):
    box = (12, 12)
    background = (255, 255, 255, 0)
    rectangle = (0, 0, 11, 11)
    line = ((2, 6), (5, 9), (9, 2))
    im = Image.new('RGBA', box, background)
    draw = ImageDraw.Draw(im, 'RGBA')
    draw.rectangle(rectangle, outline='black', width=1)
    if check == 1:
        draw.line(line, fill=button_color_2, width=2, joint='curve')
    elif check == 2:
        draw.line(line, fill='red', width=2, joint='curve')
    with BytesIO() as output:
        im.save(output, format="PNG")
        png = output.getvalue()
    return png


check = [icon(0), icon(1), icon(2)]


def init_db():
    drop_db('all')
    users = get_users_from_server()
    add_users(users)
    add_groups(get_groups_from_server())
    add_user_in_groups(users)
    orgs = get_all_organizations()
    # add_orgs(orgs)


def create_db():
    with open('adm.db', 'w'):
        print('  ')
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    # with open(Path(Path.cwd(), 'config', 'pashi_db.db.sql'), 'r') as c_sql:
    #     sql_to_create = c_sql.read()
    sql_to_create = """BEGIN TRANSACTION;
                        CREATE TABLE IF NOT EXISTS "Users_in_Groups" (
                            "id"	INTEGER NOT NULL UNIQUE,
                            "user_id"	INTEGER NOT NULL,
                            "group_id"	INTEGER NOT NULL,
                            "is_boss"	INTEGER DEFAULT 0,
                            PRIMARY KEY("id" AUTOINCREMENT),
                            FOREIGN KEY("group_id") REFERENCES "Groups"("id"),
                            FOREIGN KEY("user_id") REFERENCES "Users"("id")
                        );
                        CREATE TABLE IF NOT EXISTS "Users" (
                            "id"	TEXT NOT NULL UNIQUE,
                            "Login"	TEXT NOT NULL,
                            "Password"	TEXT NOT NULL DEFAULT '********',
                            "Display_name"	TEXT NOT NULL,
                            "is_dispatcher"	INTEGER DEFAULT 0,
                            "is_admin"	INTEGER DEFAULT 0,
                            "is_blocked"	INTEGER DEFAULT 0,
                            "is_gw"	INTEGER DEFAULT 0,
                            "previous_type"	INTEGER DEFAULT 0,
                            "role_en_ind"	INTEGER DEFAULT 1,
                            "role_en_ind_mes"	INTEGER DEFAULT 1,
                            "role_en_del_chats" INTEGER DEFAULT 0,
                            "role_en_partial_drop" INTEGER DEFAULT 0,
                            "role_changer" INTEGER DEFAULT 0,
                            "role_screen_shooter" INTEGER DEFAULT 0,
                            "role_amb_caller" INTEGER DEFAULT 0,
                            "role_amb_callee" INTEGER DEFAULT 0,
                            "role_missing_msg_rv" INTEGER DEFAULT 0,
                            "role_allow_LLA" INTEGER DEFAULT 0,
                            "role_allow_LLA_client" INTEGER DEFAULT 0,
                            "role_mfc" INTEGER DEFAULT 0,
                            "fix_device" INTEGER DEFAULT 0,
                            "role_multiple_devices" INTEGER DEFAULT 0,
                            "priority" INTEGER DEFAULT 1,
                            "organization_id" TEXT DEFAULT '',
                            PRIMARY KEY("id"),
                            FOREIGN KEY("organization_id") REFERENCES "Organizations"("id")
                        );
                        CREATE TABLE IF NOT EXISTS "Groups" (
                            "id"	TEXT NOT NULL UNIQUE,
                            "Name"	TEXT NOT NULL,
                            "description"	TEXT DEFAULT NULL,
                            "priority"	INTEGER DEFAULT 0,
                            "is_broadcast"	INTEGER DEFAULT 0,
                            "is_emergency"	INTEGER DEFAULT 0,
                            "is_disabled"	INTEGER DEFAULT 0,
                            "organization_id" TEXT DEFAULT '',
                            PRIMARY KEY("id"),
                            FOREIGN KEY("organization_id") REFERENCES "Organizations"("id")
                        );
                        CREATE TABLE IF NOT EXISTS "Organizations" (
                            "id"	TEXT NOT NULL UNIQUE,
                            "Name"	TEXT NOT NULL UNIQUE,
                            PRIMARY KEY("id")
                        );
                        COMMIT;
                    """
    cur.executescript(sql_to_create)
    con.commit()
    con.close()


def get_users_from_server() -> list[dict]:
    res = []
    try:
        res = requests.get(BASE_URL + 'users', headers=HEADER_dict)
    except Exception as e:
        print(e)
    if res:
        users = json.loads(res.text)
    else:
        users = []
    return users


def get_groups_from_server() -> list[dict]:
    res = []
    try:
        res = requests.get(BASE_URL + 'groups', headers=HEADER_dict)
    except Exception as e:
        print(e)
    if res:
        groups = json.loads(res.text)
    else:
        groups = []
    return groups


def add_users(users_list):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    for user in users_list:
        is_dispatcher, is_admin, is_blocked, is_gw, previous_type, enabled_ind, enabled_ind_mes, role_en_del_chats, \
            role_en_partial_drop, role_changer, role_screen_shooter, role_amb_caller, role_amb_callee, role_missing_msg_rv, role_allow_LLA, \
            role_allow_LLA_client, role_mfc, fix_device, role_multiple_devices, priority, organization_id = (
            1 if user["userType"] == 15 or user['previousType'] == 15 else 0,
            1 if user["userType"] == 30 or user['previousType'] == 30 else 0,
            1 if user["userType"] == -1 else 0,
            1 if user["userType"] == 1 or user['previousType'] == 1 else 0,
            user['previousType'],
            1 if role.role_allow_ind_call.value in user["userRoles"] else 0,
            1 if role.role_allow_ind_mes.value in user["userRoles"] else 0,
            1 if role.role_allow_delete_chats.value in user['userRoles'] else 0,
            1 if role.role_allow_partial_drop.value in user['userRoles'] else 0,
            1 if role.role_changer.value in user['userRoles'] else 0,
            1 if role.role_screen_shooter.value in user['userRoles'] else 0,
            1 if role.role_amb_caller.value in user['userRoles'] else 0,
            1 if role.role_amb_callee.value in user['userRoles'] else 0,
            1 if role.role_missing_msg_rv.value in user['userRoles'] else 0,
            1 if role.role_allow_LLA.value in user['userRoles'] else 0,
            1 if role.role_allow_LLA_client.value in user['userRoles'] else 0,
            1 if role.role_mfc.value in user['userRoles'] else 0,
            1 if role.fix_device.value in user['userRoles'] else 0,
            1 if role.role_multiple_devices.value in user['userRoles'] else 0,
            user['priority'],
            user['organizationId'])
        db_insert_user = """insert or replace into Users(id, login, Display_name, is_dispatcher, is_admin, 
            is_blocked, is_gw, previous_type, role_en_ind, role_en_ind_mes, role_en_del_chats, role_en_partial_drop, role_changer, 
            role_screen_shooter, role_amb_caller, role_amb_callee, role_missing_msg_rv, role_allow_LLA, role_allow_LLA_client, role_mfc, fix_device, 
            role_multiple_devices, priority, organization_id) Values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"""
        user_data = user['id'], user['login'], user['displayName'], \
            is_dispatcher, is_admin, is_blocked, is_gw, previous_type, enabled_ind, enabled_ind_mes, \
            role_en_del_chats, role_en_partial_drop, role_changer, role_screen_shooter, role_amb_caller, role_amb_callee, role_missing_msg_rv, \
            role_allow_LLA, role_allow_LLA_client, role_mfc, fix_device, role_multiple_devices, priority, organization_id
        cur.execute(db_insert_user, user_data)
    con.commit()
    con.close()


def add_and_set_groups():
    if not is_org:
        group_list, treedata = get_group_list_with_org(selected_user['organization_id'])
        tree.update(treedata)
        groups_for_user = get_groups_for_user_from_db_with_org(selected_user)
        group_for_user_ids = []
        for group_for_user in groups_for_user:
            group_for_user_ids.append(group_for_user['id'])
        all_group_ids = []
        for group_from_all in group_list:
            all_group_ids.append(group_from_all[0])
        tree.metadata = []
        for group_id_for_tree in all_group_ids:
            if group_id_for_tree in group_for_user_ids:
                tree.metadata.append(group_id_for_tree)
                tree.update(key=group_id_for_tree, icon=check[1])
            else:
                tree.update(key=group_id_for_tree, icon=check[0])
    else:
        group_list, treedata = get_group_list_with_org(org_id)
        tree.update(treedata)


def add_groups(groups_list):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    for group in groups_list:
        description, is_disabled, group_type, organization_id = ('' if group['description'] is None
                                                                 else group['description'],
                                                                 1 if group['isDisabled'] else 0,
                                                                 1 if group['groupType'] else 0,
                                                                 group['organizationId'])

        db_insert_group = """insert or replace into Groups(id, Name, description, is_emergency, is_disabled, organization_id) 
        Values (?, ?, ?, ?, ?, ?)"""
        group_data = group['id'], group['name'], description, group_type, is_disabled, organization_id
        cur.execute(db_insert_group, group_data)
    con.commit()
    con.close()


def add_orgs(orgs_list):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    for org in orgs_list:
        db_insert_org = """insert or replace into Organizations(id, Name) 
            Values (?, ?)"""
        org_data = org['id'], org['name']
        cur.execute(db_insert_org, org_data)
    con.commit()
    con.close()


def add_user_in_groups(users_list):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    for user in users_list:
        for group_id in user['userGroupIds']:
            db_insert_user_in_groups = "insert or replace into Users_in_Groups(user_id, group_id) Values " \
                                       "('" + user['id'] + "', '" + group_id + "')"
            cur.execute(db_insert_user_in_groups)
    con.commit()
    con.close()


def add_del_groups_to_user_after_apply(groups_for_user_dict):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    print(groups_for_user_dict)
    for user_id in groups_for_user_dict['UserIds']:
        for group_id in groups_for_user_dict['addGroupIds']:
            db_insert_group_for_user = "insert or replace into Users_in_Groups(user_id, group_id) Values " \
                                       "('" + user_id + "', '" + group_id + "')"
            cur.execute(db_insert_group_for_user)
    for user_id in groups_for_user_dict['UserIds']:
        for group_id in groups_for_user_dict['removeGroupIds']:
            db_delete_group_for_user = "delete from Users_in_Groups where user_id = '" + user_id + \
                                       "' and  group_id = '" + group_id + "'"
            cur.execute(db_delete_group_for_user)
    con.commit()
    con.close()


def add_del_users_to_group_after_apply(users_for_group_dict):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    for group_id in users_for_group_dict['GroupIds']:
        for user_id in users_for_group_dict['addUserIds']:
            db_insert_user_for_group = "insert or replace into Users_in_Groups(user_id, group_id) Values " \
                                       "('" + user_id + "', '" + group_id + "')"
            cur.execute(db_insert_user_for_group)
    for group_id in users_for_group_dict['GroupIds']:
        for user_id in users_for_group_dict['removeUserIds']:
            db_delete_user_for_group = "delete from Users_in_Groups where user_id = '" + user_id + \
                                       "' and  group_id = '" + group_id + "'"
            cur.execute(db_delete_user_for_group)
    con.commit()
    con.close()


def del_users_in_groups_after_delete_group(del_group_id):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_delete_group_for_user = "delete from Users_in_Groups where group_id = '" + del_group_id + "'"
    cur.execute(db_delete_group_for_user)
    con.commit()
    con.close()


def del_users_in_groups_after_delete_user(del_user_id):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_delete_group_for_user = "delete from Users_in_Groups where user_id = '" + del_user_id + "'"
    cur.execute(db_delete_group_for_user)
    con.commit()
    con.close()


def drop_db(table):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    if table == 'all':
        db_delete_groups = "delete from Groups"
        db_delete_users = "delete from Users"
        db_delete_orgs = "delete from Organizations"
        db_delete_users_in_groups = "delete from Users_in_groups"
        db_delete_users_in_groups_seq = "delete from sqlite_sequence where name='Users_in_Groups'"
        cur.execute(db_delete_users)
        cur.execute(db_delete_groups)
        cur.execute(db_delete_orgs)
        cur.execute(db_delete_users_in_groups)
        cur.execute(db_delete_users_in_groups_seq)
    elif table == 'users':
        db_delete_users = "delete from Users"
        cur.execute(db_delete_users)
    elif table == 'groups':
        db_delete_groups = "delete from Groups"
        cur.execute(db_delete_groups)
    elif table == 'orgs':
        db_delete_orgs = "delete from Organizations"
        cur.execute(db_delete_orgs)
    elif table == 'user_in_groups':
        db_delete_users_in_groups = "delete from Users_in_groups"
        cur.execute(db_delete_users_in_groups)
        db_delete_users_in_groups_seq = "delete from sqlite_sequence where name='Users_in_Groups'"
        cur.execute(db_delete_users_in_groups_seq)
    con.commit()
    con.close()


def get_users_from_db() -> list[dict]:
    """
    Get users from DB sorted by user login in list[dict]
    """
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    cur.execute('select * from users')
    users = cur.fetchall()
    users_for_table = list()
    for user in users:
        user_for_table = {'login': user[1],
                          'name': user[3],
                          'id': user[0],
                          'is_dispatcher': user[4],
                          'is_admin': user[5],
                          'is_blocked': user[6],
                          'is_gw': user[7],
                          'previous_type': user[8],
                          'role_en_ind': user[9],
                          'role_en_ind_mes': user[10],
                          'role_en_del_chats': user[11],
                          'role_en_partial_drop': user[12],
                          'role_changer': user[13],
                          'role_screen_shooter': user[14],
                          'role_amb_caller': user[15],
                          'role_amb_callee': user[16],
                          'role_missing_msg_rv': user[17],
                          'role_allow_LLA': user[18],
                          'role_allow_LLA_client': user[19],
                          'role_mfc': user[20],
                          'fix_device': user[21],
                          'role_multiple_devices': user[22],
                          'priority': user[23],
                          'organization_id': user[24],
                          }
        users_for_table.append(user_for_table)
    con.close()
    users_for_table.sort(key=lambda i: i['login'])
    return users_for_table


def get_user_list_treedata():
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    cur.execute('select * from users')
    users = cur.fetchall()
    con.close()
    users_for_table = list()
    td = sg.TreeData()
    orgs = get_all_organizations_list()
    for org in orgs:
        td.Insert(parent='', key=get_id_by_org(org), text=org, values=[], icon=ICON_FOLDER)
    for user in users:
        user_for_td = {'login': user[1],
                          'name': user[3],
                          'id': user[0],
                          'is_dispatcher': user[4],
                          'is_admin': user[5],
                          'is_blocked': user[6],
                          'is_gw': user[7],
                          'previous_type': user[8],
                          'role_en_ind': user[9],
                          'role_en_ind_mes': user[10],
                          'role_en_del_chats': user[11],
                          'role_en_partial_drop': user[12],
                          'role_changer': user[13],
                          'role_screen_shooter': user[14],
                          'role_amb_caller': user[15],
                          'role_amb_callee': user[16],
                          'role_missing_msg_rv': user[17],
                          'role_allow_LLA': user[18],
                          'role_allow_LLA_client': user[19],
                          'role_mfc': user[20],
                          'fix_device': user[21],
                          'role_multiple_devices': user[22],
                          'priority': user[23],
                          'organization_id': user[24]}
        td.Insert(parent=user_for_td['organization_id'],
                  key=(user_for_td['id'] + '.' + user_for_td['organization_id']),
                  text=user_for_td['login'],
                  values=[user_for_td['id'],
                          user_for_td['login'],
                          user_for_td['name'],
                          u'\u0020\u0020\u0020\u2713' if user_for_td['is_dispatcher'] else '',
                          u'\u0020\u0020\u0020\u2713' if user_for_td['is_admin'] else '',
                          u'\u0020\u0020\u0020\u2713' if user_for_td['is_gw'] else '',
                          (u'\u0020\u0020\u0020' + SYMBOL_X_SMALL) if user_for_td['is_blocked'] else ''],
                  icon=ICON_DISPATCHER3_16_BASE64 if user_for_td['is_dispatcher'] else
                  ICON_ADMIN2_16_BASE64 if user_for_td['is_admin'] else
                  ICON_GW_16x20_BASE64 if user_for_td['is_gw'] else
                  ICON_RADIO2_BLOCK_BASE64 if user_for_td['is_blocked']
                  else ICON_RADIO2_BASE64
                  )
    for key, node in td.tree_dict.items():
        children = node.children
        node.children = sorted(children, key=lambda child:child.text)
    # users_for_table.sort(key=lambda i: i['login'])
    return td

def get_groups_from_db() -> list[dict]:
    """
    Get groups from DB sorted by group name in list[dict]
    """
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    cur.execute('select * from groups')
    groups = cur.fetchall()
    groups_for_table = list()
    for group in groups:
        group_for_table = {'name': group[1],
                           'id': group[0],
                           'desc': group[2],
                           'is_emergency': group[5],
                           'is_disabled': group[6],
                           'organization_id': group[7]}
        groups_for_table.append(group_for_table)
    con.close()
    groups_for_table.sort(key=lambda i: i['name'])
    return groups_for_table


def get_users_for_group_from_db(gr_id):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_query_users_for_group = "Select ug.user_id, u.login, u.display_name FROM Users_in_Groups ug " \
                               "LEFT JOIN Users u on ug.user_id = u.id " \
                               "LEFT JOIN Groups g on ug.group_id = g.id WHERE g.id = '" + gr_id + "'"
    cur.execute(db_query_users_for_group)
    users = cur.fetchall()
    users_for_table = list()
    for user in users:
        user_for_table = {'id': user[0],
                          'login': user[2],
                          'name': user[1]}
        users_for_table.append(user_for_table)
    con.close()
    return users_for_table


def get_groups_for_user_from_db(us_id):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_query_groups_for_user = "Select ug.group_id, g.name, g.description FROM Users_in_Groups ug " \
                               "LEFT JOIN Users u on ug.user_id = u.id " \
                               "LEFT JOIN Groups g on ug.group_id = g.id WHERE u.id = '" + us_id + "'"
    cur.execute(db_query_groups_for_user)
    groups = cur.fetchall()
    groups_for_table = list()
    for group in groups:
        group_for_table = {'id': group[0],
                           'name': group[1],
                           'desc': group[2]}
        groups_for_table.append(group_for_table)
    con.close()
    return groups_for_table


def get_groups_for_user_from_db_with_org(user):
    # print(user)
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_query_groups_for_user = "Select ug.group_id, g.name, g.description, g.is_disabled FROM Users_in_Groups ug " \
                               "LEFT JOIN Users u on ug.user_id = u.id " \
                               "LEFT JOIN Groups g on ug.group_id = g.id WHERE u.id = '" + user['id'] + "'"
    cur.execute(db_query_groups_for_user)
    groups = cur.fetchall()
    groups_for_tree = list()
    for group in groups:
        group_for_tree = {'id': group[0],
                           'name': group[1],
                           'desc': group[2],
                           'is_disabled': group[3]}
        groups_for_tree.append(group_for_tree)
    con.close()
    return groups_for_tree


def get_group_name_by_id_from_db(gr_id):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_query_group_name_by_id = "Select name from Groups where id = '" + gr_id + "'"
    cur.execute(db_query_group_name_by_id)
    group_name = cur.fetchone()[0]
    con.close()
    return group_name


def get_user_name_by_id_from_db(us_id):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_query_user_name_by_id = "Select Display_name from Users where id = '" + us_id + "'"
    cur.execute(db_query_user_name_by_id)
    data = cur.fetchone()
    if data is not None:
        user_name = data[0]
    else:
        user_name = None
    con.close()
    return user_name


def get_user_by_id_from_db(user_id):
    for user in users_from_db:
        if user['id'] == user_id:
            selected_user = copy.deepcopy(user)
            print(selected_user)
            break
    return selected_user


def get_user_list(users):
    """Get users from DB and return users[] in list and in sg.Treedata for Tabs Users and Groups
    Input:
    users: [{}]
    Output:
    user_list: [id, login, name, is_dispatcher, is_blocked]
    user_treedata :sg.Treedata: '', id, login, name"""
    user_treedata = sg.TreeData()
    user_list = []
    for index, user_from_db in enumerate(users):
        user_list.append([user_from_db['id'], user_from_db['login'], user_from_db['name']])
        if user_from_db['is_dispatcher']:
            user_list[index].append(u'\u0020\u0020\u0020\u2713')
        else:
            user_list[index].append('')
        if user_from_db['is_admin']:
            user_list[index].append(u'\u0020\u0020\u0020\u2713')
        else:
            user_list[index].append('')
        if user_from_db['is_gw']:
            user_list[index].append(u'\u0020\u0020\u0020\u2713')
        else:
            user_list[index].append('')
        if user_from_db['is_blocked']:
            user_list[index].append(u'\u0020\u0020\u0020' + SYMBOL_X_SMALL)
        else:
            user_list[index].append('')
        if users != [{}]:
            user_treedata.insert('', user_from_db['id'], '', values=[user_from_db['login'], user_from_db['name']],
                                 icon=check[0])
    return user_list, user_treedata


def get_group_list(groups):
    """Get groups from DB and return groups[] in list and in sg.Treedata for Tabs Users and Groups
    Input:
    groups: [{}]
    Output:
    gr_list: [id, name, desc, is_emergency, is_disabled]
    group_treedata :sg.Treedata: '', id, login, name"""
    group_treedata = sg.TreeData()
    gr_list = []
    if groups:
        for index, gr_from_db in enumerate(groups):
            gr_list.append([gr_from_db['id'], gr_from_db['name'], gr_from_db['desc']])
            if gr_from_db['is_emergency']:
                gr_list[index].append(u'\u0020\u0020\u0020\u2713')
            else:
                gr_list[index].append('')
            if gr_from_db['is_disabled']:
                gr_list[index].append(u'\u0020\u0020\u0020' + SYMBOL_X_SMALL)
            else:
                gr_list[index].append('')
            group_treedata.insert('', gr_from_db['id'], '',
                                  values=[gr_from_db['name'],
                                          gr_from_db['desc'],
                                          (u'\u0020\u0020\u0020' + SYMBOL_X_SMALL) if gr_from_db['is_disabled'] else ''], icon=check[0])
    return gr_list, group_treedata


def get_group_list_with_org(org_id):
    group_treedata = sg.TreeData()
    gr_list = []
    if groups_from_db:
        for gr_from_db in groups_from_db:
            if org_id == gr_from_db['organization_id']:
                gr_list.append([gr_from_db['id'], gr_from_db['name'], gr_from_db['desc']])
                if gr_from_db['is_emergency']:
                    gr_list[-1].append(u'\u0020\u0020\u0020\u2713')
                else:
                    gr_list[-1].append('')
                if gr_from_db['is_disabled']:
                    gr_list[-1].append(u'\u0020\u0020\u0020' + SYMBOL_X_SMALL)
                else:
                    gr_list[-1].append('')
                group_treedata.insert('', gr_from_db['id'], '',
                                      values=[gr_from_db['name'],
                                              gr_from_db['desc'],
                                              (u'\u0020\u0020\u0020' + SYMBOL_X_SMALL) if gr_from_db[
                                                  'is_disabled'] else ''],
                                      # icon=check[0]
                                      )
    return gr_list, group_treedata


def make_main_window(ip):
    if server_status['run']:
        users_online_text = ' ...'
    else:
        users_online_text = '  ...'
    user_list = list()
    group_list = list()
    treedata = sg.TreeData()
    treedata2 = sg.TreeData()
    gr_treedata = sg.TreeData()
    user_list_treedata = get_user_list_treedata()
    label_text = '   100 ' + ip + '  ' + version + ', ' + val_login['']
    branch_name = get_branch()
    if branch_name != '':
        label_text += ' : ' + branch_name
    if https_on:
        label_text += ' https: ' + str(https_on)
    if users_from_db != [{}] and groups_from_db != [{}]:
        user_list, treedata2 = get_user_list(users_from_db)
        group_list, treedata = get_group_list(groups_from_db)
    # noinspection PyTypeChecker
    tab1_layout = [
        [
            sg.Frame('',
                     [
                         [
                             sg.Column([[
                                 sg.Image(data=ICON_FILTER_BASE_64_BLUE),
                                 sg.Input(size=(15, 1),
                                          enable_events=True,
                                          disabled_readonly_background_color=disabled_input,
                                          key='-filterUser-'),
                                 sg.Button('', disabled_button_color='white',
                                           image_data=ICON_CLEAR_FILTER_BASE_64_BLUE,
                                           button_color='white',
                                           tooltip=' ',
                                           key='-ClearFilterUser-',
                                           disabled=True,
                                           pad=((0, 5), 0))]],
                                 vertical_alignment='bottom',
                                 visible=False
                             ),
                             sg.Button('', disabled_button_color='white',
                                       disabled=False,
                                       image_data=ICON_COLLAPSE_32_BASE_64_BLUE,
                                       button_color='white',
                                       tooltip='',
                                       border_width=0,
                                       metadata='collapse',
                                       key='-ollapseExpandUser-',
                                       pad=((4, 10), (0, 3))
                                       ),
                             sg.Push(),
                             sg.Button('', disabled_button_color='white',
                                       image_data=ICON_ADD_BASE_64_BLUE,
                                       button_color='white',
                                       tooltip='',
                                       key='-AddUser-',
                                       pad=(4, (0, 3))),
                             sg.Button('', disabled_button_color='white',
                                       disabled=True,
                                       image_data=ICON_MODIFY_BASE_64_BLUE,
                                       button_color='white',
                                       tooltip='',
                                       key=' ', pad=(5, (0, 3))),
                             sg.Button('', disabled_button_color='white',
                                       disabled=True,
                                       button_color='white',
                                       image_data=ICON_CLONE_BASE_64_BLUE,
                                       tooltip='',
                                       key='-CloneUser-', pad=(4, (0, 3))),
                             sg.Button('', disabled_button_color='white',
                                       disabled=True,
                                       button_color='white',
                                       image_data=ICON_BLOCK_BASE_64_BLUE,
                                       tooltip='',
                                       key='-BlockUser-', pad=(4, (0, 3))),
                             sg.Button('', disabled_button_color='white',
                                       disabled=True,
                                       image_data=ICON_DELETE_BASE_64_BLUE,
                                       button_color='white',
                                       tooltip='',
                                       key='-DelUser-', pad=(4, (0, 3)))],
                         [sg.Tree(user_list_treedata,
                                  headings=['id', '', '', '', '', '500', ''],
                                  visible_column_map=[False, False, True, True, True, True, True],
                                  col0_width=15,
                                  col0_heading="",
                                  col_widths=[0, 0, 10, 4, 4, 4, 4],
                                  num_rows=10,
                                  row_height=16,
                                  font='default 9',
                                  # size=(450, 300),
                                  key='-users-tree-',
                                  # row_height=20,
                                  metadata=[],
                                  auto_size_columns=False,
                                  show_expanded=True,
                                  enable_events=True,
                                  justification='left',
                                  expand_y=True,
                                  expand_x=True,
                                  select_mode=sg.TABLE_SELECT_MODE_BROWSE,
                                  selected_row_colors='black on lightblue',
                                  )],
                         # [sg.Table(user_list, headings=['id', '', '', '', '', '500', ''],
                         #           justification="left",
                         #           # num_rows=20,
                         #           key='-users-', expand_y=True, expand_x=True,
                         #           enable_click_events=True,
                         #           enable_events=True,
                         #           # row_colors=list_block_user_with_color,
                         #           auto_size_columns=False,
                         #           visible_column_map=[False, True, True, True, True, True, True],
                         #           # right_click_selects=True,
                         #           # right_click_menu=[1, ' '],
                         #           select_mode=sg.TABLE_SELECT_MODE_BROWSE,
                         #           selected_row_colors='black on lightblue',
                         #           # auto_size_columns=False,
                         #           metadata=[],
                         #           size=(450, 300),
                         #           col_widths=[0, 10, 18, 5, 5, 5, 5],
                         #           )],
                     ],
                     size=(471, 300),
                     # expand_x=True,
                     expand_y=True,
                     ),
            sg.Frame('', [[sg.Column([[
                sg.Checkbox('  ',
                            enable_events=True,
                            key='-checkAllGroups-',
                            default=False,
                            pad=(13, (14, 4)),
                            disabled=True)]],
                vertical_alignment='bottom')
            ],
                [
                    sg.Tree(data=gr_treedata,
                            headings=['', '', ''],
                            col0_width=5,
                            # col0_heading="",
                            col_widths=[15, 20, 5],
                            num_rows=10,
                            key='-TREE-',
                            # row_height=20,
                            metadata=[],
                            auto_size_columns=False,
                            show_expanded=False,
                            enable_events=True,
                            justification='left',
                            expand_y=True,
                            expand_x=True,
                            select_mode=sg.TABLE_SELECT_MODE_BROWSE,
                            selected_row_colors='black on lightblue',
                            ),

                ]], expand_y=True,
                     # expand_x=True,
                     size=(471, 300)
                     ),
            sg.Column([[sg.Button('', key='Apply',
                                  disabled=True,
                                  image_data=ICON_APPLY_BASE_64_WHITE,
                                  tooltip='',
                                  button_color=button_color_2,
                                  disabled_button_color='gray',
                                  pad=((0, 4), 2)
                                  )]], vertical_alignment='bottom'),
            # sg.Push()
        ],
    ]
    # noinspection PyTypeChecker
    tab2_layout = [
        [sg.Frame('',
                  [
                      [sg.Column([[
                          sg.Image(data=ICON_FILTER_BASE_64_BLUE),
                          sg.Input(size=(15, 1),
                                   enable_events=True,
                                   disabled_readonly_background_color=disabled_input,
                                   key='-filterGroup-'),
                          sg.Button('', disabled_button_color='white',
                                    image_data=ICON_CLEAR_FILTER_BASE_64_BLUE,
                                    button_color='white',
                                    tooltip=' ',
                                    key='-ClearFilterGroup-',
                                    disabled=True,
                                    pad=((0, 5), 0))]],
                          vertical_alignment='bottom'),
                          sg.Push(),
                          sg.Button('', disabled_button_color='white',
                                    image_data=ICON_ADD_BASE_64_BLUE,
                                    button_color='white',
                                    tooltip='',
                                    key='-AddGroup-',
                                    pad=(4, (0, 3))),
                          sg.Button('', disabled_button_color='white',
                                    disabled=True,
                                    image_data=ICON_MODIFY_BASE_64_BLUE,
                                    button_color='white',
                                    tooltip='',
                                    key=' ', pad=(4, (0, 3))),  # TODO
                          sg.Button('', disabled_button_color='white',
                                    disabled=True,
                                    button_color='white',
                                    image_data=ICON_BLOCK_BASE_64_BLUE,
                                    tooltip='',
                                    key='-BlockGroup-', pad=(4, (0, 3))),
                          sg.Button('', disabled_button_color='white',
                                    disabled=True,
                                    image_data=ICON_DELETE_BASE_64_BLUE,
                                    button_color='white',
                                    tooltip='',
                                    key='-DelGroup-', pad=(4, (0, 3)))],
                      [sg.Table(group_list, headings=['id', '', '', '', ''],
                                justification="left",
                                # num_rows=40,
                                key='-groups2-',
                                expand_y=True,
                                expand_x=True,
                                enable_click_events=True,
                                enable_events=True,
                                auto_size_columns=False,
                                visible_column_map=[False, True, True, True, True],
                                # right_click_selects=True,
                                # right_click_menu=[1, [' ', ' ']],
                                select_mode=sg.TABLE_SELECT_MODE_BROWSE,
                                selected_row_colors='black on lightblue',
                                size=(450, 300),
                                col_widths=[0, 10, 27, 5, 5],
                                )], ],
                  expand_y=True,
                  size=(471, 300)),
         sg.Frame('', [[sg.Column([[
             sg.Checkbox('  ',
                         enable_events=True,
                         key='-checkAllUsers-',
                         default=False,
                         pad=(13, (14, 4)),
                         disabled=True)]],
             vertical_alignment='bottom')],
             [
                 sg.Tree(data=treedata2,
                         headings=['', ''],
                         col0_width=5,
                         col_widths=[20, 30],
                         num_rows=10,
                         key='-TREE2-',
                         # row_height=20,
                         metadata=[],
                         auto_size_columns=False,
                         show_expanded=False,
                         enable_events=True,
                         justification='left',
                         expand_y=True,
                         expand_x=True,
                         select_mode=sg.TABLE_SELECT_MODE_BROWSE,
                         selected_row_colors='black on lightblue',
                         ), ]],
                  expand_y=True,
                  # expand_x=True,
                  size=(471, 300)
                  ),
         sg.Column([[sg.Button('',
                               key='Apply2',
                               disabled=True,
                               image_data=ICON_APPLY_BASE_64_WHITE,
                               tooltip='',
                               button_color=button_color_2,
                               # bind_return_key=True,
                               disabled_button_color='gray',
                               pad=((0, 4), 2))]],
                   vertical_alignment='bottom'),
         ], ]
    tab1_journal = [
        [sg.Column([[
            sg.Image(data=ICON_FILTER_BASE_64_BLUE),
            sg.Input(size=(15, 1),
                     enable_events=True,
                     disabled_readonly_background_color=disabled_input,
                     key='-filterJournal-'),
            sg.Button('', disabled_button_color='white',
                      image_data=ICON_CLEAR_FILTER_BASE_64_BLUE,
                      button_color='white',
                      tooltip=' ',
                      key='-ClearFilterJournal-',
                      disabled=True,
                      pad=((0, 5), 0))]],
            vertical_alignment='bottom'),
            sg.Push(),
            sg.Button('', disabled_button_color='white',
                      image_data=ICON_SAVE_BASE_64_BLUE,
                      button_color='white',
                      # initial_folder='.',
                      tooltip='',
                      key='-SaveLog-',
                      pad=((10, 165), (0, 3))),

        ],
        [sg.Multiline(key='journal', write_only=True, disabled=True, expand_x=True, expand_y=True,
                      autoscroll=True, auto_refresh=True,
                      background_color='white'),
         sg.Frame('',
                  [
                      [sg.Checkbox('', enable_events=True, key='info', default=True)],
                      [sg.Checkbox('', enable_events=True, key='warning', default=True)],
                      [sg.Checkbox('', enable_events=True, key='error', default=True)],
                      [sg.Checkbox('', enable_events=True, key='critical', default=True)],
                  ],
                  size=(150, 140),
                  vertical_alignment='top')
         ],
        [sg.T(' :'),
         sg.Multiline(key='countLogs', no_scrollbar=True,
                      write_only=True, disabled=True, auto_refresh=True,
                      background_color='lightgray', size=15, justification='right'
                      ),
         sg.T(' ' + str(LOG_DEPTH) + ' ', key='rowLimit')
         ]
    ]
    tab2_journal = [
        [sg.Column([[
            sg.Image(data=ICON_FILTER_BASE_64_BLUE),
            sg.Input(size=(15, 1),
                     enable_events=True,
                     disabled_readonly_background_color=disabled_input,
                     key='-filterJournalServer-'),
            sg.Button('', disabled_button_color='white',
                      image_data=ICON_CLEAR_FILTER_BASE_64_BLUE,
                      button_color='white',
                      tooltip=' ',
                      key='-ClearFilterJournalServer-',
                      disabled=True,
                      pad=((0, 5), 0))]],
            vertical_alignment='bottom'),
            sg.Push(),
            sg.Button('', disabled_button_color='white',
                      image_data=ICON_UPDATE_LOG_BASE_64_BLUE,
                      button_color='white',
                      # initial_folder='.',
                      tooltip='',
                      key='-UpdateLogServer-',
                      pad=((10, 5), (0, 3))),
            sg.Button('', disabled_button_color='white',
                      image_data=ICON_SAVE_BASE_64_BLUE,
                      button_color='white',
                      # initial_folder='.',
                      tooltip='',
                      key='-SaveLogServer-',
                      # pad=((10, 5), (0, 3))),
                      pad=((10, 165), (0, 3))),

        ],
        [sg.Multiline(key='journalServer', write_only=True, disabled=True, expand_x=True, expand_y=True,
                      autoscroll=True, auto_refresh=True,
                      background_color='white'),
         sg.Frame('',
                  [
                      [sg.Checkbox('', enable_events=True, key='info_server', default=True)],
                      [sg.Checkbox('', enable_events=True, key='warning_server', default=True)],
                      [sg.Checkbox('', enable_events=True, key='fail_server', default=True)],
                  ],
                  size=(150, 110),
                  vertical_alignment='top')
         ],
        [sg.T(' :'),
         sg.Multiline(key='countLogsServer', no_scrollbar=True, write_only=True, disabled=True, auto_refresh=True,
                      background_color='lightgray',
                      size=15,
                      justification='right'
                      ),
         sg.T(' ' + str(LOG_DEPTH) + ' ', key='rowLimitServer')
         ]
    ]
    tab3_layout = [
        [sg.Frame('',
                  [
                      [sg.TabGroup([[sg.Tab('', tab1_journal, key="Tab1_journal")],
                                    [sg.Tab('', tab2_journal, key="Tab2_journal")]],
                                   expand_x=True,
                                   expand_y=True,
                                   enable_events=True,
                                   key='Tabs_journal'), ]],
                  expand_x=True, expand_y=True
                  ),

         ],
    ]
    layout = [[sg.Menu([
        ['', [' ...', '!', '', '', '', ' ', ['', '']]],
        ['', ' '], ], key='-Menu-', )],
        [sg.Frame('', [[sg.Column([[sg.Push(),
                                          sg.Button('', key='-Start-',
                                                    disabled_button_color='gray',
                                                    size=8,
                                                    pad=((20, 10), (5, 10))),
                                          sg.Button('', key='-Stop-',
                                                    disabled_button_color='gray',
                                                    size=8,
                                                    # image_data=DEFAULT_BASE64_LOADING_GIF,
                                                    pad=((10, 20), (5, 10))),
                                          sg.Push()]], vertical_alignment='center')]]
                  # size=(200, 80),
                  ),
         ],
        [sg.TabGroup(
            [[sg.Tab('', tab1_layout, key="Tab1"),
              sg.Tab('', tab2_layout, key="Tab2"),
              sg.Tab('', tab3_layout, key="Tab3"),
              ]], key="Tabs", size=(1020, 660),
            pad=((4, 0), (0, 3)),
            enable_events=True),
            sg.B(SYMBOL_LEFT_ARROWHEAD, pad=(5, 0),
                 disabled_button_color='gray',
                 font='Arial 20 bold',
                 size=1,
                 # mouseover_colors='white',
                 k='-hide-online-'),
            sg.pin(
                sg.Frame('', [[sg.Multiline('',
                                                  # expand_x=True,
                                                  horizontal_scroll=True,
                                                  size=(20, 1),
                                                  expand_y=True,
                                                  key='online-users',
                                                  write_only=True,
                                                  disabled=True,
                                                  auto_refresh=True, )]],
                         expand_x=True, expand_y=True,
                         pad=((0, 5), (18, 2)),
                         key='-frame-online-'
                         ),
                expand_x=True,
                expand_y=True,
                shrink=True,

            )
        ],
        [sg.StatusBar(users_online_text, key='-StatusBar-',
                      size=(37, 1),
                      p=((5, 0), 0),
                      # expand_x=True
                      ),
         sg.StatusBar('', key='-StatusBar2-',
                      size=(37, 1),
                      p=(0, 0),
                      ),
         sg.StatusBar('', key='-StatusBar3-',
                      size=(30, 1),
                      p=((0, 5), 0),
                      ),
         ]
    ]
    return sg.Window(label_text, layout, icon=ICON_BASE_64,
                     use_ttk_buttons=True,
                     enable_close_attempted_event=True,
                     relative_location=(0, -50),
                     finalize=True)


def make_login_window():
    try:
        ip = ipaddress.ip_address((([ip for ip in socket.gethostbyname_ex(socket.gethostname())[2]
                                     if not ip.startswith("127.")] or [
                                        [(s.connect(("8.8.8.8", 53)), s.getsockname()[0], s.close()) for s in
                                         [socket.socket(socket.AF_INET, socket.SOCK_DGRAM)]][0][1]]) + ["no IP found"])[
                                      0]).exploded
    except Exception as e:
        print(f'    ip, {e}')
        ip = ''
    print(ip)
    if not os.path.exists(PATH_CONFIG):
        os.mkdir(PATH_CONFIG)
    if not os.path.exists(PATH_LOG):
        os.mkdir(PATH_LOG)
    # global active_config
    config_app = {"ip": "", "login": "", "ssh_login": "", "ssh_port": ""}
    if os.path.isfile(Path(Path.cwd(), 'config', 'app.json')):
        # print(os.stat(Path(Path.cwd(), 'config', 'app.json')).st_size)
        try:
            with open(Path(Path.cwd(), 'config', 'app.json'), 'r') as f_app_config:
                config_app = json.load(f_app_config)
                print(config_app)
                global SSH_PORT, SSH_LOGIN
                SSH_PORT, SSH_LOGIN = config_app['ssh_port'], config_app['ssh_login']
        except Exception as e:
            print(f'{e}')
            # config_app = {'ip': '', 'login': ''}
    else:
        with open(Path(Path.cwd(), 'config', 'app.json'), 'x') as f_app_config:
            f_app_config.write(json.dumps(config_app, sort_keys=True, indent=4))
    global active_config, ip_config
    if config_app['ip']:
        active_config = True
        ip_config = config_app['ip']
    else:
        active_config = False
        ip_config = ''
    layout_login = [[sg.Text(" ", background_color='white'),
                     sg.Push(background_color='white'),
                     sg.Input(
                         # default_text="10.1.4.73",
                         default_text=config_app['ip'],
                         focus=True,
                         key="ip",
                         pad=((0, 40), (0, 0)),
                         enable_events=True)],
                    [sg.Text("", background_color='white'),
                     sg.Push(background_color='white'),
                     sg.Input(
                         # default_text="radiotech",
                         default_text=config_app['login'],
                         key="",
                         pad=((0, 40), (2, 0)), disabled=False, enable_events=True)],
                    [sg.Text("", background_color='white'),
                     sg.Push(background_color='white'),
                     sg.Input(
                         # default_text='radiotech',
                         key="password",
                         enable_events=True,
                         password_char='*'),
                     sg.Button(key='showLoginPassword',
                               button_color='#ffffff',
                               image_data=ICON_SHOW_BASE_64,
                               disabled=False)
                     ],
                    [sg.Checkbox(' ',
                                 default=True,
                                 enable_events=True,
                                 key='remember_credentials'), sg.Push(),
                     sg.Checkbox('https', default=False, key='https_on')],
                    [sg.Push(background_color='white'),
                     sg.Button('', key="OK button", size=10,
                               bind_return_key=True),
                     sg.Push(background_color='white')]]
    return sg.Window('  ', layout_login,
                     icon=ICON_BASE_64,
                     background_color='white',
                     use_ttk_buttons=True,
                     finalize=True)


def make_add_lic():
    # noinspection PyTypeChecker
    layout_lic = [[
        sg.Frame(' ', [
            [
                sg.Input(
                    default_text='   -->',
                    disabled=True,
                    text_color='gray',
                    enable_events=True,
                    expand_x=True,
                    key='-FILENAME-'),
                sg.Push(),
                sg.FileBrowse('',
                              target='-FILENAME-',
                              disabled=False,
                              initial_folder='../',
                              file_types=((" ", "*.lic"),))],
            [sg.Button(' id ', disabled=False), sg.Push(),
             sg.Button(' ',
                       disabled=True,
                       key='show_cur_lic'
                       ),
             sg.Button('',
                       disabled=True,
                       bind_return_key=True)]], expand_x=True)],
        [sg.Frame('',
                  [[sg.Table([], headings=['', '', ''],
                             justification="left",
                             select_mode=sg.TABLE_SELECT_MODE_NONE,
                             key='-lic-',
                             auto_size_columns=False,
                             col_widths=[27, 9, 10]
                             )
                    ]], expand_x=True)],
        [sg.Frame('  ', [
            [sg.Input(
                # size=(60),
                default_text='   -->',
                disabled=True,
                text_color='gray',
                enable_events=True,
                expand_x=True,
                key='-KEYNAME-'),
                sg.Push(),
                sg.FileBrowse('',
                              target='-KEYNAME-',
                              disabled=False,
                              initial_folder='../',
                              file_types=(("  ", "*.pem"),))],
            [sg.Text('*   !')],
            [sg.Push(),
             sg.Button(' ',
                       # disabled=True,
                       key='restore-key'),
             sg.Button(' ',
                       disabled=True,
                       key='install-key')
             ]
        ], expand_x=True)],
        [sg.Push(), sg.Button('', disabled=True, key='restart'), sg.Button(''), sg.Push()]]
    return sg.Window('', layout_lic, icon=ICON_BASE_64, background_color='white', modal=True, finalize=True)


def make_credential_window():
    layout_ssh_credentials = [[sg.Text("", background_color='white'),
                               sg.Push(background_color='white'),
                               sg.Input(
                                   default_text=SSH_LOGIN,
                                   key="ssh_login",
                                   focus=True,
                                   pad=((0, 40), (2, 0)), disabled=False, enable_events=True)],
                              [sg.Text("", background_color='white'),
                               sg.Push(background_color='white'),
                               sg.Input(
                                   key="ssh_password",
                                   enable_events=True,
                                   password_char='*'),
                               sg.Button(key='showLoginPasswordCred',
                                         button_color='#ffffff',
                                         image_data=ICON_SHOW_BASE_64,
                                         disabled=False)
                               ],
                              [sg.Text("SSH ", background_color='white'),
                               sg.Push(background_color='white'),
                               sg.Input(
                                   default_text=SSH_PORT,
                                   key="ssh_port",
                                   pad=((0, 40), (2, 0)), disabled=False, enable_events=True)],
                              [sg.Checkbox(' ',
                                           default=True,
                                           enable_events=True,
                                           key='remember_ssh_credentials'), sg.Push()],
                              [sg.Push(background_color='white'),
                               sg.Button('', key="OK cred", size=10,
                                         bind_return_key=True),
                               sg.Push(background_color='white')]]
    return sg.Window('    ', layout_ssh_credentials,
                     icon=ICON_BASE_64,
                     background_color='white',
                     use_ttk_buttons=True,
                     modal=True,
                     use_default_focus=True,
                     finalize=True)


def make_settings():
    settings = get_settings(BASE_URL_SETTINGS)
    if settings:
        tab1_layout = [
            [sg.Frame('',
                      [
                          [sg.Push(), sg.Text('  ()'),
                           sg.Input(default_text=settings['privateCallTimeout'],
                                    size=20,
                                    key='---',
                                    enable_events=True)],
                          [sg.Push(), sg.Text('  ()'),
                           sg.Input(default_text=settings['groupCallTimeout'],
                                    size=20,
                                    key='---',
                                    enable_events=True)],
                          [sg.Push(), sg.Text('   ()'),
                           sg.Input(default_text=settings['finalizeCallTimeout'],
                                    size=20,
                                    key='---',
                                    enable_events=True)],
                          [sg.Push(), sg.Text('   ()'),
                           sg.Input(default_text=settings['tonalTimeout'],
                                    size=20,
                                    key='----',
                                    enable_events=True)],
                          [sg.Push(), sg.Text('   ()'),
                           sg.Input(default_text=settings['ambientCallDuration'],
                                    size=20,
                                    key='---',
                                    enable_events=True)],
                      ], expand_x=True)
             ],
            [sg.Frame(' ',
                      [
                          [sg.Push(), sg.Text('   (UDP)'),
                           sg.Input(size=20, key='----',
                                    default_text=(settings['udpPortsRange'].rpartition('-')[0]
                                                  if 6 < len(settings['udpPortsRange']) < 12 else 0),
                                    enable_events=True)],
                          [sg.Push(), sg.Text('   (UDP)'),
                           sg.Input(size=20, key='----',
                                    default_text=(settings['udpPortsRange'].rpartition('-')[2]
                                                  if 6 < len(settings['udpPortsRange']) < 12 else 0),
                                    enable_events=True)]
                      ], expand_x=True)
             ],
            [sg.Frame(' ',
                      [
                          [sg.Push(), sg.Text('   ()'),
                           sg.Input(size=20, key='---',
                                    default_text=ping_timeout,
                                    enable_events=True)],
                          [sg.Push(), sg.Text('   ()'),
                           sg.Input(size=20, key='---',
                                    default_text=LOG_DEPTH,
                                    enable_events=True)],
                          [sg.Push(), sg.Text('   ()'),
                           sg.Input(size=20, key='-auto-del-',
                                    default_text=settings['autoCleanDays'],
                                    enable_events=True)],
                          [sg.Push(), sg.Text(' SSH'),
                           sg.Input(size=20, key='--ssh-',
                                    default_text=SSH_PORT,
                                    enable_events=True)],
                          [sg.Push(), sg.Text(''),
                           sg.Input(size=20, key='--ssh-',
                                    default_text=SSH_LOGIN,
                                    enable_events=True)],
                          [sg.Push(), sg.Text(''),
                           sg.Input(size=20, key='--ssh-',
                                    default_text=SSH_PWD,
                                    password_char='*',
                                    enable_events=True)],
                      ], expand_x=True)
             ],
        ]
        tab2_layout = [[sg.Frame(' ',
                                 [[sg.Checkbox(' ',
                                               default=True if settings['ambientListening'] else False,
                                               enable_events=True,
                                               pad=(10, (5, 2)),
                                               key='ambientListening')],
                                  [sg.Checkbox(' ',
                                               default=True if settings['deviceAuthorization'] else False,
                                               enable_events=True,
                                               pad=(10, 2),
                                               key='deviceAuthorization')],
                                  [sg.Checkbox(' ',
                                               default=True if settings['dgna'] else False,
                                               enable_events=True,
                                               pad=(10, 2),
                                               key='dgna')],
                                  [sg.Checkbox('',
                                               default=True if settings['geoData'] else False,
                                               enable_events=True,
                                               pad=(10, 2),
                                               key='geoData')],
                                  [sg.Checkbox('  ',
                                               default=True if settings['longAmbientListening'] else False,
                                               enable_events=True,
                                               pad=(10, 2),
                                               key='longAmbientListening')],
                                  [sg.T('   ()',
                                        pad=((40, 10), 2)),
                                   sg.Input(settings['longAmbientCallDuration'],
                                            enable_events=True,
                                            size=5,
                                            disabled=False if settings['longAmbientListening'] else True,
                                            pad=((0, 20), 2),
                                            key='longAmbientCallDuration')],
                                  [sg.Checkbox(' ',
                                               default=True if settings['mfc'] else False,
                                               enable_events=True,
                                               pad=(10, 2),
                                               key='mfc')],
                                  [sg.Checkbox('  ',
                                               default=True if settings['otap'] else False,
                                               enable_events=True,
                                               pad=(10, (2, 5)),
                                               key='otap')],
                                  ], expand_x=True)
                        ]]
        layout_settings = [
            [
                sg.TabGroup([[sg.Tab(' ', tab1_layout)],
                             [sg.Tab(' ', tab2_layout)],
                             ])
            ],
            [[sg.Push()],
             [sg.ProgressBar(max_value=10, orientation='horizontal', key='-Progress-Bar-',
                             size_px=(400, 10),
                             pad=((30, 30), (30, 10))
                             )],
             [sg.Push(), sg.Button('OK', disabled=True, key='-OK-set-'), sg.Button('', key='-Exit-set-'),
              sg.Push()]]
        ]
    else:
        layout_settings = [
            [sg.Push(), sg.Text(' ', justification='center', size=60), sg.Push()],
            [sg.Push(), sg.Button('', key='-Exit-set-'), sg.Push()]
        ]
    return sg.Window('', layout_settings, icon=ICON_BASE_64, background_color='white',
                     modal=True,
                     # size=(500, 400),
                     finalize=True)


def make_apply_set():
    layout_apply = [
        [sg.ProgressBar(max_value=10, orientation='horizontal', key='-Progress-Bar-')],
        [sg.Push(), sg.Button('OK', disabled=True), sg.Button(''), sg.Push()]
    ]
    return sg.Window('   ', layout_apply, icon=ICON_BASE_64, background_color='white',
                     modal=True,
                     finalize=True)


def make_get_id(srv_id):
    layout_get_id = [[sg.InputText(srv_id, key='-id-'), sg.Button('', key='--')],
                     [sg.Push(), sg.Button('OK'), sg.Push()]]
    return sg.Window('id ', layout_get_id, icon=ICON_BASE_64, background_color='white', modal=True,
                     finalize=True)


def make_updates_window():
    # update_list = [['2.0.9.2.9.1', '']]
    server_ver = get_version()
    update_list = get_updates()
    layout = [
        [sg.Text(' : ' + server_ver)],
        [sg.Frame('  ',
                  [
                      [
                          # sg.Column([[
                          # sg.Image(data=ICON_FILTER_BASE_64_BLUE),
                          # sg.Input(size=(15, 1),
                          #          enable_events=True,
                          #          disabled_readonly_background_color=disabled_input,
                          #          key='-filterUpdate-'),
                          # sg.Button('', disabled_button_color='white',
                          #           image_data=ICON_CLEAR_FILTER_BASE_64_BLUE,
                          #           button_color='white',
                          #           border_width=0,
                          #           tooltip=' ',
                          #           key='-ClearFilterUpdate-',
                          #           disabled=True,
                          #           pad=((0, 5), 0))]],
                          # vertical_alignment='bottom'),
                          sg.Push(),
                          sg.Button('', disabled_button_color='white',
                                    image_data=ICON_ADD_BASE_64_BLUE,
                                    button_color='white',
                                    tooltip='',
                                    border_width=0,
                                    key='-AddUpdate-',
                                    pad=(4, (0, 3))),
                          sg.Button('', disabled_button_color='white',
                                    disabled=True,
                                    image_data=ICON_MODIFY_BASE_64_BLUE,
                                    button_color='white',
                                    tooltip='',
                                    border_width=0,
                                    key='-EditUpdate-',
                                    pad=(4, (0, 3))),
                          sg.Button('', disabled_button_color='white',
                                    disabled=True,
                                    image_data=ICON_DELETE_BASE_64_BLUE,
                                    button_color='white',
                                    tooltip='',
                                    border_width=0,
                                    key='-DelUpdate-',
                                    pad=((4, 10), (0, 3)))],
                      [sg.Table(update_list,
                                headings=['id','', '', '', '', ''],
                                justification="left",
                                key='-updates-',
                                expand_x=True,
                                enable_click_events=True,
                                enable_events=True,
                                auto_size_columns=False,
                                visible_column_map=[False, True, True, True, True, True],
                                select_mode=sg.TABLE_SELECT_MODE_BROWSE,
                                selected_row_colors='black on lightblue',
                                metadata=[],
                                pad=(10, 5),
                                col_widths=[10, 10, 10, 12, 15, 30],
                                )
                       ],

                  ])
         ]]
    return sg.Window(' ', layout=layout,
                     icon=ICON_BASE_64,
                     background_color='white',
                     use_ttk_buttons=True,
                     modal=True,
                     finalize=True)


def make_add_update_window(update_info=None):
    layout = [
        [sg.Frame('  ',
                  [
                      [sg.Push(),
                       sg.Text(' ',
                               size=17,
                               justification='right',
                               visible=False if update_info else True,
                               pad=(0, (10, 5))),
                       sg.Input(default_text='' if update_info else '  .apk -->',
                                disabled=True,
                                text_color='gray',
                                enable_events=True,
                                visible=False if update_info else True,
                                # expand_x=True,
                                pad=(10, (10, 5)),
                                size=30,
                                key='-FILENAME-UPDATE-'),
                       sg.FileBrowse('',
                                     target='-FILENAME-UPDATE-',
                                     disabled=True if update_info else False,
                                     initial_folder='../',
                                     pad=((0, 0), 5),
                                     size=10,
                                     enable_events=True,
                                     visible=False if update_info else True,
                                     key='-choose-apk-',
                                     file_types=((" ", "*.apk"),)),
                       sg.Push()],
                      [sg.Push(),
                       sg.Text(' ',
                               size=17,
                               justification='right',
                               pad=(0, 5)),
                       sg.Input(default_text=update_info[2] if update_info else '',
                                size=30,
                                key='-ver-',
                                enable_events=True,
                                disabled=False if update_info else True,
                                pad=((11, 109), 5)),
                       sg.Push()],
                      [sg.Push(),
                       sg.Text(' ',
                               size=17,
                               justification='right',
                               pad=(0, 5)
                               ),
                       sg.Combo(list(type_app),
                                size=28,
                                default_value=update_info[1] if update_info else list(type_app.keys())[list(type_app.values()).index(0)],
                                disabled=False if update_info else True,
                                enable_events=True,
                                key='-type-app-',
                                pad=((10, 110), 5)),
                       sg.Push()
                       ],
                      [sg.Push(),
                       sg.Checkbox('',
                                   default=True if update_info and update_info[3] == '' else False,
                                   enable_events=True,
                                   disabled=False if update_info else True,
                                   key='-isForced-',
                                   pad=((10, 100),(10, 5))),
                       sg.Push()
                       ],
                      [sg.Push(),
                       sg.Text('',
                               size=17,
                               justification='right',
                               pad=(0, 5)
                               ),
                       sg.Multiline(size=(30, 1),
                                    pad=((11, 109), 5),
                                    no_scrollbar=True,
                                    enable_events=True,
                                    default_text=update_info[4] if update_info else '',
                                    key='-notes-',
                                    disabled=False if update_info else True,
                                    ),
                       sg.Push()
                       ],
                      [sg.Push(),
                       sg.Text('',
                               size=17,
                               justification='right',
                               pad=(0, 5)
                               ),
                       sg.Multiline(size=(30, 5),
                                    pad=((10, 10), (5, 10)),
                                    no_scrollbar=True,
                                    enable_events=True,
                                    default_text=str(update_info[5]).replace(' | ', '\n') if update_info else '',
                                    key='-changelog-',
                                    disabled=False if update_info else True,
                                    ),
                       sg.Button(button_text='' if update_info else'',
                                 key='-upload-apk-',
                                 size=10,
                                 disabled=True,
                                 pad=((0, 0), 5)),
                       sg.Push()],
                  ])
         ]]
    return sg.Window(title=' ' if update_info else ' ',
                     layout=layout,
                     icon=ICON_BASE_64,
                     background_color='white',
                     # use_ttk_buttons=True,
                     modal=True,
                     finalize=True)

def make_add_user_window():
    org_list = get_all_organizations_list()
    layout_add_user = [
        [sg.Text(''), sg.Push(), sg.Input(key='UserLogin', pad=((0, 40), (0, 0)), enable_events=True,
                                               tooltip=(' ' + str(MIN_LEN_LOGIN) + '   ' +
                                                        str(MAX_LEN_LOGIN) + ' '))],
        [sg.Text(''), sg.Push(), sg.Input(key='UserName', pad=((0, 40), (2, 0)), enable_events=True,
                                             tooltip=('  ' + str(MAX_LEN_USERNAME) + ' '))],
        [sg.Text(''), sg.Push(), sg.Input(key='UserPassword',
                                                password_char='*', enable_events=True,
                                                tooltip=('  ' + str(MIN_LEN_PASSWORD) + '    '
                                                         + str(MAX_LEN_PASSWORD) + ' ')),
         sg.Button(key='showPassword',
                   button_color='#ffffff',
                   image_data=ICON_BLANK_BASE_64,
                   disabled=True)],
        [sg.Frame('', [
            [sg.Radio('',
                      default=True,
                      key='user',
                      group_id='u_type',
                      enable_events=True)],
            [sg.Radio('', key='disp', group_id='u_type', enable_events=True)],
            [sg.Radio(' 500', key='gw', group_id='u_type', enable_events=True)],
            [sg.Radio('', key='adm', group_id='u_type', enable_events=True)]],
                  pad=((8, 0), (10, 10)))],
        [sg.Frame(' ', [
            [sg.Checkbox('  ',
                         default=True,
                         enable_events=True,
                         key='addUserRoleIndCallEn'), sg.Push()],
            [sg.Checkbox('  ',
                         default=True,
                         enable_events=True,
                         key='addUserRoleIndMesEn'), sg.Push()],
            [sg.Checkbox('    ',
                         default=False,
                         disabled=True,
                         enable_events=True,
                         key='addUserRoleAllowDelChats'), sg.Push()],
            [sg.Checkbox('   ',
                         default=False,
                         disabled=True,
                         enable_events=True,
                         key='addUserRoleAllowPartialDrop'), sg.Push()],
            [sg.Checkbox('   ',
                         default=False,
                         disabled=True,
                         enable_events=True,
                         key='addUserRoleChanger'), sg.Push()],
            [sg.Checkbox(' ',
                         default=False,
                         disabled=False,
                         enable_events=True,
                         key='addUserRoleScreenShooter'), sg.Push()],
            [sg.Checkbox('   ',
                         default=False,
                         disabled=True,
                         enable_events=True,
                         key='addUserRoleAmbCaller'), sg.Push()],
            [sg.Checkbox('   ',
                         default=False,
                         disabled=False,
                         enable_events=True,
                         key='addUserRoleAmbCallee'), sg.Push()],
            [sg.Checkbox('  ',
                         default=False,
                         disabled=False,
                         enable_events=True,
                         key='addUserRoleMissingMsgRv'), sg.Push()],
            [sg.Checkbox('   ',
                         default=False,
                         disabled=True,
                         enable_events=True,
                         key='addUserRoleAllowLLA'), sg.Push()],
            [sg.Checkbox('    ',
                         default=False,
                         disabled=False,
                         enable_events=True,
                         key='addUserRoleAllowLLAclient'), sg.Push()],
            [sg.Checkbox('  ',
                         default=False,
                         disabled=False,
                         enable_events=True,
                         key='addUserRoleMfc'), sg.Push()]],
                  pad=((8, 0), (10, 10)),
                  expand_x=True)],
            [sg.Frame('  ',
                      [[sg.Checkbox('  ',
                         default=False,
                         disabled=False,
                         enable_events=True,
                         key='addUserFixDevice'), sg.Push()],
            [sg.Checkbox('  ',
                         default=False,
                         disabled=False,
                         enable_events=True,
                         key='addUserRoleMultipleDevices'), sg.Push()]],
                      pad=((8, 0), (10, 10)),
                      key='addUserDeviceAutorization',
                      expand_x=True
                      )
        ],
        [sg.Column([[sg.Text('')],
                    [sg.Text('',
                              visible=True)]], element_justification='right'),
         sg.Column([[sg.Input(default_text='0',
                              key='UserPriority',
                              size=(4, 1),
                              enable_events=True,
                              tooltip=' 0  15')],
                    [sg.Combo(org_list,
                              key='UserAddOrg',
                              default_value='',
                              disabled=False,
                              visible=True,
                              enable_events=True,
                              tooltip='')]],),],
        [sg.Push(), sg.Checkbox('',
                                default=False,
                                disabled=False,
                                text_color='red',
                                enable_events=True,
                                key='addUserBlock')],
        [sg.Push(), sg.Button(button_text='', key='addUserButton',
                              disabled=True,
                              disabled_button_color='gray')]
    ]
    return sg.Window(' ', layout_add_user,
                     icon=ICON_BASE_64,
                     use_ttk_buttons=True,
                     finalize=True,
                     # disable_minimize=True,
                     modal=True
                     )


def make_modify_user_window(user: dict):
    org_name = get_org_by_id(user['organization_id'])
    org_list = get_all_organizations_list()
    layout_modify_user = [
        [sg.Text(''), sg.Push(), sg.Input(disabled=True, pad=((0, 40), (0, 0)),
                                               default_text=user['login'], key='UserModifyLogin')],
        [sg.Text(''), sg.Push(), sg.Input(default_text=user['name'],
                                             pad=((0, 40), (2, 0)), enable_events=True, key='UserModifyName',
                                             tooltip=('  ' + str(MAX_LEN_USERNAME) + ' '))],
        [sg.Text(''), sg.Push(), sg.Input(default_text='', enable_events=True,
                                                key='userModifyPassword', password_char='*',
                                                tooltip=('  ' + str(MIN_LEN_PASSWORD) + '    '
                                                         + str(MAX_LEN_PASSWORD) + ' ')),
         sg.Button(key='showModifyPassword',
                   button_color='#ffffff',
                   image_data=ICON_BLANK_BASE_64,
                   disabled=True)],
        [sg.Frame('', [
            [sg.Radio('',
                      default=True,
                      key='modifyUserUser',
                      group_id='u_type',
                      disabled=True if user['is_blocked'] or user['is_admin'] else False,
                      enable_events=True)],
            [sg.Radio('',
                      default=user['is_dispatcher'],
                      key='modifyUserDispatcher',
                      group_id='u_type',
                      disabled=True if user['is_blocked'] or user['is_admin'] else False,
                      enable_events=True)],
            [sg.Radio(' 500',
                      default=user['is_gw'],
                      key='modifyUserGw',
                      group_id='u_type',
                      disabled=True if user['is_blocked'] or user['is_admin'] else False,
                      enable_events=True)],
            [sg.Radio('',
                      default=user['is_admin'],
                      key='modifyUserAdm',
                      group_id='u_type',
                      disabled=True,
                      enable_events=True)]],
                  # size=(300, 140),
                  pad=((8, 0), (10, 10)))],
        # [sg.Push(),
        #  sg.B(SYMBOL_DOWN_ARROWHEAD,
        #          # pad=(5, 0),
        #          disabled_button_color='gray',
        #          font='Arial 20 bold',
        #          # size=(5, 1),
        #          # enable_events=True,
        #          # mouseover_colors='white',
        #          k='-hide-roles-'),
        #  sg.Push()],
         [sg.Frame(' ', [
            [sg.Checkbox('  ',
                         default=user['role_en_ind'],
                         enable_events=True,
                         disabled=True if (user['is_admin'] or user['is_gw']) else False,
                         key='modifyUserRoleIndCallEn'), sg.Push()],
            [sg.Checkbox('  ',
                         default=user['role_en_ind_mes'],
                         enable_events=True,
                         disabled=True if (user['is_admin'] or user['is_gw']) else False,
                         key='modifyUserRoleIndMesEn'), sg.Push()],
            [sg.Checkbox('    ',
                         default=user['role_en_del_chats'],
                         disabled=False if user['is_dispatcher'] else True,
                         enable_events=True,
                         key='modifyUserRoleAllowDelChats'), sg.Push()],
            [sg.Checkbox('   ',
                         default=user['role_en_partial_drop'],
                         disabled=False if user['is_dispatcher'] else True,
                         enable_events=True,
                         key='modifyUserRoleAllowPartialDrop'), sg.Push()],
            [sg.Checkbox('   ',
                         default=user['role_changer'],
                         disabled=False if user['is_dispatcher'] else True,
                         enable_events=True,
                         key='modifyUserRoleChanger'), sg.Push()],
            [sg.Checkbox(' ',
                         default=user['role_screen_shooter'],
                         disabled=True if (user['is_dispatcher'] or user['is_admin'] or user['is_gw']) else False,
                         enable_events=True,
                         key='modifyUserRoleScreenShooter'), sg.Push()],
            [sg.Checkbox('   ',
                         default=user['role_amb_caller'],
                         disabled=False if user['is_dispatcher'] else True,
                         enable_events=True,
                         key='modifyUserRoleAmbCaller'), sg.Push()],
            [sg.Checkbox('   ',
                         default=user['role_amb_callee'],
                         disabled=True if (user['is_dispatcher'] or user['is_admin'] or user['is_gw']) else False,
                         enable_events=True,
                         key='modifyUserRoleAmbCallee'), sg.Push()],
            [sg.Checkbox('  ',
                         default=user['role_missing_msg_rv'],
                         disabled=True if (user['is_admin'] or user['is_gw']) else False,
                         enable_events=True,
                         key='modifyUserRoleMissingMsgRv'), sg.Push()],
            [sg.Checkbox('   ',
                         default=user['role_allow_LLA'],
                         disabled=False if user['is_dispatcher'] else True,
                         enable_events=True,
                         key='modifyUserRoleAllowLLA'), sg.Push()],
            [sg.Checkbox('    ',
                         default=user['role_allow_LLA_client'],
                         disabled=True if (user['is_dispatcher'] or user['is_admin'] or user['is_gw']) else False,
                         enable_events=True,
                         key='modifyUserRoleAllowLLAclient'), sg.Push()],
            [sg.Checkbox('  ',
                         default=user['role_mfc'],
                         # default=False,
                         disabled=True if (user['is_admin'] or user['is_gw']) else False,
                         # disabled=True,
                         pad=(5, (0, 10)),
                         enable_events=True,
                         key='modifyUserRoleMfc'), sg.Push()],
            # [sg.Checkbox('  ',
            #              default=user['fix_device'],
            #              disabled=True if (user['is_dispatcher'] or user['is_admin'] or user['is_gw']) else False,
            #              enable_events=True,
            #              key='modifyUserRoleFixDevice'), sg.Push()],
        ],
                  # size=(300, 110),
                  pad=((8, 0), (10, 10)),
                  key='modifyUserRoles',
                  expand_x=True)],
        [sg.Frame('  ',
                  [[sg.Checkbox('  ',
                                default=user['role_multiple_devices'],
                                disabled=True if (
                                            user['is_dispatcher'] or user['is_admin']) else False,
                                enable_events=True,
                                key='modifyUserRoleMultipleDevices'), sg.Push()],
                   [sg.Push(),
                    sg.Button(button_text=' ',
                              key='modifyUserShowDevice',
                              disabled=True if (
                                            user['is_dispatcher'] or user['is_admin']) else False,
                              pad=10,
                              size=26,
                              disabled_button_color='gray'
                              ),
                    sg.Button(button_text='  ',
                              key='modifyUserFixNewDevice',
                              disabled=True if (user['is_dispatcher'] or user['is_admin']) else False,
                              pad=10,
                              size=26,
                              disabled_button_color='gray'
                              )
                    ]
                   ],
                  pad=((8, 0), (10, 10)),
                  key='modifyUserDeviceAutorization',
                  expand_x=True),
         ],
        # [sg.Text(''), sg.Input(key='UserModifyPriority',
        #                                 default_text=user['priority'],
        #                                 size=(4, 1),
        #                                 disabled=True if user['is_admin'] else False,
        #                                 enable_events=True,
        #                                 tooltip=' 0  15')],
        [sg.Column([[sg.Text('')],
                    [sg.Text('',
                             visible=True)]], element_justification='right'),
         sg.Column([[sg.Input(key='UserModifyPriority',
                                        default_text=user['priority'],
                                        size=(4, 1),
                                        disabled=True if user['is_admin'] else False,
                                        enable_events=True,
                                        tooltip=' 0  15')],
                    [sg.Combo(org_list,
                              key='UserModifyOrg',
                              default_value=org_name if org_name else '',
                              disabled=True if user['is_admin'] else False,
                              visible=True,
                              enable_events=True,
                              tooltip='')]],),
         ],
        [sg.Push(), sg.Checkbox('',
                                default=user['is_blocked'],
                                disabled=True if user['is_admin'] else False,
                                text_color='red',
                                enable_events=True,
                                key='modifyUserBlock')],
        # [sg.Text(' ()', size=(13)), sg.Input(size=(10), enable_events=True, key='userTimeout')],
        [sg.Push(), sg.Button(button_text='',
                              key='modifyUserButton',
                              disabled=True,
                              disabled_button_color='gray')]
    ]
    return sg.Window(' ', layout_modify_user,
                     icon=ICON_BASE_64,
                     use_ttk_buttons=True,
                     finalize=True,
                     # disable_minimize=True,
                     modal=True)


def make_devices(dev_l):
    # layout =[[sg.Table(dev_l,
    #                    headings=['id', '', 'c/', ' ', ' ', ' ', '', '', '', 'MAC-' ,'IP-', '   '],
    #                    justification="left",
    #                    key='-devices-',
    #                    expand_x=True,
    #                    enable_click_events=True,
    #                    enable_events=True,
    #                    auto_size_columns=True,
    #                    # visible_column_map=[False, True, True, True, True, True],
    #                    select_mode=sg.TABLE_SELECT_MODE_BROWSE,
    #                    selected_row_colors='black on lightblue',
    #                    metadata=[],
    #                    pad=10,
    #                    # num_rows=1,
    #                    hide_vertical_scroll=True
    #                    # col_widths=[15, 15, 15, 15, 15, 15, 15, 15, 15],
    #                    )
    #           ]]
    # treedata_devs = get_all_devices_in_treedata()
    layout_treedata = [
        [sg.Frame('', [
            [
                # sg.Push(),
             # sg.Button('', disabled_button_color='white',
             #           image_data=ICON_ADD_BASE_64_BLUE,
             #           button_color='white',
             #           tooltip='',
             #           border_width=0,
             #           key='-AddUpdate-',
             #           pad=(4, (0, 3))),
             # sg.Button('', disabled_button_color='white',
             #           disabled=True,
             #           image_data=ICON_MODIFY_BASE_64_BLUE,
             #           button_color='white',
             #           tooltip='',
             #           border_width=0,
             #           key='-EditUpdate-',
             #           pad=(4, (0, 3))),
             sg.Button('', disabled_button_color='white',
                       disabled=False,
                       image_data=ICON_CHANGE_BASE_64_BLUE,
                       button_color='white',
                       tooltip='',
                       border_width=0,
                       key='-ChangeDevUser-',
                       pad=((4, 10), (0, 3))),
             sg.Button('', disabled_button_color='white',
                       disabled=False,
                       image_data=ICON_COLLAPSE_32_BASE_64_BLUE,
                       button_color='white',
                       tooltip='',
                       border_width=0,
                       metadata='collapse',
                       key='-ollapseExpandDev-',
                       pad=((4, 10), (0, 3))
                       ),
                       ],
            [sg.Tree(data=dev_l,
                     key='-devices-tree-',
                     headings=['id', '', 'c/', ' ', ' ', ' ', '', '', '', 'MAC-' ,'IP-', '   '],
                     col0_width=20,
                     col0_heading='',
                     def_col_width=30,
                     max_col_width=30,
                     visible_column_map=[True, False, True, True, True, True, True, True, True, True, True, True],
                     # num_rows=20,
                     justification='left',
                     selected_row_colors='black on lightblue',
                     # col_widths=[5, 5],
                     # auto_size_columns=True,
                     select_mode=sg.TABLE_SELECT_MODE_EXTENDED,
                     show_expanded=True,
                     enable_events=True,
                     expand_x=True,
                     expand_y=True)]
        ])
         ]
    ]
    return sg.Window('', layout_treedata,
                     icon=ICON_BASE_64,
                     # use_ttk_buttons=True,
                     finalize=True,
                     # disable_minimize=True,
                     modal=True
                     )
    # return sg.Window('', layout,
    #                  icon=ICON_BASE_64,
    #                  # use_ttk_buttons=True,
    #                  finalize=True,
    #                  # disable_minimize=True,
    #                  modal=True
    #                  )


def make_organizations(org_l):
    layout = [
        [
            # sg.Column([[sg.Image(data=ICON_FILTER_BASE_64_BLUE),
            #               sg.Input(size=(15, 1),
            #                        enable_events=True,
            #                        disabled_readonly_background_color=disabled_input,
            #                        key='-filterOrg-'),
            #               sg.Button('', disabled_button_color='white',
            #                         image_data=ICON_CLEAR_FILTER_BASE_64_BLUE,
            #                         button_color='white',
            #                         tooltip=' ',
            #                         key='-ClearFilterOrg-',
            #                         disabled=True,
            #                         pad=((0, 5), 0))]],
            #             vertical_alignment='bottom'),
              sg.Push(),
              sg.Button('', disabled_button_color='white',
                        image_data=ICON_ADD_BASE_64_BLUE,
                        button_color='white',
                        tooltip='',
                        key='-AddOrg-',
                        pad=((130, 4), (0, 3))),
              sg.Button('', disabled_button_color='white',
                        disabled=True,
                        image_data=ICON_MODIFY_BASE_64_BLUE,
                        button_color='white',
                        tooltip='',
                        key='-EditOrg-',
                        pad=(5, (0, 3))),
              sg.Button('', disabled_button_color='white',
                        disabled=True,
                        image_data=ICON_DELETE_BASE_64_BLUE,
                        button_color='white',
                        tooltip='',
                        key='-DelOrg-',
                        pad=(4, (0, 3)))],
             [sg.Table(org_l,
                       headings=['id', ''],
                       justification="left",
                       key='-orgs-',
                       expand_x=True,
                       enable_click_events=True,
                       enable_events=True,
                       # auto_size_columns=True,
                       visible_column_map=[False, True],
                       select_mode=sg.TABLE_SELECT_MODE_BROWSE,
                       selected_row_colors='black on lightblue',
                       metadata=[],
                       pad=10,

                       # num_rows=1,
                       hide_vertical_scroll=False,
                       # col_widths=[100, 200],
                       )
              ]]
    return sg.Window('', layout,
                     icon=ICON_BASE_64,
                     use_ttk_buttons=True,
                     finalize=True,
                     # disable_minimize=True,
                     modal=True
                     )


def make_add_org_window(org_info=None):
    layout = [
        [sg.Column([
            [sg.Text('', pad=(0, 5))],
        ], element_justification='right'),
            sg.Column([
                [sg.Input(default_text=org_info[1] if org_info else '',
                          size=25,
                          pad=(0, 5),
                          key='-OrgName-',
                          disabled=False)],
            ])
        ],
        [sg.Push(),
         sg.Button(button_text='' if org_info else '',
                   key='-AddOrgConfirm-')]
    ]
    return sg.Window('', layout,
                     icon=ICON_BASE_64,
                     # use_ttk_buttons=True,
                     finalize=True,
                     # disable_minimize=True,
                     modal=True
                     )


def make_device(dev_l):
    layout = [
        [sg.Column([
            [sg.Text('id ', pad=(0, 5))],
            [sg.Text(' ', pad=(0, 5))],
            [sg.Text(' ', pad=(0, 5))],
            [sg.Text(' ', pad=(0, 5))],
            [sg.Text(' ', pad=(0, 5))],
            [sg.Text(' ', pad=(0, 5))],
            [sg.Text('. ', pad=(0, 5))],
            [sg.Text(' , %', pad=(0, 5))],
            [sg.Text('  ', pad=(0, 5))],
            [sg.Text('IP ', pad=(0, 5))],
            [sg.Text('MAC ', pad=(0, 5))],
            [sg.Text(' ', pad=(0, 5))],
        ], element_justification='right'),
        sg.Column([
            [sg.Input(dev_l['deviceIdentifier'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(dev_l['deviceName'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(client_os(dev_l['osType']).name, size=25, pad=(0, 5), disabled=True)],
            [sg.Input(dev_l['osVersion'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(dev_l['appType'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(dev_l['appVersion'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(dev_l['serialNumber'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(dev_l['battery'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(strftime('%d-%m-%Y %H:%M:%S', localtime(int(dev_l['batteryUpdated'])/1000)),
                      size=25, pad=(0, 5), disabled=True)],
            [sg.Input(dev_l['ipAddr'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(dev_l['macAddr'], size=25, pad=(0, 5), disabled=True)],
            [sg.Input(strftime('%d-%m-%Y %H:%M:%S', localtime(int(dev_l['lastOnline'])/1000)),
                      size=25, pad=(0, 5), disabled=True)],
        ])
        ],
        [sg.Push(),
         sg.Button('',
                   key='-fixLastDevice-')]
    ]
    return sg.Window('', layout,
                     icon=ICON_BASE_64,
                     # use_ttk_buttons=True,
                     finalize=True,
                     # disable_minimize=True,
                     modal=True
                     )

def make_modify_group_window(group: dict):
    org_name = get_org_by_id(group['organization_id'])
    org_list = get_all_organizations_list()
    layout_modify_group = [
        [sg.Column([[sg.Text(' ',
                             pad=0)],
                    [sg.Text('',
                             pad=0)],
                    [sg.Text(' ',
                             pad=0)],
                    [sg.Text('',
                             pad=0)],
                    [sg.Text('',
                             pad=0,
                             visible=True)]], element_justification='right'),
         sg.Column([[sg.Input(size=(40, 1),
                              default_text=group['name'],
                              disabled=True,
                              enable_events=True,
                              key='GroupModifyName')],
                    [sg.Multiline(enter_submits=True,
                                  no_scrollbar=True,
                                  size=(40, 3),
                                  default_text=group['desc'],
                                  enable_events=True,
                                  key='GroupModifyDesc')],
                    [sg.Combo(org_list,
                              key='GroupEditOrg',
                              default_value=org_name if org_name else '',
                              disabled=False,
                              visible=True,
                              enable_events=True,
                              tooltip='')]
                    ], element_justification='left')
         ],
        [sg.Button(button_text=' ', key='modifyGroupDelChat'), sg.Push(),
         sg.Checkbox('',
                     default=group['is_emergency'],
                     enable_events=True,
                     size=15,
                     pad=(5, (10, 5)),
                     key='GroupModifyEmergency')],
        [sg.Push(), sg.Checkbox('', text_color='red',
                                enable_events=True,
                                size=15,
                                default=group['is_disabled'],
                                key='GroupModifyBlocked')],
        [sg.Push(), sg.Button(button_text='',
                              disabled=True,
                              disabled_button_color='gray',
                              key='modifyGroupButton')]
    ]
    win = sg.Window(' ', layout_modify_group, icon=ICON_BASE_64,
                    use_ttk_buttons=True,
                    # disable_minimize=True,
                    finalize=True, modal=True)
    return win


def make_del_user_window(user):
    delete_text = ' ,     ' + user + '?'
    layout_del_user = [
        [sg.Text(delete_text)],
        [sg.Button('', key="okDel"), sg.Button('', key='noDel')]
    ]
    return sg.Window(' ', layout_del_user, icon=ICON_BASE_64, use_ttk_buttons=True,
                     finalize=True, modal=True)


def make_clone_user_window(user):
    layout_clone_user = [
        [sg.Text(''), sg.Push(), sg.Input(key='CloneUserLogin', pad=((0, 40), (0, 0)), enable_events=True,
                                               tooltip=(' ' + str(MIN_LEN_LOGIN) + '   ' +
                                                        str(MAX_LEN_LOGIN) + ' '))],
        [sg.Text(''), sg.Push(), sg.Input(key='CloneUserName', pad=((0, 40), (2, 0)), enable_events=True,
                                             tooltip=('  ' + str(MAX_LEN_USERNAME) + ' '))],
        [sg.Text(''), sg.Push(), sg.Input(key='CloneUserPassword', password_char='*', enable_events=True,
                                                tooltip=('  ' + str(MIN_LEN_PASSWORD) + '    '
                                                         + str(MAX_LEN_PASSWORD) + ' ')),
         sg.Button(key='CloneUserShowPassword',
                   button_color='#ffffff',
                   image_data=ICON_BLANK_BASE_64,
                   disabled=True)],
        [sg.Push(), sg.Ok(button_text='', key='cloneUserButton')]
    ]
    return sg.Window(('  ' + user), layout_clone_user, icon=ICON_BASE_64, use_ttk_buttons=True,
                     finalize=True, modal=True)


def make_add_group_window():
    org_list = get_all_organizations_list()
    layout_add_group = [
        [sg.Column([[sg.Text(' ',
                             pad=0)],
                    [sg.Text('',
                             pad=0)],
                    [sg.Text(' ',
                             pad=0)],
                    [sg.Text('',
                             pad=0)],
                    [sg.Text('',
                             pad=0,
                             visible=True)]], element_justification='right'),
        sg.Column([[sg.Input(size=(40, 1),
                             key='GroupName',
                             enable_events=True,
                             tooltip=('  ' + str(MAX_LEN_GROUPNAME) + ' '))],
                   [sg.Multiline(enter_submits=True,
                                 no_scrollbar=True,
                                 size=(40, 3),
                                 key='description',
                                 enable_events=True,
                                 tooltip=('  ' + str(MAX_LEN_GROUPDESC) + ' '))],
                   [sg.Combo(org_list,
                             key='GroupAddOrg',
                             default_value='',
                             disabled=False,
                             visible=True,
                             enable_events=True,
                             tooltip='')]], element_justification='left')],
        [sg.Push(), sg.Checkbox('', 
                                key='emergency',
                                size=15,
                                enable_events=True,
                                pad=(5, (10, 5)))],
        [sg.Push(), sg.Checkbox('',
                                default=False,
                                disabled=False,
                                text_color='red',
                                size=15,
                                enable_events=True,
                                key='addGroupBlock')],
        [sg.Push(), sg.Button(button_text='', disabled=True, key='addGroupButton',
                              disabled_button_color='gray')]
    ]
    return sg.Window(' ', layout_add_group, icon=ICON_BASE_64, use_ttk_buttons=True,
                     finalize=True,
                     # disable_minimize=True,
                     modal=True)


def make_del_group_window(group):
    delete_text = ' ,     ' + group + '?'
    layout_del_group = [
        [sg.Text(delete_text)],
        [sg.Button('', key="okDelGroup"), sg.Button('', key='noDelGroup')]
    ]
    return sg.Window(' ', layout_del_group, icon=ICON_BASE_64, use_ttk_buttons=True,
                     finalize=True, modal=True)


def make_exit_window():
    exit_text = ' ,   ?'
    layout_exit = [
        [sg.Text(exit_text)],
        [sg.Push(), sg.Button('', key="okExit", pad=((0, 10), (10, 10)), size=10),
         sg.Button('', key='noExit', pad=((10, 0), (10, 10)), size=10), sg.Push()]
    ]
    return sg.Window('', layout_exit, icon=ICON_BASE_64,
                     # disable_minimize=True,
                     use_ttk_buttons=True,
                     finalize=True, modal=True)


def make_confirm_window(message):
    layout_exit = [
        [sg.Text(message)],
        [sg.Push(), sg.Button('', key="okExit", pad=((0, 10), (10, 10)), size=10),
         sg.Button('', key='noExit', pad=((10, 0), (10, 10)), size=10), sg.Push()]
    ]
    return sg.Window('', layout_exit, icon=ICON_BASE_64,
                     # disable_minimize=True,
                     use_ttk_buttons=True,
                     finalize=True, modal=True)


def get_online_users(users: list):
    usernames = []
    for user in users:
        username = get_user_name_by_id_from_db(user)
        if username is not None:
            usernames.append(username)
    return "\n".join(sorted(usernames))


def set_window_running_server():
    bar_text = ': ' + str(server_status['online']) + ', : ' + str(server_status['db']) \
               + (', ' if server_status["isReserved"] else ', ')
    bar_text2 = update_free_space(server_status)
    window['-StatusBar-'].update(bar_text, background_color=(button_color_2 if
                                                             server_status["isReserved"] else status_bar_color))
    window['-StatusBar2-'].update(bar_text2)
    window['-Menu-'].update([
        ['', [' ...', '', '', '', '', ' ', ['', '']]],
        ['', ' '], ])
    update_free_space(server_status)
    window['online-users'].update(get_online_users(server_status['onlineUserIds']))
    set_lic_status_bar()


def set_lic_status_bar():
    lic = get_current_lic()
    if lic:
        lic_date_format = datetime.strptime(str(lic['ExpirationDate']), '%d/%m/%Y')
        delta = lic_date_format - datetime.today()
        delta_days = int(delta.days)
        window['-StatusBar3-'].update(' : ' + str(lic['ExpirationDate']).replace('/', '-') +
                                      ',  : ' + str(delta_days))
        window['-StatusBar3-'].update(background_color=status_bar_color if delta_days > WARN_LIC_DAYS
        else button_color_2)
        logging.info(f'   {str(delta_days)} ')
        if delta_days <= WARN_LIC_DAYS:
            logging.warning(f'   !  {str(delta_days)} ')


def the_thread(ip):
    try:
        sleep(5)
        num = 0
        print(' ')
        while True:
            if additional_window:
                sleep(ping_timeout)
                continue
            res_ping = ''
            global change_state
            change_state = False
            try:
                res_ping = requests.get(ip, timeout=3)
            except Exception as e:
                print(f'   {e}')
            if res_ping == '':
                if server_status['run']:
                    logging.info(f'[{num}]    ')
                    change_state = True
                default_status_dict = {"onlineUsersCount": -1,
                                       "databaseVersion": 0,
                                       'run': server_status['run'],
                                       'freeSpace': 0,
                                       'spaceTotal': 1,
                                       'onlineUserIds': [],
                                       'isReserved': False}
                default_json = json.dumps(default_status_dict)
                # print(f' Thread {num} after - {default_status_dict}')
                print(f' Thread {num} ')
                window.write_event_value('-THREAD-', (threading.current_thread().name, default_json))
            else:
                if res_ping.status_code == 200:
                    if not server_status['run']:
                        logging.info(f'[{num}]   ')
                        change_state = True
                    # print(f' Thread {num} after - {res_ping.text}')
                    print(f' Thread {num}')
                    window.write_event_value('-THREAD-', (threading.current_thread().name, res_ping.text))
            num += 1
            sleep(ping_timeout)
    except Exception as e:
        global thread_started
        thread_started = False
        print(f'Exception! {e}, thread_started = {thread_started}')
        window.write_event_value('-THREAD-', (threading.current_thread().name, json.dumps({'restart': 'true'})))


def check_server(url_ping):
    status = {
        'run': False,
        'online': 0,
        'db': 0,
        'freeSpace': 0,
        'spaceTotal': 1,
        'onlineUserIds': [],
        'isReserved': False}
    res_ping = ''
    try:
        res_ping = requests.get(url_ping, timeout=3)
    except Exception as e:
        print(f" . {e}")
    if res_ping == '':
        print('  ')
        logging.info(f'     ')
    else:
        if res_ping.status_code == 200:
            status['run'] = True
            logging.info(f'    ')
            res_dict = json.loads(res_ping.text)
            status['online'] = res_dict['onlineUsersCount']
            status['db'] = res_dict['databaseVersion']
            status['freeSpace'] = res_dict['freeSpace']
            status['spaceTotal'] = res_dict['spaceTotal']
            status['onlineUserIds'] = res_dict['onlineUserIds']
            status['isReserved'] = res_dict['isReserved']
            print(status)
        else:
            print(f'  {res_ping.status_code}   {url_ping}')
    return status


def check_org(id):
    if id:
        if '.' in id:
            return False
        else:
            return True
    else:
        return False


def get_token(url_auth):
    token = ''
    res_auth = ''
    dict_auth = {'login': val_login[''], 'password': val_login['password']}
    try:
        res_auth = requests.post(url_auth, json=dict_auth)
    except Exception as e:
        print(f" . {e}")
    if res_auth == '':
        print('  ')
    else:
        if res_auth.status_code == 200:
            res_dict = json.loads(res_auth.text)
            error = res_dict['error']
            if error:
                print(f' : {error}')
                my_popup(' : ' + error + '.   !')
                if window:
                    window.hide()
                window_login.un_hide()
                window_login.Element('').SetFocus()
                window_login[''].update(background_color=omega_theme['BACKGROUND'],
                                             text_color=omega_theme['TEXT'])
            else:
                token = res_dict['token']
        else:
            print(f'  {res_auth.status_code}   {url_auth}')
    return token


def get_settings(url):
    res = ''
    res_dict = dict()
    try:
        res = requests.get(url, timeout=3, headers=HEADER_dict)
    except Exception as e:
        print(f" . {e}")
    if res == '':
        print('  ')
        logging.info(f'     ')
    else:
        if res.status_code == 200:
            res_dict = json.loads(res.text)
        else:
            print(f'  {res.status_code}   {url}')
    return res_dict


def get_version():
    res = ''
    result = ''
    try:
        res = requests.get(BASE_URL + 'version', timeout=3, headers=HEADER_dict)
    except Exception as e:
        print(f" . {e}")
    if res == '':
        print('  ')
        logging.info(f'     ')
    else:
        if res.status_code == 200:
            result = json.loads(res.text)
        else:
            print(f'  {res.status_code}  ')
            logging.error(f'  {res.status_code}  ')
            result = ''
    return result


def get_app_version_and_type_from_filename(filename: str):
    version = ''
    if '_a.apk' in filename:
        type = type_app['']
    elif '_t.apk' in filename:
        type = type_app['']
    elif '_ns.apk' in filename:
        type = type_app[' ']
    elif 'box' in filename:
        type = type_app['500']
    elif 'ZTE' in filename:
        type = type_app['ZTE']
    else:
        type = type = type_app['']
    filename = filename.rstrip('.apk')
    for word in filename[::-1]:
        if word.isdigit() or word == '.':
            version += word
        elif word == '\\' or word == '/':
            break
    if version:
        version = version[::-1].strip('.')
    return version, type


def upload_app(app_path: str):
    res = False
    with open(app_path, "rb") as file:
        files = {'file': file,
                 'type': (None, type_app[val_add_upd['-type-app-']]),
                 'notes': (None, val_add_upd['-notes-']),
                 'version': (None, val_add_upd['-ver-']),
                 'changelog': (None, val_add_upd['-changelog-']),
                 'isForced': (None, val_add_upd
                 ['-isForced-'])}
        try:
            res = requests.post(BASE_URL_UPDATE +
                                'upload',
                                files=files,
                                headers=HEADER_dict)
            if res.status_code == 200:
                updates_dict = json.loads(res.text)
                print('  ')
                logging.info('  ')
                my_popup('  ')
                return updates_dict['id']
            else:
                print(f'    - {res.status_code}, {res.text}')
                logging.error("   ")
                my_popup('   ')
        except Exception as e:
            print(f'    - {e}')
            logging.error("   ")
            my_popup('   ')
    return False


def edit_app(update_info_id):
    res = False
    json_dict = {'InfoId': update_info_id,
             'Type': type_app[val_edit_upd['-type-app-']],
             'Notes': val_edit_upd['-notes-'],
             'Version': val_edit_upd['-ver-'],
             'Changelog': val_edit_upd['-changelog-'],
             'Force': val_edit_upd['-isForced-']}
    try:
        res = requests.post(BASE_URL_UPDATE +
                            'update',
                            json=json_dict,
                            headers=HEADER_dict)
        if res.status_code == 200:
            updates_dict = json.loads(res.text)
            print('  ')
            logging.info('  ')
            my_popup('  ')
            return updates_dict['id']
        else:
            print(f'    - {res.status_code}, {res.text}')
            logging.error("   ")
            my_popup('   ')
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
        my_popup('   ')
    return False


def get_updates():
    updates = []
    try:
        res = requests.get(BASE_URL_UPDATE +
                            'info',
                            headers=HEADER_dict)
        if res.status_code == 200:
            print(res.text)
            updates_dict = json.loads(res.text)
            for update in updates_dict:
                updates.append([update['id'],
                                list(type_app.keys())[list(type_app.values()).index(update['type'])],
                                '?' if update['version'] is None else update['version'],
                                '' if update['force'] else '',
                                '' if update['notes'] is None else str(update['notes']).replace('\n', ' | '),
                                '' if update['changelog'] is None else str(update['changelog']).replace('\n', ' | ')])
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
        my_popup('   ')
    return sorted(updates, key=lambda upd: upd[1])


def get_update_id_from_table():
    id = ''
    print(val_upd)
    if val_upd['-updates-']:
        index_upd = val_upd['-updates-'][0]
        print(val_upd['-updates-'][0])
        id = window_updates['-updates-'].Values[index_upd][0]
        print(window_updates['-updates-'].Values[index_upd][0])
    return id


def del_update(id):
    if id:
        window_confirm = make_confirm_window('  ?')
        while True:
            ev_confirm, val_confirm = window_confirm.Read()
            if ev_confirm == 'okExit':
                res = False
                try:
                    del_upd_dict = {'InfoId': id}
                    res = requests.post(BASE_URL_UPDATE +
                                        'delete',
                                        json=del_upd_dict,
                                        headers=HEADER_dict)
                    if res.status_code == 200:
                        updates_dict = json.loads(res.text)
                        window_confirm.close()
                        print('  ')
                        logging.info('  ')
                        my_popup('  ')
                    else:
                        window_confirm.close()
                        print(f'    - {res.status_code}, {res.text}')
                        logging.error("   ")
                        my_popup('   ')
                except Exception as e:
                    window_confirm.close()
                    print(f'    - {e}')
                    logging.error("   ")
                    my_popup('   ')
            if ev_confirm == sg.WIN_CLOSED or ev_confirm == 'Exit':
                break
            if ev_confirm == 'noExit':
                window_confirm.close()
                break
    else:
        print(f'    -  id')
        logging.error("   ")
        my_popup('   ')


def get_all_devices():
    devs = []
    try:
        res = requests.get(BASE_URL_DEVICE +
                           'getDevices',
                           headers=HEADER_dict)
        if res.status_code == 200:
            print(res.text)
            devs = json.loads(res.text)
        else:
            print(res.status_code)
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
        my_popup('   ')
    return get_list_devices(devs)


def get_all_devices_in_treedata(type='dev'):
    try:
        res = requests.get(BASE_URL_DEVICE +
                           'getDevices',
                           headers=HEADER_dict)
        if res.status_code == 200:
            print(res.text)
            devs = json.loads(res.text)
        else:
            print(res.status_code)
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
        my_popup('   ')
    return get_treedata(devs, type)


def key_to_id(k, win):
    # return window_devices['-devices-tree-'].KeyToID[k] if k in window_devices['-devices-tree-'].KeyToID else None
    return win.KeyToID[k] if k in win.KeyToID else None


def get_all_organizations():
    orgs = []
    try:
        res = requests.get(BASE_URL_ORG +
                           '/all',
                           headers=HEADER_dict)
        if res.status_code == 200:
            print(res.text)
            orgs = json.loads(res.text)
            drop_db('orgs')
            add_orgs(orgs)
        else:
            print(res.status_code)
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
        my_popup('   ')
    return get_list_orgs(orgs)


def get_list_orgs(org_list_of_dict: list):
    org_list_of_list = []
    if org_list_of_dict:
        for org in org_list_of_dict:
            org_list = []
            org_list.append(org['id'] if org['id'] else '')
            org_list.append(org['name'] if org['name'] else '')
            org_list_of_list.append(org_list)
    return org_list_of_list


def get_org_by_id(id):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_query_org = "Select name FROM Organizations WHERE id = '" + id + "'"
    cur.execute(db_query_org)
    try:
        name = cur.fetchone()[0]
    except Exception as e:
        name = ''
    con.close()
    return name


def get_id_by_org(org_name):
    try:
        con = sqlite3.connect('adm.db')
        cur = con.cursor()
        db_query_org = "Select id FROM Organizations WHERE Name = '" + org_name + "'"
        cur.execute(db_query_org)
        id = cur.fetchone()[0]
        con.close()
        return id
    except Exception as e:
        print({e})
        return ''


def get_all_organizations_list():
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    db_query_org = "Select name FROM Organizations "
    cur.execute(db_query_org)
    orgs_from_db = cur.fetchall()
    orgs_for_table = []
    for org_from_db in orgs_from_db:
        orgs_for_table.append(org_from_db[0])
    con.close()
    return orgs_for_table


def update_org(org_id, new_name):
    res = False
    json_dict = {'Id': org_id,
                 'Name': new_name,
                 }
    try:
        res = requests.post(BASE_URL_ORG +
                            '/update',
                            json=json_dict,
                            headers=HEADER_dict)
        if res.status_code == 200:
            org_dict = json.loads(res.text)
            print(' ')
            logging.info(' ')
            my_popup(' ')
            return org_dict['id']
        else:
            print(f'    - {res.status_code}, {res.text}')
            logging.error("   ")
            my_popup('   ')
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
        my_popup('   ')
    return False


def delete_org(id):
    res = False
    json_dict = {'Id': id,
                 }
    try:
        res = requests.post(BASE_URL_ORG +
                            '/delete',
                            json=json_dict,
                            headers=HEADER_dict)
        if res.status_code == 200:
            org_dict = json.loads(res.text)
            print(' ')
            logging.info(' ')
            my_popup(' ')
            return org_dict
        else:
            print(f'    - {res.status_code}, {res.text}')
            logging.error("   ")
            my_popup('   ')
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
        my_popup('   ')
    return False


def clear_devices(us_id):
    try:
        res_modify_clear_devices = requests.post(BASE_URL_DEVICE +
                                               'clearDevices',
                                               json={'UserId': us_id},
                                               headers=HEADER_dict)
        if res_modify_clear_devices.status_code == 200:
            # modify_success = True
            # current_db += 1
            # my_popup('    ')
            logging.info(
                f" {get_user_name_by_id_from_db(us_id)} "
                f'  ')
        else:
            my_popup(' ')
            logging.error(
                f"     "
                f" {get_user_name_by_id_from_db(us_id)}")
        window_confirm.close()
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")


def print_chosen_device(val):
    # print(val)
    if val['-devices-tree-']:
        dev_id = val['-devices-tree-'][0]
        print(dev_id)
        print(window_devices.key_dict['-devices-tree-'].Values[dev_id])
        # window_devices.ReturnValuesDictionary['']


# def change_dev_user(type: str):



def get_treedata(dev_list_of_dict: list, type: str):
    td = sg.TreeData()
    if dev_list_of_dict:
        if type == 'dev':
            for dev in dev_list_of_dict:
                td.Insert(parent='',
                          key=dev['deviceIdentifier'],
                          text=dev['deviceName'] if dev['deviceName'] else dev['deviceIdentifier'],
                          values=[dev['deviceIdentifier'] if dev['deviceIdentifier'] else '',
                                  dev['deviceName'] if dev['deviceName'] else '',
                                  dev['serialNumber'] if dev['serialNumber'] else '',
                                  client_os(dev['osType']).name if dev['osType'] else '',
                                  dev['osVersion'] if dev['osVersion'] else '',
                                  dev['appType'] if dev['appType'] else '',
                                  dev['appVersion'] if dev['appVersion'] else '',
                                  dev['battery'] if dev['battery'] else '',
                                  strftime('%d-%m-%Y %H:%M:%S', localtime(int(dev['batteryUpdated']) / 1000))
                                  if dev['batteryUpdated'] else '',
                                  dev['macAddr'] if dev['macAddr'] else '',
                                  dev['ipAddr'] if dev['ipAddr'] else '',
                                  strftime('%d-%m-%Y %H:%M:%S', localtime(int(dev['lastOnline']) / 1000))
                                  if dev['lastOnline'] else ''
                                  ]

                          )
                for user in dev['userIds']:
                    td.Insert(parent=dev['deviceIdentifier'],
                              key=(user + '.' + dev['deviceIdentifier']),
                              text=get_user_name_by_id_from_db(user),
                              values=['', ''])
        else:
            users_ids = []
            for dev in dev_list_of_dict:
                for user in dev['userIds']:
                    if user not in users_ids:
                        users_ids.append(user)
                        td.Insert(parent='',
                                  key=user,
                                  text=get_user_name_by_id_from_db(user),
                                  values=[''])
                    td.Insert(parent=user,
                              key=dev['deviceIdentifier'],
                              text=dev['deviceName'] if dev['deviceName'] else dev['deviceIdentifier'],
                              values=[dev['deviceIdentifier'] if dev['deviceIdentifier'] else '',
                                      dev['deviceName'] if dev['deviceName'] else '',
                                      dev['serialNumber'] if dev['serialNumber'] else '',
                                      client_os(dev['osType']).name if dev['osType'] else '',
                                      dev['osVersion'] if dev['osVersion'] else '',
                                      dev['appType'] if dev['appType'] else '',
                                      dev['appVersion'] if dev['appVersion'] else '',
                                      dev['battery'] if dev['battery'] else '',
                                      strftime('%d-%m-%Y %H:%M:%S', localtime(int(dev['batteryUpdated']) / 1000))
                                      if dev['batteryUpdated'] else '',
                                      dev['macAddr'] if dev['macAddr'] else '',
                                      dev['ipAddr'] if dev['ipAddr'] else '',
                                      strftime('%d-%m-%Y %H:%M:%S', localtime(int(dev['lastOnline']) / 1000))
                                      if dev['lastOnline'] else ''
                                      ])
    return td

def get_last_device():
    dev = {}
    try:
        res = requests.get(BASE_URL_DEVICE +
                           'getLastDevice/' + str(user_to_change['id']),
                           headers=HEADER_dict)
        if res.status_code == 200:
            print(res.text)
            dev = json.loads(res.text)
        elif res.status_code == 400:
            if res.text == 'user has no last device':
                my_popup('     ')
                return []
            else:
                print(res.status_code)
        else:
            print(res.status_code)
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
        my_popup('   ')
    return dev


def get_list_devices(dev_list_of_dict: list):
    dev_list = []
    dev_list_of_list = []
    if dev_list_of_dict:
        for dev in dev_list_of_dict:
            dev_list = []
            dev_list.append(dev['deviceIdentifier'] if dev['deviceIdentifier'] else '' )
            dev_list.append(dev['deviceName'] if dev['deviceName'] else '' )
            dev_list.append(dev['serialNumber'] if dev['serialNumber'] else '' )
            dev_list.append(client_os(dev['osType']).name if dev['osType'] else '' )
            dev_list.append(dev['osVersion'] if dev['osVersion'] else '' )
            dev_list.append(dev['appType'] if dev['appType'] else '' )
            dev_list.append(dev['appVersion'] if dev['appVersion'] else '' )
            dev_list.append(dev['battery'] if dev['battery'] else '' )
            dev_list.append(strftime('%d-%m-%Y %H:%M:%S', localtime(int(dev['batteryUpdated'])/1000))
                            if dev['batteryUpdated'] else '' )
            dev_list.append(dev['macAddr'] if dev['macAddr'] else '' )
            dev_list.append(dev['ipAddr'] if dev['ipAddr'] else '' )
            dev_list.append(strftime('%d-%m-%Y %H:%M:%S', localtime(int(dev['lastOnline'])/1000)) if dev['lastOnline'] else '' )
            dev_list_of_list.append(dev_list)
    return dev_list_of_list


def fixLastDevice(user_id):
    if user_id:
        window_confirm = make_confirm_window('   ?')
        while True:
            ev_confirm, val_confirm = window_confirm.Read()
            if ev_confirm == 'okExit':
                res = False
                try:
                    fix_dict = {'UserId': user_id}
                    res = requests.post(BASE_URL_DEVICE +
                                        'fixLastDevice',
                                        json=fix_dict,
                                        headers=HEADER_dict)
                    if res.status_code == 200:
                        window_confirm.close()
                        print(' ')
                        logging.info(' ')
                        my_popup(' ')
                        return True
                    else:
                        window_confirm.close()
                        print(f'    - {res.status_code}, {res.text}')
                        logging.error("   ")
                        my_popup('   ')
                except Exception as e:
                    window_confirm.close()
                    print(f'    - {e}')
                    logging.error("   ")
                    my_popup('   ')
            if ev_confirm == sg.WIN_CLOSED or ev_confirm == 'Exit':
                break
            if ev_confirm == 'noExit':
                window_confirm.close()
                break
    else:
        print(f'    -  id ')
        logging.error("    -  id ")
        my_popup('    -  id ')
    return False

def add_org(org):
    # print('1')
    res = False
    org_json = {'Name': org['-OrgName-']}
    try:
        res = requests.post(BASE_URL_ORG +
                            '/add',
                            json=org_json,
                            headers=HEADER_dict)
        if res.status_code == 200:
            orgs_dict = json.loads(res.text)
            print(' ')
            logging.info(' ')
            my_popup(' ')
            return orgs_dict['id']
        else:
            print(f'   - {res.status_code}, {res.text}')
            logging.error("  ")
            my_popup('  ')
    except Exception as e:
        print(f'   - {e}')
        logging.error("  ")
        my_popup('  ')
    return False


def filter_journal(journal: list):
    if filter_journal_info:
        if filter_journal_warning:
            if filter_journal_error:
                if filter_journal_critical:
                    return list(
                        filter(lambda x: 'INFO' in x or 'CRITICAL' in x or 'ERROR' in x or 'WARNING' in x, journal))
                else:
                    return list(filter(lambda x: 'INFO' in x or 'ERROR' in x or 'WARNING' in x, journal))
            elif filter_journal_critical:
                return list(filter(lambda x: 'INFO' in x or 'CRITICAL' in x or 'WARNING' in x, journal))
            return list(filter(lambda x: 'INFO' in x or 'WARNING' in x, journal))
        elif filter_journal_error:
            if filter_journal_critical:
                return list(filter(lambda x: 'INFO' in x or 'CRITICAL' in x or 'ERROR' in x, journal))
            else:
                return list(filter(lambda x: 'INFO' in x or 'ERROR' in x, journal))
        elif filter_journal_critical:
            return list(filter(lambda x: 'INFO' in x or 'CRITICAL' in x, journal))
        else:
            return list(filter(lambda x: 'INFO' in x, journal))
    elif filter_journal_warning:
        if filter_journal_error:
            if filter_journal_critical:
                return list(filter(lambda x: 'CRITICAL' in x or 'ERROR' in x or 'WARNING' in x, journal))
            else:
                return list(filter(lambda x: 'ERROR' in x or 'WARNING' in x, journal))
        elif filter_journal_critical:
            return list(filter(lambda x: 'CRITICAL' in x or 'WARNING' in x, journal))
        else:
            return list(filter(lambda x: 'WARNING' in x, journal))
    elif filter_journal_error:
        if filter_journal_critical:
            return list(filter(lambda x: 'CRITICAL' in x or 'ERROR' in x, journal))
        else:
            return list(filter(lambda x: 'ERROR' in x, journal))
    elif filter_journal_critical:
        return list(filter(lambda x: 'CRITICAL' in x, journal))
    else:
        return []


def check_os():
    running_os = os.name
    running_platform = platform.system()
    print(running_os)
    print(running_platform)
    return running_platform


def get_id(os):
    start_command = 'cat /var/lib/dbus/machine-id'
    if ip != '127.0.0.1':
        global SSH_PORT, SSH_LOGIN, SSH_PWD
        ssh, remotepath = get_ssh_connection()
        try:
            stdin, stdout, stderr = ssh.exec_command(start_command)
            stdout = stdout.readlines()
            ssh.close()
            output = ''
            for line in stdout:
                output = output + line
            print(output)
            system_id = output.rstrip('\n')
        except Exception as e:
            print(f'{e}')
            logging.error('    ')
            my_popup("    ")
            return ''
    else:
        if os == 'Windows':
            command = 'reg query HKLM\Software\Microsoft\Cryptography /v MachineGuid'
            output_list = str(subprocess.getoutput(command)).split()
            system_id = output_list[-1]
        else:
            process = subprocess.Popen(start_command, shell=True,
                                       stdout=subprocess.PIPE,
                                       stderr=subprocess.PIPE)
            system_id = process.stdout.read().decode('utf-8').rstrip('\n')
            print(system_id)
    with open('system_id', 'w') as f:
        f.write(system_id)
        print(' c id ')
    return system_id


def show_app(icon):
    window.un_hide()
    icon.stop()


def block_user(set_flag, us_id):
    user_dict = {'id': us_id}
    res = False
    if set_flag:
        try:
            res = requests.post(BASE_URL +
                                'disableUser',
                                json=user_dict,
                                headers=HEADER_dict)
        except Exception as e:
            print(f'    - {e}')
            logging.error("   ")
    else:
        try:
            res = requests.post(BASE_URL +
                                'enableUser',
                                json=user_dict,
                                headers=HEADER_dict)
        except Exception as e:
            print(f'    - {e}')
            logging.error("   ")
    return res


def block_group(set_flag, gr_id):
    group_dict = {'id': gr_id}
    res = False
    if set_flag:
        try:
            res = requests.post(BASE_URL +
                                'disableGroup',
                                json=group_dict,
                                headers=HEADER_dict)
        except Exception as e:
            print(f'    - {e}')
            logging.error("   ")
    else:
        try:
            res = requests.post(BASE_URL +
                                'enableGroup',
                                json=group_dict,
                                headers=HEADER_dict)
        except Exception as e:
            print(f'    - {e}')
            logging.error("   ")
    return res


def disable_input(win):
    win['-OK-set-'].update(disabled=True)
    win['-Exit-set-'].update(disabled=True)
    win['---'].update(disabled=True)
    win['---'].update(disabled=True)
    win['---'].update(disabled=True)
    win['----'].update(disabled=True)
    win['---'].update(disabled=True)
    win['----'].update(disabled=True)
    win['----'].update(disabled=True)
    win['---'].update(disabled=True)
    win['-auto-del-'].update(disabled=True)
    win['---'].update(disabled=True)
    win['--ssh-'].update(disabled=True)
    win['--ssh-'].update(disabled=True)
    win['--ssh-'].update(disabled=True)
    win.DisableClose = True


def enable_input(win):
    win['-OK-set-'].update(disabled=False)
    win['-Exit-set-'].update(disabled=False)
    win['---'].update(disabled=False)
    win['---'].update(disabled=False)
    win['---'].update(disabled=False)
    win['----'].update(disabled=False)
    win['---'].update(disabled=False)
    win['----'].update(disabled=False)
    win['----'].update(disabled=False)
    win['---'].update(disabled=False)
    win['-auto-del-'].update(disabled=False)
    win['---'].update(disabled=False)
    win['--ssh-'].update(disabled=False)
    win['--ssh-'].update(disabled=False)
    win['--ssh-'].update(disabled=False)
    win.DisableClose = False


def change_role(role: Enum, set_flag, us_id):
    user_dict = {'userIds': [us_id], 'roles': [role.value]}
    res_modify_user_role = False
    if set_flag:
        try:
            res_modify_user_role = requests.post(BASE_URL +
                                                 'addToRole',
                                                 json=user_dict,
                                                 headers=HEADER_dict)
        except Exception as e:
            print(f'    - {e}')
            logging.error("   ")
    else:
        try:
            res_modify_user_role = requests.post(BASE_URL +
                                                 'removeFromRole',
                                                 json=user_dict,
                                                 headers=HEADER_dict)
        except Exception as e:
            print(f'    - {e}')
            logging.error("   ")
    return res_modify_user_role


def get_role_from_key(key: str):
    if 'IndCallEn' in key or key == 'role_en_ind':
        return 1
    elif 'AllowDelChats' in key or 'en_del_chats' in key:
        return 2
    elif 'AllowPartialDrop' in key or 'en_partial_drop' in key:
        return 3
    elif 'IndMesEn' in key or 'en_ind_mes' in key:
        return 4
    elif 'RoleChanger' in key or 'changer' in key:
        return 5
    elif 'ScreenShooter' in key or 'screen_shooter' in key:
        return 6
    elif 'AmbCaller' in key or 'amb_caller' in key:
        return 7
    elif 'AmbCallee' in key or 'amb_callee' in key:
        return 8
    elif 'MissingMsgRv' in key or 'missing_msg_rv' in key:
        return 9
    elif 'AllowLLAclient' in key or 'allow_LLA_client' in key:
        return 11
    elif 'AllowLLA' in key or 'allow_LLA' in key:
        return 10
    elif 'Mfc' in key or 'mfc' in key:
        return 12
    # elif key == 'modifyUserRoleFixDevice':
    #     return 13
    elif 'MultipleDevices' in key or 'multiple_devices' in key:
        return 14
    else:
        return 0


def change_all_roles(us_id, val):
    print(us_id)
    print(val)
    add_roles = list()
    role_change_error = False
    for par in val:
        if 'Role'.lower() in par.lower():
            if val[par]:
                role_number = get_role_from_key(par)
                if role_number:
                    add_roles.append(role_number)
    modify_role_add_dict = {'userId': us_id, 'roles': add_roles}
    try:
        res_modify_user_change_role = requests.post(BASE_URL +
                                                    'changeRoles',
                                                    json=modify_role_add_dict,
                                                    headers=HEADER_dict)
        if res_modify_user_change_role.status_code == 200:
            global current_db, modify_success
            modify_success = True
            current_db += 1
        else:
            role_change_error = True
    except Exception as e:
        print(f'    - {e}')
        logging.error("   ")
    # print(res_modify_user_change_role.status_code)
    if role_change_error:
        my_popup("   !")
        return False
    else:
        return True


def change_user_type(us_id, user_type):
    user_dict = {'userId': us_id, 'userType': int(user_type)}
    res = False
    try:
        res = requests.post(BASE_URL +
                            'changeUserType',
                            json=user_dict,
                            headers=HEADER_dict)
    except Exception as e:
        print(f'     - {e}')
        logging.error("    ")
    return res


def my_popup(message):
    layout = [[sg.Frame('', [[sg.Text(message, justification='center', background_color=omega_theme['INPUT'])],
                             [sg.Push(background_color=omega_theme['INPUT']), sg.Button('OK', pad=((0, 0), (10, 10)),
                                                                                        bind_return_key=True,
                                                                                        key='-ok-popup-',
                                                                                        ),
                              sg.Push(background_color=omega_theme['INPUT'])]], background_color=omega_theme['INPUT'],
                        pad=((7, 7), (10, 10)))]]
    win = sg.Window('', layout,
                    icon=ICON_BASE_64,
                    use_ttk_buttons=True,
                    no_titlebar=True,
                    border_depth=5,
                    grab_anywhere=True,
                    background_color=omega_theme['INPUT'],
                    finalize=True,
                    use_default_focus=True,
                    modal=True)
    win.Element('-ok-popup-').SetFocus()
    win.read(close=True)


def validate_input(field: str, input_type: int = 1):
    if input_type == 1:
        if re.search('[^\w-]', field):
            return True
    elif input_type == 2:
        if re.search("[^\w\s-]", field):
            return True
        return False


def validate(window: str):
    result = True
    if window == 'add_user':
        print(val_add_user)
        if MIN_LEN_LOGIN <= len(str(val_add_user['UserLogin'])) <= MAX_LEN_LOGIN:
            if not validate_input(str(val_add_user['UserLogin'])):
                window_add_user['UserLogin'].update(background_color=omega_theme['BACKGROUND'],
                                                    text_color=omega_theme['TEXT'])
            else:
                my_popup('   \n'
                         '  ,   : "-"  "_"')
                window_add_user.Element('UserLogin').SetFocus()
                window_add_user['UserLogin'].update(background_color=button_color_2,
                                                    text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup(("     " + str(MAX_LEN_LOGIN) + "    " +
                      str(MIN_LEN_LOGIN) + " "))
            window_add_user.Element('UserLogin').SetFocus()
            window_add_user['UserLogin'].update(background_color=button_color_2,
                                                text_color=omega_theme['BACKGROUND'])
            return False
        if 0 < len(str(val_add_user['UserName'])) <= MAX_LEN_USERNAME:
            if not validate_input(str(val_add_user['UserName']), 2):
                window_add_user['UserName'].update(background_color=omega_theme['BACKGROUND'],
                                                   text_color=omega_theme['TEXT'])
            else:
                my_popup('    \n'
                         '  ,   : "-"  "_"  ')
                window_add_user.Element('UserName').SetFocus()
                window_add_user['UserName'].update(background_color=button_color_2,
                                                   text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup(("     " + str(MAX_LEN_USERNAME) + " "))
            window_add_user.Element('UserName').SetFocus()
            window_add_user['UserName'].update(background_color=button_color_2,
                                               text_color=omega_theme['BACKGROUND'])
            return False
        if MIN_LEN_PASSWORD <= len(str(val_add_user['UserPassword'])) <= MAX_LEN_PASSWORD:
            window_add_user['UserPassword'].update(background_color=omega_theme['BACKGROUND'],
                                                   text_color=omega_theme['TEXT'])
        else:
            my_popup(("     " + str(MIN_LEN_PASSWORD) + "    "
                      + str(MAX_LEN_PASSWORD) + " "))
            window_add_user.Element('UserPassword').SetFocus()
            window_add_user['UserPassword'].update(background_color=button_color_2,
                                                   text_color=omega_theme['BACKGROUND'])
            return False
        if val_add_user['UserPriority'] == '':
            result = True
        elif val_add_user['UserPriority'].isdigit() or val_add_user['UserPriority'] == '':
            if 0 <= int((val_add_user['UserPriority'])) <= 15:
                window_add_user['UserPriority'].update(background_color=omega_theme['BACKGROUND'],
                                                       text_color=omega_theme['TEXT'])
            else:
                my_popup("    0  15")
                window_add_user.Element('UserPriority').SetFocus()
                window_add_user['UserPriority'].update(background_color=button_color_2,
                                                       text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup("     0  15")
            window_add_user.Element('UserPriority').SetFocus()
            window_add_user['UserPriority'].update(background_color=button_color_2,
                                                   text_color=omega_theme['BACKGROUND'])
            return False
    elif window == 'modify_user':
        # print(val_modify_user)
        if 0 < len(str(val_modify_user['UserModifyName'])) <= MAX_LEN_USERNAME:
            if not validate_input(str(val_modify_user['UserModifyName']), 2):
                window_modify_user['UserModifyName'].update(background_color=omega_theme['BACKGROUND'],
                                                            text_color=omega_theme['TEXT'])
            else:
                my_popup('    \n'
                         '  ,   : "-"  "_"  ')
                window_modify_user.Element('UserModifyName').SetFocus()
                window_modify_user['UserModifyName'].update(background_color=button_color_2,
                                                            text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup(("     " + str(MAX_LEN_USERNAME) + " "))
            window_modify_user.Element('UserModifyName').SetFocus()
            window_modify_user['UserModifyName'].update(background_color=button_color_2,
                                                        text_color=omega_theme['BACKGROUND'])
            return False
        if not val_modify_user['userModifyPassword'] == '':
            if MIN_LEN_PASSWORD <= len(str(val_modify_user['userModifyPassword'])) <= MAX_LEN_PASSWORD:
                window_modify_user['userModifyPassword'].update(background_color=omega_theme['BACKGROUND'],
                                                                text_color=omega_theme['TEXT'])
            else:
                my_popup(("     " + str(MIN_LEN_PASSWORD) + "    "
                          + str(MAX_LEN_PASSWORD) + " "))
                window_modify_user.Element('userModifyPassword').SetFocus()
                window_modify_user['userModifyPassword'].update(background_color=button_color_2,
                                                                text_color=omega_theme['BACKGROUND'])
                return False
        if val_modify_user['UserModifyPriority'] == '':
            result = True
        elif val_modify_user['UserModifyPriority'].isdigit() or val_modify_user['UserModifyPriority'] == '':
            if 0 <= int((val_modify_user['UserModifyPriority'])) <= 15:
                window_modify_user['UserModifyPriority'].update(background_color=omega_theme['BACKGROUND'],
                                                                text_color=omega_theme['TEXT'])
            else:
                my_popup("    0  15")
                window_modify_user.Element('UserModifyPriority').SetFocus()
                window_modify_user['UserModifyPriority'].update(background_color=button_color_2,
                                                                text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup("     0  15")
            window_modify_user.Element('UserModifyPriority').SetFocus()
            window_modify_user['UserModifyPriority'].update(background_color=button_color_2,
                                                            text_color=omega_theme['BACKGROUND'])
            return False
    elif window == 'add_group':
        print(val_add_group)
        if 0 < len(str(val_add_group['GroupName'])) <= MAX_LEN_GROUPNAME:
            if not validate_input(str(val_add_group['GroupName']), 2):
                window_add_group['GroupName'].update(background_color=omega_theme['BACKGROUND'],
                                                     text_color=omega_theme['TEXT'])
            else:
                my_popup('    \n'
                         '  ,   : "-"  "_"  ')
                window_add_group.Element('GroupName').SetFocus()
                window_add_group['GroupName'].update(background_color=button_color_2,
                                                     text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup(("     " + str(MAX_LEN_GROUPNAME) + " "))
            window_add_group.Element('GroupName').SetFocus()
            window_add_group['GroupName'].update(background_color=button_color_2,
                                                 text_color=omega_theme['BACKGROUND'])
            return False
        if 0 <= len(str(val_add_group['description'])) <= MAX_LEN_GROUPDESC:
            if not validate_input(str(val_add_group['description']), 2):
                window_add_group['description'].update(background_color=omega_theme['BACKGROUND'],
                                                       text_color=omega_theme['TEXT'])
            else:
                my_popup('    \n'
                         '  ,   : "-"  "_"  ')
                window_add_group.Element('description').SetFocus()
                window_add_group['description'].update(background_color=button_color_2,
                                                       text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup(("     " + str(MAX_LEN_GROUPDESC) + " "))
            window_add_group.Element('description').SetFocus()
            window_add_group['description'].update(background_color=button_color_2,
                                                   text_color=omega_theme['BACKGROUND'])
            return False
    elif window == 'modify_group':
        print(val_modify_group)
        if 0 < len(str(val_modify_group['GroupModifyName'])) <= MAX_LEN_GROUPNAME:
            if not validate_input(str(val_modify_group['GroupModifyName']), 2):
                window_modify_group['GroupModifyName'].update(background_color=omega_theme['BACKGROUND'],
                                                              text_color=omega_theme['TEXT'])
            else:
                my_popup('    \n'
                         '  ,   : "-"  "_"  ')
                window_modify_group.Element('GroupModifyName').SetFocus()
                window_modify_group['GroupModifyName'].update(background_color=button_color_2,
                                                              text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup(("     " + str(MAX_LEN_GROUPNAME) + " "))
            window_modify_group.Element('GroupModifyName').SetFocus()
            window_modify_group['GroupModifyName'].update(background_color=button_color_2,
                                                          text_color=omega_theme['BACKGROUND'])
            return False
        if 0 <= len(str(val_modify_group['GroupModifyDesc'])) <= MAX_LEN_GROUPDESC:
            if not validate_input(str(val_modify_group['GroupModifyDesc']), 2):
                window_modify_group['GroupModifyDesc'].update(background_color=omega_theme['BACKGROUND'],
                                                              text_color=omega_theme['TEXT'])
            else:
                my_popup('    \n'
                         '  ,   : "-"  "_"  ')
                window_modify_group.Element('GroupModifyDesc').SetFocus()
                window_modify_group['GroupModifyDesc'].update(background_color=button_color_2,
                                                              text_color=omega_theme['BACKGROUND'])
                return False

        else:
            my_popup(("     " + str(MAX_LEN_GROUPDESC) + " "))
            window_modify_group.Element('GroupModifyDesc').SetFocus()
            window_modify_group['GroupModifyDesc'].update(background_color=button_color_2,
                                                          text_color=omega_theme['BACKGROUND'])
            return False
    elif window == 'settings':
        print(val_set)
        if val_set['---'].isnumeric() and MIN_CALL_TM <= int(
                val_set['---']) <= MAX_CALL_TM:
            window_settings['---'].update(background_color=omega_theme['BACKGROUND'],
                                                               text_color=omega_theme['TEXT'])
        else:
            my_popup(("       " + str(
                MIN_CALL_TM) + "    " + str(MAX_CALL_TM) + " "))
            window_settings.Element('---').SetFocus()
            window_settings['---'].update(background_color=button_color_2,
                                                               text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['---'].isnumeric() and MIN_CALL_TM <= int(
                val_set['---']) <= MAX_CALL_TM:
            window_settings['---'].update(background_color=omega_theme['BACKGROUND'],
                                                          text_color=omega_theme['TEXT'])
        else:
            my_popup(("       " + str(MIN_CALL_TM) + "    " + str(
                MAX_CALL_TM) + " "))
            window_settings.Element('---').SetFocus()
            window_settings['---'].update(background_color=button_color_2,
                                                          text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['---'].isnumeric() and MIN_CALL_END_TM <= int(
                val_set['---']) <= MAX_CALL_END_TM:
            window_settings['---'].update(background_color=omega_theme['BACKGROUND'],
                                                          text_color=omega_theme['TEXT'])
        else:
            my_popup(("       " + str(MIN_CALL_END_TM) + "    " + str(
                MAX_CALL_END_TM) + " "))
            window_settings.Element('---').SetFocus()
            window_settings['---'].update(background_color=button_color_2,
                                                          text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['----'].isnumeric() and MIN_TONAL_CALL_END_TM <= int(
                val_set['----']) <= MAX_TONAL_CALL_END_TM:
            window_settings['----'].update(background_color=omega_theme['BACKGROUND'],
                                                                 text_color=omega_theme['TEXT'])
        else:
            my_popup(("       " + str(
                MIN_TONAL_CALL_END_TM) + "    " + str(
                MAX_TONAL_CALL_END_TM) + " "))
            window_settings.Element('----').SetFocus()
            window_settings['----'].update(background_color=button_color_2,
                                                                 text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['---'].isnumeric() and MIN_AMB_LIST_TM <= int(
                val_set['---']) <= MAX_AMB_LIST_TM:
            window_settings['---'].update(background_color=omega_theme['BACKGROUND'],
                                                              text_color=omega_theme['TEXT'])
        else:
            my_popup(("       " + str(
                MIN_AMB_LIST_TM) + "    " + str(
                MAX_AMB_LIST_TM) + ' '))
            window_settings.Element('---').SetFocus()
            window_settings['---'].update(background_color=button_color_2,
                                                              text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['----'].isnumeric() and MIN_AUDIO_PORT <= int(
                val_set['----']) <= MAX_AUDIO_PORT:
            window_settings['----'].update(background_color=omega_theme['BACKGROUND'],
                                                       text_color=omega_theme['TEXT'])
        else:
            my_popup(("      " + str(MIN_AUDIO_PORT) + "    " + str(
                MAX_AUDIO_PORT)))
            window_settings.Element('----').SetFocus()
            window_settings['----'].update(background_color=button_color_2,
                                                       text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['----'].isnumeric() and MIN_AUDIO_PORT <= int(
                val_set['----']) <= MAX_AUDIO_PORT:
            window_settings['----'].update(background_color=omega_theme['BACKGROUND'],
                                                        text_color=omega_theme['TEXT'])
        else:
            my_popup(("      " + str(MIN_AUDIO_PORT) + "    " + str(
                MAX_AUDIO_PORT)))
            window_settings.Element('----').SetFocus()
            window_settings['----'].update(background_color=button_color_2,
                                                        text_color=omega_theme['BACKGROUND'])
            return False
        if MIN_PORTS <= int(val_set['----']) - int(val_set['----']) <= MAX_PORTS:
            pass
        else:
            my_popup(("      " + str(MIN_PORTS) + "    " + str(
                MAX_PORTS)))
            window_settings.Element('----').SetFocus()
            window_settings['----'].update(background_color=button_color_2,
                                                        text_color=omega_theme['BACKGROUND'])
            window_settings['----'].update(background_color=button_color_2,
                                                       text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['---'].isnumeric() and MIN_PING_TM <= int(val_set['---']) <= MAX_PING_TM:
            window_settings['---'].update(background_color=omega_theme['BACKGROUND'],
                                                     text_color=omega_theme['TEXT'])
        else:
            my_popup(("       " + str(MIN_PING_TM) + "    " + str(
                MAX_PING_TM) + " "))
            window_settings.Element('---').SetFocus()
            window_settings['---'].update(background_color=button_color_2,
                                                     text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['-auto-del-'].isnumeric() and MIN_DEL_DAYS <= int(val_set['-auto-del-']) <= MAX_DEL_DAYS:
            window_settings['-auto-del-'].update(background_color=omega_theme['BACKGROUND'],
                                                 text_color=omega_theme['TEXT'])
        else:
            my_popup(("      " + str(MIN_DEL_DAYS) + "    " + str(
                MAX_DEL_DAYS) + " "))
            window_settings.Element('-auto-del-').SetFocus()
            window_settings['-auto-del-'].update(background_color=button_color_2,
                                                 text_color=omega_theme['BACKGROUND'])
            return False
        if val_set['---'].isnumeric() and 0 <= int(val_set['---']) <= MAX_DEPTH_LOG:
            window_settings['---'].update(background_color=omega_theme['BACKGROUND'],
                                                        text_color=omega_theme['TEXT'])
        else:
            my_popup(("      0    " + str(
                MAX_DEPTH_LOG) + " "))
            window_settings.Element('---').SetFocus()
            window_settings['---'].update(background_color=button_color_2,
                                                        text_color=omega_theme['BACKGROUND'])
            return False
    elif window == 'clone_user':
        print(val_clone_user)
        if MIN_LEN_LOGIN <= len(str(val_clone_user['CloneUserLogin'])) <= MAX_LEN_LOGIN:
            if not validate_input(str(val_clone_user['CloneUserLogin'])):
                window_clone_user['CloneUserLogin'].update(background_color=omega_theme['BACKGROUND'],
                                                           text_color=omega_theme['TEXT'])
            else:
                my_popup('    \n'
                         '  ,   : "-"  "_"')
                window_clone_user.Element('CloneUserLogin').SetFocus()
                window_clone_user['CloneUserLogin'].update(background_color=button_color_2,
                                                           text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup(("     " + str(MAX_LEN_LOGIN) + "    " +
                      str(MIN_LEN_LOGIN) + " "))
            window_clone_user.Element('CloneUserLogin').SetFocus()
            window_clone_user['CloneUserLogin'].update(background_color=button_color_2,
                                                       text_color=omega_theme['BACKGROUND'])
            return False
        if 0 < len(str(val_clone_user['CloneUserName'])) <= MAX_LEN_USERNAME:
            if not validate_input(str(val_clone_user['CloneUserName']), 2):
                window_clone_user['CloneUserName'].update(background_color=omega_theme['BACKGROUND'],
                                                          text_color=omega_theme['TEXT'])
            else:
                my_popup('    \n'
                         '  ,   : "-"  "_"  ')
                window_clone_user.Element('CloneUserName').SetFocus()
                window_clone_user['CloneUserName'].update(background_color=button_color_2,
                                                          text_color=omega_theme['BACKGROUND'])
                return False
        else:
            my_popup(("     " + str(MAX_LEN_USERNAME) + " "))
            window_clone_user.Element('CloneUserName').SetFocus()
            window_clone_user['CloneUserName'].update(background_color=button_color_2,
                                                      text_color=omega_theme['BACKGROUND'])
            return False
        if MIN_LEN_PASSWORD <= len(str(val_clone_user['CloneUserPassword'])) <= MAX_LEN_PASSWORD:
            window_clone_user['CloneUserPassword'].update(background_color=omega_theme['BACKGROUND'],
                                                          text_color=omega_theme['TEXT'])
        else:
            my_popup(("     " + str(MIN_LEN_PASSWORD) + "    "
                      + str(MAX_LEN_PASSWORD) + " "))
            window_clone_user.Element('CloneUserPassword').SetFocus()
            window_clone_user['CloneUserPassword'].update(background_color=button_color_2,
                                                          text_color=omega_theme['BACKGROUND'])
            return False
    elif window == 'login':
        if find_cyrillic(val_login['']):
            my_popup('    ')
            window_login.Element('').SetFocus()
            window_login[''].update(background_color=button_color_2,
                                         text_color=omega_theme['BACKGROUND'])
            return False
    elif window == 'ssh_cred':
        if not (val_cred['ssh_port'] and val_cred['ssh_login']
                and val_cred['ssh_password']):
            my_popup(' ,   !')
            window_ssh_credentials.Element('ssh_login').SetFocus()
            return False
    return result


def find_cyrillic(text: str, alphabet=None) -> bool:
    if alphabet is None:
        alphabet = set('')
    return not alphabet.isdisjoint(text.lower())


def get_user_type(window): #TODO
    result = user_type['user']
    if window == 'add_user':
        if val_add_user['disp']:
            result = user_type['dispatcher']
            return result
        elif val_add_user['gw']:
            result = user_type['box']
            return result
        elif val_add_user['adm']:
            result = user_type['admin']
            return result
        elif val_add_user['user']:
            return result
    elif window == 'modify_user':
        if val_modify_user['modifyUserDispatcher']:
            result = user_type['dispatcher']
            return result
        elif val_modify_user['modifyUserGw']:
            result = user_type['box']
            return result
        elif val_modify_user['modifyUserAdm']:
            result = user_type['admin']
            return result
        elif val_modify_user['modifyUserUser']:
            return result
    elif type(window) is dict:
        if window['is_dispatcher']:
            result = user_type['dispatcher']
            return result
        elif window['is_gw']:
            result = user_type['box']
            return result
        elif window['is_admin']:
            result = user_type['admin']
            return result
        elif window['is_blocked']:
            result = user_type['disabled']
            return result
    return result


def update_users():
    users_from_server = get_users_from_server()
    add_users(users_from_server)
    global users_from_db, user_list, treedata_update_user, filtered_users_list_of_dict
    users_from_db = get_users_from_db()
    users_from_db.sort(key=lambda i: i['login'])
    drop_db('user_in_groups')
    add_user_in_groups(users_from_server)
    if filter_status:
        search_str = values['-filterUser-']
        filtered_users = filter(lambda x: search_str.lower() in x['login'].lower() or
                                          search_str.lower() in x['name'].lower(), users_from_db)
        filtered_users_list_of_dict = list(filtered_users)
        global filtered_users_list
        filtered_users_list, treedata_update_user = get_user_list(
            filtered_users_list_of_dict)
        if not filtered_users_list:
            window['-filterUser-'].update(background_color=button_color_2)
        else:
            window['-filterUser-'].update(background_color='lightblue')
        window['-users-tree-'].update(filtered_users_list)
    else:
        user_list, treedata_update_user = get_user_list(users_from_db)
        user_td = get_user_list_treedata()
        window['-users-tree-'].update(user_td)
    window['-TREE2-'].update(treedata_update_user)


def update_groups():
    add_groups(get_groups_from_server())
    global groups_from_db, group_list, treedata_update_group, filtered_groups_list_of_dict
    groups_from_db = get_groups_from_db()
    groups_from_db.sort(key=lambda i: i['name'])
    if filter_status_group:
        search_str = values['-filterGroup-']
        filtered_groups = filter(lambda x: search_str.lower() in x['name'].lower() or
                                           search_str.lower() in x['desc'].lower(), groups_from_db)
        filtered_groups_list_of_dict = list(filtered_groups)
        global filtered_groups_list
        filtered_groups_list, treedata_update_group = get_group_list(filtered_groups_list_of_dict)
        if not filtered_groups_list:
            window['-filterGroup-'].update(background_color=button_color_2)
        else:
            window['-filterGroup-'].update(background_color='lightblue')
        window['-groups2-'].update(filtered_groups_list)
    else:
        group_list, treedata_update_group = get_group_list(groups_from_db)
        window['-groups2-'].update(group_list)
    add_and_set_groups()


def update_users_and_groups():
    init_db()
    global users_from_db, user_list, treedata_update_user, groups_from_db, group_list, treedata_update_group, \
        filtered_users_list_of_dict, filtered_group_list_of_dict
    users_from_db = get_users_from_db()
    groups_from_db = get_groups_from_db()
    users_from_db.sort(key=lambda i: i['login'])
    groups_from_db.sort(key=lambda i: i['name'])
    treedata_update_group = sg.TreeData()
    if users_from_db != [[]]:

        if filter_status:
            search_str = values['-filterUser-']
            filtered_users = filter(lambda x: search_str.lower() in x['login'].lower() or
                                              search_str.lower() in x['name'].lower(), users_from_db)
            filtered_users_list_of_dict = list(filtered_users)
            global filtered_users_list
            filtered_users_list, treedata_update_user = get_user_list(
                filtered_users_list_of_dict)
            window['-users-'].update(filtered_users_list) #TODO
        else:
            user_list, treedata_update_user = get_user_list(users_from_db)
            user_td = get_user_list_treedata()
            window['-users-tree-'].update(user_td)
    if groups_from_db != [[]]:
        group_list, treedata_update_group = get_group_list(groups_from_db)
        if filter_status_group:
            search_str = values['-filterGroup-']
            filtered_groups = filter(lambda x: search_str.lower() in x['name'].lower() or
                                               search_str.lower() in x['desc'].lower(), groups_from_db)
            filtered_groups_list_of_dict = list(filtered_groups)
            global filtered_groups_list
            filtered_groups_list = list()
            for filtered_group_list_of_dict in filtered_groups_list_of_dict:
                filtered_groups_list.append([filtered_group_list_of_dict['id'],
                                             filtered_group_list_of_dict['name'],
                                             filtered_group_list_of_dict['desc']])
            window['-groups2-'].update(filtered_groups_list)
        else:
            window['-groups2-'].update(group_list)
    window['-TREE2-'].update(treedata_update_user)
    window['-TREE-'].update(treedata_update_group)


def update_free_space(status):
    nonfree_space_perc = round((status['spaceTotal'] -
                                status['freeSpace']) * 100 / status['spaceTotal'], 1)
    upd_t = str(round((100 - nonfree_space_perc), 1)) + '% (' \
            + str(round(status['freeSpace'] / 1024 / 1024 / 1024, 2)) \
            + ' )    '
    window['-StatusBar2-'].update(upd_t, background_color=status_bar_color if nonfree_space_perc < WARN_FREE_SPACE
    else 'yellow' if nonfree_space_perc < ALARM_FREE_SPACE else button_color_2)
    return upd_t


def set_buttons_disabled(param=True):
    window['-AddUser-'].update(disabled=param)
    window['-AddGroup-'].update(disabled=param)
    if filter_status:
        window['-ClearFilterUser-'].update(disabled=False)
    else:
        window['-ClearFilterUser-'].update(disabled=True)
    if filter_status_group:
        window['-ClearFilterGroup-'].update(disabled=False)
    else:
        window['-ClearFilterGroup-'].update(disabled=True)
    if param:
        window[' '].update(disabled=param)
        window[' '].update(disabled=param)
        window['-DelUser-'].update(disabled=param)
        window['-DelGroup-'].update(disabled=param)
        window['-CloneUser-'].update(disabled=param)
        window['-BlockUser-'].update(disabled=param)
        window['-BlockGroup-'].update(disabled=param)
        window['-checkAllGroups-'].update(disabled=param)
        window['-checkAllUsers-'].update(disabled=param)
        window['-ClearFilterUser-'].update(disabled=param)
        window['-ClearFilterGroup-'].update(disabled=param)
    window['-filterUser-'].update(disabled=param)
    window['-filterGroup-'].update(disabled=param)
    window['-hide-online-'].update(disabled=param)
    window['-frame-online-'].update(visible=not window['-frame-online-'].metadata)
    # window['-users-'].update(visible=not param) #  treedata  users 
    window['-users-tree-'].update(visible=not param)
    window['-groups2-'].update(visible=not param)
    window['-TREE-'].update(visible=not param)
    window['-TREE2-'].update(visible=not param)


def set_disabled_user_modify():
    window_modify_user['UserModifyName'].update(disabled=True)
    window_modify_user['userModifyPassword'].update(disabled=True)
    window_modify_user['showModifyPassword'].update(disabled=True)
    window_modify_user['modifyUserUser'].update(disabled=True)
    window_modify_user['modifyUserDispatcher'].update(disabled=True)
    window_modify_user['modifyUserGw'].update(disabled=True)
    window_modify_user['modifyUserAdm'].update(disabled=True)
    window_modify_user['modifyUserRoleIndCallEn'].update(disabled=True)
    window_modify_user['modifyUserRoleAllowDelChats'].update(disabled=True)
    window_modify_user['modifyUserRoleAllowPartialDrop'].update(disabled=True)
    window_modify_user['modifyUserRoleIndMesEn'].update(disabled=True)
    window_modify_user['modifyUserRoleChanger'].update(disabled=True)
    window_modify_user['modifyUserRoleScreenShooter'].update(disabled=True)
    window_modify_user['modifyUserRoleAmbCaller'].update(disabled=True)
    window_modify_user['modifyUserRoleAmbCallee'].update(disabled=True)
    window_modify_user['modifyUserRoleMissingMsgRv'].update(disabled=True)
    window_modify_user['modifyUserRoleAllowLLA'].update(disabled=True)
    window_modify_user['modifyUserRoleAllowLLAclient'].update(disabled=True)
    window_modify_user['modifyUserRoleMfc'].update(disabled=True)
    window_modify_user['modifyUserRoleMultipleDevices'].update(disabled=True)
    window_modify_user['modifyUserShowDevice'].update(disabled=True)
    window_modify_user['modifyUserFixNewDevice'].update(disabled=True)
    window_modify_user['UserModifyPriority'].update(disabled=True)
    window_modify_user['UserModifyOrg'].update(disabled=True)


def get_ssh_connection(pwd=SSH_PWD):
    global SSH_LOGIN, SSH_PWD, SSH_PORT
    try:
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        if not SSH_LOGIN or SSH_LOGIN == base64.b64decode(SSH_LOGIN_DEF).decode("utf-8"):
            if pwd:
                ssh.connect(hostname=ip, timeout=3, port=SSH_PORT,
                            username=base64.b64decode(SSH_LOGIN_DEF).decode("utf-8"),
                            password=pwd)
                SSH_LOGIN, SSH_PWD = base64.b64decode(SSH_LOGIN_DEF).decode("utf-8"), pwd
            else:
                ssh.connect(hostname=ip, timeout=3, port=(SSH_PORT_DEF if not SSH_PORT else SSH_PORT),
                            username=base64.b64decode(SSH_LOGIN_DEF).decode("utf-8"),
                            password=base64.b64decode(SSH_PWD_DEF).decode("utf-8"))
                SSH_LOGIN, SSH_PWD = base64.b64decode(SSH_LOGIN_DEF).decode("utf-8"), base64.b64decode(
                    SSH_PWD_DEF).decode("utf-8")
            remotepath = '/home/omega/Omega/'
        else:
            ssh.connect(hostname=ip, timeout=3, port=SSH_PORT, username=SSH_LOGIN, password=SSH_PWD)
            remotepath = '/home/' + SSH_LOGIN + '/Omega/'
        change_config_file('ssh')
        return ssh, remotepath
    except Exception as e:
        print(f'{e}')
        logging.error('    !')
        my_popup("    !  / ssh  ")
        try:
            global window_ssh_credentials
            window_ssh_credentials = make_credential_window()
            login_ssh_password_clear = False
            window_ssh_credentials.Element('ssh_login').SetFocus()
            while True:
                global ev_cred, val_cred
                ev_cred, val_cred = window_ssh_credentials.Read()
                print(f'{ev_cred}, {val_cred}')
                if ev_cred == sg.WIN_CLOSED or ev_cred == '-Exit-set-':
                    window_ssh_credentials.close()
                    break
                if ev_cred == 'showLoginPasswordCred':
                    if login_ssh_password_clear:
                        window_ssh_credentials['ssh_password'].update(password_char='*')
                        window_ssh_credentials['showLoginPasswordCred'].update(image_data=ICON_SHOW_BASE_64)
                        login_ssh_password_clear = False
                    else:
                        window_ssh_credentials['ssh_password'].update(password_char='')
                        window_ssh_credentials['showLoginPasswordCred'].update(image_data=ICON_HIDE_BASE_64)
                        login_ssh_password_clear = True
                    window_ssh_credentials.Element('ssh_password').SetFocus()
                if ev_cred == 'OK cred':
                    if validate('ssh_cred'):
                        SSH_PORT, SSH_LOGIN, SSH_PWD = val_cred['ssh_port'], val_cred['ssh_login'], val_cred[
                            'ssh_password']
                        ssh = paramiko.SSHClient()
                        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
                        try:
                            ssh.connect(hostname=ip, timeout=3, port=SSH_PORT, username=SSH_LOGIN, password=SSH_PWD)
                        except Exception as e:
                            print(f'{e}')
                            my_popup('  !')
                            window_ssh_credentials.Element('ssh_login').SetFocus()
                            continue
                        if ssh:
                            remotepath = '/home/' + SSH_LOGIN + '/Omega/'
                            change_config_file('ssh')
                            window_ssh_credentials.close()
                            return ssh, remotepath
                        else:
                            continue
                    else:
                        continue
        except Exception as e:
            print(f'{e}')


def get_current_lic():
    res_get_lic = ''
    try:
        res_get_lic = requests.get(BASE_URL + 'getLicenseInfo', headers=HEADER_dict)
    except Exception as e:
        print(f"    - {e}")
        logging.warning(f"    - {e}")
    if res_get_lic != '' and res_get_lic.status_code == 200:
        lic = res_get_lic.json()
        print(lic)
    else:
        lic = dict()
        my_popup('   !    ...')
        try:
            ssh, remotepath = get_ssh_connection()
            if ssh:
                stdin, stdout, stderr = ssh.exec_command('cat $HOME/Omega/.licenseState')
                stdout = stdout.readlines()
                ssh.close()
                output = ''
                for line in stdout:
                    output = output + line
                print(f'  - {output}')
                if output:
                    if output == '0':
                        print('    ')
                        logging.info('    ')
                        my_popup('    ')
                    elif output == '5':
                        print('  ')
                        logging.warning('  ')
                        my_popup('  ')
                    elif output == '6':
                        print('  Omega/generated.lic')
                        logging.error('  Omega/generated.lic')
                        my_popup('  Omega/generated.lic')
                    elif output == '7':
                        print('  Omega/keys/pub.pem')
                        logging.error('  Omega/keys/pub.pem')
                        my_popup('  Omega/keys/pub.pem')
                    elif output == '8':
                        print('  ')
                        logging.error('  ')
                        my_popup('  ')
                    elif output == '9':
                        print('    ')
                        logging.error('    ')
                        my_popup('    ')
                    elif output == '10':
                        print(' ')
                        logging.error(' ')
                        my_popup(' ')
                    elif output == '11':
                        print('    = 0')
                        logging.error('    = 0')
                        my_popup('    = 0')
                    else:
                        print(f'  : {output}')
                        logging.warning(f'  : {output}')
                        my_popup(f'  : {output}')
                ssh.close()
        except Exception as e:
            print(f"     - {e}")
            logging.warning(f"     - {e}")
    return lic


def parse_cur_lic(lic):
    LICS = [[' ', lic['UserCount'],
             lic['ExpirationDate']],
            [' ', lic['DispatcherCount'], lic[
                'ExpirationDate']]]
    for feature in lic['Features']:
        feature_name = " " if feature == "AmbientListening" \
            else "" if feature == "GeoData" \
            else " " if feature == "DGNA" \
            else "  " if feature == "OTAP" \
            else " " if feature == "LongAmbientListening" \
            else " " if feature == "MFC" \
            else " " if feature == "DeviceAuthorization" else "?"
        LICS.append([feature_name, '+', lic['ExpirationDate']])
    return LICS


def get_logs():
    try:
        with open('admin.log', mode='r', encoding='cp1251') as log_f:
            s = log_f.read().rstrip('\n')
            journal_list = s.split('\n')
            for i, raw in enumerate(journal_list):
                journal_list[i] = str(i + 1).ljust(6) + ' ' + raw
            filtered_journal = filter_journal(journal_list)
            if filter_status_journal:
                filtered_journal = list(
                    filter(lambda x: values['-filterJournal-'].lower() in x.lower(), filtered_journal))
            return ["\n".join(filtered_journal[-LOG_DEPTH:]), len(filtered_journal), len(journal_list)]
    except Exception as e:
        print(f'     - {e}')
        logging.error(f'     - {e}')
    return ['', 0, 0]


def get_block_status(user_to_change):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    if type(user_to_change) is dict:
        cur.execute("select is_blocked from users where id='" + user_to_change['id'] + "'")
    else:
        cur.execute("select is_blocked from users where id='" + user_to_change + "'")
    status = cur.fetchone()
    if status is not None:
        status = status[0]
    con.close()
    return status


def get_block_status_group(group):
    con = sqlite3.connect('adm.db')
    cur = con.cursor()
    if type(group) is dict:
        cur.execute("select is_disabled from groups where id='" + group['id'] + "'")
    else:
        cur.execute("select is_disabled from groups where id='" + group + "'")
    status = cur.fetchone()
    if status is not None:
        status = status[0]
    con.close()
    return status


def get_logs_server():
    global SSH_LOGIN, SSH_PWD, SSH_PORT
    try:
        ssh, remotepath = get_ssh_connection()
        ftp_client = ssh.open_sftp()
        ftp_client.get(remotepath=(remotepath + '/log.txt'), localpath='logs/ServerLog.txt')
        ftp_client.close()
        ssh.close()
        change_config_file('ssh')
        global got_server_log
        got_server_log = True
        return filter_logs_server()
    except Exception as e:
        print(f'{e}')
        logging.error('    !')
        my_popup("    !")
    return ['', 0, 0]


def get_journal_with_types(journal: list):
    count = 0
    count_all = 0
    unset_row = False
    final_list = list()
    default_types = ['info', 'warn', 'fail']
    string_types = list()
    if filter_journal_info_server:
        string_types.append('info')
    if filter_journal_warn_server:
        string_types.append('warn')
    if filter_journal_fail_server:
        string_types.append('fail')
    raw: str
    for i, raw in enumerate(journal):
        if raw.startswith(tuple(string_types)):
            count += 1
            count_all += 1
            unset_row = False
            final_list.append(str(count).ljust(6) + ' ' + raw)
        else:
            if raw.startswith(tuple(set(default_types) - set(string_types))):
                unset_row = True
                count_all += 1
            else:
                if not unset_row:
                    final_list.append('.'.ljust(15, '.') + raw)
                else:
                    pass
    return final_list, count, count_all


def filter_logs_server():
    try:
        with open('logs/ServerLog.txt', mode='r', encoding='utf-8') as log_f:
            s = log_f.read().rstrip('\n')
            journal_list = s.split('\n')
            journal_list_with_types, count_log, count_all = get_journal_with_types(journal_list)
            if filter_status_journal_server:
                filtered_journal_server = list()
                new_i = 0
                filter_count_log = 0
                for i, raw in enumerate(journal_list_with_types):
                    if i >= new_i:
                        new_i += 1
                        if values['-filterJournalServer-'].lower() in raw.lower():
                            try:
                                if raw[0:6].strip().isdigit():
                                    filtered_journal_server.append(raw)
                                else:
                                    for j in range(1, i):
                                        if journal_list_with_types[i - j][0:6].strip().isdigit():
                                            for k in range(j, -1, -1):
                                                filtered_journal_server.append(journal_list_with_types[i - k])
                                            break
                                for w in range(0, len(journal_list_with_types) - i - 1):
                                    if journal_list_with_types[i + w + 1][0:6].strip().isdigit():
                                        for m in range(0, w):
                                            filtered_journal_server.append(journal_list_with_types[i + m + 1])
                                        new_i += w
                                        break
                                    if len(journal_list_with_types) - 1 == i + w + 1:
                                        for m in range(0, w + 1):
                                            filtered_journal_server.append(journal_list_with_types[i + m + 1])
                                            new_i += 1
                                        break
                                filter_count_log += 1
                            except Exception as e:
                                print(f'{e}')
                return ["\n".join(filtered_journal_server[-LOG_DEPTH:]), filter_count_log, count_all]
            return ["\n".join(journal_list_with_types[-LOG_DEPTH:]), count_log, count_all]
    except Exception as e:
        print(f'{e}')
        logging.error('    !')
        my_popup("    !")
        return ['', 0, 0]


def change_config_file(mode):
    if os.stat(Path(Path.cwd(), 'config', 'app.json')).st_size:
        try:
            with open(Path(Path.cwd(), 'config', 'app.json'), 'r') as f_app_config:
                config_app = json.load(f_app_config)
                print(config_app)
                if mode == 'auth':
                    config_app['ip'] = val_login['ip']
                    config_app['login'] = val_login['']
                elif mode == 'ssh':
                    config_app['ssh_login'] = SSH_LOGIN
                    config_app['ssh_port'] = SSH_PORT
                elif mode == 'all':
                    config_app['ip'] = val_login['ip']
                    config_app['login'] = val_login['']
                    config_app['ssh_login'] = SSH_LOGIN
                    config_app['ssh_port'] = SSH_PORT
            with open(Path(Path.cwd(), 'config', 'app.json'), 'w') as f_app_config:
                f_app_config.write(json.dumps(config_app, sort_keys=True, indent=4))
                print("  ")
        except Exception as e:
            print(f'{e}')


def set_roles(ev: str):
    if 'add' in ev:
        print('add')
    else:
        print('modify')
        window_modify_user['modifyUserRoleIndCallEn'].update(user_to_change['role_en_ind'],
                                                             disabled=False if ev == 'modifyUserUser' or
                                                                               ev == 'modifyUserDispatcher' else True)
        window_modify_user['modifyUserRoleAllowDelChats'].update(user_to_change['role_en_del_chats'],
                                                                 disabled=False if ev == 'modifyUserDispatcher' else True)
        window_modify_user['modifyUserRoleAllowPartialDrop'].update(user_to_change['role_en_partial_drop'],
                                                                    disabled=False if ev == 'modifyUserDispatcher' else True)
        window_modify_user['modifyUserRoleIndMesEn'].update(user_to_change['role_en_ind_mes'],
                                                            disabled=False if ev == 'modifyUserUser' or
                                                                              ev == 'modifyUserDispatcher' else True)
        window_modify_user['modifyUserRoleChanger'].update(user_to_change['role_changer'],
                                                           disabled=False if ev == 'modifyUserDispatcher' else True)
        window_modify_user['modifyUserRoleScreenShooter'].update(user_to_change['role_screen_shooter'],
                                                                 disabled=False if ev == 'modifyUserUser' else True)
        window_modify_user['modifyUserRoleAmbCaller'].update(user_to_change['role_amb_caller'],
                                                             disabled=False if ev == 'modifyUserDispatcher' else True)
        window_modify_user['modifyUserRoleAmbCallee'].update(user_to_change['role_amb_callee'],
                                                             disabled=False if ev == 'modifyUserUser' else True)
        window_modify_user['modifyUserRoleMissingMsgRv'].update(user_to_change['role_missing_msg_rv'],
                                                                disabled=False if ev == 'modifyUserUser' or
                                                                                  ev == 'modifyUserDispatcher' else True)
        window_modify_user['modifyUserRoleAllowLLA'].update(user_to_change['role_allow_LLA'],
                                                            disabled=False if ev == 'modifyUserDispatcher' else True)
        window_modify_user['modifyUserRoleAllowLLAclient'].update(user_to_change['role_allow_LLA_client'],
                                                                  disabled=False if ev == 'modifyUserUser' else True)
        window_modify_user['modifyUserRoleMfc'].update(user_to_change['role_mfc'],
                                                       disabled=False if ev == 'modifyUserUser' or
                                                                         ev == 'modifyUserDispatcher' else True)
        # window_modify_user['modifyUserRoleFixDevice'].update(user_to_change['fix_device'],
        #                                                      disabled=False if ev == 'modifyUserUser' else True)
        window_modify_user['modifyUserRoleMultipleDevices'].update(user_to_change['role_multiple_devices'],
                                                                   disabled=False if ev == 'modifyUserUser' or
                                                                   ev == 'modifyUserGw' else True)


if __name__ == '__main__':
    if sys.version_info[1] < 9:
        logging.basicConfig(filename='admin.log', filemode='a', format='%(asctime)s %(levelname)s %(message)s',
                            datefmt='%d/%m/%Y %H:%M:%S', level=logging.INFO)
    else:
        logging.basicConfig(filename='admin.log', filemode='a', format='%(asctime)s %(levelname)s %(message)s',
                            encoding='cp1251', datefmt='%d/%m/%Y %H:%M:%S', level=logging.INFO)
    logging.getLogger('paramiko').setLevel(logging.WARNING)
    logging.info(' ')
    window_login = make_login_window()
    login_password_clear = False
    remember_credentials = True
    window = None
    # active_config = None
    ip_config = None
    change_state = None
    create_db()
    thread_started = False
    current_db = 0
    ip = ''
    additional_window = False
    # noinspection PyUnboundLocalVariable
    if active_config:
        if window_login.ReturnValuesDictionary['']:
            window_login.Element('password').SetFocus()
        else:
            window_login.Element('').SetFocus()
    while True:
        break_flag = False
        break_flag2 = False
        ev_login, val_login = window_login.Read()
        if ev_login == sg.WIN_CLOSED or ev_login == 'Exit':
            break
        if ev_login == 'password':
            window_login['showLoginPassword'].update(disabled=False)
            window_login['showLoginPassword'].update(image_data=ICON_SHOW_BASE_64)
        if ev_login == 'showLoginPassword':
            if login_password_clear:
                window_login['password'].update(password_char='*')
                window_login['showLoginPassword'].update(image_data=ICON_SHOW_BASE_64)
                login_password_clear = False
            else:
                window_login['password'].update(password_char='')
                window_login['showLoginPassword'].update(image_data=ICON_HIDE_BASE_64)
                login_password_clear = True
            window_login.Element('password').SetFocus()
        if ev_login == 'ip':
            pass
        if ev_login == '':
            pass
        if ev_login == 'remember_credentials':
            print(ev_login)
            print(val_login)
            if val_login['remember_credentials']:
                remember_credentials = True
            else:
                remember_credentials = False
        if ev_login == "OK button":
            host_ok = False
            port = 5000
            if remember_credentials:
                # noinspection PyUnboundLocalVariable
                if ip_config != val_login['ip']:
                    change_config_file('auth')
            try:
                parsed_url = urllib.parse.urlsplit('//' + val_login['ip'])
                print(parsed_url.hostname, parsed_url.port)
                if re.search('^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+', parsed_url.hostname):
                    ip = ipaddress.ip_address(parsed_url.hostname).exploded
                else:
                    print(socket.gethostbyname(parsed_url.hostname))
                    ip = socket.gethostbyname(parsed_url.hostname)
                host_ok = True
                if parsed_url.port:
                    port = parsed_url.port
            except Exception as e:
                print(f'{e}')
            if not host_ok:
                my_popup(' IP')
                window_login.Element('ip').SetFocus()
                window_login['ip'].update(background_color=button_color_2,
                                          text_color=omega_theme['BACKGROUND'])
                continue
            window_login['ip'].update(background_color=omega_theme['BACKGROUND'],
                                      text_color=omega_theme['TEXT'])
            if validate('login'):
                if ip == '127.0.0.1':  # TODO
                    LOCAL = True
                    # print(f'DEF1A = {DEF1A}')
                    try:
                        with open("/home/omega/Omega/.admPWD_b", mode='r') as pwd_hash_file:
                            DEF1A = str(pwd_hash_file.readline()).rstrip('\n')
                            # print(f'{type(DEF1A)}')
                            # print(f'DEF1A = {DEF1A}')
                    except Exception as e:
                        print(f'{e}')
                        logging.error(f'{e}')
                    hash_pwd = hashlib.pbkdf2_hmac('sha256',
                                                   bytes(str(val_login["password"]).encode('ASCII', 'ignore')),
                                                   bytes(str(SALT).encode('ASCII')), 10000).hex()
                    # print(f'{type(hash_pwd)}')
                    # print(f'{hash_pwd}')
                    # print(f'{hash_pwd == DEF1A}')
                    if (hashlib.pbkdf2_hmac('sha256', bytes(str(val_login[""]).encode('ASCII')),
                                            bytes(str(SALT).encode('ASCII')), 10000).hex() == DEF1
                        and hashlib.pbkdf2_hmac('sha256', bytes(str(val_login["password"]).encode('ASCII', 'ignore')),
                                                bytes(str(SALT).encode('ASCII')), 10000).hex() == DEF1A) \
                            or (hashlib.pbkdf2_hmac('sha256', bytes(str(val_login[""]).encode('ASCII')),
                                                    bytes(str(SALT).encode('ASCII')), 10000).hex() == DEF2
                                and hashlib.pbkdf2_hmac('sha256', bytes(str(val_login["password"]).encode('ASCII')),
                                                        bytes(str(SALT).encode('ASCII')), 10000).hex() == DEF2) \
                            or (hashlib.pbkdf2_hmac('sha256', bytes(str(val_login[""]).encode('ASCII')),
                                                    bytes(str(SALT).encode('ASCII')), 10000).hex() == DEF3
                                and hashlib.pbkdf2_hmac('sha256', bytes(str(val_login["password"]).encode('ASCII')),
                                                        bytes(str(SALT).encode('ASCII')), 10000).hex() == DEF3A):
                        logging.info('   ')
                    else:
                        my_popup(' ')
                        window_login.Element('').SetFocus()
                        continue
                while True:
                    if break_flag:
                        break
                    https_on = True if val_login['https_on'] else False
                    if https_on:
                        BASE_URL_PROTO = 'https://'  # TODO
                    else:
                        BASE_URL_PROTO = 'http://'
                    BASE_URL = BASE_URL_PROTO + ip + ':' + str(port) + '/api/admin/'
                    BASE_URL_PING = BASE_URL_PROTO + ip + ':' + str(port) + '/api/ping'
                    BASE_URL_AUTH = BASE_URL_PROTO + ip + ':' + str(port) + '/api/auth'
                    BASE_URL_SETTINGS = BASE_URL_PROTO + ip + ':' + str(port) + '/api/admin/settings'
                    BASE_URL_UPDATE = BASE_URL_PROTO + ip + ':' + str(port) + '/api/update/'
                    BASE_URL_DEVICE = BASE_URL_PROTO + ip + ':' + str(port) + '/api/device/'
                    BASE_URL_ORG = BASE_URL_PROTO + ip + ':' + str(port) + '/api/admin/org'
                    server_status = check_server(BASE_URL_PING)
                    current_db = server_status['db']
                    if server_status['run']:
                        TOKEN = get_token(BASE_URL_AUTH)
                        if not TOKEN:
                            break
                        else:
                            HEADER_dict = {'Authorization': "Bearer " + TOKEN}
                            # print(get_settings(BASE_URL_SETTINGS))
                            init_db()
                            users_from_db = get_users_from_db()
                            groups_from_db = get_groups_from_db()
                    else:
                        users_from_db = [{}]
                        groups_from_db = [{}]
                    window_login.hide()
                    filter_status = False
                    filter_status_group = False
                    filter_status_journal = False
                    filter_status_journal_server = False
                    filter_journal_info = True
                    filter_journal_info_server = True
                    filter_journal_warn_server = True
                    filter_journal_fail_server = True
                    filter_journal_warning = True
                    filter_journal_error = True
                    filter_journal_critical = True
                    got_server_log = False
                    selected_user = False
                    ping_timeout = DEF_PING_TM
                    window = make_main_window(ip)
                    tree = window['-TREE-']
                    tree2 = window['-TREE2-']
                    if server_status['run']:
                        set_window_running_server()
                    else:
                        set_buttons_disabled()
                        window.Element('-Start-').SetFocus()
                    while True:
                        if break_flag2:
                            break
                        if server_status['run']:  # TODO
                            window['-Start-'].update(disabled=True)
                        else:
                            window['-Stop-'].update(disabled=True)
                        if not thread_started:
                            threading.Thread(target=the_thread, args=[BASE_URL_PING], daemon=True).start()
                            thread_started = True
                        event, values = window.read()
                        print(event, type(event), values)
                        if event == '-hide-online-':
                            window['-frame-online-'].update(visible=window['-frame-online-'].metadata == True)
                            window['-frame-online-'].metadata = not window['-frame-online-'].metadata
                            window['-hide-online-'].update(
                                text=SYMBOL_RIGHT_ARROWHEAD if window[
                                    '-frame-online-'].metadata else SYMBOL_LEFT_ARROWHEAD)
                        # if event == 'ambientListening':
                        #     print('sdgfdfgdfg')
                        if event == '-THREAD-':
                            if not thread_started:
                                # print(json.loads(values['-THREAD-'][1]))
                                threading.Thread(target=the_thread, args=[BASE_URL_PING], daemon=True).start()
                                thread_started = True
                            else:
                                dict_online = json.loads(values['-THREAD-'][1])
                                # print(current_db)
                                if dict_online["onlineUsersCount"] != -1:
                                    update_free_space(dict_online)
                                    window['-Start-'].update(disabled=True)
                                    window['-Stop-'].update(disabled=False)
                                    window['online-users'].update(get_online_users(dict_online['onlineUserIds']))
                                    if not server_status['run']:
                                        TOKEN = get_token(BASE_URL_AUTH)
                                        if not TOKEN:
                                            break_flag = True
                                            break
                                        else:
                                            HEADER_dict = {'Authorization': "Bearer " + TOKEN}
                                            update_users_and_groups()
                                            window['-Menu-'].update([
                                                ['',
                                                 [' ...', '', '', '',
                                                  '', ' ',
                                                  ['', '']]],
                                                ['', ' '], ])
                                    if current_db < dict_online['databaseVersion']:  # TODO
                                        update_users_and_groups()
                                        current_db = dict_online['databaseVersion']
                                    update_text = ': ' + str(dict_online["onlineUsersCount"]) \
                                                  + ', : ' + str(dict_online["databaseVersion"]) \
                                                  + (', ' if dict_online["isReserved"] else ', ')
                                    update_text2 = update_free_space(dict_online)
                                    window['-StatusBar-'].update(update_text,
                                                                 background_color=(button_color_2 if
                                                                                   dict_online[
                                                                                       "isReserved"] else status_bar_color))
                                    window['-StatusBar2-'].update(update_text2)
                                    set_buttons_disabled(False)
                                    server_status['run'] = True
                                else:
                                    window['-StatusBar-'].update('  ', background_color=button_color_2)
                                    window['-StatusBar2-'].update('', background_color=button_color_2)
                                    window['-StatusBar3-'].update('', background_color=button_color_2)
                                    window['-Start-'].update(disabled=False)
                                    window['-Stop-'].update(disabled=True)
                                    # window['-users-'].update([[]])
                                    clear_treedata = sg.TreeData()
                                    window['-groups2-'].update([[]])
                                    window['-users-tree-'].update(clear_treedata)
                                    window['-TREE-'].update(clear_treedata)
                                    window['-TREE2-'].update(clear_treedata)
                                    set_buttons_disabled()
                                    window.Element('-Start-').SetFocus()
                                    server_status['run'] = False
                                    update_free_space(dict_online)
                                    window['online-users'].update('')
                                    if server_status['run']:
                                        server_status['run'] = False
                                        window['-Menu-'].update([
                                            ['',
                                             [' ...', '!', '', '',
                                              '', ' ',
                                              ['', '']]],
                                            ['', ' '], ])
                                # noinspection PyUnboundLocalVariable
                                if change_state:  # TODO
                                    output_text = get_logs()
                                    window['journal'].update(output_text[0])
                                    count_string = str(output_text[1]) + '  ' + str(output_text[2])
                                    window['countLogs'].update(count_string)
                                    window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                                    if server_status['run']:
                                        set_lic_status_bar()
                        if event == sg.WINDOW_CLOSE_ATTEMPTED_EVENT:
                            additional_window = True
                            break_flag = True
                            window_exit = make_exit_window()
                            while True:
                                ev_exit, val_exit = window_exit.Read()
                                if ev_exit == 'okExit':
                                    logging.info('  ')
                                    logging.info(' ')
                                    window_exit.close()
                                    window_login.close()
                                    window.close()
                                    break_flag2 = True
                                    break
                                if ev_exit == sg.WIN_CLOSED or ev_exit == 'Exit':
                                    # print('  ')
                                    break
                                if ev_exit == 'noExit':
                                    # print('  ')
                                    window_exit.close()
                                    break
                            additional_window = False
                        if event == sg.WIN_CLOSED or event == 'Exit':
                            break_flag = True
                            break
                        if event == '-users-tree-':
                            if values['-users-tree-']:
                                is_org = check_org(values['-users-tree-'][0])
                                if filter_status:
                                    # noinspection PyUnboundLocalVariable
                                    selected_user = filtered_users_list_of_dict[values['-users-'][0]]
                                else:
                                    if not is_org:
                                        selected_user_id = str(values['-users-tree-'][0]).partition('.')[0]
                                        selected_user = get_user_by_id_from_db(selected_user_id)
                                    else:
                                        org_id = values['-users-tree-'][0]
                                window['Apply'].update(disabled=True)
                                if not is_org:
                                    window[' '].update(disabled=False)
                                    if selected_user['name'] == 'admin':
                                        window['-DelUser-'].update(disabled=True)
                                        window['-BlockUser-'].update(disabled=True)
                                    else:
                                        window['-DelUser-'].update(disabled=False)
                                        window['-BlockUser-'].update(disabled=False)
                                        if get_block_status(selected_user):
                                            window['-BlockUser-'].update(image_data=ICON_UNBLOCK_BASE_64_BLUE)
                                            window['-BlockUser-'].TooltipObject.text = ''
                                        else:
                                            window['-BlockUser-'].update(image_data=ICON_BLOCK_BASE_64_BLUE)
                                            window['-BlockUser-'].TooltipObject.text = ''
                                    window['-checkAllGroups-'].update(False, disabled=False)
                                    window['-CloneUser-'].update(disabled=False)
                                else:
                                    window['-DelUser-'].update(disabled=True)
                                    window['-BlockUser-'].update(image_data=ICON_BLOCK_BASE_64_BLUE)
                                    window['-BlockUser-'].TooltipObject.text = ''
                                    window['-checkAllGroups-'].update(False, disabled=True)
                                    window['-CloneUser-'].update(disabled=True)
                                    window[' '].update(disabled=True)
                                add_and_set_groups()
                            else:
                                window['Apply'].update(disabled=True)
                                window[' '].update(disabled=True)
                                window['-CloneUser-'].update(disabled=True)
                                window['-BlockUser-'].update(disabled=True)
                                window['-DelUser-'].update(disabled=True)
                                window['-checkAllGroups-'].update(disabled=True)
                                # window['-checkAllGroups-'].update(True)
                        if event == '-ollapseExpandUser-':
                            user_list_treedata = get_user_list_treedata()
                            if window['-ollapseExpandUser-'].metadata == 'collapse':
                                window['-ollapseExpandUser-'].update(image_data=ICON_EXPAND_32_BASE_64_BLUE)
                                for key in user_list_treedata.tree_dict:
                                    window['-users-tree-'].Widget.item(key_to_id(key, window['-users-tree-']), open=False)
                                window['-ollapseExpandUser-'].metadata = 'expand'
                                window['-ollapseExpandUser-'].TooltipObject.text = ''
                            else:
                                window['-ollapseExpandUser-'].update(
                                    image_data=ICON_COLLAPSE_32_BASE_64_BLUE)
                                for key in user_list_treedata.tree_dict:
                                    window['-users-tree-'].Widget.item(key_to_id(key, window['-users-tree-']), open=True)
                                window['-ollapseExpandUser-'].metadata = 'collapse'
                                window['-ollapseExpandUser-'].TooltipObject.text = ''
                        # if event == '-users-':
                        #     if values['-users-']:
                        #         if filter_status:
                        #             # noinspection PyUnboundLocalVariable
                        #             selected_user = filtered_users_list_of_dict[values['-users-'][0]]
                        #         else:
                        #             selected_user = users_from_db[values['-users-'][0]]
                        #         window['Apply'].update(disabled=True)
                        #         window[' '].update(disabled=False)
                        #         if selected_user['name'] == 'admin':
                        #             window['-DelUser-'].update(disabled=True)
                        #         else:
                        #             window['-DelUser-'].update(disabled=False)
                        #         window['-CloneUser-'].update(disabled=False)
                        #         if get_block_status(selected_user):
                        #             window['-BlockUser-'].update(image_data=ICON_UNBLOCK_BASE_64_BLUE)
                        #             window['-BlockUser-'].TooltipObject.text = ''
                        #         else:
                        #             window['-BlockUser-'].update(image_data=ICON_BLOCK_BASE_64_BLUE)
                        #             window['-BlockUser-'].TooltipObject.text = ''
                        #         window['-BlockUser-'].update(disabled=False)
                        #         window['-checkAllGroups-'].update(disabled=False)
                        #         window['-checkAllGroups-'].update(False)
                        #         groups_for_user = get_groups_for_user_from_db(selected_user['id'])
                        #         group_for_user_ids = []
                        #         for group_for_user in groups_for_user:
                        #             group_for_user_ids.append(group_for_user['id'])
                        #         all_group_ids = []
                        #         for group_from_all in groups_from_db:
                        #             all_group_ids.append(group_from_all['id'])
                        #         tree.metadata = []
                        #         for group_id_for_tree in all_group_ids:
                        #             if group_id_for_tree in group_for_user_ids:
                        #                 tree.metadata.append(group_id_for_tree)
                        #                 tree.update(key=group_id_for_tree, icon=check[1])
                        #             else:
                        #                 tree.update(key=group_id_for_tree, icon=check[0])
                        #     else:
                        #         window['Apply'].update(disabled=True)
                        #         window[' '].update(disabled=True)
                        #         window['-CloneUser-'].update(disabled=True)
                        #         window['-BlockUser-'].update(disabled=True)
                        #         window['-DelUser-'].update(disabled=True)
                        #         window['-checkAllGroups-'].update(disabled=True)
                        #         window['-checkAllGroups-'].update(True)
                        if event == '-groups2-':
                            if values['-groups2-']:
                                if filter_status_group:
                                    # noinspection PyUnboundLocalVariable
                                    selected_group = filtered_groups_list_of_dict[values['-groups2-'][0]]
                                else:
                                    selected_group = groups_from_db[values['-groups2-'][0]]
                                window['Apply2'].update(disabled=True)
                                window[' '].update(disabled=False)
                                window['-DelGroup-'].update(disabled=False)
                                if get_block_status_group(selected_group):
                                    window['-BlockGroup-'].update(image_data=ICON_UNBLOCK_BASE_64_BLUE)
                                    window['-BlockGroup-'].TooltipObject.text = ''
                                else:
                                    window['-BlockGroup-'].update(image_data=ICON_BLOCK_BASE_64_BLUE)
                                    window['-BlockGroup-'].TooltipObject.text = ''
                                window['-BlockGroup-'].update(disabled=False)
                                window['-checkAllUsers-'].update(disabled=False)
                                window['-checkAllUsers-'].update(False)
                                users_for_group = get_users_for_group_from_db(selected_group['id'])
                                user_for_group_ids = []
                                for user_for_group in users_for_group:
                                    user_for_group_ids.append(user_for_group['id'])
                                all_user_ids = []
                                for user_from_all in users_from_db:
                                    all_user_ids.append(user_from_all['id'])
                                tree2.metadata = []
                                for user_id_for_tree in all_user_ids:
                                    if user_id_for_tree in user_for_group_ids:
                                        tree2.metadata.append(user_id_for_tree)
                                        tree2.update(key=user_id_for_tree, icon=check[1])
                                    else:
                                        tree2.update(key=user_id_for_tree, icon=check[0])
                            else:
                                window['Apply2'].update(disabled=True)
                                window[' '].update(disabled=True)
                                window['-BlockGroup-'].update(disabled=True)
                                window['-DelGroup-'].update(disabled=True)
                                window['-checkAllGroups-'].update(disabled=True)
                                window['-checkAllGroups-'].update(True)
                        if event == ' ':
                            """
                               userType
                            """
                            additional_window = True
                            if not values['-users-tree-']:
                                my_popup('  ')
                            else:
                                users_from_db = get_users_from_db()
                                if filter_status:
                                    user_to_change = filtered_users_list_of_dict[values['-users-'][0]]
                                else:
                                    if not is_org:
                                        selected_user_id = str(values['-users-tree-'][0]).partition('.')[0]
                                        print(selected_user_id)
                                        for user in users_from_db:
                                            if user['id'] == selected_user_id:
                                                user_to_change = copy.deepcopy(user)
                                                print(user_to_change)
                                                break
                                    else:
                                        org_id = values['-users-tree-'][0]
                                window_modify_user = make_modify_user_window(user_to_change)
                                if get_user_type(user_to_change) == -1:
                                    set_disabled_user_modify()
                                window_modify_user.Element('UserModifyName').SetFocus()
                                password_clear = False
                                modify_role = False
                                while True:
                                    ev_modify_user, val_modify_user = window_modify_user.Read()
                                    modify_fix_device = False
                                    modify_show_device = False
                                    modify_success = False
                                    if ev_modify_user == sg.WIN_CLOSED or ev_modify_user == 'Exit':
                                        break
                                    if ev_modify_user == 'userModifyPassword':
                                        window_modify_user['showModifyPassword'].update(disabled=False)
                                        window_modify_user['showModifyPassword'].update(image_data=ICON_SHOW_BASE_64)
                                    if (ev_modify_user == 'modifyUserUser'
                                            or ev_modify_user == 'modifyUserDispatcher'
                                            or ev_modify_user == 'modifyUserGw'
                                            or ev_modify_user == 'modifyUserAdm'):
                                        set_roles(ev_modify_user)
                                    # if ev_modify_user == '-hide-roles-':
                                    #     window_modify_user['modifyUserRoles'].update(
                                    #         visible=window_modify_user['modifyUserRoles'].metadata == True)
                                    #     window_modify_user['modifyUserRoles'].metadata = not window_modify_user['modifyUserRoles'].metadata
                                    #     window_modify_user['-hide-roles-'].update(
                                    #         text=SYMBOL_UP_ARROWHEAD if window_modify_user[
                                    #             'modifyUserRoles'].metadata else SYMBOL_DOWN_ARROWHEAD)
                                    if (ev_modify_user == 'modifyUserRoleIndCallEn'
                                            or ev_modify_user == 'modifyUserRoleIndMesEn'
                                            or ev_modify_user == 'modifyUserRoleAllowDelChats'
                                            or ev_modify_user == 'modifyUserRoleAllowPartialDrop'
                                            or ev_modify_user == 'modifyUserRoleChanger'
                                            or ev_modify_user == 'modifyUserRoleScreenShooter'
                                            or ev_modify_user == 'modifyUserRoleAmbCaller'
                                            or ev_modify_user == 'modifyUserRoleAmbCallee'
                                            or ev_modify_user == 'modifyUserRoleMissingMsgRv'
                                            or ev_modify_user == 'modifyUserRoleAllowLLA'
                                            or ev_modify_user == 'modifyUserRoleAllowLLAclient'
                                            or ev_modify_user == 'modifyUserRoleMfc'
                                            # or ev_modify_user == 'modifyUserRoleFixDevice'
                                            or ev_modify_user == 'modifyUserRoleMultipleDevices'):
                                        modify_role = True
                                    if ev_modify_user == 'modifyUserShowDevice':
                                        modify_show_device = True
                                        last_device = get_last_device()
                                        if last_device:
                                            window_device = make_device(last_device)
                                            while True:
                                                ev_dev, val_dev = window_device.Read()
                                                if ev_dev == sg.WIN_CLOSED or ev_dev == '':
                                                    window_device.close()
                                                    break
                                                if ev_dev == '-fixLastDevice-':
                                                    fix_last_device_success = fixLastDevice(user_to_change['id'])
                                                    if fix_last_device_success:
                                                        update_users()
                                                        window_modify_user['modifyUserRoleMultipleDevices'].update(False)
                                                        window_device.close()
                                        else:
                                            pass
                                    if ev_modify_user == 'modifyUserFixNewDevice':
                                        # fix_device_error = False
                                        modify_fix_device = True
                                        window_confirm = make_confirm_window(
                                            ' ,      ?\n'
                                            '       !')
                                        while True:
                                            ev_confirm, val_confirm = window_confirm.Read()
                                            if ev_confirm == 'okExit':
                                                try:
                                                    clear_devices(user_to_change['id'])
                                                    res_modify_fix_new_dev = requests.post(BASE_URL +
                                                                                                'allowNewDevice',
                                                                                                json={'UserId': user_to_change['id']},
                                                                                                headers=HEADER_dict)
                                                    if res_modify_fix_new_dev.status_code == 200:
                                                        # modify_success = True
                                                        current_db += 1
                                                        update_users()
                                                        my_popup('    ')
                                                        logging.info(
                                                            f" {val_modify_user['UserModifyLogin']} "
                                                            f'   ')
                                                    else:
                                                        my_popup(' ')
                                                        logging.error(
                                                            f"      "
                                                            f" {val_modify_user['UserModifyLogin']}")
                                                    window_confirm.close()
                                                except Exception as e:
                                                    print(f'    - {e}')
                                                    logging.error("   ")
                                                window_modify_user['modifyUserRoleMultipleDevices'].update(False)
                                            if ev_confirm == sg.WIN_CLOSED or ev_confirm == 'Exit':
                                                break
                                            if ev_confirm == 'noExit':
                                                window_confirm.close()
                                                break
                                    if ev_modify_user == 'UserModifyPriority':
                                        if val_modify_user['UserModifyPriority'] == '':
                                            window_modify_user['UserModifyPriority'].update(
                                                background_color=omega_theme['INPUT'],
                                                text_color=omega_theme['TEXT'])
                                        elif len(val_modify_user['UserModifyPriority']) > 2:
                                            window_modify_user['UserModifyPriority'].update(
                                                val_modify_user['UserModifyPriority'][:2])
                                        elif val_modify_user['UserModifyPriority'].isdigit():
                                            window_modify_user['UserModifyPriority'].update(
                                                background_color=omega_theme['INPUT'])
                                            if 0 <= int(val_modify_user['UserModifyPriority'][:2]) <= 15:
                                                window_modify_user['UserModifyPriority'].update(
                                                    background_color=omega_theme['INPUT'],
                                                    text_color=omega_theme['TEXT'])
                                            else:
                                                window_modify_user['UserModifyPriority'].update(
                                                    background_color=button_color_2)
                                        else:
                                            window_modify_user['UserModifyPriority'].update(
                                                background_color=button_color_2)
                                    if ev_modify_user == 'showModifyPassword':
                                        if password_clear:
                                            window_modify_user['userModifyPassword'].update(password_char='*')
                                            window_modify_user['showModifyPassword'].update(
                                                image_data=ICON_SHOW_BASE_64)
                                            password_clear = False
                                        else:
                                            window_modify_user['userModifyPassword'].update(password_char='')
                                            window_modify_user['showModifyPassword'].update(
                                                image_data=ICON_HIDE_BASE_64)
                                            password_clear = True
                                    if ev_modify_user == 'modifyUserButton':
                                        if validate('modify_user'):
                                            modify_user_type = get_user_type('modify_user')
                                            modify_user_dict = {'id': user_to_change['id']}
                                            modify_name = False
                                            modify_password = False
                                            modify_is_blocked = False
                                            modify_priority = False
                                            modify_org = False
                                            modify_u_t = False
                                            modify_success = False
                                            if val_modify_user['UserModifyName'] != user_to_change['name']:
                                                modify_user_dict['displayName'] = val_modify_user['UserModifyName']
                                                modify_name = True
                                            if get_id_by_org(val_modify_user['UserModifyOrg']) != user_to_change['organization_id']:
                                                modify_user_dict['OrganizationId'] = get_id_by_org(val_modify_user['UserModifyOrg'])
                                                modify_org = True
                                            if val_modify_user['UserModifyPriority'] != str(user_to_change['priority']):
                                                modify_user_dict['priority'] = val_modify_user['UserModifyPriority']
                                                modify_priority = True
                                            if val_modify_user['userModifyPassword']:
                                                modify_user_dict['password'] = val_modify_user['userModifyPassword']
                                                modify_password = True
                                            if modify_role:
                                                result = change_all_roles(user_to_change['id'], val_modify_user)
                                                if result:
                                                    modify_success = True
                                                    logging.info(
                                                        f" {val_modify_user['UserModifyLogin']} "
                                                        f' ')
                                                else:
                                                    logging.error(
                                                        f"    "
                                                        f" {val_modify_user['UserModifyLogin']}")
                                            if val_modify_user['modifyUserBlock'] != user_to_change['is_blocked']:
                                                modify_is_blocked = True
                                                res_block = block_user(val_modify_user['modifyUserBlock'],
                                                                       user_to_change['id'])
                                                if res_block:
                                                    if res_block.status_code == 200:
                                                        current_db += 1
                                                        modify_success = True
                                                        if val_modify_user['modifyUserBlock']:
                                                            logging.info(f" "
                                                                         f"{val_modify_user['UserModifyLogin']}"
                                                                         f' ')
                                                        else:
                                                            logging.info(f" "
                                                                         f"{val_modify_user['UserModifyLogin']}"
                                                                         f' ')
                                                    else:
                                                        my_popup('  / ')
                                                        if val_modify_user['modifyUserBlock']:
                                                            logging.error(
                                                                f'    - '
                                                                f'{res_block.status_code}')
                                                        else:
                                                            logging.error(
                                                                f'    - '
                                                                f'{res_block.status_code}')
                                            if (get_user_type(user_to_change) != -1) and (get_user_type(user_to_change) != modify_user_type):
                                                modify_u_t = True
                                                modify_user_type_dict = {'userType': modify_user_type,
                                                                         'userId': user_to_change['id']}
                                                try:
                                                    # noinspection PyUnboundLocalVariable
                                                    res_modify_user_type = requests.post(BASE_URL + 'changeUserType',
                                                                                         json=modify_user_type_dict,
                                                                                         headers=HEADER_dict)
                                                    if res_modify_user_type.status_code == 200:
                                                        current_db += 1
                                                        modify_success = True
                                                        logging.info(
                                                            f" {val_modify_user['UserModifyLogin']} "
                                                            f'   {list(user_type.keys())[list(user_type.values()).index(modify_user_type)]}')
                                                    else:
                                                        my_popup('    ')
                                                        logging.error(f'   '
                                                                      f' - '
                                                                      f'{res_modify_user_type.status_code}')
                                                except Exception as e:
                                                    print(f'     - {e}')
                                                    logging.error("    ")
                                            if modify_name or modify_password or modify_priority or modify_org:
                                                try:
                                                    res_modify_user = requests.post(BASE_URL + 'updateUser',
                                                                                    json=modify_user_dict,
                                                                                    headers=HEADER_dict)
                                                    if res_modify_user.status_code == 200:
                                                        current_db += 1
                                                        modify_success = True
                                                        if modify_name:
                                                            logging.info(
                                                                f" {val_modify_user['UserModifyLogin']}  ")
                                                        if modify_password:
                                                            logging.info(
                                                                f" {val_modify_user['UserModifyLogin']} "
                                                                f' ')
                                                        if modify_priority:
                                                            logging.info(
                                                                f" {val_modify_user['UserModifyLogin']} "
                                                                f' ')
                                                        if modify_org:
                                                            logging.info(
                                                                f" {val_modify_user['UserModifyLogin']} "
                                                                f' ')
                                                    else:
                                                        logging.error(f'   - '
                                                                      f'{res_modify_user.status_code}')
                                                        window_modify_user.close()
                                                        my_popup(f': {res_modify_user.text}')
                                                    if val_modify_user['UserModifyLogin'] == 'admin':
                                                        new_hash_pwd = hashlib.pbkdf2_hmac('sha256', bytes(
                                                            str(val_modify_user["userModifyPassword"]).encode('ASCII',
                                                                                                              'ignore')),
                                                                                           bytes(str(SALT).encode(
                                                                                               'ASCII')),
                                                                                           10000).hex()
                                                        print(f'{new_hash_pwd}')
                                                        try:
                                                            if ip != '127.0.0.1':
                                                                ssh, remotepath = get_ssh_connection()
                                                                change_password_command = 'echo ' + new_hash_pwd + ' > $HOME/Omega/.admPWD_b'
                                                                stdin, stdout, stderr = ssh.exec_command(
                                                                    change_password_command)
                                                                stdout = stdout.readlines()
                                                                ssh.close()
                                                                output = ''
                                                                for line in stdout:
                                                                    output = output + line
                                                                print(output)
                                                            else:
                                                                with open("/home/omega/Omega/.admPWD_b",
                                                                          mode='w') as f_ch_pwd:
                                                                    f_ch_pwd.write(new_hash_pwd)
                                                                    print(" ")
                                                        except Exception as e:
                                                            print(f'    ssh - {e}')
                                                            logging.error(f'    ssh - {e}')
                                                except Exception as e:
                                                    print(f'     - {e}')
                                                    logging.error("    ")
                                            if (modify_name or modify_password
                                                    or modify_is_blocked
                                                    or modify_priority
                                                    or modify_u_t
                                                    or modify_fix_device
                                                    or modify_org
                                                    or modify_role):
                                                if modify_success:
                                                    update_users()
                                                    my_popup(" !")
                                                else:
                                                    my_popup("  !")
                                                window_modify_user.close()
                                            else:
                                                my_popup("  !")
                                    if not modify_fix_device and not modify_show_device and not modify_success:
                                        window_modify_user['modifyUserButton'].update(disabled=False)
                                        window_modify_user['modifyUserButton'].update(button_color=button_color_2)
                            additional_window = False
                        if event == ' ':
                            """ group_from_db  """
                            additional_window = True
                            modify_group_success = False
                            if not values['-groups2-']:
                                my_popup('  ')
                            else:
                                groups_from_db = get_groups_from_db()
                                if filter_status_group:
                                    group_to_change = filtered_groups_list_of_dict[values['-groups2-'][0]]
                                else:
                                    group_to_change = groups_from_db[values['-groups2-'][0]]
                                window_modify_group = make_modify_group_window(group_to_change)
                                window_modify_group.Element('GroupModifyName').SetFocus()
                                while True:
                                    ev_modify_group, val_modify_group = window_modify_group.Read()
                                    if ev_modify_group == sg.WIN_CLOSED or ev_modify_group == 'Exit':
                                        break
                                    elif ev_modify_group == 'modifyGroupDelChat':
                                        window_confirm = make_confirm_window(' ,    ?')
                                        while True:
                                            ev_confirm, val_confirm = window_confirm.Read()
                                            if ev_confirm == 'okExit':
                                                modify_group_del_chat_dict = {'GroupId': group_to_change['id']}
                                                try:
                                                    res_modify_group_del_chat = requests.post(
                                                        BASE_URL + 'clearGroupMessages',
                                                        json=modify_group_del_chat_dict,
                                                        headers=HEADER_dict)
                                                    if res_modify_group_del_chat.status_code == 200:
                                                        current_db += 1
                                                        modify_group_success = True
                                                        logging.info(f" {group_to_change['name']} ")
                                                        my_popup("  ")
                                                        window_confirm.close()
                                                    else:
                                                        logging.error(f'   - '
                                                                      f'{res_modify_group_del_chat.status_code}')
                                                        my_popup("   !")
                                                except Exception as e:
                                                    print(f'    - {e}')
                                                    logging.error("   ")
                                                window_confirm.close()
                                            if ev_confirm == sg.WIN_CLOSED or ev_confirm == 'Exit':
                                                break
                                            if ev_confirm == 'noExit':
                                                window_confirm.close()
                                                break
                                    elif ev_modify_group == 'modifyGroupButton':
                                        if validate('modify_group'):
                                            modify_group_name = val_modify_group['GroupModifyName']
                                            modify_group_desc = val_modify_group['GroupModifyDesc']
                                            modify_group_emergency = int(val_modify_group['GroupModifyEmergency'])
                                            modify_group_blocked = int(val_modify_group['GroupModifyBlocked'])
                                            modify_group_organization_id = get_id_by_org(val_modify_group['GroupEditOrg'])
                                            modify_group_dict = {}
                                            modify_group = False
                                            modify_group_is_blocked = False
                                            modify_group_dict['id'] = group_to_change['id']
                                            if modify_group_name != group_to_change['name']:
                                                modify_group_dict['name'] = modify_group_name
                                                modify_group = True
                                            if modify_group_desc != group_to_change['desc']:
                                                modify_group_dict['description'] = modify_group_desc
                                                modify_group = True
                                            if modify_group_emergency != group_to_change['is_emergency']:
                                                modify_group_dict['groupType'] = modify_group_emergency
                                                modify_group = True
                                            else:
                                                modify_group_dict['groupType'] = group_to_change['is_emergency']
                                            if get_id_by_org(val_modify_group['GroupEditOrg']) != group_to_change['organization_id']:
                                                modify_group_dict['OrganizationId'] = get_id_by_org(val_modify_group['GroupEditOrg'])
                                                modify_group = True
                                            if modify_group:
                                                try:
                                                    res_modify_group = requests.post(BASE_URL + 'updateGroup',
                                                                                     json=modify_group_dict,
                                                                                     headers=HEADER_dict)
                                                    if res_modify_group.status_code == 200:
                                                        current_db += 1
                                                        modify_group_success = True
                                                        logging.info(f' {modify_group_name} ')
                                                    else:
                                                        my_popup('   ')
                                                        logging.error(f'   - '
                                                                      f'{res_modify_group.status_code}')
                                                except Exception as e:
                                                    print(f'     - {e}')
                                                    logging.error("    ")
                                            if modify_group_blocked != group_to_change['is_disabled']:
                                                modify_group_is_blocked = True
                                                if modify_group_blocked:
                                                    try:
                                                        res_modify_group_is_disabled = requests.post(
                                                            BASE_URL + 'disableGroup',
                                                            json=modify_group_dict,
                                                            headers=HEADER_dict)
                                                        if res_modify_group_is_disabled.status_code == 200:
                                                            current_db += 1
                                                            modify_group_success = True
                                                            logging.info(f' {modify_group_name} ')
                                                        elif res_modify_group_is_disabled.status_code == 400:
                                                            my_popup('  ')
                                                            logging.info(
                                                                f' {modify_group_name}   ')
                                                        else:
                                                            my_popup(f': {res_modify_group_is_disabled.text}')
                                                            logging.info(
                                                                f' {modify_group_name}  , '
                                                                f' - {res_modify_group_is_disabled.status_code}')
                                                    except Exception as e:
                                                        print(f'    - {e}')
                                                        logging.error("   ")
                                                else:
                                                    try:
                                                        res_modify_group_is_disabled = requests.post(
                                                            BASE_URL + 'enableGroup',
                                                            json=modify_group_dict,
                                                            headers=HEADER_dict)
                                                        if res_modify_group_is_disabled.status_code == 200:
                                                            current_db += 1
                                                            modify_group_success = True
                                                            logging.info(f' {modify_group_name} ')
                                                        elif res_modify_group_is_disabled.status_code == 400:
                                                            my_popup('  ')
                                                            logging.info(
                                                                f' {modify_group_name}   ')
                                                        else:
                                                            my_popup(f': {res_modify_group_is_disabled.text}')
                                                            logging.info(
                                                                f' {modify_group_name}  , '
                                                                f' - {res_modify_group_is_disabled.status_code}')
                                                    except Exception as e:
                                                        print(f'    - {e}')
                                                        logging.error("  ")
                                            if modify_group or modify_group_is_blocked:
                                                window_modify_group.close()
                                                if modify_group_success:
                                                    update_groups()
                                                    my_popup(" !")
                                            else:
                                                my_popup(" ")
                                    else:
                                        window_modify_group['modifyGroupButton'].update(disabled=False)
                                        window_modify_group['modifyGroupButton'].update(button_color=button_color_2)
                            additional_window = False
                        if event == ' ':
                            additional_window = True
                            if not values['-groups2-']:
                                my_popup('  ')
                            else:
                                window_confirm = make_confirm_window(' ,    ?')
                                while True:
                                    ev_confirm, val_confirm = window_confirm.Read()
                                    if ev_confirm == 'okExit':
                                        group_to_change = groups_from_db[values['-groups2-'][0]]
                                        modify_group_del_chat_dict = {'GroupId': group_to_change['id']}
                                        try:
                                            res_modify_group_del_chat = requests.post(BASE_URL + 'clearGroupMessages',
                                                                                      json=modify_group_del_chat_dict,
                                                                                      headers=HEADER_dict)
                                            if res_modify_group_del_chat.status_code == 200:
                                                current_db += 1
                                                logging.info(f" {group_to_change['name']} ")
                                                my_popup("  ")
                                            else:
                                                logging.error(f'   - '
                                                              f'{res_modify_group_del_chat.status_code}')
                                                my_popup("   !")
                                        except Exception as e:
                                            print(f'    - {e}')
                                            logging.error("   ")
                                        window_confirm.close()
                                    if ev_confirm == sg.WIN_CLOSED or ev_confirm == 'Exit':
                                        break
                                    if ev_confirm == 'noExit':
                                        window_confirm.close()
                                        break
                            additional_window = False
                        if event == '-TREE-' and values['-TREE-'] != []:
                            is_org = check_org(values['-users-tree-'][0])
                            if not is_org:
                                group_id = values['-TREE-'][0]
                                if group_id in tree.metadata:
                                    tree.metadata.remove(group_id)
                                    tree.update(key=group_id, icon=check[0])
                                else:
                                    tree.metadata.append(group_id)
                                    tree.update(key=group_id, icon=check[1])
                                window['Apply'].update(disabled=False)
                                window['Apply'].SetFocus()
                        if event == '-TREE2-' and values['-TREE2-'] != []:
                            user_id = values['-TREE2-'][0]
                            if user_id in tree2.metadata:
                                tree2.metadata.remove(user_id)
                                tree2.update(key=user_id, icon=check[0])
                            else:
                                tree2.metadata.append(user_id)
                                tree2.update(key=user_id, icon=check[1])
                            window['Apply2'].update(disabled=False)
                            window['Apply2'].SetFocus()
                        if event == "Apply":
                            additional_window = True
                            if not values['-users-tree-']:
                                print(f"  ")
                                my_popup('  ')
                            else:
                                add_group = False
                                del_group = False
                                # if filter_status:
                                #     chosen_login = filtered_users_list_of_dict[values['-users-'][0]]
                                # else:
                                #     chosen_login = users_from_db[values['-users-'][0]]
                                if not is_org:
                                    current_groups = get_groups_for_user_from_db(selected_user_id)
                                    current_groups_ids = []
                                    for cur_gr in current_groups:
                                        current_groups_ids.append(cur_gr['id'])
                                    add_del_dict = {'UserIds': [selected_user_id], 'addGroupIds': [],
                                                    'removeGroupIds': []}
                                    for gr_id in tree.metadata:
                                        if gr_id in current_groups_ids:
                                            print(f"    {get_group_name_by_id_from_db(gr_id)}")
                                        else:
                                            print(f"     "
                                                  f"{get_group_name_by_id_from_db(gr_id)}")
                                            add_del_dict['addGroupIds'] += [gr_id]
                                            add_group = True
                                    for gr_id in current_groups_ids:
                                        if gr_id in tree.metadata:
                                            print(f'    {get_group_name_by_id_from_db(gr_id)}')
                                        else:
                                            print(f"     "
                                                  f"{get_group_name_by_id_from_db(gr_id)}")
                                            add_del_dict['removeGroupIds'] += [gr_id]
                                            del_group = True
                                    if add_group or del_group:
                                        print(add_del_dict)
                                        try:
                                            res_add_del = requests.post(BASE_URL + 'changeUserGroups', json=add_del_dict,
                                                                        headers=HEADER_dict)
                                            if res_add_del.status_code == 200:
                                                current_db += 1
                                                logging.info(f'      '
                                                             f'{get_user_name_by_id_from_db(selected_user_id)}')
                                                add_del_groups_to_user_after_apply(add_del_dict)
                                                add_del_text = '   ' + get_user_name_by_id_from_db(selected_user_id) + ' '
                                                my_popup(add_del_text)
                                                window['Apply'].update(disabled=True)
                                            else:
                                                logging.error(f'      '
                                                              f' {get_user_name_by_id_from_db(selected_user_id)} - {res_add_del.status_code}')
                                                my_popup("  ")
                                        except Exception as e:
                                            print(f"  ! {e}")
                                            logging.warning(f"  !")
                                    else:
                                        my_popup(' ')
                                        window["Apply"].update(disabled=True)
                            additional_window = False
                        if event == "Apply2":
                            additional_window = True
                            if not values['-groups2-']:
                                my_popup('  ')
                            else:
                                add_user = False
                                del_user = False
                                if filter_status_group:
                                    chosen_group = filtered_groups_list_of_dict[values['-groups2-'][0]]
                                else:
                                    chosen_group = groups_from_db[values['-groups2-'][0]]
                                current_users = get_users_for_group_from_db(chosen_group['id'])
                                current_users_ids = []
                                for cur_us in current_users:
                                    current_users_ids.append(cur_us['id'])
                                add_del_dict = {'GroupIds': [chosen_group['id']], 'addUserIds': [],
                                                'removeUserIds': []}
                                for us_id in tree2.metadata:
                                    if us_id in current_users_ids:
                                        print(f"  {chosen_group['name']}   "
                                              f"{get_user_name_by_id_from_db(us_id)}")
                                    else:
                                        print(f" {get_user_name_by_id_from_db(us_id)} "
                                              f"    {chosen_group['name']}")
                                        add_del_dict['addUserIds'] += [us_id]
                                        add_user = True
                                for us_id in current_users_ids:
                                    if us_id in tree2.metadata:
                                        print(f' {get_user_name_by_id_from_db(us_id)}    '
                                              f'{chosen_group["name"]}')
                                    else:
                                        print(f"  {chosen_group['name']}    "
                                              f"{get_user_name_by_id_from_db(us_id)}")
                                        add_del_dict['removeUserIds'] += [us_id]
                                        del_user = True
                                if add_user or del_user:
                                    try:
                                        res_add_del = requests.post(BASE_URL + 'changeGroupUsers', json=add_del_dict,
                                                                    headers=HEADER_dict)
                                        if res_add_del.status_code == 200:
                                            current_db += 1
                                            logging.info(
                                                f'    {chosen_group["name"]}')
                                            add_del_users_to_group_after_apply(add_del_dict)
                                            add_del_text = '   ' + \
                                                           chosen_group['name'] + ' '
                                            my_popup(add_del_text)
                                            window['Apply2'].update(disabled=True)
                                        else:
                                            logging.error(
                                                f'     {chosen_group["name"]} - '
                                                f'{res_add_del.status_code}')
                                            my_popup("  ")
                                    except Exception as e:
                                        print(f'     - {e}')
                                        logging.error("     ")
                                else:
                                    my_popup(' ')
                                    window["Apply2"].update(disabled=True)
                            additional_window = False
                        if event == ' ':
                            additional_window = True
                            my_popup(' ' + COMPANY + '\n'
                                                                '\n'
                                                                '2021-2024')
                            # noinspection PyRedeclaration
                            additional_window = False
                        if event == ' ...':
                            additional_window = True
                            new_lic_installed = False
                            f_new = False
                            lic_from_server = get_current_lic()
                            window_add_lic = make_add_lic()
                            if lic_from_server:
                                LICS = parse_cur_lic(lic_from_server)
                                window_add_lic['-lic-'].update(LICS)
                            while True:
                                ev_add_lic, val_add_lic = window_add_lic.Read()
                                print(f'{ev_add_lic}, {val_add_lic}')
                                if ev_add_lic == sg.WIN_CLOSED or ev_add_lic == '':
                                    window_add_lic.close()
                                    break
                                if ev_add_lic == '-FILENAME-':
                                    machine_id = get_id('Linux')  # TODO
                                    check_remote_command = "$HOME/Omega/Licensing/ValidateCli validate --license $HOME/Omega/new.lic" + \
                                                           ' --public $HOME/Omega/keys/pub.pem --machine-id ' + \
                                                           machine_id
                                    print(check_remote_command)
                                    output = ''
                                    if ip != '127.0.0.1':
                                        try:
                                            ssh, remotepath = get_ssh_connection()
                                            ftp_client = ssh.open_sftp()
                                            ftp_client.put(val_add_lic['-FILENAME-'], (remotepath + '/new.lic'))
                                            ftp_client.close()
                                            stdin, stdout, stderr = ssh.exec_command(check_remote_command)
                                            stdout = stdout.readlines()
                                            ssh.close()
                                            for line in stdout:
                                                output = output + line
                                            print(output)
                                        except Exception as e:
                                            print(f'{e}')
                                            logging.error('   !')
                                            my_popup("   !")
                                    else:
                                        if check_os() != 'Windows':
                                            start_command = "$HOME/Omega/Licensing/ValidateCli validate --license " + \
                                                            val_add_lic['-FILENAME-'] + \
                                                            ' --public $HOME/Omega/keys/pub.pem'
                                            print(start_command)
                                            process = subprocess.Popen(start_command, shell=True,
                                                                       stdout=subprocess.PIPE,
                                                                       stderr=subprocess.PIPE)
                                            try:
                                                output = process.stdout.read().decode('utf-8').rstrip('\n')
                                            except Exception as e:
                                                my_popup('  !')
                                                print(f'{e}')
                                            print(type(output))
                                            print(output)
                                    if output:
                                        if output.find('USAGE') == -1 and output.rstrip('\n') != 'Validation Failed':
                                            index = output.find('{')
                                            lics: dict = json.loads(output[index:])
                                            LICS = [[' ', lics['UserCount'], lics['ExpirationDate']],
                                                    [' ', lics['DispatcherCount'], lics[
                                                        'ExpirationDate']]]
                                            print(lics['ExpirationDate'])
                                            for feature in lics['Features']:
                                                feature_name = " " if feature == "AmbientListening" \
                                                    else "" if feature == "GeoData" \
                                                    else " " if feature == "DGNA" \
                                                    else "  " if feature == "OTAP" \
                                                    else " " if feature == "LongAmbientListening" \
                                                    else " " if feature == "MFC" \
                                                    else " " if feature == "DeviceAuthorization" else "?"
                                                print(feature_name, '+', lics['ExpirationDate'])
                                                LICS.append([feature_name, '+', lics['ExpirationDate']])
                                            window_add_lic['-lic-'].update(LICS)
                                            window_add_lic[''].update(disabled=False,
                                                                               button_color=button_color_2)
                                        else:
                                            my_popup("  ")
                                            logging.error(f"  ")
                                    else:
                                        my_popup("  ")
                                        logging.error(f"  ")
                                if ev_add_lic == ' id ':
                                    id_serv = get_id(check_os())
                                    if id_serv:
                                        window_get_id = make_get_id(id_serv)
                                        while True:
                                            ev_get_id, val_get_id = window_get_id.Read()
                                            print(f'{ev_get_id}, {val_get_id}')
                                            if ev_get_id == sg.WIN_CLOSED or ev_get_id == 'OK':
                                                window_get_id.close()
                                                break
                                            if ev_get_id == '--':
                                                sg.clipboard_set(val_get_id['-id-'])
                                if ev_add_lic == 'show_cur_lic':
                                    if f_new:
                                        window_add_lic['-lic-'].update(LICS)
                                        window_add_lic['show_cur_lic'].update(' ')
                                        f_new = False
                                    else:
                                        lic_from_server = get_current_lic()
                                        if lic_from_server:
                                            cur_lics = parse_cur_lic(lic_from_server)
                                            window_add_lic['-lic-'].update(cur_lics)
                                        window_add_lic[''].update(disabled=True)
                                        if new_lic_installed:
                                            window_add_lic['show_cur_lic'].update(' ')
                                            f_new = True
                                if ev_add_lic == '':
                                    machine_id = get_id('Linux')  # TODO
                                    start_command = "$HOME/Omega/Licensing/ValidateCli validate --license $HOME/Omega/generated.lic" + \
                                                    ' --public $HOME/Omega/keys/pub.pem --machine-id ' + \
                                                    machine_id
                                    if ip != '127.0.0.1':
                                        output = ''
                                        try:
                                            ssh, remotepath = get_ssh_connection()
                                            ftp_client = ssh.open_sftp()
                                            ftp_client.put(val_add_lic['-FILENAME-'], (remotepath + '/generated.lic'))
                                            ftp_client.close()
                                            stdin, stdout, stderr = ssh.exec_command(start_command)
                                            stdout = stdout.readlines()
                                            for line in stdout:
                                                output = output + line
                                            print(output)
                                        except Exception as e:
                                            print(f'{e}')
                                            logging.error('   !')
                                            my_popup("   !")
                                    else:
                                        output = False
                                        if check_os() != 'Windows':
                                            start_command = "$HOME/Omega/Licensing/ValidateCli validate --license " + \
                                                            val_add_lic['-FILENAME-'] + \
                                                            ' --public $HOME/Omega/keys/pub.pem'
                                            process = subprocess.Popen(start_command, shell=True,
                                                                       stdout=subprocess.PIPE,
                                                                       stderr=subprocess.PIPE)
                                            try:
                                                output = process.stdout.read().decode('utf-8').rstrip('\n')
                                            except Exception as e:
                                                my_popup('  !')
                                                print(f'{e}')
                                            copy_command = 'cp ' + val_add_lic[
                                                '-FILENAME-'] + " $HOME/Omega/generated.lic"
                                            print(copy_command)
                                            process = subprocess.Popen(copy_command, shell=True,
                                                                       stdout=subprocess.PIPE,
                                                                       stderr=subprocess.PIPE)
                                            try:
                                                output_copy = process.stdout.read().decode('utf-8').rstrip('\n')
                                                print(f'   - {output_copy}')
                                            except Exception as e:
                                                my_popup('   !')
                                                print(f'{e}')
                                    if output.find('USAGE') == -1 and output.rstrip('\n') != 'Validation Failed':
                                        index = output.find('{')
                                        lics: dict = json.loads(output[index:])
                                        LICS = [[' ', lics['UserCount'], lics['ExpirationDate']],
                                                [' ', lics['DispatcherCount'], lics[
                                                    'ExpirationDate']]]
                                        print(lics['ExpirationDate'])
                                        for feature in lics['Features']:
                                            feature_name = " " if feature == "AmbientListening" \
                                                else "" if feature == "GeoData" \
                                                else " " if feature == "DGNA" \
                                                else "  " if feature == "OTAP" \
                                                else " " if feature == "LongAmbientListening" \
                                                else " " if feature == "MFC" \
                                                else " " if feature == "DeviceAuthorization" else "?"
                                            print(feature_name, '+', lics['ExpirationDate'])
                                            LICS.append([feature_name, '+', lics['ExpirationDate']])
                                        window_add_lic['-lic-'].update(LICS)
                                        if ip != '127.0.0.1':
                                            change_state_command = 'echo -n 5 > /home/omega/Omega/.licenseState'
                                            # noinspection PyUnboundLocalVariable
                                            stdin, stdout, stderr = ssh.exec_command(change_state_command)
                                            stdout = stdout.readlines()
                                            ssh.close()
                                            output = ''
                                            for line in stdout:
                                                output = output + line
                                            print(output)
                                        else:
                                            with open("/home/omega/Omega/.licenseState", mode='w') as f_lic_st:
                                                f_lic_st.write("5")
                                                print(" ")
                                        logging.warning(f"  !   !")
                                        my_popup("  !   !")
                                        window_add_lic['restart'].update(disabled=False, button_color=button_color_2)
                                        new_lic_installed = True
                                        window_add_lic['show_cur_lic'].update(disabled=False)
                                        window_add_lic[''].update(disabled=True, button_color=button_color)
                                    else:
                                        my_popup("   ")
                                        logging.error(f"   ")
                                        ssh.close()
                                if ev_add_lic == 'restart':
                                    print(' ')
                                    try:
                                        window_add_lic.close()
                                        set_buttons_disabled()
                                        window.Element('-Start-').SetFocus()
                                        window['-groups2-'].update([[]])
                                        clear_treedata = sg.TreeData()
                                        window['-users-tree-'].update(clear_treedata)
                                        window['-TREE-'].update(clear_treedata)
                                        window['-TREE2-'].update(clear_treedata)
                                        window.refresh()
                                        ssh, remotepath = get_ssh_connection()
                                        start_command = 'sudo systemctl restart omega'
                                        if ip != '127.0.0.1':
                                            stdin, stdout, stderr = ssh.exec_command(start_command)
                                            stdout = stdout.readlines()
                                            ssh.close()
                                            output = ''
                                            for line in stdout:
                                                output = output + line
                                            print(output)
                                        else:
                                            process = subprocess.Popen(start_command, shell=True,
                                                                       stdout=subprocess.PIPE,
                                                                       stderr=subprocess.PIPE)
                                        for i in range(3):
                                            sleep(2)
                                            res_ping = ''
                                            try:
                                                res_ping = requests.get(BASE_URL_PING, timeout=1)
                                            except Exception as e:
                                                print(f"  , {e}")
                                            if res_ping == '':
                                                print('  ')
                                                if i == 2:
                                                    logging.critical(f'   - {res_ping}')
                                                    my_popup("  ")
                                            else:
                                                if res_ping.status_code == 200:
                                                    logging.info(f'  ')
                                                    print(f'{res_ping.text}')
                                                    dict_online_after_start = json.loads(res_ping.text)
                                                    update_text = ((': ...' + ', : '
                                                                    + str(dict_online_after_start["databaseVersion"]))
                                                                   + (', ' if
                                                                      dict_online_after_start["isReserved"] else
                                                                      ', '))
                                                    update_text2 = update_free_space(dict_online_after_start)
                                                    server_status['online'] = dict_online_after_start[
                                                        "onlineUsersCount"]
                                                    server_status['db'] = dict_online_after_start["databaseVersion"]
                                                    window['-StatusBar-'].update(update_text,
                                                                                 background_color=(button_color_2 if
                                                                                                   dict_online_after_start[
                                                                                                       "isReserved"] else status_bar_color))
                                                    window['-StatusBar2-'].update(update_text2)
                                                    window['-Start-'].update(disabled=True)
                                                    window['-Stop-'].update(disabled=False)
                                                    TOKEN = get_token(BASE_URL_AUTH)
                                                    HEADER_dict = {"Authorization": "Bearer " + TOKEN}
                                                    if TOKEN:
                                                        server_status['run'] = True
                                                        print(server_status)
                                                        update_users_and_groups()
                                                        window['-Menu-'].update([
                                                            ['',
                                                             [' ...', '', '',
                                                              '',
                                                              '',
                                                              ' ',
                                                              ['', '']]],
                                                            ['', ' '], ])
                                                        update_text = (': ' + str(server_status["online"])
                                                                       + ', : ' + str(server_status["db"])
                                                                       + (', ' if server_status["isReserved"]
                                                                          else ', '))
                                                        update_text2 = update_free_space(server_status)
                                                        window['-StatusBar-'].update(update_text,
                                                                                     background_color=(button_color_2 if
                                                                                                       server_status[
                                                                                                           "isReserved"] else status_bar_color))
                                                        window['-StatusBar2-'].update(update_text2)
                                                        set_buttons_disabled(False)
                                                        server_status['run'] = True
                                                        update_free_space(dict_online_after_start)
                                                        window['online-users'].update(
                                                            get_online_users(dict_online_after_start['onlineUserIds']))
                                                        set_lic_status_bar()
                                                        my_popup(' ')
                                                        break
                                                    else:
                                                        break_flag2 = True
                                                        break_flag = True
                                                        break
                                    except Exception as e:
                                        print(f'{e}')
                                        logging.error('   ')
                                        my_popup('   ')
                                if ev_add_lic == '-KEYNAME-':
                                    window_add_lic['install-key'].update(disabled=False)
                                if ev_add_lic == 'install-key':
                                    window_install_key = make_confirm_window(
                                        ' ,      ?')
                                    while True:
                                        ev_install_key, val_install_key = window_install_key.Read()
                                        if ev_install_key == sg.WIN_CLOSED or ev_install_key == 'Exit':
                                            break
                                        if ev_install_key == 'noExit':
                                            window_install_key.close()
                                            break
                                        if ev_install_key == 'okExit':
                                            try:
                                                ssh, remotepath = get_ssh_connection()
                                                backup_command = 'cp $HOME/Omega/keys/pub.pem $HOME/Omega/keys/pub.pem.bak'
                                                if ip != '127.0.0.1':
                                                    stdin, stdout, stderr = ssh.exec_command(backup_command)
                                                    stdout = stdout.readlines()
                                                    output = ''
                                                    for line in stdout:
                                                        output = output + line
                                                    print(output)
                                                    ftp_client = ssh.open_sftp()
                                                    ftp_client.put(val_add_lic['-KEYNAME-'],
                                                                   '/home/omega/Omega/keys/pub.pem')
                                                    ftp_client.close()
                                                    change_state_command = 'echo -n 5 > /home/omega/Omega/.licenseState'
                                                    stdin, stdout, stderr = ssh.exec_command(change_state_command)
                                                    stdout = stdout.readlines()
                                                    ssh.close()
                                                    output = ''
                                                    for line in stdout:
                                                        output = output + line
                                                    print(output)
                                                else:
                                                    if check_os() != 'Windows':
                                                        process = subprocess.Popen(backup_command, shell=True,
                                                                                   stdout=subprocess.PIPE,
                                                                                   stderr=subprocess.PIPE)
                                                        try:
                                                            output = process.stdout.read().decode('utf-8').rstrip('\n')
                                                        except Exception as e:
                                                            print(f'{e}')
                                                        copy_command = 'cp ' + val_add_lic[
                                                            '-KEYNAME-'] + " $HOME/Omega/keys/pub.pem"
                                                        print(copy_command)
                                                        process = subprocess.Popen(copy_command, shell=True,
                                                                                   stdout=subprocess.PIPE,
                                                                                   stderr=subprocess.PIPE)
                                                        try:
                                                            output_copy = process.stdout.read().decode('utf-8').rstrip(
                                                                '\n')
                                                            print(f'   - {output_copy}')
                                                        except Exception as e:
                                                            my_popup('   !')
                                                            print(f'{e}')
                                                    with open("/home/omega/Omega/.licenseState", mode='w') as f_lic_st:
                                                        f_lic_st.write("5")
                                                        print(" ")  # TODO
                                                my_popup('  !\n'
                                                         '    ')
                                                window_install_key.close()
                                                break
                                            except Exception as e:
                                                print(f'{e}')
                                if ev_add_lic == 'restore-key':
                                    window_restore_key = make_confirm_window(
                                        ' ,     '
                                        '  ?')
                                    while True:
                                        ev_restore_key, val_restore_key = window_restore_key.Read()
                                        if ev_restore_key == sg.WIN_CLOSED or ev_restore_key == 'Exit':
                                            break
                                        if ev_restore_key == 'noExit':
                                            window_restore_key.close()
                                            break
                                        if ev_restore_key == 'okExit':
                                            try:
                                                restore_command = 'cp $HOME/Omega/keys/.pub.default $HOME/Omega/keys/pub.pem'
                                                if ip != '127.0.0.1':
                                                    ssh, remotepath = get_ssh_connection()
                                                    stdin, stdout, stderr = ssh.exec_command(restore_command)
                                                    stdout = stdout.readlines()
                                                    output = ''
                                                    for line in stdout:
                                                        output = output + line
                                                    print(output)
                                                    change_state_command = 'echo -n 5 > /home/omega/Omega/.licenseState'
                                                    stdin, stdout, stderr = ssh.exec_command(change_state_command)
                                                    stdout = stdout.readlines()
                                                    ssh.close()
                                                    output = ''
                                                    for line in stdout:
                                                        output = output + line
                                                    print(output)
                                                    ssh.close()
                                                else:
                                                    if check_os() != 'Windows':
                                                        process = subprocess.Popen(restore_command, shell=True,
                                                                                   stdout=subprocess.PIPE,
                                                                                   stderr=subprocess.PIPE)
                                                        try:
                                                            output_copy = process.stdout.read().decode('utf-8').rstrip(
                                                                '\n')
                                                            print(
                                                                f'     - {output_copy}')
                                                        except Exception as e:
                                                            my_popup('   !')
                                                            print(f'{e}')
                                                    with open("/home/omega/Omega/.licenseState", mode='w') as f_lic_st:
                                                        f_lic_st.write("5")
                                                        print(" ")  # TODO
                                                my_popup(' !\n '
                                                         '    ')
                                                window_restore_key.close()
                                                break
                                            except Exception as e:
                                                print(f'{e}')
                            additional_window = False
                        if event == '':
                            additional_window = True
                            window_settings = make_settings()
                            # timeout = 0
                            change_settings_by_post = False
                            while True:
                                counter = 0
                                window_settings['-Progress-Bar-'].update_bar(counter)
                                ev_set, val_set = window_settings.Read()
                                print(f'{ev_set}, {val_set}')
                                if ev_set == sg.WIN_CLOSED or ev_set == '-Exit-set-':
                                    window_settings.close()
                                    break
                                elif ev_set == '---' \
                                        or ev_set == '---' \
                                        or ev_set == '---' \
                                        or ev_set == '----' \
                                        or ev_set == '---' \
                                        or ev_set == '---':
                                    if val_set[ev_set].isdigit():
                                        window_settings[ev_set].update(
                                            background_color=omega_theme['INPUT'])
                                        if 0 < int(val_set[ev_set]) <= MAX_CALL_TM:
                                            window_settings[ev_set].update(
                                                background_color=omega_theme['INPUT'],
                                                text_color=omega_theme['TEXT'])
                                        else:
                                            window_settings[ev_set].update(background_color=button_color_2)
                                    else:
                                        window_settings[ev_set].update(background_color=button_color_2)
                                    counter = 0
                                    window_settings['-Progress-Bar-'].update_bar(counter)
                                    window_settings['-OK-set-'].update(disabled=False)
                                    window_settings['-OK-set-'].update(button_color=button_color_2)
                                    change_settings_by_post = True
                                elif ev_set == '----' \
                                        or ev_set == '----':
                                    if val_set[ev_set].isdigit():
                                        window_settings[ev_set].update(
                                            background_color=omega_theme['INPUT'])
                                        if 1024 < int(val_set[ev_set]) <= 65535:
                                            window_settings[ev_set].update(
                                                background_color=omega_theme['INPUT'],
                                                text_color=omega_theme['TEXT'])
                                        else:
                                            window_settings[ev_set].update(background_color=button_color_2)
                                    else:
                                        window_settings[ev_set].update(background_color=button_color_2)
                                    counter = 0
                                    window_settings['-Progress-Bar-'].update_bar(counter)
                                    window_settings['-OK-set-'].update(disabled=False)
                                    window_settings['-OK-set-'].update(button_color=button_color_2)
                                    change_settings_by_post = True
                                elif ev_set == '---':
                                    if val_set[ev_set].isdigit():
                                        window_settings[ev_set].update(
                                            background_color=omega_theme['INPUT'])
                                        if 0 < int(val_set[ev_set]) <= MAX_DEPTH_LOG:
                                            window_settings[ev_set].update(
                                                background_color=omega_theme['INPUT'],
                                                text_color=omega_theme['TEXT'])
                                        else:
                                            window_settings[ev_set].update(background_color=button_color_2)
                                    else:
                                        window_settings[ev_set].update(background_color=button_color_2)
                                    counter = 0
                                    window_settings['-Progress-Bar-'].update_bar(counter)
                                    window_settings['-OK-set-'].update(disabled=False)
                                    window_settings['-OK-set-'].update(button_color=button_color_2)
                                elif ev_set == '--ssh-':
                                    if val_set[ev_set].isdigit():
                                        window_settings[ev_set].update(
                                            background_color=omega_theme['INPUT'])
                                        if 0 < int(val_set[ev_set]) <= MAX_AUDIO_PORT:
                                            window_settings[ev_set].update(
                                                background_color=omega_theme['INPUT'],
                                                text_color=omega_theme['TEXT'])
                                        else:
                                            window_settings[ev_set].update(background_color=button_color_2)
                                    else:
                                        window_settings[ev_set].update(background_color=button_color_2)
                                    counter = 0
                                    window_settings['-Progress-Bar-'].update_bar(counter)
                                    window_settings['-OK-set-'].update(disabled=False)
                                    window_settings['-OK-set-'].update(button_color=button_color_2)
                                elif ev_set == '--ssh-':
                                    window_settings[ev_set].update(
                                        background_color=omega_theme['INPUT'])
                                    counter = 0
                                    window_settings['-Progress-Bar-'].update_bar(counter)
                                    window_settings['-OK-set-'].update(disabled=False)
                                    window_settings['-OK-set-'].update(button_color=button_color_2)
                                elif ev_set == '--ssh-':
                                    window_settings[ev_set].update(
                                        background_color=omega_theme['INPUT'])
                                    counter = 0
                                    window_settings['-Progress-Bar-'].update_bar(counter)
                                    window_settings['-OK-set-'].update(disabled=False)
                                    window_settings['-OK-set-'].update(button_color=button_color_2)
                                elif ev_set == '-auto-del-':
                                    if val_set[ev_set].isdigit():
                                        window_settings[ev_set].update(
                                            background_color=omega_theme['INPUT'])
                                        if MIN_DEL_DAYS <= int(val_set[ev_set]) <= MAX_DEL_DAYS:
                                            window_settings[ev_set].update(
                                                background_color=omega_theme['INPUT'],
                                                text_color=omega_theme['TEXT'])
                                        else:
                                            window_settings[ev_set].update(background_color=button_color_2)
                                    else:
                                        window_settings[ev_set].update(background_color=button_color_2)
                                    counter = 0
                                    window_settings['-Progress-Bar-'].update_bar(counter)
                                    window_settings['-OK-set-'].update(disabled=False)
                                    window_settings['-OK-set-'].update(button_color=button_color_2)
                                elif ev_set == 'ambientListening' \
                                        or ev_set == 'deviceAuthorization' \
                                        or ev_set == 'dgna' \
                                        or ev_set == 'geoData' \
                                        or ev_set == 'longAmbientListening' \
                                        or ev_set == 'otap' \
                                        or ev_set == 'longAmbientCallDuration' \
                                        or ev_set == 'mfc':
                                    if ev_set == 'longAmbientListening':
                                        window_settings['longAmbientCallDuration'].update(disabled=(False if val_set['longAmbientListening'] else True))
                                    if ev_set == 'longAmbientCallDuration':
                                        if val_set['longAmbientCallDuration'].isdigit():
                                            window_settings['longAmbientCallDuration'].update(
                                                background_color=omega_theme['INPUT'])
                                            if 0 < int(val_set['longAmbientCallDuration']) <= MAX_LA_TM:
                                                window_settings['longAmbientCallDuration'].update(
                                                    background_color=omega_theme['INPUT'],
                                                    text_color=omega_theme['TEXT'])
                                            else:
                                                window_settings['longAmbientCallDuration'].update(
                                                    background_color=button_color_2)
                                        else:
                                            window_settings['longAmbientCallDuration'].update(
                                                background_color=button_color_2)
                                    print(f'change_settings_by_post - {change_settings_by_post}')
                                    change_settings_by_post = True
                                    print(f'change_settings_by_post - {change_settings_by_post}')
                                    counter = 0
                                    window_settings['-Progress-Bar-'].update_bar(counter)
                                    window_settings['-OK-set-'].update(disabled=False)
                                    window_settings['-OK-set-'].update(button_color=button_color_2)
                                elif ev_set == '-OK-set-':
                                    if validate('settings'):
                                        print(f'change_settings_by_post - {change_settings_by_post}')
                                        if change_settings_by_post:
                                            settings_dict = {'privateCallTimeout': val_set['---'],
                                                             'groupCallTimeout': val_set['---'],
                                                             'finalizeCallTimeout': val_set['---'],
                                                             'tonalTimeout': val_set[
                                                                 '----'],
                                                             'ambientCallDuration': val_set['---'],
                                                             'autoCleanDays': val_set['-auto-del-'],
                                                             'udpPortsRange': val_set['----'] + '-' +
                                                                              val_set[
                                                                                  '----'],
                                                             'ambientListening': val_set['ambientListening'],
                                                             'deviceAuthorization': val_set['deviceAuthorization'],
                                                             'dgna': val_set['dgna'],
                                                             'geoData': val_set['geoData'],
                                                             'longAmbientListening': val_set['longAmbientListening'],
                                                             'mfc': val_set['mfc'],
                                                             'otap': val_set['otap'],
                                                             'longAmbientCallDuration': val_set[
                                                                 'longAmbientCallDuration'], }
                                            try:
                                                res_update_set = requests.post(BASE_URL_SETTINGS,
                                                                               json=settings_dict,
                                                                               headers=HEADER_dict)
                                                if res_update_set.status_code == 200:
                                                    current_db += 1
                                                    logging.info(
                                                        f" : "
                                                        f".  - {settings_dict['privateCallTimeout']}, "
                                                        f".  - {settings_dict['groupCallTimeout']}, "
                                                        f"   - {settings_dict['finalizeCallTimeout']}, "
                                                        f"  - {settings_dict['tonalTimeout']}, "
                                                        f" ,  - {settings_dict['ambientCallDuration']}, "
                                                        f"   - {settings_dict['autoCleanDays']}, "
                                                        f"  - {settings_dict['udpPortsRange']}, "
                                                        f"  - {settings_dict['ambientListening']}, "
                                                        f"  - {settings_dict['deviceAuthorization']}, "
                                                        f"  - {settings_dict['dgna']}, "
                                                        f" - {settings_dict['geoData']}, "
                                                        f"   - {settings_dict['longAmbientListening']}, "
                                                        f"  - {settings_dict['mfc']}, "
                                                        f"   - {settings_dict['otap']}, "
                                                        f"   - {settings_dict['longAmbientCallDuration']}, "
                                                    )
                                                else:
                                                    logging.error(
                                                        f'    - {res_update_set.status_code}')
                                                    my_popup("   ")
                                                    continue
                                            except Exception as e:
                                                print(f'    - {e}')
                                                logging.error("   ")
                                                my_popup("   ")
                                                continue
                                        ssh_change = False
                                        local_change = False
                                        if val_set['---'] != str(ping_timeout):
                                            ping_timeout = int(val_set['---'])
                                            local_change = True
                                        if val_set['---'] != str(LOG_DEPTH):
                                            LOG_DEPTH = int(val_set['---'])
                                            local_change = True
                                        if val_set['--ssh-'] != str(SSH_PORT) or \
                                                val_set['--ssh-'] != SSH_LOGIN or \
                                                val_set['--ssh-'] != SSH_PWD:
                                            SSH_PORT_OLD = copy.deepcopy(SSH_PORT)
                                            SSH_LOGIN_OLD = copy.deepcopy(SSH_LOGIN)
                                            SSH_PORT = int(val_set['--ssh-'])
                                            SSH_LOGIN = val_set['--ssh-']
                                            SSH_PWD = val_set['--ssh-']
                                            ssh_change = True
                                        if ssh_change:
                                            try:
                                                ssh, remotepath = get_ssh_connection(val_set['--ssh-'])
                                                window_settings['--ssh-'].update(SSH_LOGIN)
                                                window_settings['--ssh-'].update(SSH_PORT)
                                                change_config_file('ssh')
                                            except Exception as e:
                                                print(f'{e}')
                                                # noinspection PyUnboundLocalVariable
                                                val_set['--ssh-'] = SSH_LOGIN_OLD
                                                # noinspection PyUnboundLocalVariable
                                                val_set['--ssh-'] = SSH_PORT_OLD
                                                SSH_LOGIN = copy.deepcopy(SSH_LOGIN_OLD)
                                                SSH_PORT = copy.deepcopy(SSH_PORT_OLD)
                                                window_settings['--ssh-'].update(SSH_LOGIN_OLD)
                                                window_settings['--ssh-'].update(SSH_PORT_OLD)
                                                window_settings['--ssh-'].update('')
                                                if not local_change and not change_settings_by_post:
                                                    window_settings['-OK-set-'].update(disabled=True)
                                                    window_settings['-OK-set-'].update(button_color=button_color)
                                                    continue
                                        disable_input(window_settings)
                                        counter = 0
                                        while counter < 11:
                                            counter += 5
                                            sleep(0.5)
                                            window_settings['-Progress-Bar-'].update_bar(counter)
                                        enable_input(window_settings)
                                        window_settings['-OK-set-'].update(disabled=True)
                                        window_settings['-OK-set-'].update(button_color=button_color)
                                        my_popup(" ")
                                        continue
                            window_settings.close()
                            additional_window = False
                        if event == '':
                            additional_window = True
                            window_updates = make_updates_window()
                            # after_change = False
                            while True:
                                ev_upd, val_upd = window_updates.Read()
                                # print(ev_upd, val_upd)
                                if ev_upd == sg.WIN_CLOSED or ev_upd == 'Exit':
                                    break
                                if ev_upd == '-updates-':
                                    print(val_upd)
                                    update_id = get_update_id_from_table()
                                    if val_upd['-updates-']:
                                        window_updates['-EditUpdate-'].update(disabled=False)
                                        window_updates['-DelUpdate-'].update(disabled=False)
                                if ev_upd == '-DelUpdate-':
                                    del_update(update_id)
                                    updates_list = get_updates()
                                    window_updates['-updates-'].update(updates_list)
                                    window_updates['-EditUpdate-'].update(disabled=True)
                                    window_updates['-DelUpdate-'].update(disabled=True)
                                    # after_change = True
                                if ev_upd == '-AddUpdate-':
                                    window_add_update = make_add_update_window()
                                    while True:
                                        ev_add_upd, val_add_upd = window_add_update.Read()
                                        print(ev_add_upd, val_add_upd)
                                        if ev_add_upd == sg.WIN_CLOSED or ev_add_upd == 'Exit':
                                            break
                                        if ev_add_upd == '-choose-apk-':
                                            pass
                                        if ev_add_upd == '-FILENAME-UPDATE-':
                                            version_app, type_app_val = get_app_version_and_type_from_filename(val_add_upd['-FILENAME-UPDATE-'])
                                            print(version_app, type_app_val)
                                            window_add_update['-ver-'].update(version_app if version_app else '?', disabled=False)
                                            window_add_update['-notes-'].update(disabled=False)
                                            window_add_update['-changelog-'].update(disabled=False)
                                            window_add_update['-isForced-'].update(disabled=False)
                                            if type_app_val:
                                                window_add_update['-type-app-'].update(list(type_app.keys())[list(type_app.values()).index(type_app_val)], disabled=False)
                                            else:
                                                window_add_update['-type-app-'].update(list(type_app.keys())[list(type_app.values()).index(0)], disabled=False)
                                            window_add_update['-upload-apk-'].update(disabled=False, button_color=button_color_2)
                                        if ev_add_upd == '-upload-apk-':
                                            update_id_from_server = upload_app(val_add_upd['-FILENAME-UPDATE-'])
                                            if update_id_from_server:
                                                window_add_update['-ver-'].update('', disabled=True)
                                                window_add_update['-notes-'].update('', disabled=True)
                                                window_add_update['-changelog-'].update('', disabled=True)
                                                window_add_update['-isForced-'].update('', disabled=True)
                                                window_add_update['-FILENAME-UPDATE-'].update('', disabled=True)
                                                window_add_update['-type-app-'].update(list(type_app.keys())[list(type_app.values()).index(0)], disabled=True)
                                                updates_list = get_updates()
                                                window_updates['-updates-'].update(updates_list)
                                                window_updates['-EditUpdate-'].update(disabled=True)
                                                window_updates['-DelUpdate-'].update(disabled=True)
                                                # after_change = True
                                                window_add_update.close()
                                                break
                                            window_add_update['-upload-apk-'].update(disabled=True, button_color=button_color)
                                if ev_upd == '-EditUpdate-':
                                    window_add_update = make_add_update_window(window_updates['-updates-'].Values[val_upd['-updates-'][0]])
                                    while True:
                                        ev_edit_upd, val_edit_upd = window_add_update.Read()
                                        print(ev_edit_upd, val_edit_upd)
                                        if ev_edit_upd == sg.WIN_CLOSED or ev_edit_upd == 'Exit':
                                            break
                                        if ev_edit_upd == '-upload-apk-':
                                            print(f"updates - {window_updates['-updates-'].Values[val_upd['-updates-'][0]][0]}")
                                            update_id = edit_app(window_updates['-updates-'].Values[val_upd['-updates-'][0]][0])
                                            if update_id:
                                                window_add_update['-ver-'].update('', disabled=True)
                                                window_add_update['-notes-'].update('', disabled=True)
                                                window_add_update['-changelog-'].update('', disabled=True)
                                                window_add_update['-isForced-'].update('', disabled=True)
                                                window_add_update['-FILENAME-UPDATE-'].update('', disabled=True)
                                                window_add_update['-type-app-'].update(list(type_app.keys())[list(type_app.values()).index(0)], disabled=True)
                                                updates_list = get_updates()
                                                window_updates['-updates-'].update(updates_list)
                                                window_updates['-EditUpdate-'].update(disabled=True)
                                                window_updates['-DelUpdate-'].update(disabled=True)
                                                # after_change = True
                                                window_add_update.close()
                                                break
                                            window_add_update['-upload-apk-'].update(disabled=True, button_color=button_color)
                                        window_add_update['-upload-apk-'].update(disabled=False, button_color=button_color_2)
                            additional_window = False
                        if event == '':
                            additional_window = True
                            userBased = False
                            treedata_devs = get_all_devices_in_treedata()
                            window_devices = make_devices(treedata_devs)
                            while True:
                                ev_devs, val_devs = window_devices.Read()
                                print(ev_devs, val_devs)
                                if ev_devs == sg.WIN_CLOSED or ev_devs == 'Exit':
                                    break
                                if ev_devs == '-devices-':
                                    # print(1)
                                    print_chosen_device(val_devs)
                                if ev_devs == '-devices-tree-':
                                    if val_devs['-devices-tree-']:
                                        dev_id = val_devs['-devices-tree-'][0]
                                        print(dev_id)
                                        # delete_dev_fr
                                    # print_chosen_device(val_devs)
                                if ev_devs == '-ollapseExpandDev-':
                                    if window_devices['-ollapseExpandDev-'].metadata == 'collapse':
                                        window_devices['-ollapseExpandDev-'].update(image_data=ICON_EXPAND_32_BASE_64_BLUE)
                                        if not userBased:
                                            for key in treedata_devs.tree_dict:
                                                window_devices['-devices-tree-'].Widget.item(key_to_id(key, window_devices['-devices-tree-']), open=False)
                                        else:
                                            for key in devs_by_user.tree_dict:
                                                window_devices['-devices-tree-'].Widget.item(key_to_id(key, window_devices['-devices-tree-']), open=False)
                                        window_devices['-ollapseExpandDev-'].metadata ='expand'
                                        window_devices['-ollapseExpandDev-'].TooltipObject.text = ''
                                    else:
                                        window_devices['-ollapseExpandDev-'].update(
                                            image_data=ICON_COLLAPSE_32_BASE_64_BLUE)
                                        if not userBased:
                                            for key in treedata_devs.tree_dict:
                                                window_devices['-devices-tree-'].Widget.item(key_to_id(key, window_devices['-devices-tree-']), open=True)
                                        else:
                                            for key in devs_by_user.tree_dict:
                                                window_devices['-devices-tree-'].Widget.item(key_to_id(key, window_devices['-devices-tree-']), open=True)
                                        window_devices['-ollapseExpandDev-'].metadata='collapse'
                                        window_devices['-ollapseExpandDev-'].TooltipObject.text = ''
                                if ev_devs == '-ChangeDevUser-':
                                    if not userBased:
                                        devs_by_user = get_all_devices_in_treedata('user')
                                        window_devices['-devices-tree-'].update(devs_by_user)
                                        userBased = True
                                    else:
                                        users_by_devs = get_all_devices_in_treedata()
                                        window_devices['-devices-tree-'].update(users_by_devs)
                                        userBased = False
                                    window_devices['-ollapseExpandDev-'].update(
                                        image_data=ICON_COLLAPSE_32_BASE_64_BLUE)
                                    window_devices['-ollapseExpandDev-'].metadata = 'collapse'
                                    window_devices['-ollapseExpandDev-'].TooltipObject.text = ''
                            additional_window = False
                        if event == '':
                            additional_window = True
                            window_organizations = make_organizations(get_all_organizations())
                            while True:
                                ev_orgs, val_orgs = window_organizations.Read()
                                if ev_orgs == sg.WIN_CLOSED or ev_orgs == 'Exit':
                                    break
                                if ev_orgs == '-orgs-':
                                    if val_orgs['-orgs-']:
                                        window_organizations['-EditOrg-'].update(disabled=False)
                                        window_organizations['-DelOrg-'].update(disabled=False)
                                if ev_orgs == '-AddOrg-':
                                    window_add_org = make_add_org_window()
                                    while True:
                                        ev_add_org, val_add_org = window_add_org.Read()
                                        print(ev_add_org, val_add_org)
                                        if ev_add_org == sg.WIN_CLOSED or ev_add_org == 'Exit':
                                            break
                                        if ev_add_org == '-AddOrgConfirm-':
                                            add_org(val_add_org)
                                            window_add_org.close()
                                            window_organizations['-orgs-'].update(get_all_organizations())
                                            update_users()
                                            break
                                if ev_orgs == '-DelOrg-':
                                    org_id = delete_org(window_organizations['-orgs-'].Values[val_orgs['-orgs-'][0]][0])
                                    if org_id:
                                        window_organizations['-orgs-'].update(get_all_organizations())
                                        window_organizations['-EditOrg-'].update(disabled=True)
                                        window_organizations['-DelOrg-'].update(disabled=True)
                                        update_users()
                                if ev_orgs == '-EditOrg-':
                                    window_add_org = make_add_org_window(
                                        window_organizations['-orgs-'].Values[val_orgs['-orgs-'][0]])
                                    while True:
                                        ev_edit_org, val_edit_org = window_add_org.Read()
                                        print(ev_edit_org, val_edit_org)
                                        if ev_edit_org == sg.WIN_CLOSED or ev_edit_org == 'Exit':
                                            break
                                        if ev_edit_org == '-AddOrgConfirm-':
                                            org_id = update_org(window_organizations['-orgs-'].Values[val_orgs['-orgs-'][0]][0], val_edit_org['-OrgName-'])
                                            window_add_org.close()
                                            if org_id:
                                                window_organizations['-orgs-'].update(get_all_organizations())
                                                window_organizations['-EditOrg-'].update(disabled=True)
                                                window_organizations['-DelOrg-'].update(disabled=True)
                                                update_users()
                            additional_window = False
                        if event == '-AddUser-':
                            """
                               userType
                            """
                            additional_window = True
                            window_add_user = make_add_user_window()
                            window_add_user.Element('UserLogin').SetFocus()
                            password_clear = False
                            while True:
                                ev_add_user, val_add_user = window_add_user.Read()
                                # print(ev_add_user, val_add_user)
                                if ev_add_user == sg.WIN_CLOSED or ev_add_user == 'Exit':
                                    break
                                elif ev_add_user == 'UserPassword':
                                    window_add_user['showPassword'].update(disabled=False)
                                    window_add_user['showPassword'].update(image_data=ICON_SHOW_BASE_64)
                                elif ev_add_user == 'user':
                                    window_add_user['addUserRoleIndCallEn'].update(True, disabled=False)
                                    window_add_user['addUserRoleIndMesEn'].update(True, disabled=False)
                                    window_add_user['addUserRoleAllowDelChats'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowPartialDrop'].update(False, disabled=True)
                                    window_add_user['addUserRoleChanger'].update(False, disabled=True)
                                    window_add_user['addUserRoleScreenShooter'].update(False, disabled=False)
                                    window_add_user['addUserRoleAmbCaller'].update(False, disabled=True)
                                    window_add_user['addUserRoleAmbCallee'].update(False, disabled=False)
                                    window_add_user['addUserRoleMissingMsgRv'].update(False, disabled=False)
                                    window_add_user['addUserRoleAllowLLA'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowLLAclient'].update(False, disabled=False)
                                    window_add_user['addUserRoleMfc'].update(False, disabled=False)
                                    window_add_user['addUserFixDevice'].update(False, disabled=False)
                                    window_add_user['addUserRoleMultipleDevices'].update(False, disabled=False)
                                    window_add_user['UserPriority'].update('0')
                                elif ev_add_user == 'disp':
                                    window_add_user['addUserRoleIndCallEn'].update(True, disabled=False)
                                    window_add_user['addUserRoleIndMesEn'].update(True, disabled=False)
                                    window_add_user['addUserRoleAllowDelChats'].update(False, disabled=False)
                                    window_add_user['addUserRoleAllowPartialDrop'].update(False, disabled=False)
                                    window_add_user['addUserRoleChanger'].update(False, disabled=False)
                                    window_add_user['addUserRoleScreenShooter'].update(False, disabled=True)
                                    window_add_user['addUserRoleAmbCaller'].update(False, disabled=False)
                                    window_add_user['addUserRoleAmbCallee'].update(False, disabled=True)
                                    window_add_user['addUserRoleMissingMsgRv'].update(False, disabled=False)
                                    window_add_user['addUserRoleAllowLLA'].update(False, disabled=False)
                                    window_add_user['addUserRoleAllowLLAclient'].update(False, disabled=True)
                                    window_add_user['addUserRoleMfc'].update(False, disabled=False)
                                    window_add_user['addUserFixDevice'].update(False, disabled=True)
                                    window_add_user['addUserRoleMultipleDevices'].update(False, disabled=True)
                                    window_add_user['UserPriority'].update('10')
                                elif ev_add_user == 'gw':
                                    window_add_user['addUserRoleIndCallEn'].update(False, disabled=True)
                                    window_add_user['addUserRoleIndMesEn'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowDelChats'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowPartialDrop'].update(False, disabled=True)
                                    window_add_user['addUserRoleChanger'].update(False, disabled=True)
                                    window_add_user['addUserRoleScreenShooter'].update(False, disabled=True)
                                    window_add_user['addUserRoleAmbCaller'].update(False, disabled=True)
                                    window_add_user['addUserRoleAmbCallee'].update(False, disabled=True)
                                    window_add_user['addUserRoleMissingMsgRv'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowLLA'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowLLAclient'].update(False, disabled=True)
                                    window_add_user['addUserRoleMfc'].update(False, disabled=True)
                                    window_add_user['addUserFixDevice'].update(False, disabled=False)
                                    window_add_user['addUserRoleMultipleDevices'].update(False, disabled=False)
                                    window_add_user['UserPriority'].update('5')
                                elif ev_add_user == 'adm':
                                    window_add_user['addUserRoleIndCallEn'].update(False, disabled=True)
                                    window_add_user['addUserRoleIndMesEn'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowDelChats'].update(True, disabled=False)
                                    window_add_user['addUserRoleAllowPartialDrop'].update(True, disabled=False)
                                    window_add_user['addUserRoleChanger'].update(False, disabled=True)
                                    window_add_user['addUserRoleScreenShooter'].update(False, disabled=True)
                                    window_add_user['addUserRoleAmbCaller'].update(False, disabled=True)
                                    window_add_user['addUserRoleAmbCallee'].update(False, disabled=True)
                                    window_add_user['addUserRoleMissingMsgRv'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowLLA'].update(False, disabled=True)
                                    window_add_user['addUserRoleAllowLLAclient'].update(False, disabled=True)
                                    window_add_user['addUserRoleMfc'].update(False, disabled=True)
                                    window_add_user['addUserFixDevice'].update(False, disabled=True)
                                    window_add_user['addUserRoleMultipleDevices'].update(False, disabled=True)
                                    window_add_user['UserPriority'].update('15')
                                elif ev_add_user == 'UserPriority':
                                    if val_add_user['UserPriority'] == '':
                                        window_add_user['UserPriority'].update(background_color=omega_theme['INPUT'],
                                                                               text_color=omega_theme['TEXT'])
                                    elif len(val_add_user['UserPriority']) > 2:
                                        window_add_user['UserPriority'].update(val_add_user['UserPriority'][:2])
                                    elif val_add_user['UserPriority'].isdigit():
                                        window_add_user['UserPriority'].update(background_color=omega_theme['INPUT'])
                                        if 0 <= int(val_add_user['UserPriority'][:2]) <= 15:
                                            window_add_user['UserPriority'].update(
                                                background_color=omega_theme['INPUT'],
                                                text_color=omega_theme['TEXT'])
                                        else:
                                            window_add_user['UserPriority'].update(background_color=button_color_2)
                                    else:
                                        window_add_user['UserPriority'].update(background_color=button_color_2)
                                elif ev_add_user == 'addUserFixDevice':
                                    window_add_user['addUserRoleMultipleDevices'].update(False)
                                elif ev_add_user == 'addUserRoleMultipleDevices':
                                    window_add_user['addUserFixDevice'].update(False)
                                elif ev_add_user == 'showPassword':
                                    if password_clear:
                                        window_add_user['UserPassword'].update(password_char='*')
                                        window_add_user['showPassword'].update(image_data=ICON_SHOW_BASE_64)
                                        password_clear = False
                                    else:
                                        window_add_user['UserPassword'].update(password_char='')
                                        window_add_user['showPassword'].update(image_data=ICON_HIDE_BASE_64)
                                        password_clear = True
                                    window_add_user.Element('UserPassword').SetFocus()
                                elif ev_add_user == 'addUserButton':
                                    if validate('add_user'):
                                        new_user_type = get_user_type('add_user')
                                        add_user_dict = {'login': val_add_user['UserLogin'],
                                                         'displayName': val_add_user['UserName'],
                                                         'password': val_add_user['UserPassword'],
                                                         'userType': new_user_type,
                                                         'priority': val_add_user['UserPriority']
                                                         if val_add_user['UserPriority'] else 0,
                                                         'OrganizationId': get_id_by_org(val_add_user['UserAddOrg'])
                                                         }
                                        try:
                                            res_add_user = requests.post(BASE_URL + 'addUser',
                                                                         json=add_user_dict, headers=HEADER_dict)
                                            if res_add_user.status_code == 200:
                                                current_db += 1
                                                logging.info(f" {val_add_user['UserLogin']} ")
                                                if new_user_type == user_type['dispatcher']:
                                                    logging.info(f" {val_add_user['UserLogin']} "
                                                                 f' ')
                                                elif new_user_type == user_type['box']:
                                                    logging.info(f" {val_add_user['UserLogin']} "
                                                                 f'  500')
                                                elif new_user_type == user_type['admin']:
                                                    logging.info(f" {val_add_user['UserLogin']} "
                                                                 f' ')
                                                result = change_all_roles(res_add_user.text[1:-1], val_add_user)
                                                if result:
                                                    current_db += 1
                                                    logging.info(f" {val_add_user['UserLogin']} "
                                                                 f' ')
                                                else:
                                                    logging.error(
                                                        f"    "
                                                        f" {val_add_user['UserLogin']}")
                                                if val_add_user['addUserFixDevice']:
                                                    try:
                                                        res_add_fix_new_dev = requests.post(BASE_URL +
                                                                                               'allowNewDevice',
                                                                                               json={'UserId':
                                                                                                         res_add_user.text[1:-1]},
                                                                                               headers=HEADER_dict)
                                                        if res_add_fix_new_dev.status_code == 200:
                                                            # modify_success = True
                                                            current_db += 1
                                                            # my_popup('    ')
                                                            logging.info(
                                                                f" {val_add_user['UserLogin']} "
                                                                f'   ')
                                                        else:
                                                            my_popup(' ')
                                                            logging.error(
                                                                f"      "
                                                                f" {val_add_user['UserLogin']}")
                                                    except Exception as e:
                                                        print(f'    - {e}')
                                                        logging.error("   ")
                                                if val_add_user['addUserBlock']:
                                                    res_block = block_user(val_add_user['addUserBlock'],
                                                                           res_add_user.text[1:-1])
                                                    if res_block:
                                                        if res_block.status_code == 200:
                                                            current_db += 1
                                                            if val_add_user['addUserBlock']:
                                                                logging.info(f" "
                                                                             f"{val_add_user['UserLogin']}"
                                                                             f' ')
                                                            else:
                                                                logging.info(f" "
                                                                             f"{val_add_user['UserLogin']}"
                                                                             f' ')
                                                        else:
                                                            if val_add_user['addUserBlock']:
                                                                logging.error(
                                                                    f'    - '
                                                                    f'{res_block.status_code}')
                                                            else:
                                                                logging.error(
                                                                    f'    - '
                                                                    f'{res_block.status_code}')
                                                update_users()
                                                my_popup(" !")
                                                window_add_user.close()
                                            else:
                                                logging.error(f" {val_add_user['UserLogin']}   - "
                                                              f'{res_add_user.status_code}')
                                                my_popup("  ! : " + str(res_add_user.status_code) + ". " + res_add_user.text)
                                        except Exception as e:
                                            print(f'    - {e}')
                                            logging.error("   ")
                                else:
                                    window_add_user['addUserButton'].update(disabled=False)
                                    window_add_user['addUserButton'].update(button_color=button_color_2)
                            additional_window = False
                        if event == '-DelUser-':
                            additional_window = True
                            if not values['-users-tree-']:
                                print(f"  ")
                                my_popup('  ')
                            else:
                                # if filter_status:
                                #     del_user = filtered_users_list_of_dict[values['-users-'][0]]
                                # else:
                                #     del_user = users_from_db[values['-users-'][0]]
                                selected_user_id = str(values['-users-tree-'][0]).partition('.')[0]
                                selected_user = get_user_by_id_from_db(selected_user_id)
                                if selected_user['login'] == 'admin':
                                    my_popup("   admin")
                                else:
                                    window_del_user = make_confirm_window(' , '
                                                                          '    ' + selected_user[
                                                                              'name'] + '?')
                                    while True:
                                        ev_del_user, val_del_user = window_del_user.Read()
                                        if ev_del_user == sg.WIN_CLOSED or ev_del_user == 'Exit':
                                            break
                                        if ev_del_user == 'noExit':
                                            window_del_user.close()
                                            break
                                        if ev_del_user == 'okExit':
                                            try:
                                                res_del_user = requests.post(BASE_URL + 'deleteUser',
                                                                             json=selected_user, headers=HEADER_dict)
                                                if res_del_user.status_code == 200:
                                                    current_db += 1
                                                    logging.info(f' {selected_user["name"]} ')
                                                    drop_db('users')
                                                    update_users()
                                                    # if filter_status:
                                                    #     search_str = values['-filterUser-']
                                                    #     filtered_users = filter(
                                                    #         lambda x: search_str.lower() in x['login'].lower() or
                                                    #                   search_str.lower() in x['name'].lower(),
                                                    #         users_from_db)
                                                    #     filtered_users_list_of_dict = list(filtered_users)
                                                    #     filtered_users_list, treedata_update_user = get_user_list(
                                                    #         filtered_users_list_of_dict)
                                                    #     if not filtered_users_list:
                                                    #         window['-filterUser-'].update(
                                                    #             background_color=button_color_2)
                                                    #     window['-users-'].update(filtered_users_list)
                                                    # else:
                                                    #     window['-users-'].update(user_list)

                                                    # window['-TREE2-'].update(treedata_update_user)
                                                    my_popup(" !")
                                                    window_del_user.close()
                                                    break
                                                else:
                                                    logging.error(f' {del_user["name"]}  ')
                                                    my_popup("  !")
                                            except Exception as e:
                                                print(f'    - {e}')
                                                logging.error("   ")
                            additional_window = False
                        if event == '-CloneUser-':
                            additional_window = True
                            if not values['-users-tree-']:
                                print(f"  ")
                                my_popup('  ')
                            else:
                                # if filter_status:
                                #     user_clone = filtered_users_list_of_dict[values['-users-'][0]]
                                # else:
                                #     user_clone = users_from_db[values['-users-'][0]]
                                selected_user_id = str(values['-users-tree-'][0]).partition('.')[0]
                                selected_user = get_user_by_id_from_db(selected_user_id)
                                window_clone_user = make_clone_user_window(selected_user['name'])
                                window_clone_user.Element('CloneUserLogin').SetFocus()
                                password_clear = False
                                while True:
                                    ev_clone_user, val_clone_user = window_clone_user.Read()
                                    if ev_clone_user == sg.WIN_CLOSED or ev_clone_user == 'Exit':
                                        break
                                    if ev_clone_user == 'CloneUserPassword':
                                        window_clone_user['CloneUserShowPassword'].update(
                                            image_data=ICON_SHOW_BASE_64)
                                        window_clone_user['CloneUserShowPassword'].update(
                                            disabled=False)
                                    if ev_clone_user == 'CloneUserShowPassword':
                                        if password_clear:
                                            window_clone_user['CloneUserPassword'].update(password_char='*')
                                            window_clone_user['CloneUserShowPassword'].update(
                                                image_data=ICON_SHOW_BASE_64)
                                            password_clear = False
                                        else:
                                            window_clone_user['CloneUserPassword'].update(password_char='')
                                            window_clone_user['CloneUserShowPassword'].update(
                                                image_data=ICON_HIDE_BASE_64)
                                            password_clear = True
                                    if ev_clone_user == 'cloneUserButton':
                                        if validate('clone_user'):
                                            clone_user_login, \
                                                clone_user_name, \
                                                clone_user_password = val_clone_user.values()
                                            clone_res = True
                                            clone_user_dict = {'login': clone_user_login,
                                                               'displayName': clone_user_name,
                                                               'password': clone_user_password,
                                                               'userType': get_user_type(selected_user),
                                                               'priority': selected_user['priority'],
                                                               'OrganizationId': selected_user['organization_id']
                                                               }
                                            try:
                                                res_clone_user = requests.post(BASE_URL + 'addUser',
                                                                               json=clone_user_dict,
                                                                               headers=HEADER_dict)
                                                if res_clone_user.status_code == 200:
                                                    current_db += 1
                                                    logging.info(f"  {selected_user['name']} ")
                                                    original_groups = get_groups_for_user_from_db_with_org(selected_user)
                                                    original_groups_ids = []
                                                    for or_gr in original_groups:
                                                        original_groups_ids.append(or_gr['id'])
                                                    user_from_server = res_clone_user.text[1:-1]
                                                    clone_dict = {'UserIds': [user_from_server],
                                                                  'addGroupIds': original_groups_ids,
                                                                  'removeGroupIds': []}
                                                    try:
                                                        res_clone_add_group = requests.post(BASE_URL +
                                                                                            'changeUserGroups',
                                                                                            json=clone_dict,
                                                                                            headers=HEADER_dict)
                                                        if res_clone_add_group.status_code == 200:
                                                            current_db += 1
                                                            logging.info(f'  {clone_user_login} ')
                                                            result = change_all_roles(user_from_server,
                                                                                                  selected_user)
                                                            if result:
                                                                current_db += 1
                                                                logging.info(
                                                                    f" {clone_user_login} "
                                                                    f' ')
                                                            else:
                                                                logging.error(
                                                                    f"    "
                                                                    f" {clone_user_login}")
                                                            if selected_user['fix_device']:
                                                                try:
                                                                    res_clone_fix_new_dev = requests.post(BASE_URL +
                                                                                                        'allowNewDevice',
                                                                                                        json={'UserId':
                                                                                                                  user_from_server},
                                                                                                        headers=HEADER_dict)
                                                                    if res_clone_fix_new_dev.status_code == 200:
                                                                        # modify_success = True
                                                                        current_db += 1
                                                                        # my_popup('    ')
                                                                        logging.info(
                                                                            f" {clone_user_login} "
                                                                            f'   ')
                                                                    else:
                                                                        my_popup(' ')
                                                                        logging.error(
                                                                            f"      "
                                                                            f" {clone_user_login}")
                                                                except Exception as e:
                                                                    print(f'    - {e}')
                                                                    logging.error("   ")
                                                            update_users_and_groups()

                                                            if clone_res:
                                                                my_popup(" !")
                                                            else:
                                                                my_popup("   !")
                                                            window_clone_user.close()
                                                            # break
                                                        else:
                                                            logging.error(f'   {clone_user_login} '
                                                                          f'  - {res_clone_add_group.status_code}')
                                                            my_popup("   ")
                                                    except Exception as e:
                                                        print(f'     - {e}')
                                                        logging.error("    ")
                                                else:
                                                    logging.error(f'  {clone_user_login}  ')
                                                    my_popup("  !")
                                            except Exception as e:
                                                print(f'    - {e}')
                                                logging.error("   ")
                            additional_window = False
                        if event == '-BlockUser-':
                            additional_window = True
                            if not values['-users-tree-']:
                                print(f"  ")
                                my_popup('  ')
                            else:
                                is_org = check_org(values['-users-tree-'][0])
                                if filter_status:
                                    # noinspection PyUnboundLocalVariable
                                    selected_user = filtered_users_list_of_dict[values['-users-'][0]]
                                else:
                                    if not is_org:
                                        selected_user_id = str(values['-users-tree-'][0]).partition('.')[0]
                                        print(selected_user_id)
                                        for user in users_from_db:
                                            if user['id'] == selected_user_id:
                                                selected_user = copy.deepcopy(user)
                                                print(selected_user)
                                                break
                                    else:
                                        org_id = values['-users-tree-'][0]
                                if not is_org:
                                    block_status = get_block_status(selected_user)
                                    print(block_status)
                                    if block_status is not None:
                                        if not block_status:
                                            confirm_text = ' ,     '
                                        else:
                                            confirm_text = ' ,     '
                                        window_block_user = make_confirm_window(confirm_text +
                                                                                selected_user['name']
                                                                                + '?')
                                        while True:
                                            ev_block_user, val_block_user = window_block_user.Read()
                                            if ev_block_user == sg.WIN_CLOSED or ev_block_user == 'Exit':
                                                break
                                            if ev_block_user == 'noExit':
                                                window_block_user.close()
                                                break
                                            if ev_block_user == 'okExit':
                                                try:
                                                    res_block = block_user(not block_status,
                                                                           selected_user['id'])
                                                    if res_block:
                                                        if res_block.status_code == 200:
                                                            current_db += 1
                                                            if not block_status:
                                                                logging.info(f" "
                                                                             f"{selected_user['name']}"
                                                                             f' ')
                                                            else:
                                                                logging.info(f" "
                                                                             f"{selected_user['name']}"
                                                                             f' ')
                                                        else:
                                                            if not block_status:
                                                                logging.error(
                                                                    f'    - '
                                                                    f'{res_block.status_code}')
                                                            else:
                                                                logging.error(
                                                                    f'    - '
                                                                    f'{res_block.status_code}')
                                                    update_users()
                                                    if block_status:
                                                        my_popup(" !")
                                                    else:
                                                        my_popup(" !")
                                                    window_block_user.close()
                                                except Exception as e:
                                                    print(f'    - {e}')
                                                    logging.error("   ")
                            additional_window = False
                        if event == '-BlockGroup-':
                            additional_window = True
                            if not values['-groups2-']:
                                my_popup('  ')
                            else:
                                groups_from_db = get_groups_from_db()
                                if filter_status_group:
                                    group_to_change = filtered_groups_list_of_dict[values['-groups2-'][0]]
                                else:
                                    group_to_change = groups_from_db[values['-groups2-'][0]]
                                block_status = get_block_status_group(group_to_change)
                                print(block_status)
                                if block_status is not None:
                                    if not block_status:
                                        confirm_text = ' ,     '
                                    else:
                                        confirm_text = ' ,     '
                                    window_block_group = make_confirm_window(confirm_text +
                                                                             group_to_change['name']
                                                                             + '?')
                                    while True:
                                        ev_block_group, val_block_group = window_block_group.Read()
                                        if ev_block_group == sg.WIN_CLOSED or ev_block_group == 'Exit':
                                            break
                                        if ev_block_group == 'noExit':
                                            window_block_group.close()
                                            break
                                        if ev_block_group == 'okExit':
                                            try:
                                                res_block = block_group(not block_status,
                                                                        group_to_change['id'])
                                                if res_block:
                                                    if res_block.status_code == 200:
                                                        current_db += 1
                                                        if not block_status:
                                                            logging.info(f" "
                                                                         f"{group_to_change['name']}"
                                                                         f' ')
                                                        else:
                                                            logging.info(f" "
                                                                         f"{group_to_change['name']}"
                                                                         f' ')
                                                    else:
                                                        if not block_status:
                                                            logging.error(
                                                                f'    - '
                                                                f'{res_block.status_code}')
                                                        else:
                                                            logging.error(
                                                                f'    - '
                                                                f'{res_block.status_code}')
                                                window_block_group.close()
                                                update_groups()
                                                if block_status:
                                                    my_popup(" !")
                                                else:
                                                    my_popup(" !")
                                            except Exception as e:
                                                print(f'    - {e}')
                                                logging.error("   ")
                            additional_window = False
                        if event == '-filterUser-':
                            filter_status = True
                            if values['-filterUser-']:
                                window['-ClearFilterUser-'].update(disabled=False)
                                window['-filterUser-'].update(background_color='lightblue')
                                search_str = values['-filterUser-']
                                filtered_users = filter(lambda x: search_str.lower() in x['login'].lower() or
                                                                  search_str.lower() in x['name'].lower(),
                                                        users_from_db)
                                filtered_users_list_of_dict = list(filtered_users)
                                filtered_users_list, treedata2 = get_user_list(filtered_users_list_of_dict)
                                window['-users-'].update(filtered_users_list)
                                window['-TREE2-'].update(treedata2)
                                if not filtered_users_list:
                                    window['-filterUser-'].update(background_color=button_color_2)
                            else:
                                window['-filterUser-'].update(background_color=omega_theme['INPUT'])
                                user_list_after_filter_null, treedata2 = get_user_list(users_from_db)
                                window['-users-'].update(user_list_after_filter_null)
                                window['-TREE2-'].update(treedata2)
                                window['-ClearFilterUser-'].update(disabled=True)
                                filter_status = False
                        if event == '-ClearFilterUser-':
                            window['-filterUser-'].update('')
                            window['-filterUser-'].update(background_color=omega_theme['INPUT'])
                            user_list_after_filter_null, treedata2 = get_user_list(users_from_db)
                            window['-users-'].update(user_list_after_filter_null)
                            window['-TREE2-'].update(treedata2)
                            window.Element('-filterUser-').SetFocus()
                            window['-ClearFilterUser-'].update(disabled=True)
                            filter_status = False
                        if event == '-filterGroup-':
                            filter_status_group = True
                            if values['-filterGroup-']:
                                window['-ClearFilterGroup-'].update(disabled=False)
                                window['-filterGroup-'].update(background_color='lightblue')
                                search_str = values['-filterGroup-']
                                filtered_groups = filter(lambda x: search_str.lower() in x['name'].lower() or
                                                                   search_str.lower() in x['desc'].lower(),
                                                         groups_from_db)
                                filtered_groups_list_of_dict = list(filtered_groups)
                                filtered_groups_list, treedata = get_group_list(filtered_groups_list_of_dict)
                                window['-groups2-'].update(filtered_groups_list)
                                window['-TREE-'].update(treedata)
                                if not filtered_groups_list:
                                    window['-filterGroup-'].update(background_color=button_color_2)
                            else:
                                window['-filterGroup-'].update(background_color=omega_theme['INPUT'])
                                group_list_after_filter_null, treedata = get_group_list(groups_from_db)
                                window['-groups2-'].update(group_list_after_filter_null)
                                window['-TREE-'].update(treedata)
                                window['-ClearFilterGroup-'].update(disabled=True)
                                filter_status_group = False
                        if event == '-ClearFilterGroup-':
                            window['-filterGroup-'].update('')
                            window['-filterGroup-'].update(background_color=omega_theme['INPUT'])
                            group_list_after_filter_null, treedata = get_group_list(groups_from_db)
                            window['-groups2-'].update(group_list_after_filter_null)
                            window['-TREE-'].update(treedata)
                            window.Element('-filterGroup-').SetFocus()
                            window['-ClearFilterGroup-'].update(disabled=True)
                            filter_status_group = False
                        if event == '-filterJournal-':
                            filter_status_journal = True
                            output_text = get_logs()
                            if values['-filterJournal-']:
                                window['-ClearFilterJournal-'].update(disabled=False)
                                window['-filterJournal-'].update(background_color='lightblue')
                                if not output_text[1]:
                                    window['-filterJournal-'].update(background_color=button_color_2)
                            else:
                                window['-filterJournal-'].update(background_color=omega_theme['INPUT'])
                                filter_status_journal = False
                                window['-ClearFilterJournal-'].update(disabled=True)
                            window['journal'].update(output_text[0])
                            count_string = str(output_text[1]) + '  ' + str(output_text[2])
                            window['countLogs'].update(count_string)
                            window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == '-ClearFilterJournal-':
                            window['-filterJournal-'].update('')
                            window['-filterJournal-'].update(background_color=omega_theme['INPUT'])
                            window.Element('-filterJournal-').SetFocus()
                            window['-ClearFilterJournal-'].update(disabled=True)
                            filter_status_journal = False
                            output_text = get_logs()
                            window['journal'].update(output_text[0])
                            count_string = str(output_text[1]) + '  ' + str(output_text[2])
                            window['countLogs'].update(count_string)
                            window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == '-SaveLog-':
                            print(f'   ')
                            try:
                                today = date.today()
                                today_format = today.strftime("%d-%m-%Y")
                                now = datetime.now()
                                current_time = now.strftime("%H-%M-%S")
                                print(current_time)
                                log_filename = 'log_' + today_format + '_' + current_time + '.txt'
                                print(log_filename)
                                full_log_path = Path(Path.cwd(), 'logs', log_filename)
                                os.makedirs('logs', exist_ok=True)
                                # noinspection PyUnboundLocalVariable
                                if output_text[0]:
                                    with open(full_log_path, 'w', encoding='cp1251') as log:
                                        log.write(output_text[0])
                                    my_popup(f' {full_log_path} ')
                                else:
                                    my_popup(' !')
                            except IOError as e:
                                print(f'    . {e}')
                                logging.error(f'    . {e}')
                        if event == 'Tabs_journal':
                            if values['Tabs_journal'] == 'Tab1_journal':
                                output_text = get_logs()
                                window['journal'].update(output_text[0])
                                count_string = str(output_text[1]) + '  ' + str(output_text[2])
                                window['countLogs'].update(count_string)
                                window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                            elif values['Tabs_journal'] == 'Tab2_journal':
                                if not got_server_log:
                                    output_text_server = get_logs_server()
                                    if output_text_server == ['', 0, 0]:
                                        continue
                                    window['journalServer'].update(output_text_server[0])
                                    count_string = str(output_text_server[1]) + '  ' + str(output_text_server[2])
                                    window['countLogsServer'].update(count_string)
                                    window['rowLimitServer'].update(' ' + str(LOG_DEPTH) + ' ')
                                    if output_text_server[2] == 0:
                                        window['-filterJournalServer-'].update(disabled=True)
                                        window['-ClearFilterJournalServer-'].update(disabled=True)
                                        window['-SaveLogServer-'].update(disabled=True)
                                        window['info_server'].update(disabled=True)
                                        window['warning_server'].update(disabled=True)
                                        window['fail_server'].update(disabled=True)
                                    else:
                                        window['-filterJournalServer-'].update(disabled=False)
                                        window['-ClearFilterJournalServer-'].update(disabled=False)
                                        window['-SaveLogServer-'].update(disabled=False)
                                        window['info_server'].update(disabled=False)
                                        window['warning_server'].update(disabled=False)
                                        window['fail_server'].update(disabled=False)
                        if event == '-UpdateLogServer-':
                            output_text_server = get_logs_server()
                            if output_text_server[1] == 0:
                                if filter_status_journal_server:
                                    window['-filterJournalServer-'].update(background_color=button_color_2)
                            else:
                                if filter_status_journal_server:
                                    window['-filterJournalServer-'].update(background_color='lightblue')
                            window['journalServer'].update(output_text_server[0])
                            count_string = str(output_text_server[1]) + '  ' + str(output_text_server[2])
                            window['countLogsServer'].update(count_string)
                            window['rowLimitServer'].update(' ' + str(LOG_DEPTH) + ' ')
                            if output_text_server[2] == 0:
                                window['-filterJournalServer-'].update(disabled=True)
                                window['-ClearFilterJournalServer-'].update(disabled=True)
                                window['-SaveLogServer-'].update(disabled=True)
                                window['info_server'].update(disabled=True)
                                window['warning_server'].update(disabled=True)
                                window['fail_server'].update(disabled=True)
                            else:
                                window['-filterJournalServer-'].update(disabled=False)
                                window['-ClearFilterJournalServer-'].update(disabled=False)
                                window['-SaveLogServer-'].update(disabled=False)
                                window['info_server'].update(disabled=False)
                                window['warning_server'].update(disabled=False)
                                window['fail_server'].update(disabled=False)
                        if event == '-filterJournalServer-':
                            filter_status_journal_server = True
                            output_text = filter_logs_server()
                            if values['-filterJournalServer-']:
                                window['-ClearFilterJournalServer-'].update(disabled=False)
                                window['-filterJournalServer-'].update(background_color='lightblue')
                                if not output_text[1]:
                                    window['-filterJournalServer-'].update(background_color=button_color_2)
                            else:
                                window['-filterJournalServer-'].update(background_color=omega_theme['INPUT'])
                                filter_status_journal_server = False
                                window['-ClearFilterJournalServer-'].update(disabled=True)
                            window['journalServer'].update(output_text[0])
                            count_string = str(output_text[1]) + '  ' + str(output_text[2])
                            window['countLogsServer'].update(count_string)
                            window['rowLimitServer'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == '-ClearFilterJournalServer-':
                            window['-filterJournalServer-'].update('')
                            window['-filterJournalServer-'].update(background_color=omega_theme['INPUT'])
                            window.Element('-filterJournalServer-').SetFocus()
                            window['-ClearFilterJournalServer-'].update(disabled=True)
                            filter_status_journal_server = False
                            output_text = filter_logs_server()
                            window['journalServer'].update(output_text[0])
                            count_string = str(output_text[1]) + '  ' + str(output_text[2])
                            window['countLogsServer'].update(count_string)
                            window['rowLimitServer'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == '-SaveLogServer-':
                            print(f'   ')
                            try:
                                today = date.today()
                                today_format = today.strftime("%d-%m-%Y")
                                now = datetime.now()
                                current_time = now.strftime("%H-%M-%S")
                                print(current_time)
                                log_filename = 'log_server_' + today_format + '_' + current_time + '.txt'
                                print(log_filename)
                                full_log_path = Path(Path.cwd(), 'logs', log_filename)
                                os.makedirs('logs', exist_ok=True)
                                # noinspection PyUnboundLocalVariable
                                if output_text_server[0]:
                                    with open(full_log_path, 'w', encoding='utf-8') as log:
                                        log.write(output_text_server[0])
                                    my_popup(f' {full_log_path} ')
                                else:
                                    my_popup(' !')
                            except IOError as e:
                                print(f'    . {e}')
                                logging.error(f'    . {e}')
                        if event == '-AddGroup-':
                            additional_window = True
                            window_add_group = make_add_group_window()
                            window_add_group.Element('GroupName').SetFocus()
                            while True:
                                ev_add_group, val_add_group = window_add_group.Read()
                                print(ev_add_group, val_add_group)
                                if ev_add_group == sg.WIN_CLOSED or ev_add_group == 'Exit':
                                    break
                                elif ev_add_group == 'addGroupButton':
                                    if validate('add_group'):
                                        new_group_name = val_add_group['GroupName']
                                        new_group_desc = val_add_group['description']
                                        new_group_is_emergency = int(val_add_group['emergency'])
                                        new_group_blocked = int(val_add_group['addGroupBlock'])
                                        add_group_dict = {'name': new_group_name,
                                                          'description': new_group_desc,
                                                          'groupType': new_group_is_emergency,
                                                          'OrganizationId': get_id_by_org(val_add_group['GroupAddOrg'])}
                                        try:
                                            res_add_user = requests.post(BASE_URL + 'addGroup',
                                                                         json=add_group_dict, headers=HEADER_dict)
                                            if res_add_user.status_code == 200:
                                                current_db += 1
                                                logging.info(f' {new_group_name} ')
                                                if val_add_group['addGroupBlock']:
                                                    res_block = block_group(new_group_blocked, res_add_user.text[1:-1])
                                                    if res_block:
                                                        if res_block.status_code == 200:
                                                            current_db += 1
                                                            if new_group_blocked:
                                                                logging.info(f" "
                                                                             f"{new_group_name}"
                                                                             f' ')
                                                        else:
                                                            if new_group_blocked:
                                                                logging.error(
                                                                    f'    - '
                                                                    f'{res_block.status_code}')
                                                update_groups()
                                                my_popup(" !")
                                                window_add_group.close()
                                                # break
                                            else:
                                                logging.error(f' {new_group_name}  ')
                                                my_popup("  !")
                                                window_add_group.Element('GroupName').SetFocus()
                                        except Exception as e:
                                            print(f'    - {e}')
                                            logging.error("   ")
                                else:
                                    window_add_group['addGroupButton'].update(disabled=False)
                                    window_add_group['addGroupButton'].update(button_color=button_color_2)
                            additional_window = False
                        if event == '-DelGroup-':
                            additional_window = True
                            if not values['-groups2-']:
                                my_popup('  ')
                            else:
                                if filter_status_group:
                                    del_group = filtered_groups_list_of_dict[values['-groups2-'][0]]
                                else:
                                    del_group = groups_from_db[values['-groups2-'][0]]
                                window_del_group = make_confirm_window(' , '
                                                                       '    ' + del_group[
                                                                           'name'] + '?')
                                while True:
                                    ev_del_group, val_del_group = window_del_group.Read()
                                    if ev_del_group == sg.WIN_CLOSED or ev_del_group == 'Exit':
                                        break
                                    if ev_del_group == 'noExit':
                                        window_del_group.close()
                                        break
                                    if ev_del_group == 'okExit':
                                        try:
                                            res_del_group = requests.post(BASE_URL + 'deleteGroup',
                                                                          json=del_group, headers=HEADER_dict)
                                            if res_del_group.status_code == 200:
                                                current_db += 1
                                                logging.info(f' {del_group["name"]} ')
                                                drop_db('groups')
                                                add_groups(get_groups_from_server())
                                                groups_from_db = get_groups_from_db()
                                                groups_from_db.sort(key=lambda i: i['name'])
                                                treedata_update_group = sg.TreeData()
                                                group_list = list()
                                                for group_from_db in groups_from_db:
                                                    group_list.append([group_from_db['id'], group_from_db['name'],
                                                                       group_from_db['desc']])
                                                    treedata_update_group.insert('', group_from_db['id'], '',
                                                                                 values=[group_from_db['name'],
                                                                                         group_from_db['desc']],
                                                                                 icon=check[0])
                                                del_users_in_groups_after_delete_group(del_group['id'])
                                                if filter_status_group:
                                                    search_str = values['-filterGroup-']
                                                    filtered_groups = filter(
                                                        lambda x: search_str.lower() in x['name'].lower() or
                                                                  search_str.lower() in x['desc'].lower(),
                                                        groups_from_db)
                                                    filtered_groups_list_of_dict = list(filtered_groups)
                                                    filtered_groups_list = list()
                                                    for filtered_group_list_of_dict in filtered_groups_list_of_dict:
                                                        filtered_groups_list.append([filtered_group_list_of_dict['id'],
                                                                                     filtered_group_list_of_dict[
                                                                                         'name'],
                                                                                     filtered_group_list_of_dict[
                                                                                         'desc']])
                                                    if not filtered_groups_list:
                                                        window['-filterGroup-'].update(background_color=button_color_2)
                                                    window['-groups2-'].update(filtered_groups_list)
                                                else:
                                                    window['-groups2-'].update(group_list)
                                                window['-TREE-'].update(treedata_update_group)
                                                window_del_group.close()
                                                my_popup(" !")
                                                break
                                            else:
                                                logging.error(f' {del_group["name"]}   - '
                                                              f'{res_del_group.status_code}')
                                                my_popup("  !")
                                        except Exception as e:
                                            print(f'    - {e}')
                                            logging.error("   ")
                            additional_window = False
                        if event == '-Start-':
                            additional_window = True
                            try:
                                ssh, remotepath = get_ssh_connection()
                                start_command = 'sudo systemctl restart omega'
                                if ip != '127.0.0.1':
                                    ssh, remotepath = get_ssh_connection()
                                    stdin, stdout, stderr = ssh.exec_command(start_command)
                                    stdout = stdout.readlines()
                                    ssh.close()
                                    output = ''
                                    for line in stdout:
                                        output = output + line
                                    print(output)
                                else:
                                    process = subprocess.Popen(start_command, shell=True,
                                                               stdout=subprocess.PIPE,
                                                               stderr=subprocess.PIPE)
                                for i in range(3):
                                    sleep(2)
                                    res_ping = ''
                                    try:
                                        res_ping = requests.get(BASE_URL_PING, timeout=1)
                                    except Exception as e:
                                        print(f"  , {e}")
                                    if res_ping == '':
                                        print('  ')
                                        if i == 2:
                                            logging.critical(f'   - {res_ping}')
                                            my_popup("  ")
                                    else:
                                        if res_ping.status_code == 200:
                                            logging.info(f'  ')
                                            print(f'{res_ping.text}')
                                            dict_online_after_start = json.loads(res_ping.text)
                                            update_text = (': ...' + ', : ' +
                                                           str(dict_online_after_start["databaseVersion"]) +
                                                           (', ' if dict_online_after_start["isReserved"]
                                                            else ', '))
                                            update_text2 = update_free_space(server_status)
                                            server_status['online'] = dict_online_after_start["onlineUsersCount"]
                                            server_status['db'] = dict_online_after_start["databaseVersion"]
                                            window['-StatusBar-'].update(update_text,
                                                                         background_color=(button_color_2 if
                                                                                           dict_online_after_start[
                                                                                               "isReserved"] else status_bar_color))
                                            window['-StatusBar2-'].update(update_text2)
                                            window['-Start-'].update(disabled=True)
                                            window['-Stop-'].update(disabled=False)
                                            TOKEN = get_token(BASE_URL_AUTH)
                                            HEADER_dict = {"Authorization": "Bearer " + TOKEN}
                                            if TOKEN:
                                                server_status['run'] = True
                                                print(server_status)
                                                update_users_and_groups()
                                                window['-Menu-'].update([
                                                    ['',
                                                     [' ...', '', '', '',
                                                      '', ' ',
                                                      ['', '']]],
                                                    ['', ' '], ])
                                                update_text = (': ' + str(server_status["online"]) + ', : '
                                                               + str(server_status["db"]) +
                                                               (', ' if server_status["isReserved"]
                                                                else ', '))
                                                update_text2 = update_free_space(server_status)
                                                window['-StatusBar-'].update(update_text,
                                                                             background_color=(button_color_2 if
                                                                                               server_status[
                                                                                                   "isReserved"] else status_bar_color))
                                                window['-StatusBar2-'].update(update_text2)
                                                set_buttons_disabled(False)
                                                server_status['run'] = True
                                                update_free_space(dict_online_after_start)
                                                window['online-users'].update(
                                                    get_online_users(dict_online_after_start['onlineUserIds']))
                                                set_lic_status_bar()
                                                break
                                            else:
                                                break_flag2 = True
                                                break_flag = True
                                                break
                            except Exception as e:
                                print(f'{e}')
                                logging.error('   ')
                                my_popup('   ')
                            additional_window = False
                        if event == '-Stop-':
                            additional_window = True
                            res = ''
                            # noinspection PyBroadException
                            try:
                                res = requests.get(BASE_URL + 'stopServer', headers=HEADER_dict)
                            except Exception as e:
                                print(" ")
                                logging.warning(f"     ")
                            if res:
                                if res.status_code == 200:
                                    print(" ")
                                    logging.warning(f"   - {res.status_code}")
                                else:
                                    print(f"    - {res.status_code}")
                                    logging.warning(f"    - {res.status_code}")
                            num = 0
                            hard_stop = False
                            f_br = False
                            while True:
                                sleep(1)
                                res_ping = False
                                try:
                                    res_ping = requests.get(BASE_URL_PING, timeout=1)
                                except Exception as e:
                                    print(f"  , {e}")
                                if res_ping:
                                    print('  ')
                                    logging.warning(f'   ')
                                    if num == 10:
                                        my_popup('  ')  # TODO
                                        if not hard_stop:
                                            window_confirm = make_confirm_window('   ?')
                                            while True:
                                                ev_confirm, val_confirm = window_confirm.Read()
                                                if ev_confirm == 'okExit':
                                                    stop_command = 'sudo systemctl stop omega'
                                                    if ip == '127.0.0.1':
                                                        process = subprocess.Popen(stop_command, shell=True,
                                                                                   stdout=subprocess.PIPE,
                                                                                   stderr=subprocess.PIPE)
                                                    else:
                                                        ssh, remotepath = get_ssh_connection()
                                                        stop_command = 'sudo systemctl stop omega'
                                                        stdin, stdout, stderr = ssh.exec_command(stop_command)
                                                        stdout = stdout.readlines()
                                                        ssh.close()
                                                        output = ''
                                                        for line in stdout:
                                                            output = output + line
                                                        print(output)
                                                    num = 0
                                                    window_confirm.close()
                                                    hard_stop = True
                                                    break
                                                if ev_confirm == sg.WIN_CLOSED or ev_confirm == 'Exit':
                                                    f_br = True
                                                    break
                                                if ev_confirm == 'noExit':
                                                    window_confirm.close()
                                                    f_br = True
                                                    break
                                        else:
                                            break
                                    if f_br:
                                        break
                                    num += 1
                                else:
                                    logging.warning(f'  ')
                                    my_popup(' ')
                                    window['-StatusBar-'].update('  ', background_color=button_color_2)
                                    window['-StatusBar2-'].update('', background_color=button_color_2)
                                    window['-StatusBar3-'].update('', background_color=button_color_2)
                                    window['-Start-'].update(disabled=False)
                                    window['-Stop-'].update(disabled=True)
                                    # window['-users-'].update([[]])
                                    window['-users-tree-'].update(visible=False)
                                    window['-groups2-'].update([[]])
                                    clear_treedata = sg.TreeData()
                                    window['-TREE-'].update(clear_treedata)
                                    window['-TREE2-'].update(clear_treedata)
                                    set_buttons_disabled()
                                    window['Apply'].update(disabled=True)
                                    window['Apply2'].update(disabled=True)
                                    window['-Menu-'].update([
                                        ['',
                                         [' ...', '!', '', '',
                                          '', ' ',
                                          ['', '']]],
                                        ['', ' '], ])
                                    server_status['run'] = False
                                    update_free_space({'freeSpace': 0, 'spaceTotal': 1})
                                    window['online-users'].update('')
                                    break
                            additional_window = False
                        if event == 'Tabs':
                            if values['Tabs'] == 'Tab3':
                                output_text = get_logs()
                                window['journal'].update(output_text[0])
                                count_string = str(output_text[1]) + '  ' + str(output_text[2])
                                window['countLogs'].update(count_string)
                                window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == 'info':
                            if filter_journal_info:
                                filter_journal_info = False
                            else:
                                filter_journal_info = True
                            output_text = get_logs()
                            window['journal'].update(output_text[0])
                            count_string = str(output_text[1]) + '  ' + str(output_text[2])
                            window['countLogs'].update(count_string)
                            window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == 'warning':
                            if filter_journal_warning:
                                filter_journal_warning = False
                            else:
                                filter_journal_warning = True
                            output_text = get_logs()
                            window['journal'].update(output_text[0])
                            count_string = str(output_text[1]) + '  ' + str(output_text[2])
                            window['countLogs'].update(count_string)
                            window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == 'error':
                            if filter_journal_error:
                                filter_journal_error = False
                            else:
                                filter_journal_error = True
                            output_text = get_logs()
                            window['journal'].update(output_text[0])
                            count_string = str(output_text[1]) + '  ' + str(output_text[2])
                            window['countLogs'].update(count_string)
                            window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == 'critical':
                            if filter_journal_critical:
                                filter_journal_critical = False
                            else:
                                filter_journal_critical = True
                            output_text = get_logs()
                            window['journal'].update(output_text[0])
                            count_string = str(output_text[1]) + '  ' + str(output_text[2])
                            window['countLogs'].update(count_string)
                            window['rowLimit'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == 'info_server':
                            if filter_journal_info_server:
                                filter_journal_info_server = False
                            else:
                                filter_journal_info_server = True
                            output_text_server = filter_logs_server()
                            window['journalServer'].update(output_text_server[0])
                            count_string = str(output_text_server[1]) + '  ' + str(output_text_server[2])
                            window['countLogsServer'].update(count_string)
                            window['rowLimitServer'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == 'warning_server':
                            if filter_journal_warn_server:
                                filter_journal_warn_server = False
                            else:
                                filter_journal_warn_server = True
                            output_text_server = filter_logs_server()
                            window['journalServer'].update(output_text_server[0])
                            count_string = str(output_text_server[1]) + '  ' + str(output_text_server[2])
                            window['countLogsServer'].update(count_string)
                            window['rowLimitServer'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == 'fail_server':
                            if filter_journal_fail_server:
                                filter_journal_fail_server = False
                            else:
                                filter_journal_fail_server = True
                            output_text_server = filter_logs_server()
                            window['journalServer'].update(output_text_server[0])
                            count_string = str(output_text_server[1]) + '  ' + str(output_text_server[2])
                            window['countLogsServer'].update(count_string)
                            window['rowLimitServer'].update(' ' + str(LOG_DEPTH) + ' ')
                        if event == '-checkAllGroups-':
                            if not values['-users-tree-']:
                                print(f"  ")
                                my_popup('  ')
                                window['-checkAllGroups-'].update(False)
                            else:
                                if filter_status:
                                    # noinspection PyTypeChecker
                                    user_id = filtered_users_list_of_dict[values['-users-'][0]]['id']
                                else:
                                    selected_user_id = str(values['-users-tree-'][0]).partition('.')[0]
                                    # selected_user = get_user_by_id_from_db(selected_user_id)
                                group_list, treedata = get_group_list_with_org(selected_user['organization_id'])
                                tree.update(treedata)
                                all_group_ids = []
                                for group_from_all in group_list:
                                    all_group_ids.append(group_from_all[0])
                                tree.metadata = []
                                if values['-checkAllGroups-']:
                                    for group_id_for_tree in all_group_ids:
                                        tree.metadata.append(group_id_for_tree)
                                        tree.update(key=group_id_for_tree, icon=check[1])
                                else:
                                    for group_id_for_tree in all_group_ids:
                                        tree.update(key=group_id_for_tree, icon=check[0])
                                window['Apply'].update(disabled=False)
                        if event == '-checkAllUsers-':
                            if not values['-groups2-']:
                                my_popup('  ')
                                window['-checkAllUsers-'].update(False)
                            else:
                                if filter_status:
                                    # noinspection PyTypeChecker
                                    group_id = filtered_groups_list_of_dict[values['-groups2-'][0]]['id']
                                else:
                                    group_id = groups_from_db[values['-groups2-'][0]]['id']
                                all_user_ids = []
                                for user_from_all in users_from_db:
                                    all_user_ids.append(user_from_all['id'])
                                tree2.metadata = []
                                if values['-checkAllUsers-']:
                                    for user_id_for_tree in all_user_ids:
                                        tree2.metadata.append(user_id_for_tree)
                                        tree2.update(key=user_id_for_tree, icon=check[1])
                                else:
                                    for user_id_for_tree in all_user_ids:
                                        tree2.update(key=user_id_for_tree, icon=check[0])
                                window['Apply2'].update(disabled=False)
                        if event == '-dropDB-' or event == '':
                            additional_window = True
                            window_confirm = make_confirm_window(' ,        ?')
                            while True:
                                ev_confirm, val_confirm = window_confirm.Read()
                                if ev_confirm == 'okExit':
                                    try:
                                        res_drop_db = requests.get(BASE_URL + 'drop',
                                                                   headers=HEADER_dict)
                                        if res_drop_db.status_code == 200:
                                            logging.info('     ')
                                            logging.info(' ')
                                        else:
                                            logging.info('   !')
                                    except Exception as e:
                                        print(f'    - {e}')
                                        logging.error("   ")
                                    window_confirm.close()
                                if ev_confirm == sg.WIN_CLOSED or ev_confirm == 'Exit':
                                    print('  ')
                                    break
                                if ev_confirm == 'noExit':
                                    print('  ')
                                    window_confirm.close()
                                    break
                            additional_window = False
                        if event == '-partially-dropDB-' or event == '':
                            additional_window = True
                            window_confirm = make_confirm_window(' ,    '
                                                                 ' ,    ?')
                            while True:
                                ev_confirm, val_confirm = window_confirm.Read()
                                if ev_confirm == 'okExit':
                                    try:
                                        res_drop_db = requests.get(BASE_URL + 'partiallyDrop',
                                                                   headers=HEADER_dict)
                                        if res_drop_db.status_code == 200:
                                            current_db += 1
                                            logging.info(' ,    ')
                                            logging.info(' ')
                                            my_popup('  ')
                                        else:
                                            logging.info('   ,    !')
                                    except Exception as e:
                                        print(f'    - {e}')
                                        logging.error("   ")
                                    window_confirm.close()
                                if ev_confirm == sg.WIN_CLOSED or ev_confirm == 'Exit':
                                    print('  ')
                                    break
                                if ev_confirm == 'noExit':
                                    print('  ')
                                    window_confirm.close()
                                    break
                            additional_window = False
    window_login.close()
